<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Mary.Value</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier">AssetName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier">MaryValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier">MultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#insert"><span class="hs-identifier">insert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#insertMultiAsset"><span class="hs-identifier">insertMultiAsset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#lookup"><span class="hs-identifier">lookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#lookupMultiAsset"><span class="hs-identifier">lookupMultiAsset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#multiAssetFromList"><span class="hs-identifier">multiAssetFromList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#policies"><span class="hs-identifier">policies</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#mapMaybeMultiAsset"><span class="hs-identifier">mapMaybeMultiAsset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#filterMultiAsset"><span class="hs-identifier">filterMultiAsset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#pruneZeroMultiAsset"><span class="hs-identifier">pruneZeroMultiAsset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier">representationSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#showValue"><span class="hs-identifier">showValue</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#flattenMultiAsset"><span class="hs-identifier">flattenMultiAsset</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier">valueFromList</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier">CompactForm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier">CompactValue</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#isMultiAssetSmallEnough"><span class="hs-identifier">isMultiAssetSmallEnough</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#assetNameToTextAsHex"><span class="hs-identifier">assetNameToTextAsHex</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Deprecated</span></span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#prune"><span class="hs-identifier">prune</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-crypto-class-2.2.3.1-587788bd0abb83ca86364e7e25fdd2cb1ce3c8f25ede4b71a1cb43e4a1d72f36/share/doc/html/src/Cardano.Crypto.Hash.Class.html"><span class="hs-identifier">Cardano.Crypto.Hash.Class</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Hash</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Inject"><span class="hs-identifier">Inject</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#KeyValuePairs"><span class="hs-identifier">KeyValuePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ToKeyValuePairs"><span class="hs-identifier">ToKeyValuePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.html"><span class="hs-identifier">Cardano.Ledger.Binary</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier">DecCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#Decoder"><span class="hs-identifier">Decoder</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.FromCBOR.html#DecoderError"><span class="hs-identifier">DecoderError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier">EncCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TokenType"><span class="hs-identifier">TokenType</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.FromCBOR.html#cborError"><span class="hs-identifier">cborError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeInteger"><span class="hs-identifier">decodeInteger</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeMap"><span class="hs-identifier">decodeMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeWord64"><span class="hs-identifier">decodeWord64</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#ifDecoderVersionAtLeast"><span class="hs-identifier">ifDecoderVersionAtLeast</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#peekTokenType"><span class="hs-identifier">peekTokenType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Coders.html"><span class="hs-identifier">Cardano.Ledger.Binary.Coders</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#Decode"><span class="hs-identifier">Decode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#Encode"><span class="hs-identifier">Encode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#decode"><span class="hs-identifier">decode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#encode"><span class="hs-identifier">encode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#%21%3E"><span class="hs-operator">(!&gt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#%3C%21"><span class="hs-operator">(&lt;!)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html"><span class="hs-identifier">Cardano.Ledger.Binary.Version</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier">natVersion</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier">CompactForm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#integerToWord64"><span class="hs-identifier">integerToWord64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html"><span class="hs-identifier">Cardano.Ledger.Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#Compactible"><span class="hs-identifier">Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#Val"><span class="hs-identifier">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">deepseq</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">rwhnf</span></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assert</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">guard</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">when</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.ST</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runST</span></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier">FromJSON</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSONKey"><span class="hs-identifier">FromJSONKey</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier">ToJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Aeson</span></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.html"><span class="hs-identifier">Data.Aeson.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSONKey"><span class="hs-identifier">ToJSONKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSONKeyText"><span class="hs-identifier">toJSONKeyText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/base16-bytestring-1.0.2.0-9ee6195db8aa68eff84c30f8281e5a8902536668e00c8d5aecb570a4d535b748/share/doc/html/src/Data.ByteString.Base16.html"><span class="hs-identifier">Data.ByteString.Base16</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS16</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SBS</span></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Short.Internal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ShortByteString</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SBS</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html"><span class="hs-identifier">Data.CanonicalMaps</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMap"><span class="hs-identifier">canonicalMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMapUnion"><span class="hs-identifier">canonicalMapUnion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#pointWise"><span class="hs-identifier">pointWise</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldMap'</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html"><span class="hs-identifier">Data.Group</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#Abelian"><span class="hs-identifier">Abelian</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#Group"><span class="hs-identifier">Group</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Int</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">sortOn</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Internal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">link</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">link2</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assocs</span></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromJust</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html"><span class="hs-identifier">Data.MemPack</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Monoid</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Sum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Sum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getSum</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html"><span class="hs-identifier">Data.Primitive.ByteArray</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BA</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Proxy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Semigroup</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Sum</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">decodeLatin1</span></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word32</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html"><span class="hs-identifier">NoThunks.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier">NoThunks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#OnlyCheckWhnfNamed"><span class="hs-identifier">OnlyCheckWhnfNamed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lookup</span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="annot"><span class="hs-comment">-- | Asset Name</span></span><span>
</span><span id="line-111"></span><span class="hs-keyword">newtype</span><span> </span><span id="AssetName"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AssetName"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span></span><span> </span><span class="hs-special">{</span><span id="assetNameBytes"><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameBytes"><span class="hs-identifier hs-var hs-var">assetNameBytes</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SBS.ShortByteString</span></span><span class="hs-special">}</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679278242"><span id="local-6989586621679278247"><span class="annot"><span class="annottext">AssetName -&gt; AssetName -&gt; Bool
(AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool) -&gt; Eq AssetName
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: AssetName -&gt; AssetName -&gt; Bool
== :: AssetName -&gt; AssetName -&gt; Bool
$c/= :: AssetName -&gt; AssetName -&gt; Bool
/= :: AssetName -&gt; AssetName -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278255"><span id="local-6989586621679278262"><span id="local-6989586621679278268"><span class="annot"><span class="annottext">Typeable AssetName
Typeable AssetName =&gt;
(AssetName -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy AssetName -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [AssetName] -&gt; Size)
-&gt; EncCBOR AssetName
AssetName -&gt; Encoding
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [AssetName] -&gt; Size
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy AssetName -&gt; Size
forall a.
Typeable a =&gt;
(a -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; EncCBOR a
$cencCBOR :: AssetName -&gt; Encoding
encCBOR :: AssetName -&gt; Encoding
$cencodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy AssetName -&gt; Size
encodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy AssetName -&gt; Size
$cencodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [AssetName] -&gt; Size
encodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [AssetName] -&gt; Size
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">EncCBOR</span></a></span></span></span></span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278276"><span id="local-6989586621679278281"><span id="local-6989586621679278285"><span id="local-6989586621679278289"><span id="local-6989586621679278293"><span id="local-6989586621679278297"><span id="local-6989586621679278301"><span class="annot"><span class="annottext">Eq AssetName
Eq AssetName =&gt;
(AssetName -&gt; AssetName -&gt; Ordering)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; Bool)
-&gt; (AssetName -&gt; AssetName -&gt; AssetName)
-&gt; (AssetName -&gt; AssetName -&gt; AssetName)
-&gt; Ord AssetName
AssetName -&gt; AssetName -&gt; Bool
AssetName -&gt; AssetName -&gt; Ordering
AssetName -&gt; AssetName -&gt; AssetName
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: AssetName -&gt; AssetName -&gt; Ordering
compare :: AssetName -&gt; AssetName -&gt; Ordering
$c&lt; :: AssetName -&gt; AssetName -&gt; Bool
&lt; :: AssetName -&gt; AssetName -&gt; Bool
$c&lt;= :: AssetName -&gt; AssetName -&gt; Bool
&lt;= :: AssetName -&gt; AssetName -&gt; Bool
$c&gt; :: AssetName -&gt; AssetName -&gt; Bool
&gt; :: AssetName -&gt; AssetName -&gt; Bool
$c&gt;= :: AssetName -&gt; AssetName -&gt; Bool
&gt;= :: AssetName -&gt; AssetName -&gt; Bool
$cmax :: AssetName -&gt; AssetName -&gt; AssetName
max :: AssetName -&gt; AssetName -&gt; AssetName
$cmin :: AssetName -&gt; AssetName -&gt; AssetName
min :: AssetName -&gt; AssetName -&gt; AssetName
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278306"><span id="local-6989586621679278311"><span id="local-6989586621679278315"><span class="annot"><span class="annottext">Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
Proxy AssetName -&gt; [Char]
(Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy AssetName -&gt; [Char])
-&gt; NoThunks AssetName
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; [Char])
-&gt; NoThunks a
$cnoThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; AssetName -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: Proxy AssetName -&gt; [Char]
showTypeOf :: Proxy AssetName -&gt; [Char]
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278321"><span class="annot"><span class="annottext">AssetName -&gt; ()
(AssetName -&gt; ()) -&gt; NFData AssetName
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: AssetName -&gt; ()
rnf :: AssetName -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278328"><span id="local-6989586621679278332"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621679278337"><span class="annot"><span class="annottext">show :: AssetName -&gt; [Char]
</span><a href="#local-6989586621679278337"><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; [Char])
-&gt; (AssetName -&gt; ByteString) -&gt; AssetName -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameToBytesAsHex"><span class="hs-identifier hs-var">assetNameToBytesAsHex</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#assetNameToBytesAsHex"><span class="hs-identifier hs-type">assetNameToBytesAsHex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BS.ByteString</span></span><span>
</span><span id="line-124"></span><span id="assetNameToBytesAsHex"><span class="annot"><span class="annottext">assetNameToBytesAsHex :: AssetName -&gt; ByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameToBytesAsHex"><span class="hs-identifier hs-var hs-var">assetNameToBytesAsHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/base16-bytestring-1.0.2.0-9ee6195db8aa68eff84c30f8281e5a8902536668e00c8d5aecb570a4d535b748/share/doc/html/src/Data.ByteString.Base16.html#encode"><span class="hs-identifier hs-var">BS16.encode</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (AssetName -&gt; ByteString) -&gt; AssetName -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">SBS.fromShort</span></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; ByteString)
-&gt; (AssetName -&gt; ShortByteString) -&gt; AssetName -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameBytes"><span class="hs-identifier hs-var">assetNameBytes</span></a></span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#assetNameToTextAsHex"><span class="hs-identifier hs-type">assetNameToTextAsHex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-127"></span><span id="assetNameToTextAsHex"><span class="annot"><span class="annottext">assetNameToTextAsHex :: AssetName -&gt; Text
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameToTextAsHex"><span class="hs-identifier hs-var hs-var">assetNameToTextAsHex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><span class="hs-identifier hs-var">decodeLatin1</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Text)
-&gt; (AssetName -&gt; ByteString) -&gt; AssetName -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameToBytesAsHex"><span class="hs-identifier hs-var">assetNameToBytesAsHex</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278347"><span id="local-6989586621679278351"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-130"></span><span>  </span><span id="local-6989586621679278368"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s AssetName
</span><a href="#local-6989586621679278368"><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679278370"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679278370"><span class="hs-identifier hs-var">an</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s ShortByteString
forall s. Decoder s ShortByteString
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><span class="hs-identifier hs-var">SBS.length</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679278370"><span class="hs-identifier hs-var">an</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-keyword">then</span><span>
</span><span id="line-134"></span><span>        </span><span class="annot"><span class="annottext">DecoderError -&gt; Decoder s AssetName
forall (m :: * -&gt; *) e a. (MonadFail m, Buildable e) =&gt; e -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.FromCBOR.html#cborError"><span class="hs-identifier hs-var">cborError</span></a></span><span> </span><span class="annot"><span class="annottext">(DecoderError -&gt; Decoder s AssetName)
-&gt; DecoderError -&gt; Decoder s AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-135"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; DecoderError
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.FromCBOR.html#DecoderErrorCustom"><span class="hs-identifier hs-var">DecoderErrorCustom</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;asset name exceeds 32 bytes:&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; DecoderError) -&gt; Text -&gt; DecoderError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-136"></span><span>            </span><span class="annot"><span class="annottext">AssetName -&gt; Text
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameToTextAsHex"><span class="hs-identifier hs-var">assetNameToTextAsHex</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Text) -&gt; AssetName -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-137"></span><span>              </span><span class="annot"><span class="annottext">ShortByteString -&gt; AssetName
</span><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679278370"><span class="hs-identifier hs-var">an</span></a></span><span>
</span><span id="line-138"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; Decoder s AssetName
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Decoder s AssetName)
-&gt; AssetName -&gt; Decoder s AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; AssetName
</span><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679278370"><span class="hs-identifier hs-var">an</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="annot"><span class="hs-comment">-- | Policy ID</span></span><span>
</span><span id="line-141"></span><span class="hs-keyword">newtype</span><span> </span><span id="PolicyID"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-var">PolicyID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PolicyID"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-var">PolicyID</span></a></span></span><span> </span><span class="hs-special">{</span><span id="policyID"><span class="annot"><span class="annottext">PolicyID -&gt; ScriptHash
</span><a href="Cardano.Ledger.Mary.Value.html#policyID"><span class="hs-identifier hs-var hs-var">policyID</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-keyword">deriving</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679278377"><span id="local-6989586621679278382"><span id="local-6989586621679278386"><span class="annot"><span class="annottext">Int -&gt; PolicyID -&gt; ShowS
[PolicyID] -&gt; ShowS
PolicyID -&gt; [Char]
(Int -&gt; PolicyID -&gt; ShowS)
-&gt; (PolicyID -&gt; [Char]) -&gt; ([PolicyID] -&gt; ShowS) -&gt; Show PolicyID
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; PolicyID -&gt; ShowS
showsPrec :: Int -&gt; PolicyID -&gt; ShowS
$cshow :: PolicyID -&gt; [Char]
show :: PolicyID -&gt; [Char]
$cshowList :: [PolicyID] -&gt; ShowS
showList :: [PolicyID] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278389"><span id="local-6989586621679278394"><span class="annot"><span class="annottext">PolicyID -&gt; PolicyID -&gt; Bool
(PolicyID -&gt; PolicyID -&gt; Bool)
-&gt; (PolicyID -&gt; PolicyID -&gt; Bool) -&gt; Eq PolicyID
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: PolicyID -&gt; PolicyID -&gt; Bool
== :: PolicyID -&gt; PolicyID -&gt; Bool
$c/= :: PolicyID -&gt; PolicyID -&gt; Bool
/= :: PolicyID -&gt; PolicyID -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span>
</span><span id="line-145"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278401"><span id="local-6989586621679278406"><span id="local-6989586621679278410"><span id="local-6989586621679278414"><span id="local-6989586621679278418"><span id="local-6989586621679278422"><span id="local-6989586621679278426"><span class="annot"><span class="annottext">Eq PolicyID
Eq PolicyID =&gt;
(PolicyID -&gt; PolicyID -&gt; Ordering)
-&gt; (PolicyID -&gt; PolicyID -&gt; Bool)
-&gt; (PolicyID -&gt; PolicyID -&gt; Bool)
-&gt; (PolicyID -&gt; PolicyID -&gt; Bool)
-&gt; (PolicyID -&gt; PolicyID -&gt; Bool)
-&gt; (PolicyID -&gt; PolicyID -&gt; PolicyID)
-&gt; (PolicyID -&gt; PolicyID -&gt; PolicyID)
-&gt; Ord PolicyID
PolicyID -&gt; PolicyID -&gt; Bool
PolicyID -&gt; PolicyID -&gt; Ordering
PolicyID -&gt; PolicyID -&gt; PolicyID
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: PolicyID -&gt; PolicyID -&gt; Ordering
compare :: PolicyID -&gt; PolicyID -&gt; Ordering
$c&lt; :: PolicyID -&gt; PolicyID -&gt; Bool
&lt; :: PolicyID -&gt; PolicyID -&gt; Bool
$c&lt;= :: PolicyID -&gt; PolicyID -&gt; Bool
&lt;= :: PolicyID -&gt; PolicyID -&gt; Bool
$c&gt; :: PolicyID -&gt; PolicyID -&gt; Bool
&gt; :: PolicyID -&gt; PolicyID -&gt; Bool
$c&gt;= :: PolicyID -&gt; PolicyID -&gt; Bool
&gt;= :: PolicyID -&gt; PolicyID -&gt; Bool
$cmax :: PolicyID -&gt; PolicyID -&gt; PolicyID
max :: PolicyID -&gt; PolicyID -&gt; PolicyID
$cmin :: PolicyID -&gt; PolicyID -&gt; PolicyID
min :: PolicyID -&gt; PolicyID -&gt; PolicyID
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278430"><span id="local-6989586621679278432"><span class="annot"><span class="annottext">(forall x. PolicyID -&gt; Rep PolicyID x)
-&gt; (forall x. Rep PolicyID x -&gt; PolicyID) -&gt; Generic PolicyID
forall x. Rep PolicyID x -&gt; PolicyID
forall x. PolicyID -&gt; Rep PolicyID x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. PolicyID -&gt; Rep PolicyID x
from :: forall x. PolicyID -&gt; Rep PolicyID x
$cto :: forall x. Rep PolicyID x -&gt; PolicyID
to :: forall x. Rep PolicyID x -&gt; PolicyID
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278436"><span id="local-6989586621679278441"><span id="local-6989586621679278445"><span class="annot"><span class="annottext">Context -&gt; PolicyID -&gt; IO (Maybe ThunkInfo)
Proxy PolicyID -&gt; [Char]
(Context -&gt; PolicyID -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; PolicyID -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy PolicyID -&gt; [Char])
-&gt; NoThunks PolicyID
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; [Char])
-&gt; NoThunks a
$cnoThunks :: Context -&gt; PolicyID -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; PolicyID -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; PolicyID -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; PolicyID -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: Proxy PolicyID -&gt; [Char]
showTypeOf :: Proxy PolicyID -&gt; [Char]
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278450"><span class="annot"><span class="annottext">PolicyID -&gt; ()
(PolicyID -&gt; ()) -&gt; NFData PolicyID
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: PolicyID -&gt; ()
rnf :: PolicyID -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278458"><span id="local-6989586621679278465"><span id="local-6989586621679278471"><span class="annot"><span class="annottext">Typeable PolicyID
Typeable PolicyID =&gt;
(PolicyID -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy PolicyID -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [PolicyID] -&gt; Size)
-&gt; EncCBOR PolicyID
PolicyID -&gt; Encoding
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [PolicyID] -&gt; Size
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy PolicyID -&gt; Size
forall a.
Typeable a =&gt;
(a -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; EncCBOR a
$cencCBOR :: PolicyID -&gt; Encoding
encCBOR :: PolicyID -&gt; Encoding
$cencodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy PolicyID -&gt; Size
encodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy PolicyID -&gt; Size
$cencodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [PolicyID] -&gt; Size
encodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [PolicyID] -&gt; Size
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">EncCBOR</span></a></span></span></span></span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278478"><span id="local-6989586621679278483"><span id="local-6989586621679278487"><span class="annot"><span class="annottext">Typeable PolicyID
Typeable PolicyID =&gt;
(forall s. Decoder s PolicyID)
-&gt; (forall s. Proxy PolicyID -&gt; Decoder s ())
-&gt; (Proxy PolicyID -&gt; Text)
-&gt; DecCBOR PolicyID
Proxy PolicyID -&gt; Text
forall s. Decoder s PolicyID
forall a.
Typeable a =&gt;
(forall s. Decoder s a)
-&gt; (forall s. Proxy a -&gt; Decoder s ())
-&gt; (Proxy a -&gt; Text)
-&gt; DecCBOR a
forall s. Proxy PolicyID -&gt; Decoder s ()
$cdecCBOR :: forall s. Decoder s PolicyID
decCBOR :: forall s. Decoder s PolicyID
$cdropCBOR :: forall s. Proxy PolicyID -&gt; Decoder s ()
dropCBOR :: forall s. Proxy PolicyID -&gt; Decoder s ()
$clabel :: Proxy PolicyID -&gt; Text
label :: Proxy PolicyID -&gt; Text
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">DecCBOR</span></a></span></span></span></span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278492"><span id="local-6989586621679278497"><span id="local-6989586621679278501"><span id="local-6989586621679278505"><span id="local-6989586621679278509"><span class="annot"><span class="annottext">[PolicyID] -&gt; Value
[PolicyID] -&gt; Encoding
PolicyID -&gt; Bool
PolicyID -&gt; Value
PolicyID -&gt; Encoding
(PolicyID -&gt; Value)
-&gt; (PolicyID -&gt; Encoding)
-&gt; ([PolicyID] -&gt; Value)
-&gt; ([PolicyID] -&gt; Encoding)
-&gt; (PolicyID -&gt; Bool)
-&gt; ToJSON PolicyID
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: PolicyID -&gt; Value
toJSON :: PolicyID -&gt; Value
$ctoEncoding :: PolicyID -&gt; Encoding
toEncoding :: PolicyID -&gt; Encoding
$ctoJSONList :: [PolicyID] -&gt; Value
toJSONList :: [PolicyID] -&gt; Value
$ctoEncodingList :: [PolicyID] -&gt; Encoding
toEncodingList :: [PolicyID] -&gt; Encoding
$comitField :: PolicyID -&gt; Bool
omitField :: PolicyID -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278515"><span id="local-6989586621679278520"><span id="local-6989586621679278524"><span class="annot"><span class="annottext">Maybe PolicyID
Value -&gt; Parser [PolicyID]
Value -&gt; Parser PolicyID
(Value -&gt; Parser PolicyID)
-&gt; (Value -&gt; Parser [PolicyID])
-&gt; Maybe PolicyID
-&gt; FromJSON PolicyID
forall a.
(Value -&gt; Parser a)
-&gt; (Value -&gt; Parser [a]) -&gt; Maybe a -&gt; FromJSON a
$cparseJSON :: Value -&gt; Parser PolicyID
parseJSON :: Value -&gt; Parser PolicyID
$cparseJSONList :: Value -&gt; Parser [PolicyID]
parseJSONList :: Value -&gt; Parser [PolicyID]
$comittedField :: Maybe PolicyID
omittedField :: Maybe PolicyID
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278530"><span id="local-6989586621679278535"><span class="annot"><span class="annottext">ToJSONKeyFunction [PolicyID]
ToJSONKeyFunction PolicyID
ToJSONKeyFunction PolicyID
-&gt; ToJSONKeyFunction [PolicyID] -&gt; ToJSONKey PolicyID
forall a.
ToJSONKeyFunction a -&gt; ToJSONKeyFunction [a] -&gt; ToJSONKey a
$ctoJSONKey :: ToJSONKeyFunction PolicyID
toJSONKey :: ToJSONKeyFunction PolicyID
$ctoJSONKeyList :: ToJSONKeyFunction [PolicyID]
toJSONKeyList :: ToJSONKeyFunction [PolicyID]
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSONKey"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">ToJSONKey</span></a></span></span></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278541"><span id="local-6989586621679278546"><span class="annot"><span class="annottext">FromJSONKeyFunction [PolicyID]
FromJSONKeyFunction PolicyID
FromJSONKeyFunction PolicyID
-&gt; FromJSONKeyFunction [PolicyID] -&gt; FromJSONKey PolicyID
forall a.
FromJSONKeyFunction a -&gt; FromJSONKeyFunction [a] -&gt; FromJSONKey a
$cfromJSONKey :: FromJSONKeyFunction PolicyID
fromJSONKey :: FromJSONKeyFunction PolicyID
$cfromJSONKeyList :: FromJSONKeyFunction [PolicyID]
fromJSONKeyList :: FromJSONKeyFunction [PolicyID]
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.FromJSON.html#FromJSONKey"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSONKey</span></a></span></span></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span class="annot"><span class="hs-comment">-- | The MultiAssets map</span></span><span>
</span><span id="line-158"></span><span class="hs-keyword">newtype</span><span> </span><span id="MultiAsset"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MultiAsset"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679278553"><span id="local-6989586621679278560"><span id="local-6989586621679278564"><span class="annot"><span class="annottext">Int -&gt; MultiAsset -&gt; ShowS
[MultiAsset] -&gt; ShowS
MultiAsset -&gt; [Char]
(Int -&gt; MultiAsset -&gt; ShowS)
-&gt; (MultiAsset -&gt; [Char])
-&gt; ([MultiAsset] -&gt; ShowS)
-&gt; Show MultiAsset
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MultiAsset -&gt; ShowS
showsPrec :: Int -&gt; MultiAsset -&gt; ShowS
$cshow :: MultiAsset -&gt; [Char]
show :: MultiAsset -&gt; [Char]
$cshowList :: [MultiAsset] -&gt; ShowS
showList :: [MultiAsset] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278567"><span id="local-6989586621679278569"><span class="annot"><span class="annottext">(forall x. MultiAsset -&gt; Rep MultiAsset x)
-&gt; (forall x. Rep MultiAsset x -&gt; MultiAsset) -&gt; Generic MultiAsset
forall x. Rep MultiAsset x -&gt; MultiAsset
forall x. MultiAsset -&gt; Rep MultiAsset x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. MultiAsset -&gt; Rep MultiAsset x
from :: forall x. MultiAsset -&gt; Rep MultiAsset x
$cto :: forall x. Rep MultiAsset x -&gt; MultiAsset
to :: forall x. Rep MultiAsset x -&gt; MultiAsset
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278572"><span id="local-6989586621679278579"><span id="local-6989586621679278585"><span id="local-6989586621679278591"><span id="local-6989586621679278597"><span class="annot"><span class="annottext">[MultiAsset] -&gt; Value
[MultiAsset] -&gt; Encoding
MultiAsset -&gt; Bool
MultiAsset -&gt; Value
MultiAsset -&gt; Encoding
(MultiAsset -&gt; Value)
-&gt; (MultiAsset -&gt; Encoding)
-&gt; ([MultiAsset] -&gt; Value)
-&gt; ([MultiAsset] -&gt; Encoding)
-&gt; (MultiAsset -&gt; Bool)
-&gt; ToJSON MultiAsset
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: MultiAsset -&gt; Value
toJSON :: MultiAsset -&gt; Value
$ctoEncoding :: MultiAsset -&gt; Encoding
toEncoding :: MultiAsset -&gt; Encoding
$ctoJSONList :: [MultiAsset] -&gt; Value
toJSONList :: [MultiAsset] -&gt; Value
$ctoEncodingList :: [MultiAsset] -&gt; Encoding
toEncodingList :: [MultiAsset] -&gt; Encoding
$comitField :: MultiAsset -&gt; Bool
omitField :: MultiAsset -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278618"><span id="local-6989586621679278627"><span id="local-6989586621679278635"><span class="annot"><span class="annottext">Typeable MultiAsset
Typeable MultiAsset =&gt;
(MultiAsset -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy MultiAsset -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [MultiAsset] -&gt; Size)
-&gt; EncCBOR MultiAsset
MultiAsset -&gt; Encoding
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [MultiAsset] -&gt; Size
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy MultiAsset -&gt; Size
forall a.
Typeable a =&gt;
(a -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; EncCBOR a
$cencCBOR :: MultiAsset -&gt; Encoding
encCBOR :: MultiAsset -&gt; Encoding
$cencodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy MultiAsset -&gt; Size
encodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy MultiAsset -&gt; Size
$cencodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [MultiAsset] -&gt; Size
encodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [MultiAsset] -&gt; Size
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">EncCBOR</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278650"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679278661"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278661"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679278662"><span class="annot"><span class="annottext">== :: MultiAsset -&gt; MultiAsset -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679278663"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278663"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer -&gt; Bool)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Bool
forall k v.
(Ord k, CanonicalZero v) =&gt;
(v -&gt; v -&gt; Bool) -&gt; Map k v -&gt; Map k v -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#pointWise"><span class="hs-identifier hs-var">pointWise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer -&gt; Bool
forall k v.
(Ord k, CanonicalZero v) =&gt;
(v -&gt; v -&gt; Bool) -&gt; Map k v -&gt; Map k v -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#pointWise"><span class="hs-identifier hs-var">pointWise</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278661"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278663"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>  </span><span id="local-6989586621679278673"><span class="annot"><span class="annottext">rnf :: MultiAsset -&gt; ()
</span><a href="#local-6989586621679278673"><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679278675"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278675"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278675"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278677"><span id="local-6989586621679278681"><span id="local-6989586621679278687"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-type">NoThunks</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span></span></span></span><span>
</span><span id="line-168"></span><span>
</span><span id="line-169"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278716"><span id="local-6989586621679278720"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679278731"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278731"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679278732"><span class="annot"><span class="annottext">&lt;&gt; :: MultiAsset -&gt; MultiAsset -&gt; MultiAsset
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679278733"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278733"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer
 -&gt; Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMapUnion"><span class="hs-identifier hs-var">canonicalMapUnion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer)
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMapUnion"><span class="hs-identifier hs-var">canonicalMapUnion</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278731"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278733"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278739"><span id="local-6989586621679278742"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-174"></span><span>  </span><span id="local-6989586621679278747"><span class="annot"><span class="annottext">mempty :: MultiAsset
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278752"><span id="local-6989586621679278756"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#Group"><span class="hs-identifier hs-type">Group</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-177"></span><span>  </span><span id="local-6989586621679278769"><span class="annot"><span class="annottext">invert :: MultiAsset -&gt; MultiAsset
</span><a href="#local-6989586621679278769"><span class="hs-identifier hs-var hs-var hs-var hs-var">invert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679278771"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278771"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMap"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMap"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679278771"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278777"><span id="local-6989586621679278781"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-181"></span><span>  </span><span id="local-6989586621679278783"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s MultiAsset
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall t. Decoder t Integer) -&gt; Decoder s MultiAsset
forall s. (forall t. Decoder t Integer) -&gt; Decoder s MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAsset"><span class="hs-identifier hs-var">decodeMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder t Integer
forall t. Decoder t Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeIntegerBounded64"><span class="hs-identifier hs-var">decodeIntegerBounded64</span></a></span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><span class="hs-comment">-- | The Value representing MultiAssets</span></span><span>
</span><span id="line-184"></span><span class="hs-keyword">data</span><span> </span><span id="MaryValue"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MaryValue"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679278788"><span id="local-6989586621679278793"><span id="local-6989586621679278797"><span class="annot"><span class="annottext">Int -&gt; MaryValue -&gt; ShowS
[MaryValue] -&gt; ShowS
MaryValue -&gt; [Char]
(Int -&gt; MaryValue -&gt; ShowS)
-&gt; (MaryValue -&gt; [Char])
-&gt; ([MaryValue] -&gt; ShowS)
-&gt; Show MaryValue
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; MaryValue -&gt; ShowS
showsPrec :: Int -&gt; MaryValue -&gt; ShowS
$cshow :: MaryValue -&gt; [Char]
show :: MaryValue -&gt; [Char]
$cshowList :: [MaryValue] -&gt; ShowS
showList :: [MaryValue] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679278800"><span id="local-6989586621679278802"><span class="annot"><span class="annottext">(forall x. MaryValue -&gt; Rep MaryValue x)
-&gt; (forall x. Rep MaryValue x -&gt; MaryValue) -&gt; Generic MaryValue
forall x. Rep MaryValue x -&gt; MaryValue
forall x. MaryValue -&gt; Rep MaryValue x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. MaryValue -&gt; Rep MaryValue x
from :: forall x. MaryValue -&gt; Rep MaryValue x
$cto :: forall x. Rep MaryValue x -&gt; MaryValue
to :: forall x. Rep MaryValue x -&gt; MaryValue
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679278805"><span id="local-6989586621679278811"><span id="local-6989586621679278816"><span id="local-6989586621679278821"><span id="local-6989586621679278826"><span class="annot"><span class="annottext">[MaryValue] -&gt; Value
[MaryValue] -&gt; Encoding
MaryValue -&gt; Bool
MaryValue -&gt; Value
MaryValue -&gt; Encoding
(MaryValue -&gt; Value)
-&gt; (MaryValue -&gt; Encoding)
-&gt; ([MaryValue] -&gt; Value)
-&gt; ([MaryValue] -&gt; Encoding)
-&gt; (MaryValue -&gt; Bool)
-&gt; ToJSON MaryValue
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: MaryValue -&gt; Value
toJSON :: MaryValue -&gt; Value
$ctoEncoding :: MaryValue -&gt; Encoding
toEncoding :: MaryValue -&gt; Encoding
$ctoJSONList :: [MaryValue] -&gt; Value
toJSONList :: [MaryValue] -&gt; Value
$ctoEncodingList :: [MaryValue] -&gt; Encoding
toEncodingList :: [MaryValue] -&gt; Encoding
$comitField :: MaryValue -&gt; Bool
omitField :: MaryValue -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#KeyValuePairs"><span class="hs-identifier hs-type">KeyValuePairs</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278834"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621679278840"><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679278840"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679278841"><span class="annot"><span class="annottext">== :: MaryValue -&gt; MaryValue -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621679278842"><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679278842"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool) -&gt; MaryValue -&gt; MaryValue -&gt; Bool
forall t. Val t =&gt; (Integer -&gt; Integer -&gt; Bool) -&gt; t -&gt; t -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#pointwise"><span class="hs-identifier hs-var">pointwise</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679278840"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679278842"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621679278849"><span class="annot"><span class="annottext">rnf :: MaryValue -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679278850"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278850"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679278851"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278851"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278850"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; () -&gt; ()
forall a b. NFData a =&gt; a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`deepseq`</span></span><span> </span><span class="annot"><span class="annottext">MultiAsset -&gt; ()
forall a. NFData a =&gt; a -&gt; ()
</span><span class="hs-identifier hs-var">rnf</span></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278851"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278853"><span id="local-6989586621679278857"><span id="local-6989586621679278863"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-type">NoThunks</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span></span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278886"><span id="local-6989586621679278890"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679278897"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278897"><span class="hs-identifier hs-var">c1</span></a></span></span><span> </span><span id="local-6989586621679278898"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278898"><span class="hs-identifier hs-var">m1</span></a></span></span><span> </span><span id="local-6989586621679278899"><span class="annot"><span class="annottext">&lt;&gt; :: MaryValue -&gt; MaryValue -&gt; MaryValue
</span><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679278900"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278900"><span class="hs-identifier hs-var">c2</span></a></span></span><span> </span><span id="local-6989586621679278901"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278901"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278897"><span class="hs-identifier hs-var">c1</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278900"><span class="hs-identifier hs-var">c2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278898"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset -&gt; MultiAsset -&gt; MultiAsset
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278901"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278906"><span id="local-6989586621679278910"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-201"></span><span>  </span><span id="local-6989586621679278915"><span class="annot"><span class="annottext">mempty :: MaryValue
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">MultiAsset
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278920"><span id="local-6989586621679278924"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#Group"><span class="hs-identifier hs-type">Group</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621679278931"><span class="annot"><span class="annottext">invert :: MaryValue -&gt; MaryValue
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#invert"><span class="hs-identifier hs-var hs-var hs-var hs-var">invert</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679278932"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278932"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679278933"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278933"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Coin
forall m. Group m =&gt; m -&gt; m
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#invert"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278932"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiAsset -&gt; MultiAsset
forall m. Group m =&gt; m -&gt; m
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#invert"><span class="hs-identifier hs-var">invert</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679278933"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/groups-0.5.3-9a9bbeb34e11b6941d1c31115962af9b6cfe665bc5b63c17e53cdcd6264ee49d/share/doc/html/src/Data.Group.html#Abelian"><span class="hs-identifier hs-type">Abelian</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Inject"><span class="hs-identifier hs-type">Inject</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-212"></span><span>  </span><span id="local-6989586621679278941"><span class="annot"><span class="annottext">inject :: Coin -&gt; MaryValue
</span><a href="#local-6989586621679278941"><span class="hs-identifier hs-var hs-var hs-var hs-var">inject</span></a></span></span><span> </span><span id="local-6989586621679278943"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278943"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679278943"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span class="hs-comment">-- ===================================================</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- Make the Val instance of MaryValue</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679278975"><span id="local-6989586621679278978"><span id="local-6989586621679278982"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#Val"><span class="hs-identifier hs-type">Val</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-218"></span><span>  </span><span id="local-6989586621679279007"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679279007"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621679279008"><span class="annot"><span class="annottext">&lt;&#215;&gt; :: forall b. Integral b =&gt; b -&gt; MaryValue -&gt; MaryValue
</span><a href="#local-6989586621679279008"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&#215;&gt;</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279010"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279010"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279011"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279011"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span>
</span><span id="line-220"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679279007"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">i -&gt; Coin -&gt; Coin
forall i. Integral i =&gt; i -&gt; Coin -&gt; Coin
forall t i. (Val t, Integral i) =&gt; i -&gt; t -&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C%D7%3E"><span class="hs-operator hs-var">&lt;&#215;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279010"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMap"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a.
(Ord k, CanonicalZero a) =&gt;
(a -&gt; a) -&gt; Map k a -&gt; Map k a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#canonicalMap"><span class="hs-identifier hs-var">canonicalMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">i -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679279007"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279011"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>  </span><span id="local-6989586621679279015"><span class="annot"><span class="annottext">isZero :: MaryValue -&gt; Bool
</span><a href="#local-6989586621679279015"><span class="hs-identifier hs-var hs-var hs-var hs-var">isZero</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279017"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279017"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279018"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279018"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279017"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279018"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-223"></span><span>  </span><span id="local-6989586621679279022"><span class="annot"><span class="annottext">coin :: MaryValue -&gt; Coin
</span><a href="#local-6989586621679279022"><span class="hs-identifier hs-var hs-var hs-var hs-var">coin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279024"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279024"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279024"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-224"></span><span>  </span><span id="local-6989586621679279025"><span class="annot"><span class="annottext">modifyCoin :: (Coin -&gt; Coin) -&gt; MaryValue -&gt; MaryValue
</span><a href="#local-6989586621679279025"><span class="hs-identifier hs-var hs-var hs-var hs-var">modifyCoin</span></a></span></span><span> </span><span id="local-6989586621679279027"><span class="annot"><span class="annottext">Coin -&gt; Coin
</span><a href="#local-6989586621679279027"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279028"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279028"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679279029"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279029"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Coin
</span><a href="#local-6989586621679279027"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279028"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279029"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-225"></span><span>  </span><span id="local-6989586621679279035"><span class="annot"><span class="annottext">pointwise :: (Integer -&gt; Integer -&gt; Bool) -&gt; MaryValue -&gt; MaryValue -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#pointwise"><span class="hs-identifier hs-var hs-var hs-var hs-var">pointwise</span></a></span></span><span> </span><span id="local-6989586621679279036"><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679279036"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621679279038"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279038"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279039"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279039"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621679279040"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279040"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279041"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279041"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679279036"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279038"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279040"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer -&gt; Bool)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Bool
forall k v.
(Ord k, CanonicalZero v) =&gt;
(v -&gt; v -&gt; Bool) -&gt; Map k v -&gt; Map k v -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#pointWise"><span class="hs-identifier hs-var">pointWise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer -&gt; Bool
forall k v.
(Ord k, CanonicalZero v) =&gt;
(v -&gt; v -&gt; Bool) -&gt; Map k v -&gt; Map k v -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.CanonicalMaps.html#pointWise"><span class="hs-identifier hs-var">pointWise</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679279036"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279039"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279041"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-comment">-- returns the size, in Word64's, of the CompactValue representation of MaryValue</span><span>
</span><span id="line-229"></span><span>  </span><span id="local-6989586621679279045"><span class="annot"><span class="annottext">size :: MaryValue -&gt; Integer
</span><a href="#local-6989586621679279045"><span class="hs-identifier hs-var hs-var hs-var hs-var">size</span></a></span></span><span> </span><span id="local-6989586621679279047"><span class="annot"><span class="annottext">vv :: MaryValue
</span><a href="#local-6989586621679279047"><span class="hs-identifier hs-var">vv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279048"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279048"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- when MaryValue contains only ada</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- !WARNING! This branch is INCORRECT in the Mary era and should ONLY be</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">-- used in the Alonzo ERA.</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-comment">-- TODO - find a better way to reconcile the mistakes in Mary with what needs</span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-comment">-- to be the case in Alonzo.</span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279048"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-comment">-- when MaryValue contains ada as well as other tokens</span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-comment">-- sums up :</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-comment">-- i) adaWords : the space taken up by the ada amount</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-comment">-- ii) numberMulAssets : the space taken by number of words used to store</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-comment">--    number of non-ada assets in a value</span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-comment">-- iii) the space taken up by the rest of the representation (quantities,</span><span>
</span><span id="line-242"></span><span>    </span><span class="hs-comment">--    PIDs, AssetNames, indeces)</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span>
</span><span id="line-245"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#roundupBytesToWords"><span class="hs-identifier hs-var">roundupBytesToWords</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)] -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier hs-var">representationSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Coin, [(PolicyID, AssetName, Integer)])
-&gt; [(PolicyID, AssetName, Integer)]
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((Coin, [(PolicyID, AssetName, Integer)])
 -&gt; [(PolicyID, AssetName, Integer)])
-&gt; (Coin, [(PolicyID, AssetName, Integer)])
-&gt; [(PolicyID, AssetName, Integer)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">MaryValue -&gt; (Coin, [(PolicyID, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var">gettriples</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279047"><span class="hs-identifier hs-var">vv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>              </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#repOverhead"><span class="hs-identifier hs-var">repOverhead</span></a></span><span>
</span><span id="line-247"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621679279053"><span class="annot"><span class="annottext">isAdaOnly :: MaryValue -&gt; Bool
</span><a href="#local-6989586621679279053"><span class="hs-identifier hs-var hs-var hs-var hs-var">isAdaOnly</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279055"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279055"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279055"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621679279056"><span class="annot"><span class="annottext">isAdaOnlyCompact :: CompactForm MaryValue -&gt; Bool
</span><a href="#local-6989586621679279056"><span class="hs-identifier hs-var hs-var hs-var hs-var">isAdaOnlyCompact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>  </span><span id="local-6989586621679279060"><span class="annot"><span class="annottext">coinCompact :: CompactForm MaryValue -&gt; CompactForm Coin
</span><a href="#local-6989586621679279060"><span class="hs-identifier hs-var hs-var hs-var hs-var">coinCompact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span id="local-6989586621679279062"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279062"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279062"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span id="local-6989586621679279063"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279063"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279063"><span class="hs-identifier hs-var">cc</span></a></span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span>  </span><span id="local-6989586621679279064"><span class="annot"><span class="annottext">injectCompact :: CompactForm Coin -&gt; CompactForm MaryValue
</span><a href="#local-6989586621679279064"><span class="hs-identifier hs-var hs-var hs-var hs-var">injectCompact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; CompactForm MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactValue -&gt; CompactForm MaryValue)
-&gt; (CompactForm Coin -&gt; CompactValue)
-&gt; CompactForm Coin
-&gt; CompactForm MaryValue
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span>  </span><span id="local-6989586621679279066"><span class="annot"><span class="annottext">modifyCompactCoin :: (CompactForm Coin -&gt; CompactForm Coin)
-&gt; CompactForm MaryValue -&gt; CompactForm MaryValue
</span><a href="#local-6989586621679279066"><span class="hs-identifier hs-var hs-var hs-var hs-var">modifyCompactCoin</span></a></span></span><span> </span><span id="local-6989586621679279068"><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactForm Coin
</span><a href="#local-6989586621679279068"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span id="local-6989586621679279069"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279069"><span class="hs-identifier hs-var">cc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>      </span><span class="annot"><span class="annottext">CompactValue -&gt; CompactForm MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactForm Coin
</span><a href="#local-6989586621679279068"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279069"><span class="hs-identifier hs-var">cc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span id="local-6989586621679279070"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279070"><span class="hs-identifier hs-var">cc</span></a></span></span><span> </span><span id="local-6989586621679279071"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279071"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679279072"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279072"><span class="hs-identifier hs-var">sbs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>      </span><span class="annot"><span class="annottext">CompactValue -&gt; CompactForm MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Word32 -&gt; ShortByteString -&gt; CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-var">CompactValueMultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactForm Coin
</span><a href="#local-6989586621679279068"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279070"><span class="hs-identifier hs-var">cc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279071"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279072"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span class="hs-comment">-- space (in Word64s) taken up by the ada amount</span><span>
</span><span id="line-268"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#adaWords"><span class="hs-identifier hs-type">adaWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-269"></span><span id="adaWords"><span class="annot"><span class="annottext">adaWords :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#adaWords"><span class="hs-identifier hs-var hs-var">adaWords</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-comment">-- 64 bit machine Word64 length</span><span>
</span><span id="line-272"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-type">wordLength</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-273"></span><span id="wordLength"><span class="annot"><span class="annottext">wordLength :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-var hs-var">wordLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">8</span></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-comment">-- overhead in MA compact rep</span><span>
</span><span id="line-276"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#repOverhead"><span class="hs-identifier hs-type">repOverhead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-277"></span><span id="repOverhead"><span class="annot"><span class="annottext">repOverhead :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#repOverhead"><span class="hs-identifier hs-var hs-var">repOverhead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#adaWords"><span class="hs-identifier hs-var">adaWords</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#numberMulAssets"><span class="hs-identifier hs-var">numberMulAssets</span></a></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- number of words used to store number of MAs in a value</span><span>
</span><span id="line-280"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#numberMulAssets"><span class="hs-identifier hs-type">numberMulAssets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-281"></span><span id="numberMulAssets"><span class="annot"><span class="annottext">numberMulAssets :: Int
</span><a href="Cardano.Ledger.Mary.Value.html#numberMulAssets"><span class="hs-identifier hs-var hs-var">numberMulAssets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">-- converts bytes to words (rounding up)</span><span>
</span><span id="line-284"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#roundupBytesToWords"><span class="hs-identifier hs-type">roundupBytesToWords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-285"></span><span id="roundupBytesToWords"><span class="annot"><span class="annottext">roundupBytesToWords :: Int -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#roundupBytesToWords"><span class="hs-identifier hs-var hs-var">roundupBytesToWords</span></a></span></span><span> </span><span id="local-6989586621679279076"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279076"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">quot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279076"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-var">wordLength</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="Cardano.Ledger.Mary.Value.html#wordLength"><span class="hs-identifier hs-var">wordLength</span></a></span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-comment">-- ==============================================================</span><span>
</span><span id="line-288"></span><span class="hs-comment">-- CBOR</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span id="local-6989586621679277748"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeMaryValue"><span class="hs-identifier hs-type">decodeMaryValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#Decoder"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679277748"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span><span>
</span><span id="line-291"></span><span id="decodeMaryValue"><span class="annot"><span class="annottext">decodeMaryValue :: forall s. Decoder s MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMaryValue"><span class="hs-identifier hs-var hs-var">decodeMaryValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-292"></span><span>  </span><span id="local-6989586621679279091"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679279091"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s TokenType
forall s. Decoder s TokenType
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#peekTokenType"><span class="hs-identifier hs-var">peekTokenType</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679279091"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeUInt"><span class="hs-identifier hs-var">TypeUInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MaryValue
forall t s. Inject t s =&gt; t -&gt; s
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; MaryValue) -&gt; (Word64 -&gt; Coin) -&gt; Word64 -&gt; MaryValue
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Coin) -&gt; (Word64 -&gt; Integer) -&gt; Word64 -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; MaryValue) -&gt; Decoder s Word64 -&gt; Decoder s MaryValue
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s Word64
forall s. Decoder s Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeWord64"><span class="hs-identifier hs-var">decodeWord64</span></a></span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeUInt64"><span class="hs-identifier hs-var">TypeUInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MaryValue
forall t s. Inject t s =&gt; t -&gt; s
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; MaryValue) -&gt; (Word64 -&gt; Coin) -&gt; Word64 -&gt; MaryValue
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Coin) -&gt; (Word64 -&gt; Integer) -&gt; Word64 -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; MaryValue) -&gt; Decoder s Word64 -&gt; Decoder s MaryValue
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s Word64
forall s. Decoder s Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeWord64"><span class="hs-identifier hs-var">decodeWord64</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeListLen"><span class="hs-identifier hs-var">TypeListLen</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall t. Decoder t Integer) -&gt; Decoder s MaryValue
forall s. (forall t. Decoder t Integer) -&gt; Decoder s MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Integer) -&gt; Decoder t Word64 -&gt; Decoder t Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder t Word64
forall s. Decoder s Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeWord64"><span class="hs-identifier hs-var">decodeWord64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeListLen64"><span class="hs-identifier hs-var">TypeListLen64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall t. Decoder t Integer) -&gt; Decoder s MaryValue
forall s. (forall t. Decoder t Integer) -&gt; Decoder s MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Integer) -&gt; Decoder t Word64 -&gt; Decoder t Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder t Word64
forall s. Decoder s Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeWord64"><span class="hs-identifier hs-var">decodeWord64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeListLenIndef"><span class="hs-identifier hs-var">TypeListLenIndef</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(forall t. Decoder t Integer) -&gt; Decoder s MaryValue
forall s. (forall t. Decoder t Integer) -&gt; Decoder s MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var">decodeValuePair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Integer) -&gt; Decoder t Word64 -&gt; Decoder t Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder t Word64
forall s. Decoder s Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeWord64"><span class="hs-identifier hs-var">decodeWord64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Decoder s MaryValue
forall a. [Char] -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Decoder s MaryValue) -&gt; [Char] -&gt; Decoder s MaryValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;MaryValue: expected array or int, got &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">TokenType -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679279091"><span class="hs-identifier hs-var">tt</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span id="local-6989586621679277757"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-type">decodeValuePair</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679279105"><span class="annot"><a href="#local-6989586621679279105"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#Decoder"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679279105"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#Decoder"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679277757"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span><span>
</span><span id="line-302"></span><span id="decodeValuePair"><span class="annot"><span class="annottext">decodeValuePair :: forall s. (forall t. Decoder t Integer) -&gt; Decoder s MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#decodeValuePair"><span class="hs-identifier hs-var hs-var">decodeValuePair</span></a></span></span><span> </span><span id="local-6989586621679279109"><span class="annot"><span class="annottext">forall t. Decoder t Integer
</span><a href="#local-6989586621679279109"><span class="hs-identifier hs-var">decodeMultiAssetAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="annottext">Decode ('Closed 'Dense) MaryValue -&gt; Decoder s MaryValue
forall t (w :: Wrapped) s. Typeable t =&gt; Decode w t -&gt; Decoder s t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#decode"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">(Decode ('Closed 'Dense) MaryValue -&gt; Decoder s MaryValue)
-&gt; Decode ('Closed 'Dense) MaryValue -&gt; Decoder s MaryValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><span class="annottext">(Coin -&gt; MultiAsset -&gt; MaryValue)
-&gt; Decode ('Closed 'Dense) (Coin -&gt; MultiAsset -&gt; MaryValue)
forall t. t -&gt; Decode ('Closed 'Dense) t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#RecD"><span class="hs-identifier hs-var">RecD</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span class="annot"><span class="annottext">Decode ('Closed 'Dense) (Coin -&gt; MultiAsset -&gt; MaryValue)
-&gt; Decode ('Closed 'Dense) Coin
-&gt; Decode ('Closed 'Dense) (MultiAsset -&gt; MaryValue)
forall a (w1 :: Wrapped) t (w :: Density).
Typeable a =&gt;
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#%3C%21"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s Coin) -&gt; Decode ('Closed 'Dense) Coin
forall t. (forall s. Decoder s t) -&gt; Decode ('Closed 'Dense) t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Coin) -&gt; (Word64 -&gt; Integer) -&gt; Word64 -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Coin) -&gt; Decoder s Word64 -&gt; Decoder s Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s Word64
forall s. Decoder s Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeWord64"><span class="hs-identifier hs-var">decodeWord64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>      </span><span class="annot"><span class="annottext">Decode ('Closed 'Dense) (MultiAsset -&gt; MaryValue)
-&gt; Decode ('Closed 'Dense) MultiAsset
-&gt; Decode ('Closed 'Dense) MaryValue
forall a (w1 :: Wrapped) t (w :: Density).
Typeable a =&gt;
Decode w1 (a -&gt; t) -&gt; Decode ('Closed w) a -&gt; Decode w1 t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#%3C%21"><span class="hs-operator hs-var">&lt;!</span></a></span><span> </span><span class="annot"><span class="annottext">(forall s. Decoder s MultiAsset)
-&gt; Decode ('Closed 'Dense) MultiAsset
forall t. (forall s. Decoder s t) -&gt; Decode ('Closed 'Dense) t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Coders.html#D"><span class="hs-identifier hs-var">D</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall t. Decoder t Integer) -&gt; Decoder s MultiAsset
forall s. (forall t. Decoder t Integer) -&gt; Decoder s MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAsset"><span class="hs-identifier hs-var">decodeMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder t Integer
forall t. Decoder t Integer
</span><a href="#local-6989586621679279109"><span class="hs-identifier hs-var">decodeMultiAssetAmount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-comment">-- | `MultiAsset` can be used in two different circumstances:</span><span>
</span><span id="line-309"></span><span class="hs-comment">--</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- 1. In `MaryValue` while sending, where amounts must be positive.</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- 2. During minting, both negative and positive are allowed, but not zero.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- In both cases MultiAsset cannot be too big for compact representation and it must not</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- contain empty Maps.</span><span>
</span><span id="line-315"></span><span id="local-6989586621679277714"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAsset"><span class="hs-identifier hs-type">decodeMultiAsset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679277712"><span class="annot"><a href="#local-6989586621679277712"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#Decoder"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679277712"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#Decoder"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679277714"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span></span><span>
</span><span id="line-316"></span><span id="decodeMultiAsset"><span class="annot"><span class="annottext">decodeMultiAsset :: forall s. (forall t. Decoder t Integer) -&gt; Decoder s MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMultiAsset"><span class="hs-identifier hs-var hs-var">decodeMultiAsset</span></a></span></span><span> </span><span id="local-6989586621679279146"><span class="annot"><span class="annottext">forall t. Decoder t Integer
</span><a href="#local-6989586621679279146"><span class="hs-identifier hs-var">decodeAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-317"></span><span>  </span><span id="local-6989586621679279147"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279147"><span class="hs-identifier hs-var">ma</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">Version
-&gt; Decoder s MultiAsset
-&gt; Decoder s MultiAsset
-&gt; Decoder s MultiAsset
forall s a. Version -&gt; Decoder s a -&gt; Decoder s a -&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#ifDecoderVersionAtLeast"><span class="hs-identifier hs-var">ifDecoderVersionAtLeast</span></a></span><span>
</span><span id="line-319"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (v :: Natural).
(KnownNat v, MinVersion &lt;= v, v &lt;= MaxVersion) =&gt;
Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier hs-var">natVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">12</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>      </span><span class="annot"><span class="annottext">Decoder s MultiAsset
</span><a href="#local-6989586621679279148"><span class="hs-identifier hs-var">decodeDijkstra</span></a></span><span>
</span><span id="line-321"></span><span>      </span><span class="annot"><span class="annottext">(Decoder s MultiAsset -&gt; Decoder s MultiAsset)
-&gt; Decoder s MultiAsset -&gt; Decoder s MultiAsset
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Version
-&gt; Decoder s MultiAsset
-&gt; Decoder s MultiAsset
-&gt; Decoder s MultiAsset
forall s a. Version -&gt; Decoder s a -&gt; Decoder s a -&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#ifDecoderVersionAtLeast"><span class="hs-identifier hs-var">ifDecoderVersionAtLeast</span></a></span><span>
</span><span id="line-322"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (v :: Natural).
(KnownNat v, MinVersion &lt;= v, v &lt;= MaxVersion) =&gt;
Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier hs-var">natVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">9</span></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>        </span><span class="annot"><span class="annottext">Decoder s MultiAsset
</span><a href="#local-6989586621679279149"><span class="hs-identifier hs-var">decodeConway</span></a></span><span>
</span><span id="line-324"></span><span>        </span><span class="annot"><span class="annottext">Decoder s MultiAsset
</span><a href="#local-6989586621679279150"><span class="hs-identifier hs-var">decodeWithPrunning</span></a></span><span>
</span><span id="line-325"></span><span>  </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279147"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset -&gt; Decoder s () -&gt; Decoder s MultiAsset
forall a b. a -&gt; Decoder s b -&gt; Decoder s a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Decoder s () -&gt; Decoder s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiAsset -&gt; Bool
</span><a href="Cardano.Ledger.Mary.Value.html#isMultiAssetSmallEnough"><span class="hs-identifier hs-var">isMultiAssetSmallEnough</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279147"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Decoder s ()
forall a. [Char] -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;MultiAsset is too big to compact&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-327"></span><span>    </span><span id="local-6989586621679279149"><span class="annot"><span class="annottext">decodeConway :: Decoder s MultiAsset
</span><a href="#local-6989586621679279149"><span class="hs-identifier hs-var hs-var">decodeConway</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(Map PolicyID (Map AssetName Integer) -&gt; MultiAsset)
-&gt; Decoder s (Map PolicyID (Map AssetName Integer))
-&gt; Decoder s MultiAsset
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s PolicyID
-&gt; Decoder s (Map AssetName Integer)
-&gt; Decoder s (Map PolicyID (Map AssetName Integer))
forall k s v.
Ord k =&gt;
Decoder s k -&gt; Decoder s v -&gt; Decoder s (Map k v)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeMap"><span class="hs-identifier hs-var">decodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s PolicyID
forall s. Decoder s PolicyID
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decoder s Integer -&gt; Decoder s (Map AssetName Integer)
forall {k} {s} {a}.
(Ord k, DecCBOR k) =&gt;
Decoder s a -&gt; Decoder s (Map k a)
</span><a href="#local-6989586621679279152"><span class="hs-identifier hs-var">decodeNonEmptyMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
</span><a href="#local-6989586621679279153"><span class="hs-identifier hs-var">decodeNonZeroAmount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span id="local-6989586621679279148"><span class="annot"><span class="annottext">decodeDijkstra :: Decoder s MultiAsset
</span><a href="#local-6989586621679279148"><span class="hs-identifier hs-var hs-var">decodeDijkstra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(Map PolicyID (Map AssetName Integer) -&gt; MultiAsset)
-&gt; Decoder s (Map PolicyID (Map AssetName Integer))
-&gt; Decoder s MultiAsset
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s (Map AssetName Integer)
-&gt; Decoder s (Map PolicyID (Map AssetName Integer))
forall {k} {s} {a}.
(Ord k, DecCBOR k) =&gt;
Decoder s a -&gt; Decoder s (Map k a)
</span><a href="#local-6989586621679279152"><span class="hs-identifier hs-var">decodeNonEmptyMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decoder s Integer -&gt; Decoder s (Map AssetName Integer)
forall {k} {s} {a}.
(Ord k, DecCBOR k) =&gt;
Decoder s a -&gt; Decoder s (Map k a)
</span><a href="#local-6989586621679279152"><span class="hs-identifier hs-var">decodeNonEmptyMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
</span><a href="#local-6989586621679279153"><span class="hs-identifier hs-var">decodeNonZeroAmount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621679279150"><span class="annot"><span class="annottext">decodeWithPrunning :: Decoder s MultiAsset
</span><a href="#local-6989586621679279150"><span class="hs-identifier hs-var hs-var">decodeWithPrunning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#pruneZeroMultiAsset"><span class="hs-identifier hs-var">pruneZeroMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(MultiAsset -&gt; MultiAsset)
-&gt; (Map PolicyID (Map AssetName Integer) -&gt; MultiAsset)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; MultiAsset
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(Map PolicyID (Map AssetName Integer) -&gt; MultiAsset)
-&gt; Decoder s (Map PolicyID (Map AssetName Integer))
-&gt; Decoder s MultiAsset
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s PolicyID
-&gt; Decoder s (Map AssetName Integer)
-&gt; Decoder s (Map PolicyID (Map AssetName Integer))
forall k s v.
Ord k =&gt;
Decoder s k -&gt; Decoder s v -&gt; Decoder s (Map k v)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeMap"><span class="hs-identifier hs-var">decodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s PolicyID
forall s. Decoder s PolicyID
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decoder s AssetName
-&gt; Decoder s Integer -&gt; Decoder s (Map AssetName Integer)
forall k s v.
Ord k =&gt;
Decoder s k -&gt; Decoder s v -&gt; Decoder s (Map k v)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeMap"><span class="hs-identifier hs-var">decodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s AssetName
forall s. Decoder s AssetName
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall t. Decoder t Integer
</span><a href="#local-6989586621679279146"><span class="hs-identifier hs-var">decodeAmount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>    </span><span id="local-6989586621679279153"><span class="annot"><span class="annottext">decodeNonZeroAmount :: Decoder s Integer
</span><a href="#local-6989586621679279153"><span class="hs-identifier hs-var hs-var">decodeNonZeroAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-332"></span><span>      </span><span id="local-6989586621679279154"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279154"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall t. Decoder t Integer
</span><a href="#local-6989586621679279146"><span class="hs-identifier hs-var">decodeAmount</span></a></span><span>
</span><span id="line-333"></span><span>      </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279154"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Decoder s () -&gt; Decoder s Integer
forall a b. a -&gt; Decoder s b -&gt; Decoder s a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Decoder s () -&gt; Decoder s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279154"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Decoder s ()
forall a. [Char] -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;MultiAsset cannot contain zeros&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621679279152"><span class="annot"><span class="annottext">decodeNonEmptyMap :: Decoder s a -&gt; Decoder s (Map k a)
</span><a href="#local-6989586621679279152"><span class="hs-identifier hs-var hs-var">decodeNonEmptyMap</span></a></span></span><span> </span><span id="local-6989586621679279169"><span class="annot"><span class="annottext">Decoder s a
</span><a href="#local-6989586621679279169"><span class="hs-identifier hs-var">valueDecoder</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>      </span><span id="local-6989586621679279170"><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621679279170"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s k -&gt; Decoder s a -&gt; Decoder s (Map k a)
forall k s v.
Ord k =&gt;
Decoder s k -&gt; Decoder s v -&gt; Decoder s (Map k v)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeMap"><span class="hs-identifier hs-var">decodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s k
forall s. Decoder s k
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder s a
</span><a href="#local-6989586621679279169"><span class="hs-identifier hs-var">valueDecoder</span></a></span><span>
</span><span id="line-336"></span><span>      </span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621679279170"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Map k a -&gt; Decoder s () -&gt; Decoder s (Map k a)
forall a b. a -&gt; Decoder s b -&gt; Decoder s a
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><span class="hs-operator hs-var">&lt;$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Decoder s () -&gt; Decoder s ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map k a -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621679279170"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Decoder s ()
forall a. [Char] -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Empty Assets are not allowed&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>
</span><span id="line-338"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279175"><span id="local-6989586621679279178"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-type">EncCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-339"></span><span>  </span><span id="local-6989586621679279184"><span class="annot"><span class="annottext">encCBOR :: MaryValue -&gt; Encoding
</span><a href="#local-6989586621679279184"><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279186"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279186"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679279187"><span class="annot"><span class="annottext">ma :: MultiAsset
</span><a href="#local-6989586621679279187"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279188"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279188"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279188"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279186"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-keyword">else</span><span>
</span><span id="line-343"></span><span>        </span><span class="annot"><span class="annottext">Encode ('Closed 'Dense) MaryValue -&gt; Encoding
forall (w :: Wrapped) t. Encode w t -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#encode"><span class="hs-identifier hs-var">encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Encode ('Closed 'Dense) MaryValue -&gt; Encoding)
-&gt; Encode ('Closed 'Dense) MaryValue -&gt; Encoding
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-344"></span><span>          </span><span class="annot"><span class="annottext">(Coin -&gt; MultiAsset -&gt; MaryValue)
-&gt; Encode ('Closed 'Dense) (Coin -&gt; MultiAsset -&gt; MaryValue)
forall t. t -&gt; Encode ('Closed 'Dense) t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span>
</span><span id="line-345"></span><span>            </span><span class="annot"><span class="annottext">Encode ('Closed 'Dense) (Coin -&gt; MultiAsset -&gt; MaryValue)
-&gt; Encode ('Closed 'Dense) Coin
-&gt; Encode ('Closed 'Dense) (MultiAsset -&gt; MaryValue)
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#%21%3E"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Encode ('Closed 'Dense) Coin
forall t. EncCBOR t =&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#To"><span class="hs-identifier hs-var">To</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279186"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-346"></span><span>            </span><span class="annot"><span class="annottext">Encode ('Closed 'Dense) (MultiAsset -&gt; MaryValue)
-&gt; Encode ('Closed 'Dense) MultiAsset
-&gt; Encode ('Closed 'Dense) MaryValue
forall (w :: Wrapped) a t (r :: Density).
Encode w (a -&gt; t) -&gt; Encode ('Closed r) a -&gt; Encode w t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#%21%3E"><span class="hs-operator hs-var">!&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset -&gt; Encode ('Closed 'Dense) MultiAsset
forall t. EncCBOR t =&gt; t -&gt; Encode ('Closed 'Dense) t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Coders.html#To"><span class="hs-identifier hs-var">To</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279187"><span class="hs-identifier hs-var">ma</span></a></span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279195"><span id="local-6989586621679279198"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-349"></span><span>  </span><span id="local-6989586621679279200"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s MaryValue
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decoder s MaryValue
forall s. Decoder s MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMaryValue"><span class="hs-identifier hs-var">decodeMaryValue</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-comment">-- Note: we do not use `decodeInt64` from the cborg library here because the</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- implementation contains &quot;-- TODO FIXME: overflow&quot;</span><span>
</span><span id="line-353"></span><span id="local-6989586621679279201"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#decodeIntegerBounded64"><span class="hs-identifier hs-type">decodeIntegerBounded64</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#Decoder"><span class="hs-identifier hs-type">Decoder</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679279201"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span></span><span>
</span><span id="line-354"></span><span id="decodeIntegerBounded64"><span class="annot"><span class="annottext">decodeIntegerBounded64 :: forall t. Decoder t Integer
</span><a href="Cardano.Ledger.Mary.Value.html#decodeIntegerBounded64"><span class="hs-identifier hs-var hs-var">decodeIntegerBounded64</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-355"></span><span>  </span><span id="local-6989586621679279222"><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679279222"><span class="hs-identifier hs-var">tt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s TokenType
forall s. Decoder s TokenType
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#peekTokenType"><span class="hs-identifier hs-var">peekTokenType</span></a></span><span>
</span><span id="line-356"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TokenType
</span><a href="#local-6989586621679279222"><span class="hs-identifier hs-var">tt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-357"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeUInt"><span class="hs-identifier hs-var">TypeUInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeUInt64"><span class="hs-identifier hs-var">TypeUInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeNInt"><span class="hs-identifier hs-var">TypeNInt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cborg-0.2.10.0-3e31f6cf34ff469fb38d9399ae33f1b7220bc22b21ee079efc2a64b820f9d556/share/doc/html/src/Codec.CBOR.Decoding.html#TypeNInt64"><span class="hs-identifier hs-var">TypeNInt64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Decoder s ()
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>    </span><span class="annot"><span class="annottext">TokenType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Decoder s ()
forall a. [Char] -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;expected major type 0 or 1 when decoding mint field&quot;</span></span><span>
</span><span id="line-362"></span><span>  </span><span id="local-6989586621679279225"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279225"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Integer
forall t. Decoder t Integer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeInteger"><span class="hs-identifier hs-var">decodeInteger</span></a></span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279226"><span class="hs-identifier hs-var">minval</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279225"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279225"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279228"><span class="hs-identifier hs-var">maxval</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Decoder s Integer
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279225"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-366"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; Decoder s Integer
forall a. [Char] -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Decoder s Integer) -&gt; [Char] -&gt; Decoder s Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-367"></span><span>        </span><span class="annot"><span class="annottext">Context -&gt; [Char]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span>
</span><span id="line-368"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;overflow when decoding mint field. min value: &quot;</span></span><span>
</span><span id="line-369"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279226"><span class="hs-identifier hs-var">minval</span></a></span><span>
</span><span id="line-370"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; max value: &quot;</span></span><span>
</span><span id="line-371"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279228"><span class="hs-identifier hs-var">maxval</span></a></span><span>
</span><span id="line-372"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; got: &quot;</span></span><span>
</span><span id="line-373"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279225"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-374"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-376"></span><span>    </span><span id="local-6989586621679279228"><span class="annot"><span class="annottext">maxval :: Integer
</span><a href="#local-6989586621679279228"><span class="hs-identifier hs-var hs-var">maxval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>    </span><span id="local-6989586621679279226"><span class="annot"><span class="annottext">minval :: Integer
</span><a href="#local-6989586621679279226"><span class="hs-identifier hs-var hs-var">minval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int64
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int64</span></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span class="hs-comment">-- ========================================================================</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- JSON</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ToKeyValuePairs"><span class="hs-identifier hs-type">ToKeyValuePairs</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621679279251"><span class="annot"><span class="annottext">toKeyValuePairs :: forall e kv. KeyValue e kv =&gt; MaryValue -&gt; [kv]
</span><a href="#local-6989586621679279251"><span class="hs-identifier hs-var hs-var hs-var hs-var">toKeyValuePairs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279253"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279253"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679279254"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279254"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;lovelace&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Coin -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279253"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;policies&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; MultiAsset -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279254"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279257"><span id="local-6989586621679279261"><span id="local-6989586621679279264"><span id="local-6989586621679279267"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-389"></span><span>  </span><span id="local-6989586621679279269"><span class="annot"><span class="annottext">toJSON :: AssetName -&gt; Value
</span><a href="#local-6989586621679279269"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.Internal.html#String"><span class="hs-identifier hs-var">Aeson.String</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; (AssetName -&gt; Text) -&gt; AssetName -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; Text
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameToTextAsHex"><span class="hs-identifier hs-var">assetNameToTextAsHex</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279274"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSONKey"><span class="hs-identifier hs-type">ToJSONKey</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-392"></span><span>  </span><span id="local-6989586621679279277"><span class="annot"><span class="annottext">toJSONKey :: ToJSONKeyFunction AssetName
</span><a href="#local-6989586621679279277"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSONKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Text) -&gt; ToJSONKeyFunction AssetName
forall a. (a -&gt; Text) -&gt; ToJSONKeyFunction a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSONKeyText"><span class="hs-identifier hs-var">toJSONKeyText</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; Text
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameToTextAsHex"><span class="hs-identifier hs-var">assetNameToTextAsHex</span></a></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="hs-comment">-- ========================================================================</span><span>
</span><span id="line-395"></span><span class="hs-comment">-- Compactible</span><span>
</span><span id="line-396"></span><span class="hs-comment">-- This is used in the TxOut which stores the (CompactForm MaryValue).</span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#Compactible"><span class="hs-identifier hs-type">Compactible</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-keyword">newtype</span><span> </span><span id="CompactForm"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-var">CompactForm</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="CompactValue"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279294"><span id="local-6989586621679279299"><span class="annot"><span class="annottext">CompactForm MaryValue -&gt; CompactForm MaryValue -&gt; Bool
(CompactForm MaryValue -&gt; CompactForm MaryValue -&gt; Bool)
-&gt; (CompactForm MaryValue -&gt; CompactForm MaryValue -&gt; Bool)
-&gt; Eq (CompactForm MaryValue)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: CompactForm MaryValue -&gt; CompactForm MaryValue -&gt; Bool
== :: CompactForm MaryValue -&gt; CompactForm MaryValue -&gt; Bool
$c/= :: CompactForm MaryValue -&gt; CompactForm MaryValue -&gt; Bool
/= :: CompactForm MaryValue -&gt; CompactForm MaryValue -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279303"><span id="local-6989586621679279308"><span id="local-6989586621679279311"><span class="annot"><span class="annottext">Int -&gt; CompactForm MaryValue -&gt; ShowS
[CompactForm MaryValue] -&gt; ShowS
CompactForm MaryValue -&gt; [Char]
(Int -&gt; CompactForm MaryValue -&gt; ShowS)
-&gt; (CompactForm MaryValue -&gt; [Char])
-&gt; ([CompactForm MaryValue] -&gt; ShowS)
-&gt; Show (CompactForm MaryValue)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CompactForm MaryValue -&gt; ShowS
showsPrec :: Int -&gt; CompactForm MaryValue -&gt; ShowS
$cshow :: CompactForm MaryValue -&gt; [Char]
show :: CompactForm MaryValue -&gt; [Char]
$cshowList :: [CompactForm MaryValue] -&gt; ShowS
showList :: [CompactForm MaryValue] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279314"><span id="local-6989586621679279319"><span id="local-6989586621679279323"><span class="annot"><span class="annottext">Context -&gt; CompactForm MaryValue -&gt; IO (Maybe ThunkInfo)
Proxy (CompactForm MaryValue) -&gt; [Char]
(Context -&gt; CompactForm MaryValue -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; CompactForm MaryValue -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (CompactForm MaryValue) -&gt; [Char])
-&gt; NoThunks (CompactForm MaryValue)
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; [Char])
-&gt; NoThunks a
$cnoThunks :: Context -&gt; CompactForm MaryValue -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; CompactForm MaryValue -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; CompactForm MaryValue -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; CompactForm MaryValue -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: Proxy (CompactForm MaryValue) -&gt; [Char]
showTypeOf :: Proxy (CompactForm MaryValue) -&gt; [Char]
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279331"><span id="local-6989586621679279338"><span id="local-6989586621679279344"><span class="annot"><span class="annottext">Typeable (CompactForm MaryValue)
Typeable (CompactForm MaryValue) =&gt;
(CompactForm MaryValue -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy (CompactForm MaryValue) -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [CompactForm MaryValue] -&gt; Size)
-&gt; EncCBOR (CompactForm MaryValue)
CompactForm MaryValue -&gt; Encoding
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [CompactForm MaryValue] -&gt; Size
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (CompactForm MaryValue) -&gt; Size
forall a.
Typeable a =&gt;
(a -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; EncCBOR a
$cencCBOR :: CompactForm MaryValue -&gt; Encoding
encCBOR :: CompactForm MaryValue -&gt; Encoding
$cencodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (CompactForm MaryValue) -&gt; Size
encodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy (CompactForm MaryValue) -&gt; Size
$cencodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [CompactForm MaryValue] -&gt; Size
encodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
-&gt; Proxy [CompactForm MaryValue] -&gt; Size
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">EncCBOR</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279352"><span id="local-6989586621679279357"><span id="local-6989586621679279361"><span class="annot"><span class="annottext">Typeable (CompactForm MaryValue)
Typeable (CompactForm MaryValue) =&gt;
(forall s. Decoder s (CompactForm MaryValue))
-&gt; (forall s. Proxy (CompactForm MaryValue) -&gt; Decoder s ())
-&gt; (Proxy (CompactForm MaryValue) -&gt; Text)
-&gt; DecCBOR (CompactForm MaryValue)
Proxy (CompactForm MaryValue) -&gt; Text
forall s. Decoder s (CompactForm MaryValue)
forall a.
Typeable a =&gt;
(forall s. Decoder s a)
-&gt; (forall s. Proxy a -&gt; Decoder s ())
-&gt; (Proxy a -&gt; Text)
-&gt; DecCBOR a
forall s. Proxy (CompactForm MaryValue) -&gt; Decoder s ()
$cdecCBOR :: forall s. Decoder s (CompactForm MaryValue)
decCBOR :: forall s. Decoder s (CompactForm MaryValue)
$cdropCBOR :: forall s. Proxy (CompactForm MaryValue) -&gt; Decoder s ()
dropCBOR :: forall s. Proxy (CompactForm MaryValue) -&gt; Decoder s ()
$clabel :: Proxy (CompactForm MaryValue) -&gt; Text
label :: Proxy (CompactForm MaryValue) -&gt; Text
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">DecCBOR</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279365"><span class="annot"><span class="annottext">CompactForm MaryValue -&gt; ()
(CompactForm MaryValue -&gt; ()) -&gt; NFData (CompactForm MaryValue)
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: CompactForm MaryValue -&gt; ()
rnf :: CompactForm MaryValue -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279371"><span id="local-6989586621679279376"><span id="local-6989586621679279380"><span id="local-6989586621679279386"><span class="annot"><span class="annottext">[Char]
[Char]
-&gt; (CompactForm MaryValue -&gt; Int)
-&gt; (forall s. CompactForm MaryValue -&gt; Pack s ())
-&gt; (forall b s. Buffer b =&gt; Unpack s b (CompactForm MaryValue))
-&gt; MemPack (CompactForm MaryValue)
CompactForm MaryValue -&gt; Int
forall a.
[Char]
-&gt; (a -&gt; Int)
-&gt; (forall s. a -&gt; Pack s ())
-&gt; (forall b s. Buffer b =&gt; Unpack s b a)
-&gt; MemPack a
forall s. CompactForm MaryValue -&gt; Pack s ()
forall b s. Buffer b =&gt; Unpack s b (CompactForm MaryValue)
$ctypeName :: [Char]
typeName :: [Char]
$cpackedByteCount :: CompactForm MaryValue -&gt; Int
packedByteCount :: CompactForm MaryValue -&gt; Int
$cpackM :: forall s. CompactForm MaryValue -&gt; Pack s ()
packM :: forall s. CompactForm MaryValue -&gt; Pack s ()
$cunpackM :: forall b s. Buffer b =&gt; Unpack s b (CompactForm MaryValue)
unpackM :: forall b s. Buffer b =&gt; Unpack s b (CompactForm MaryValue)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#MemPack"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">MemPack</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621679279394"><span class="annot"><span class="annottext">toCompact :: MaryValue -&gt; Maybe (CompactForm MaryValue)
</span><a href="#local-6989586621679279394"><span class="hs-identifier hs-var hs-var hs-var hs-var">toCompact</span></a></span></span><span> </span><span id="local-6989586621679279396"><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279396"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; CompactForm MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactValue -&gt; CompactForm MaryValue)
-&gt; Maybe CompactValue -&gt; Maybe (CompactForm MaryValue)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MaryValue -&gt; Maybe CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279396"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-402"></span><span>  </span><span id="local-6989586621679279398"><span class="annot"><span class="annottext">fromCompact :: CompactForm MaryValue -&gt; MaryValue
</span><a href="#local-6989586621679279398"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromCompact</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span id="local-6989586621679279400"><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279400"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279400"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-403"></span><span>
</span><span id="line-404"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279406"><span id="local-6989586621679279409"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-type">EncCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-405"></span><span>  </span><span id="local-6989586621679279412"><span class="annot"><span class="annottext">encCBOR :: CompactValue -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaryValue -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">(MaryValue -&gt; Encoding)
-&gt; (CompactValue -&gt; MaryValue) -&gt; CompactValue -&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279417"><span id="local-6989586621679279420"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-408"></span><span>  </span><span id="local-6989586621679279425"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s CompactValue
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-409"></span><span>    </span><span id="local-6989586621679279426"><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279426"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s MaryValue
forall s. Decoder s MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#decodeMaryValue"><span class="hs-identifier hs-var">decodeMaryValue</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaryValue -&gt; Maybe CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279426"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-411"></span><span>      </span><span class="annot"><span class="annottext">Maybe CompactValue
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-412"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; Decoder s CompactValue
forall a. [Char] -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span>
</span><span id="line-413"></span><span>          </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;impossible failure: decoded nonnegative value that cannot be compacted&quot;</span></span><span>
</span><span id="line-414"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679279427"><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279427"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; Decoder s CompactValue
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279427"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span class="hs-keyword">data</span><span> </span><span id="CompactValue"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-var">CompactValue</span></a></span></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="CompactValueAdaOnly"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span></span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="CompactValueMultiAsset"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-var">CompactValueMultiAsset</span></a></span></span><span>
</span><span id="line-419"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ada</span><span>
</span><span id="line-420"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">Word32</span></span><span> </span><span class="hs-comment">-- number of ma's</span><span>
</span><span id="line-421"></span><span>      </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">ShortByteString</span></span><span> </span><span class="hs-comment">-- rep</span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279429"><span id="local-6989586621679279431"><span class="annot"><span class="annottext">(forall x. CompactValue -&gt; Rep CompactValue x)
-&gt; (forall x. Rep CompactValue x -&gt; CompactValue)
-&gt; Generic CompactValue
forall x. Rep CompactValue x -&gt; CompactValue
forall x. CompactValue -&gt; Rep CompactValue x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. CompactValue -&gt; Rep CompactValue x
from :: forall x. CompactValue -&gt; Rep CompactValue x
$cto :: forall x. Rep CompactValue x -&gt; CompactValue
to :: forall x. Rep CompactValue x -&gt; CompactValue
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279434"><span id="local-6989586621679279445"><span id="local-6989586621679279448"><span class="annot"><span class="annottext">Int -&gt; CompactValue -&gt; ShowS
[CompactValue] -&gt; ShowS
CompactValue -&gt; [Char]
(Int -&gt; CompactValue -&gt; ShowS)
-&gt; (CompactValue -&gt; [Char])
-&gt; ([CompactValue] -&gt; ShowS)
-&gt; Show CompactValue
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; [Char]) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; CompactValue -&gt; ShowS
showsPrec :: Int -&gt; CompactValue -&gt; ShowS
$cshow :: CompactValue -&gt; [Char]
show :: CompactValue -&gt; [Char]
$cshowList :: [CompactValue] -&gt; ShowS
showList :: [CompactValue] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-423"></span><span>
</span><span id="line-424"></span><span class="hs-comment">-- | We need to manually pack/unpack `CompactForm Coin` here because its MemPack instance can't be</span><span>
</span><span id="line-425"></span><span class="hs-comment">-- used due to the requirement of it being compatible with the first case of</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- `CompactValueAdaOnly`. In other words `MemPack` instance for `CompactForm Coin` also prefixes a</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- zero Tag for binary compatibility with `CompactValueAdaOnly` case.</span><span>
</span><span id="line-428"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279451"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#MemPack"><span class="hs-identifier hs-type">MemPack</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>  </span><span id="local-6989586621679279465"><span class="annot"><span class="annottext">packedByteCount :: CompactValue -&gt; Int
</span><a href="#local-6989586621679279465"><span class="hs-identifier hs-var hs-var hs-var hs-var">packedByteCount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-430"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span id="local-6989586621679279467"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279467"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-431"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packedTagByteCount"><span class="hs-identifier hs-var">packedTagByteCount</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Int
</span><a href="#local-6989586621679279469"><span class="hs-identifier hs-var">compactCoinByteCount</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279467"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span id="local-6989586621679279470"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279470"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679279471"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279471"><span class="hs-identifier hs-var">numMA</span></a></span></span><span> </span><span id="local-6989586621679279472"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279472"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-433"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packedTagByteCount"><span class="hs-identifier hs-var">packedTagByteCount</span></a></span><span>
</span><span id="line-434"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Int
</span><a href="#local-6989586621679279469"><span class="hs-identifier hs-var">compactCoinByteCount</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279470"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-435"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">VarLen Word32 -&gt; Int
forall a. MemPack a =&gt; a -&gt; Int
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packedByteCount"><span class="hs-identifier hs-var">packedByteCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; VarLen Word32
forall a. a -&gt; VarLen a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#VarLen"><span class="hs-identifier hs-var">VarLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279471"><span class="hs-identifier hs-var">numMA</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>        </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
forall a. MemPack a =&gt; a -&gt; Int
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packedByteCount"><span class="hs-identifier hs-var">packedByteCount</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279472"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-438"></span><span>      </span><span id="local-6989586621679279469"><span class="annot"><span class="annottext">compactCoinByteCount :: CompactForm Coin -&gt; Int
</span><a href="#local-6989586621679279469"><span class="hs-identifier hs-var hs-var">compactCoinByteCount</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679279477"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279477"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarLen Word64 -&gt; Int
forall a. MemPack a =&gt; a -&gt; Int
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packedByteCount"><span class="hs-identifier hs-var">packedByteCount</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; VarLen Word64
forall a. a -&gt; VarLen a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#VarLen"><span class="hs-identifier hs-var">VarLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279477"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packedByteCount"><span class="hs-pragma hs-type">packedByteCount</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-440"></span><span>  </span><span id="local-6989586621679279488"><span class="annot"><span class="annottext">packM :: forall s. CompactValue -&gt; Pack s ()
</span><a href="#local-6989586621679279488"><span class="hs-identifier hs-var hs-var hs-var hs-var">packM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-441"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span id="local-6989586621679279490"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279490"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-442"></span><span>      </span><span class="annot"><span class="annottext">Tag -&gt; Pack s ()
forall s. Tag -&gt; Pack s ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packTagM"><span class="hs-identifier hs-var">packTagM</span></a></span><span> </span><span class="annot"><span class="annottext">Tag
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Pack s () -&gt; Pack s () -&gt; Pack s ()
forall a b. Pack s a -&gt; Pack s b -&gt; Pack s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Pack s ()
forall {s}. CompactForm Coin -&gt; Pack s ()
</span><a href="#local-6989586621679279492"><span class="hs-identifier hs-var">packCompactCoinM</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279490"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-443"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span id="local-6989586621679279493"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279493"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679279494"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279494"><span class="hs-identifier hs-var">numMA</span></a></span></span><span> </span><span id="local-6989586621679279495"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279495"><span class="hs-identifier hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-444"></span><span>      </span><span class="annot"><span class="annottext">Tag -&gt; Pack s ()
forall s. Tag -&gt; Pack s ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packTagM"><span class="hs-identifier hs-var">packTagM</span></a></span><span> </span><span class="annot"><span class="annottext">Tag
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Pack s () -&gt; Pack s () -&gt; Pack s ()
forall a b. Pack s a -&gt; Pack s b -&gt; Pack s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Pack s ()
forall {s}. CompactForm Coin -&gt; Pack s ()
</span><a href="#local-6989586621679279492"><span class="hs-identifier hs-var">packCompactCoinM</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279493"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Pack s () -&gt; Pack s () -&gt; Pack s ()
forall a b. Pack s a -&gt; Pack s b -&gt; Pack s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">VarLen Word32 -&gt; Pack s ()
forall a s. MemPack a =&gt; a -&gt; Pack s ()
forall s. VarLen Word32 -&gt; Pack s ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packM"><span class="hs-identifier hs-var">packM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; VarLen Word32
forall a. a -&gt; VarLen a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#VarLen"><span class="hs-identifier hs-var">VarLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279494"><span class="hs-identifier hs-var">numMA</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Pack s () -&gt; Pack s () -&gt; Pack s ()
forall a b. Pack s a -&gt; Pack s b -&gt; Pack s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Pack s ()
forall s. ShortByteString -&gt; Pack s ()
forall a s. MemPack a =&gt; a -&gt; Pack s ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packM"><span class="hs-identifier hs-var">packM</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279495"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-446"></span><span>      </span><span class="hs-comment">-- See note on the instance for why `MemPack` instance for `CompactForm Coin` can't be used.</span><span>
</span><span id="line-447"></span><span>      </span><span id="local-6989586621679279492"><span class="annot"><span class="annottext">packCompactCoinM :: CompactForm Coin -&gt; Pack s ()
</span><a href="#local-6989586621679279492"><span class="hs-identifier hs-var hs-var">packCompactCoinM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679279497"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279497"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarLen Word64 -&gt; Pack s ()
forall a s. MemPack a =&gt; a -&gt; Pack s ()
forall s. VarLen Word64 -&gt; Pack s ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packM"><span class="hs-identifier hs-var">packM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; VarLen Word64
forall a. a -&gt; VarLen a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#VarLen"><span class="hs-identifier hs-var">VarLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279497"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679279492"><span class="hs-pragma hs-type">packCompactCoinM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#packM"><span class="hs-pragma hs-type">packM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-450"></span><span>  </span><span id="local-6989586621679279521"><span class="annot"><span class="annottext">unpackM :: forall b s. Buffer b =&gt; Unpack s b CompactValue
</span><a href="#local-6989586621679279521"><span class="hs-identifier hs-var hs-var hs-var hs-var">unpackM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-451"></span><span>    </span><span class="annot"><span class="annottext">Unpack s b Tag
forall b s. Buffer b =&gt; Unpack s b Tag
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unpackTagM"><span class="hs-identifier hs-var">unpackTagM</span></a></span><span> </span><span class="annot"><span class="annottext">Unpack s b Tag
-&gt; (Tag -&gt; Unpack s b CompactValue) -&gt; Unpack s b CompactValue
forall a b. Unpack s b a -&gt; (a -&gt; Unpack s b b) -&gt; Unpack s b b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-452"></span><span>      </span><span class="annot"><span class="annottext">Tag
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; CompactValue)
-&gt; Unpack s b (CompactForm Coin) -&gt; Unpack s b CompactValue
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unpack s b (CompactForm Coin)
forall {s}. Unpack s b (CompactForm Coin)
</span><a href="#local-6989586621679279524"><span class="hs-identifier hs-var">unpackCompactCoinM</span></a></span><span>
</span><span id="line-453"></span><span>      </span><span class="annot"><span class="annottext">Tag
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Word32 -&gt; ShortByteString -&gt; CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-var">CompactValueMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; Word32 -&gt; ShortByteString -&gt; CompactValue)
-&gt; Unpack s b (CompactForm Coin)
-&gt; Unpack s b (Word32 -&gt; ShortByteString -&gt; CompactValue)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unpack s b (CompactForm Coin)
forall {s}. Unpack s b (CompactForm Coin)
</span><a href="#local-6989586621679279524"><span class="hs-identifier hs-var">unpackCompactCoinM</span></a></span><span> </span><span class="annot"><span class="annottext">Unpack s b (Word32 -&gt; ShortByteString -&gt; CompactValue)
-&gt; Unpack s b Word32
-&gt; Unpack s b (ShortByteString -&gt; CompactValue)
forall a b. Unpack s b (a -&gt; b) -&gt; Unpack s b a -&gt; Unpack s b b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarLen Word32 -&gt; Word32
forall a. VarLen a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unVarLen"><span class="hs-identifier hs-var">unVarLen</span></a></span><span> </span><span class="annot"><span class="annottext">(VarLen Word32 -&gt; Word32)
-&gt; Unpack s b (VarLen Word32) -&gt; Unpack s b Word32
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unpack s b (VarLen Word32)
forall a b s. (MemPack a, Buffer b) =&gt; Unpack s b a
forall b s. Buffer b =&gt; Unpack s b (VarLen Word32)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unpackM"><span class="hs-identifier hs-var">unpackM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Unpack s b (ShortByteString -&gt; CompactValue)
-&gt; Unpack s b ShortByteString -&gt; Unpack s b CompactValue
forall a b. Unpack s b (a -&gt; b) -&gt; Unpack s b a -&gt; Unpack s b b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unpack s b ShortByteString
forall a b s. (MemPack a, Buffer b) =&gt; Unpack s b a
forall b s. Buffer b =&gt; Unpack s b ShortByteString
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unpackM"><span class="hs-identifier hs-var">unpackM</span></a></span><span>
</span><span id="line-454"></span><span>      </span><span id="local-6989586621679279526"><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621679279526"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a (m :: * -&gt; *) b. (MemPack a, MonadFail m) =&gt; Tag -&gt; m b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unknownTagM"><span class="hs-identifier hs-var">unknownTagM</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621679279526"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-456"></span><span>      </span><span id="local-6989586621679279524"><span class="annot"><span class="annottext">unpackCompactCoinM :: Unpack s b (CompactForm Coin)
</span><a href="#local-6989586621679279524"><span class="hs-identifier hs-var hs-var">unpackCompactCoinM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; CompactForm Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-var">CompactCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; CompactForm Coin)
-&gt; (VarLen Word64 -&gt; Word64) -&gt; VarLen Word64 -&gt; CompactForm Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VarLen Word64 -&gt; Word64
forall a. VarLen a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unVarLen"><span class="hs-identifier hs-var">unVarLen</span></a></span><span> </span><span class="annot"><span class="annottext">(VarLen Word64 -&gt; CompactForm Coin)
-&gt; Unpack s b (VarLen Word64) -&gt; Unpack s b (CompactForm Coin)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Unpack s b (VarLen Word64)
forall a b s. (MemPack a, Buffer b) =&gt; Unpack s b a
forall b s. Buffer b =&gt; Unpack s b (VarLen Word64)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unpackM"><span class="hs-identifier hs-var">unpackM</span></a></span><span>
</span><span id="line-457"></span><span>      </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679279524"><span class="hs-pragma hs-type">unpackCompactCoinM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mempack-0.2.0.0-ff6d622b816122e3f66d74f22f129bc2b6f4ac3b35e97400ea8704a2196f890e/share/doc/html/src/Data.MemPack.html#unpackM"><span class="hs-pragma hs-type">unpackM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-461"></span><span>  </span><span id="local-6989586621679279532"><span class="annot"><span class="annottext">rnf :: CompactValue -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">rnf</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; ()
forall a. a -&gt; ()
</span><span class="hs-identifier hs-var">rwhnf</span></span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679279535"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-464"></span><span>  </span><span id="local-6989586621679279538"><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279538"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679279539"><span class="annot"><span class="annottext">== :: CompactValue -&gt; CompactValue -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span id="local-6989586621679279540"><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279540"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279538"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue -&gt; MaryValue -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">CompactValue -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="annot"><span class="annottext">CompactValue
</span><a href="#local-6989586621679279540"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-465"></span><span>
</span><span id="line-466"></span><span id="local-6989586621679279542"><span id="local-6989586621679279548"><span id="local-6989586621679279553"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#OnlyCheckWhnfNamed"><span class="hs-identifier hs-type">OnlyCheckWhnfNamed</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;CompactValue&quot;</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-keyword">instance</span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-type">NoThunks</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span></span></span></span><span>
</span><span id="line-470"></span><span>
</span><span id="line-471"></span><span class="hs-comment">{-
The MaryValue surface type uses a nested map. For the compact version we use a
flattened representation, equivalent to a list of triples:
  [(PolicyID, AssetName, Quantity)]

Example:
  [ (&quot;0xa519f84e...&quot;, &quot;&quot;,       42)  -- empty asset name
  , (&quot;0xf820a82c...&quot;, &quot;Snark&quot;,  1)
  , (&quot;0xf820a82c...&quot;, &quot;Boojum&quot;, 1)   -- shared policy id, different name
  ]

We start by sorting in /descending/ order by asset name. Note that descending
order puts empty strings last:
  [ (&quot;0xf820a82c...&quot;, &quot;Snark&quot;,  1)
  , (&quot;0xf820a82c...&quot;, &quot;Boojum&quot;, 1)
  , (&quot;0xa519f84e...&quot;, &quot;&quot;,      42)
  ]

This example will be serialised as:
  &#9487;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9491;
A)&#9475;             1 &#9475;             1 &#9475;            42 &#9475; Word64 quantities
  &#9507;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9523;&#9473;&#9473;&#9473;&#9531;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9531;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9473;&#9499;
B)&#9475; 36&#9475; 36&#9475; 64&#9475;                                     Word16 policyId offsets
  &#9507;&#9473;&#9473;&#9473;&#9547;&#9473;&#9473;&#9473;&#9547;&#9473;&#9473;&#9473;&#9515;
C)&#9475; 92&#9475; 98&#9475;103&#9475;                                     Word16 asset name offsets
  &#9507;&#9473;&#9519;&#9473;&#9543;&#9473;&#9519;&#9473;&#9543;&#9473;&#9519;&#9473;&#9543;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9519;&#9473;&#9491;
D)&#9475;f820a82c.. &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9475; 28 byte policyId #1
  &#9507;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9515;
  &#9475;a519f84e.. &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9482; &#9475; 28 byte policyId #2
  &#9507;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9535;&#9473;&#9544;&#9473;&#9544;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9499;
E)&#9475;S&#9482;n&#9482;a&#9482;r&#9482;k&#9482;B&#9482;o&#9482;o&#9482;j&#9482;u&#9482;m&#9475;&#9664;&#9538;&#9472;padding to word size    Asset names, plus padding
  &#9495;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9527;&#9473;&#9531;&#9473;&#9499;
   &#9650;         &#9650;           &#9650;
   92-offset 97-offset   103-offset, end of string

Note that the asset name offsets end up sorted in ascending order, with empty
asset names pointing to the offset past the end of the concatenated names.

The serialised representation consists of five parts, concatenated together:
  A) A sequence of Word64s representing asset quantities.

  B) A sequence of Word16s representing policyId string offsets within D.
     We do not need to store a length because policyIds are fixed size.

  C) A sequence of Word16s representing asset name string offsets within E.
     We store only the starting offset and not a end offset or length. We can
     do this because we keep the assets in A,B,C sorted by the asset name, so
     the offsets in C are sorted. This means the next distinct entry gives the
     (exclusive) end offset of the asset name string. As a special case for
     empty asset names, the index points to the end of the string E.

     Note: If there are duplicate asset names, this can yield a sequence of
     multiple of the same offset. For example, if the assets are named
     &quot;Snark&quot;,&quot;Snark&quot;,&quot;Boojum&quot;, region E would contain &quot;SnarkBoojum&quot;,
     and region C would contain 92, 92, 97. For the decoder to determine the
     length of the first asset, it would subtract 92 from 97 (and not from the
     duplicate 92).

  D) a blob of policyIDs, without duplicates, concatenated.

  E) a blob of asset names, sorted, without duplicates, concatenated.

The size of the regions A,B,C are known based on the number of values. The
string offsets in B and C are relative to the whole of the representation, not
relative to the start of D &amp; E (since D is variable size depending on whether
there were duplicate policyIDs)

The encoding strategy is
 - Collect all (unique) policy Ids.
 - Collect all (unique) asset names.
 - Determine the sizes of the regions and allocate them.
   - size A = 8 * numassets
   - size B = 2 * numassets
   - size C = 2 * numassets
   - size D = length (concat policyIds)
   - size E = length (concat assetNames)
   - sum = 12*numassets
         + length (concat policyIds)
         + length (concat assetNames)
 - Write the policyIds to region D
 - Write the asset names to region E
 - For each asset entry
   - Locate the corresponding asset name and policyId
   - Write quantity, policyId location, and asset name location to corresponding
     regions
   - For the special case of 0 length asset names, the location is the end of
     region E

The decoding strategy is
 - Use length information to determine the beginnings of regions A,B,C
   (We do not need to do this for regions D and E because the policyId
   and asset name locations are relative to the beginning of entire rep.)
 - For each integer in 0..(numassets -1)
   - Read corresponding quantity, pid offset, and asset name offset from regions
     A, B, and C, respectively.
   - Read (pid length) bytes from pid offset. assume it points into region D
   - Determine asset name lengths using the difference between the offset and
     the next greater offset (if it exists). If there is no next greater offset,
     use the difference from the end of the rep. (Note: for the special case of
     0 length asset names, this calculation results in 0 because we are
     subtracting the end of the rep from itself.)
   - Read (asset name length) bytes from asset name offset. assume it points
     into region E.
 -}</span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-type">to</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-577"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-578"></span><span>  </span><span class="hs-comment">-- The Nothing case of the return value corresponds to a quantity that is outside</span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-comment">-- the bounds of a Word64. x &lt; 0 or x &gt; (2^64 - 1)</span><span>
</span><span id="line-580"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span>
</span><span id="line-581"></span><span id="to"><span class="annot"><span class="annottext">to :: MaryValue -&gt; Maybe CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var hs-var">to</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279557"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279557"><span class="hs-identifier hs-var">ada</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279558"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279558"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279558"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-var">CompactValueAdaOnly</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; CompactValue)
-&gt; Maybe (CompactForm Coin) -&gt; Maybe CompactValue
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe (CompactForm Coin)
forall a. Compactible a =&gt; a -&gt; Maybe (CompactForm a)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#toCompact"><span class="hs-identifier hs-var">toCompact</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279557"><span class="hs-identifier hs-var">ada</span></a></span><span>
</span><span id="line-583"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span id="local-6989586621679279559"><span class="annot"><span class="annottext">v :: MaryValue
</span><a href="#local-6989586621679279559"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679279560"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279560"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-584"></span><span>  </span><span id="local-6989586621679279561"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279561"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe (CompactForm Coin) -&gt; Maybe (CompactForm Coin)
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiAsset -&gt; Bool
</span><a href="Cardano.Ledger.Mary.Value.html#isMultiAssetSmallEnough"><span class="hs-identifier hs-var">isMultiAssetSmallEnough</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279560"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Maybe (CompactForm Coin)
forall a. Compactible a =&gt; a -&gt; Maybe (CompactForm a)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#toCompact"><span class="hs-identifier hs-var">toCompact</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279562"><span class="hs-identifier hs-var">ada</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-comment">-- Here we convert the (pid, assetName, quantity) triples into</span><span>
</span><span id="line-586"></span><span>  </span><span class="hs-comment">-- (Int, (Word16,Word16,Word64))</span><span>
</span><span id="line-587"></span><span>  </span><span class="hs-comment">-- These represent the index, pid offset, asset name offset, and quantity.</span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-comment">-- If any of the quantities out of bounds, this will produce Nothing.</span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-comment">-- The triples are ordered by asset name in descending order.</span><span>
</span><span id="line-590"></span><span>  </span><span id="local-6989586621679279563"><span class="annot"><span class="annottext">[(Int, (Word16, Word16, Word64))]
</span><a href="#local-6989586621679279563"><span class="hs-identifier hs-var">preparedTriples</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><span class="annottext">[Int]
-&gt; [(Word16, Word16, Word64)] -&gt; [(Int, (Word16, Word16, Word64))]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">([(Word16, Word16, Word64)] -&gt; [(Int, (Word16, Word16, Word64))])
-&gt; ([(Word16, Word16, Word64)] -&gt; [(Word16, Word16, Word64)])
-&gt; [(Word16, Word16, Word64)]
-&gt; [(Int, (Word16, Word16, Word64))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Word16, Word16, Word64) -&gt; Word16)
-&gt; [(Word16, Word16, Word64)] -&gt; [(Word16, Word16, Word64)]
forall b a. Ord b =&gt; (a -&gt; b) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">sortOn</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279564"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279564"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279564"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Word16, Word16, Word64)] -&gt; [(Int, (Word16, Word16, Word64))])
-&gt; Maybe [(Word16, Word16, Word64)]
-&gt; Maybe [(Int, (Word16, Word16, Word64))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">((PolicyID, AssetName, Integer) -&gt; Maybe (Word16, Word16, Word64))
-&gt; [(PolicyID, AssetName, Integer)]
-&gt; Maybe [(Word16, Word16, Word64)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; [a] -&gt; f [b]
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">(PolicyID, AssetName, Integer) -&gt; Maybe (Word16, Word16, Word64)
</span><a href="#local-6989586621679279566"><span class="hs-identifier hs-var">prepare</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279567"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-592"></span><span>  </span><span class="annot"><span class="annottext">CompactValue -&gt; Maybe CompactValue
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(CompactValue -&gt; Maybe CompactValue)
-&gt; CompactValue -&gt; Maybe CompactValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-593"></span><span>    </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Word32 -&gt; ShortByteString -&gt; CompactValue
</span><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-var">CompactValueMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279561"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word32
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279568"><span class="hs-identifier hs-var">numTriples</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; CompactValue)
-&gt; ShortByteString -&gt; CompactValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-594"></span><span>      </span><span class="annot"><span class="annottext">(forall s. ST s ShortByteString) -&gt; ShortByteString
forall a. (forall s. ST s a) -&gt; a
</span><span class="hs-identifier hs-var">runST</span></span><span> </span><span class="annot"><span class="annottext">((forall s. ST s ShortByteString) -&gt; ShortByteString)
-&gt; (forall s. ST s ShortByteString) -&gt; ShortByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-595"></span><span>        </span><span id="local-6989586621679279605"><span class="annot"><span class="annottext">MutableByteArray s
</span><a href="#local-6989586621679279605"><span class="hs-identifier hs-var">byteArray</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ST s (MutableByteArray (PrimState (ST s)))
forall (m :: * -&gt; *).
PrimMonad m =&gt;
Int -&gt; m (MutableByteArray (PrimState m))
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#newByteArray"><span class="hs-identifier hs-var">BA.newByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279607"><span class="hs-identifier hs-var">repSize</span></a></span><span>
</span><span id="line-596"></span><span>        </span><span class="annot"><span class="annottext">[(Int, (Word16, Word16, Word64))]
-&gt; ((Int, (Word16, Word16, Word64)) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[(Int, (Word16, Word16, Word64))]
</span><a href="#local-6989586621679279563"><span class="hs-identifier hs-var">preparedTriples</span></a></span><span> </span><span class="annot"><span class="annottext">(((Int, (Word16, Word16, Word64)) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((Int, (Word16, Word16, Word64)) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679279608"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279608"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279609"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279609"><span class="hs-identifier hs-var">pidoff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279610"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279610"><span class="hs-identifier hs-var">anoff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279611"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279611"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-597"></span><span>          </span><span class="hs-keyword">do</span><span>
</span><span id="line-598"></span><span>            </span><span class="hs-comment">-- For each triple, we write the quantity to region A,</span><span>
</span><span id="line-599"></span><span>            </span><span class="hs-comment">-- the pid offset to region B, and the asset name offset to region C.</span><span>
</span><span id="line-600"></span><span>            </span><span class="hs-comment">-- We can calculate the sizes (and therefore the starts) of each region</span><span>
</span><span id="line-601"></span><span>            </span><span class="hs-comment">-- using the number of triples.</span><span>
</span><span id="line-602"></span><span>            </span><span class="hs-comment">-- A:</span><span>
</span><span id="line-603"></span><span>            </span><span class="hs-comment">--   size: (#triples * 8) bytes</span><span>
</span><span id="line-604"></span><span>            </span><span class="hs-comment">--   start: offset 0</span><span>
</span><span id="line-605"></span><span>            </span><span class="hs-comment">-- B:</span><span>
</span><span id="line-606"></span><span>            </span><span class="hs-comment">--   size: (#triples * 2) bytes</span><span>
</span><span id="line-607"></span><span>            </span><span class="hs-comment">--   start: size(A) = #triples * 8</span><span>
</span><span id="line-608"></span><span>            </span><span class="hs-comment">-- C:</span><span>
</span><span id="line-609"></span><span>            </span><span class="hs-comment">--   size: (#triples * 2) bytes</span><span>
</span><span id="line-610"></span><span>            </span><span class="hs-comment">--   start: size(A) + size(B) = #triples * 10</span><span>
</span><span id="line-611"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-612"></span><span>            </span><span class="hs-comment">-- The position argument to writeByteArray is an index in terms of the</span><span>
</span><span id="line-613"></span><span>            </span><span class="hs-comment">-- size of the value being written. So writeByteArray of a Word64 at</span><span>
</span><span id="line-614"></span><span>            </span><span class="hs-comment">-- position 1 writes at offset 8.</span><span>
</span><span id="line-615"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-616"></span><span>            </span><span class="hs-comment">-- For the following, the byte offsets calculated above are converted to</span><span>
</span><span id="line-617"></span><span>            </span><span class="hs-comment">-- ByteArray positions by division.</span><span>
</span><span id="line-618"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-619"></span><span>            </span><span class="hs-comment">-- The byte offset of the ith...</span><span>
</span><span id="line-620"></span><span>            </span><span class="hs-comment">--   quantity: 8i</span><span>
</span><span id="line-621"></span><span>            </span><span class="hs-comment">--   pid offset: 8n + 2i</span><span>
</span><span id="line-622"></span><span>            </span><span class="hs-comment">--   asset name offset: 8n + 2n + 2i</span><span>
</span><span id="line-623"></span><span>            </span><span class="hs-comment">-- Dividing by the respective sizes (8,2,2) yields the indices below.</span><span>
</span><span id="line-624"></span><span>            </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; Int -&gt; Word64 -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#writeByteArray"><span class="hs-identifier hs-var">BA.writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679279605"><span class="hs-identifier hs-var">byteArray</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279608"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279611"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-625"></span><span>            </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; Int -&gt; Word16 -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#writeByteArray"><span class="hs-identifier hs-var">BA.writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679279605"><span class="hs-identifier hs-var">byteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279568"><span class="hs-identifier hs-var">numTriples</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279608"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279609"><span class="hs-identifier hs-var">pidoff</span></a></span><span>
</span><span id="line-626"></span><span>            </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; Int -&gt; Word16 -&gt; ST s ()
forall a (m :: * -&gt; *).
(Prim a, PrimMonad m) =&gt;
MutableByteArray (PrimState m) -&gt; Int -&gt; a -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#writeByteArray"><span class="hs-identifier hs-var">BA.writeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679279605"><span class="hs-identifier hs-var">byteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279568"><span class="hs-identifier hs-var">numTriples</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279608"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279610"><span class="hs-identifier hs-var">anoff</span></a></span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span>        </span><span class="annot"><span class="annottext">[(PolicyID, Word16)] -&gt; ((PolicyID, Word16) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyID Word16 -&gt; [(PolicyID, Word16)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID Word16
</span><a href="#local-6989586621679279614"><span class="hs-identifier hs-var">pidOffsetMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((PolicyID, Word16) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((PolicyID, Word16) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-629"></span><span>          </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span id="local-6989586621679279616"><span class="annot"><span class="annottext">Hash ADDRHASH EraIndependentScript
</span><a href="#local-6989586621679279616"><span class="hs-identifier hs-var">sh</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279617"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279617"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-630"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279618"><span class="annot"><span class="annottext">pidBytes :: ShortByteString
</span><a href="#local-6989586621679279618"><span class="hs-identifier hs-var hs-var">pidBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hash ADDRHASH EraIndependentScript -&gt; ShortByteString
forall h a. Hash h a -&gt; ShortByteString
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-crypto-class-2.2.3.1-587788bd0abb83ca86364e7e25fdd2cb1ce3c8f25ede4b71a1cb43e4a1d72f36/share/doc/html/src/Cardano.Crypto.Hash.Class.html#hashToBytesShort"><span class="hs-identifier hs-var">Hash.hashToBytesShort</span></a></span><span> </span><span class="annot"><span class="annottext">Hash ADDRHASH EraIndependentScript
</span><a href="#local-6989586621679279616"><span class="hs-identifier hs-var">sh</span></a></span><span>
</span><span id="line-631"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s))
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#copyByteArray"><span class="hs-identifier hs-var">BA.copyByteArray</span></a></span><span>
</span><span id="line-632"></span><span>                  </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679279605"><span class="hs-identifier hs-var">byteArray</span></a></span><span>
</span><span id="line-633"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279617"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279618"><span class="hs-identifier hs-var">pidBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-636"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279622"><span class="hs-identifier hs-var">pidSize</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>        </span><span class="annot"><span class="annottext">[(AssetName, Word16)]
-&gt; ((AssetName, Word16) -&gt; ST s ()) -&gt; ST s ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map AssetName Word16 -&gt; [(AssetName, Word16)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Word16
</span><a href="#local-6989586621679279623"><span class="hs-identifier hs-var">assetNameOffsetMap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(((AssetName, Word16) -&gt; ST s ()) -&gt; ST s ())
-&gt; ((AssetName, Word16) -&gt; ST s ()) -&gt; ST s ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-639"></span><span>          </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span id="local-6989586621679279624"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279624"><span class="hs-identifier hs-var">anameBS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279625"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279625"><span class="hs-identifier hs-var">offset</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-640"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279626"><span class="annot"><span class="annottext">anameBytes :: ShortByteString
</span><a href="#local-6989586621679279626"><span class="hs-identifier hs-var hs-var">anameBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279624"><span class="hs-identifier hs-var">anameBS</span></a></span><span>
</span><span id="line-641"></span><span>                </span><span id="local-6989586621679279627"><span class="annot"><span class="annottext">anameLen :: Int
</span><a href="#local-6989586621679279627"><span class="hs-identifier hs-var hs-var">anameLen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><span class="hs-identifier hs-var">SBS.length</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279624"><span class="hs-identifier hs-var">anameBS</span></a></span><span>
</span><span id="line-642"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s))
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; ST s ()
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m)
-&gt; Int -&gt; ByteArray -&gt; Int -&gt; Int -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#copyByteArray"><span class="hs-identifier hs-var">BA.copyByteArray</span></a></span><span>
</span><span id="line-643"></span><span>                  </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679279605"><span class="hs-identifier hs-var">byteArray</span></a></span><span>
</span><span id="line-644"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279625"><span class="hs-identifier hs-var">offset</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279626"><span class="hs-identifier hs-var">anameBytes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-647"></span><span>                  </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279627"><span class="hs-identifier hs-var">anameLen</span></a></span><span>
</span><span id="line-648"></span><span>        </span><span class="annot"><span class="annottext">ByteArray -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-var">byteArrayToSbs</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteArray -&gt; ShortByteString)
-&gt; ST s ByteArray -&gt; ST s ShortByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">MutableByteArray (PrimState (ST s)) -&gt; ST s ByteArray
forall (m :: * -&gt; *).
PrimMonad m =&gt;
MutableByteArray (PrimState m) -&gt; m ByteArray
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#unsafeFreezeByteArray"><span class="hs-identifier hs-var">BA.unsafeFreezeByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">MutableByteArray s
MutableByteArray (PrimState (ST s))
</span><a href="#local-6989586621679279605"><span class="hs-identifier hs-var">byteArray</span></a></span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-650"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679279562"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279562"><span class="hs-identifier hs-var">ada</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279567"><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279567"><span class="hs-identifier hs-var">triples</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaryValue -&gt; (Coin, [(PolicyID, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var">gettriples</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279559"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-651"></span><span>    </span><span id="local-6989586621679279568"><span class="annot"><span class="annottext">numTriples :: Int
</span><a href="#local-6989586621679279568"><span class="hs-identifier hs-var hs-var">numTriples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279567"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span>    </span><span class="hs-comment">-- abcRegionSize is the combined size of regions A, B, and C</span><span>
</span><span id="line-654"></span><span>    </span><span id="local-6989586621679279631"><span class="annot"><span class="annottext">abcRegionSize :: Int
</span><a href="#local-6989586621679279631"><span class="hs-identifier hs-var hs-var">abcRegionSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279568"><span class="hs-identifier hs-var">numTriples</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>    </span><span id="local-6989586621679279622"><span class="annot"><span class="annottext">pidSize :: Int
</span><a href="#local-6989586621679279622"><span class="hs-identifier hs-var hs-var">pidSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ADDRHASH -&gt; Word
forall h (proxy :: * -&gt; *). HashAlgorithm h =&gt; proxy h -&gt; Word
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-crypto-class-2.2.3.1-587788bd0abb83ca86364e7e25fdd2cb1ce3c8f25ede4b71a1cb43e4a1d72f36/share/doc/html/src/Cardano.Crypto.Hash.Class.html#sizeHash"><span class="hs-identifier hs-var">Hash.sizeHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ADDRHASH
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ADDRHASH"><span class="hs-identifier hs-type">ADDRHASH</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-comment">-- pids is the collection of all distinct pids</span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621679279637"><span class="annot"><span class="annottext">pids :: Set PolicyID
</span><a href="#local-6989586621679279637"><span class="hs-identifier hs-var hs-var">pids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[PolicyID] -&gt; Set PolicyID
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([PolicyID] -&gt; Set PolicyID) -&gt; [PolicyID] -&gt; Set PolicyID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679279639"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279639"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279639"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID, AssetName, Integer) -&gt; PolicyID)
-&gt; [(PolicyID, AssetName, Integer)] -&gt; [PolicyID]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279567"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><a href="#local-6989586621679279614"><span class="hs-identifier hs-type">pidOffsetMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-662"></span><span>    </span><span id="local-6989586621679279614"><span class="annot"><span class="annottext">pidOffsetMap :: Map PolicyID Word16
</span><a href="#local-6989586621679279614"><span class="hs-identifier hs-var hs-var">pidOffsetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>      </span><span class="hs-comment">-- the pid offsets are:</span><span>
</span><span id="line-664"></span><span>      </span><span class="hs-comment">--   X, X + s, X + 2s, X + 3s, ...</span><span>
</span><span id="line-665"></span><span>      </span><span class="hs-comment">-- where X is the start of block D and s is the size of a pid</span><span>
</span><span id="line-666"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279640"><span class="annot"><span class="annottext">offsets :: [Word16]
</span><a href="#local-6989586621679279640"><span class="hs-identifier hs-var hs-var">offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-667"></span><span>            </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; [Word16]
forall a. Enum a =&gt; a -&gt; a -&gt; [a]
</span><span class="hs-identifier hs-var">enumFromThen</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279631"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279631"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279622"><span class="hs-identifier hs-var">pidSize</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(PolicyID, Word16)] -&gt; Map PolicyID Word16
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PolicyID] -&gt; [Word16] -&gt; [(PolicyID, Word16)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set PolicyID -&gt; [PolicyID]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set PolicyID
</span><a href="#local-6989586621679279637"><span class="hs-identifier hs-var">pids</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621679279640"><span class="hs-identifier hs-var">offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span>    </span><span id="local-6989586621679279646"><span class="annot"><span class="annottext">pidOffset :: PolicyID -&gt; Word16
</span><a href="#local-6989586621679279646"><span class="hs-identifier hs-var hs-var">pidOffset</span></a></span></span><span> </span><span id="local-6989586621679279647"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279647"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Word16 -&gt; Word16
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID -&gt; Map PolicyID Word16 -&gt; Maybe Word16
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279647"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID Word16
</span><a href="#local-6989586621679279614"><span class="hs-identifier hs-var">pidOffsetMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>
</span><span id="line-672"></span><span>    </span><span id="local-6989586621679279649"><span class="annot"><span class="annottext">pidBlockSize :: Int
</span><a href="#local-6989586621679279649"><span class="hs-identifier hs-var hs-var">pidBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set PolicyID -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set PolicyID
</span><a href="#local-6989586621679279637"><span class="hs-identifier hs-var">pids</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279622"><span class="hs-identifier hs-var">pidSize</span></a></span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span>    </span><span class="hs-comment">-- Putting asset names in descending order ensures that the empty string</span><span>
</span><span id="line-675"></span><span>    </span><span class="hs-comment">-- is last, so the associated offset is pointing to the end of the array</span><span>
</span><span id="line-676"></span><span>    </span><span id="local-6989586621679279651"><span class="annot"><span class="annottext">assetNames :: [AssetName]
</span><a href="#local-6989586621679279651"><span class="hs-identifier hs-var hs-var">assetNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set AssetName -&gt; [AssetName]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toDescList</span></span><span> </span><span class="annot"><span class="annottext">(Set AssetName -&gt; [AssetName]) -&gt; Set AssetName -&gt; [AssetName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[AssetName] -&gt; Set AssetName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([AssetName] -&gt; Set AssetName) -&gt; [AssetName] -&gt; Set AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279653"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279653"><span class="hs-identifier hs-var">an</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279653"><span class="hs-identifier hs-var">an</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID, AssetName, Integer) -&gt; AssetName)
-&gt; [(PolicyID, AssetName, Integer)] -&gt; [AssetName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279567"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span>    </span><span id="local-6989586621679279654"><span class="annot"><span class="annottext">assetNameLengths :: [Int]
</span><a href="#local-6989586621679279654"><span class="hs-identifier hs-var hs-var">assetNameLengths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (AssetName -&gt; Int) -&gt; AssetName -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><span class="hs-identifier hs-var">SBS.length</span></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Int)
-&gt; (AssetName -&gt; ShortByteString) -&gt; AssetName -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameBytes"><span class="hs-identifier hs-var">assetNameBytes</span></a></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Int) -&gt; [AssetName] -&gt; [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[AssetName]
</span><a href="#local-6989586621679279651"><span class="hs-identifier hs-var">assetNames</span></a></span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>    </span><span class="annot"><a href="#local-6989586621679279623"><span class="hs-identifier hs-type">assetNameOffsetMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span>
</span><span id="line-681"></span><span>    </span><span id="local-6989586621679279623"><span class="annot"><span class="annottext">assetNameOffsetMap :: Map AssetName Word16
</span><a href="#local-6989586621679279623"><span class="hs-identifier hs-var hs-var">assetNameOffsetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-682"></span><span>      </span><span class="hs-comment">-- The asset name offsets are the running sum of the asset lengths,</span><span>
</span><span id="line-683"></span><span>      </span><span class="hs-comment">-- but starting with the offset of the start of block E.</span><span>
</span><span id="line-684"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279655"><span class="annot"><span class="annottext">offsets :: [Int]
</span><a href="#local-6989586621679279655"><span class="hs-identifier hs-var hs-var">offsets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int -&gt; Int) -&gt; Int -&gt; [Int] -&gt; [Int]
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">scanl</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279631"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279649"><span class="hs-identifier hs-var">pidBlockSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679279654"><span class="hs-identifier hs-var">assetNameLengths</span></a></span><span>
</span><span id="line-685"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word16) -&gt; Map AssetName Int -&gt; Map AssetName Word16
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(AssetName, Int)] -&gt; Map AssetName Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[AssetName] -&gt; [Int] -&gt; [(AssetName, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[AssetName]
</span><a href="#local-6989586621679279651"><span class="hs-identifier hs-var">assetNames</span></a></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679279655"><span class="hs-identifier hs-var">offsets</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span>    </span><span id="local-6989586621679279660"><span class="annot"><span class="annottext">assetNameOffset :: AssetName -&gt; Word16
</span><a href="#local-6989586621679279660"><span class="hs-identifier hs-var hs-var">assetNameOffset</span></a></span></span><span> </span><span id="local-6989586621679279661"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279661"><span class="hs-identifier hs-var">aname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Word16 -&gt; Word16
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName -&gt; Map AssetName Word16 -&gt; Maybe Word16
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279661"><span class="hs-identifier hs-var">aname</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Word16
</span><a href="#local-6989586621679279623"><span class="hs-identifier hs-var">assetNameOffsetMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>    </span><span id="local-6989586621679279662"><span class="annot"><span class="annottext">anameBlockSize :: Int
</span><a href="#local-6989586621679279662"><span class="hs-identifier hs-var hs-var">anameBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span> </span><span class="annot"><span class="annottext">[Int]
</span><a href="#local-6989586621679279654"><span class="hs-identifier hs-var">assetNameLengths</span></a></span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span>    </span><span class="hs-comment">-- size = size(A+B+C)      + size(D)      + size(E)</span><span>
</span><span id="line-692"></span><span>    </span><span id="local-6989586621679279607"><span class="annot"><span class="annottext">repSize :: Int
</span><a href="#local-6989586621679279607"><span class="hs-identifier hs-var hs-var">repSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279631"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279649"><span class="hs-identifier hs-var">pidBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279662"><span class="hs-identifier hs-var">anameBlockSize</span></a></span><span>
</span><span id="line-693"></span><span>
</span><span id="line-694"></span><span>    </span><span id="local-6989586621679279566"><span class="annot"><span class="annottext">prepare :: (PolicyID, AssetName, Integer) -&gt; Maybe (Word16, Word16, Word64)
</span><a href="#local-6989586621679279566"><span class="hs-identifier hs-var hs-var">prepare</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279666"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279666"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279667"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279667"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279668"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279668"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-695"></span><span>      </span><span id="local-6989586621679279669"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279669"><span class="hs-identifier hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#integerToWord64"><span class="hs-identifier hs-var">integerToWord64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279668"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-696"></span><span>      </span><span class="annot"><span class="annottext">(Word16, Word16, Word64) -&gt; Maybe (Word16, Word16, Word64)
forall a. a -&gt; Maybe a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID -&gt; Word16
</span><a href="#local-6989586621679279646"><span class="hs-identifier hs-var">pidOffset</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279666"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; Word16
</span><a href="#local-6989586621679279660"><span class="hs-identifier hs-var">assetNameOffset</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279667"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279669"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-697"></span><span>
</span><span id="line-698"></span><span class="hs-comment">-- | Unlike `representationSize`, this function cheaply checks whether</span><span>
</span><span id="line-699"></span><span class="hs-comment">-- any offset within a MultiAsset compact representation is likely to overflow Word16.</span><span>
</span><span id="line-700"></span><span class="hs-comment">--</span><span>
</span><span id="line-701"></span><span class="hs-comment">-- compact form inequality:</span><span>
</span><span id="line-702"></span><span class="hs-comment">--   8n (Word64) + 2n (Word16) + 2n (Word16) + 28p (policy ids) + sum of lengths of unique asset names &lt;= 65535</span><span>
</span><span id="line-703"></span><span class="hs-comment">-- maximum size for the asset name is 32 bytes, so:</span><span>
</span><span id="line-704"></span><span class="hs-comment">-- 8n + 2n + 2n + 28p + 32n &lt;= 65535</span><span>
</span><span id="line-705"></span><span class="hs-comment">-- where: n = total number of assets, p = number of unique policy ids</span><span>
</span><span id="line-706"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#isMultiAssetSmallEnough"><span class="hs-identifier hs-type">isMultiAssetSmallEnough</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-707"></span><span id="isMultiAssetSmallEnough"><span class="annot"><span class="annottext">isMultiAssetSmallEnough :: MultiAsset -&gt; Bool
</span><a href="Cardano.Ledger.Mary.Value.html#isMultiAssetSmallEnough"><span class="hs-identifier hs-var hs-var">isMultiAssetSmallEnough</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279670"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279670"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-708"></span><span>  </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">44</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Sum Int -&gt; Int
forall a. Sum a -&gt; a
</span><span class="hs-identifier hs-var">M.getSum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Sum Int)
-&gt; Map PolicyID (Map AssetName Integer) -&gt; Sum Int
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Map PolicyID a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Sum Int
forall a. a -&gt; Sum a
</span><span class="hs-identifier hs-var">M.Sum</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Sum Int)
-&gt; (Map AssetName Integer -&gt; Int)
-&gt; Map AssetName Integer
-&gt; Sum Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Int
forall a. Map AssetName a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279670"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">28</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; Int
forall a. Map PolicyID a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279670"><span class="hs-identifier hs-var">ma</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">65535</span></span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier hs-type">representationSize</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-712"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-713"></span><span id="representationSize"><span class="annot"><span class="annottext">representationSize :: [(PolicyID, AssetName, Integer)] -&gt; Int
</span><a href="Cardano.Ledger.Mary.Value.html#representationSize"><span class="hs-identifier hs-var hs-var">representationSize</span></a></span></span><span> </span><span id="local-6989586621679279671"><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279671"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279672"><span class="hs-identifier hs-var">abcRegionSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279673"><span class="hs-identifier hs-var">pidBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279674"><span class="hs-identifier hs-var">anameBlockSize</span></a></span><span>
</span><span id="line-714"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-715"></span><span>    </span><span id="local-6989586621679279675"><span class="annot"><span class="annottext">len :: Int
</span><a href="#local-6989586621679279675"><span class="hs-identifier hs-var hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279671"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-716"></span><span>    </span><span id="local-6989586621679279672"><span class="annot"><span class="annottext">abcRegionSize :: Int
</span><a href="#local-6989586621679279672"><span class="hs-identifier hs-var hs-var">abcRegionSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279675"><span class="hs-identifier hs-var">len</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">12</span></span><span>
</span><span id="line-717"></span><span>
</span><span id="line-718"></span><span>    </span><span id="local-6989586621679279676"><span class="annot"><span class="annottext">numPids :: Int
</span><a href="#local-6989586621679279676"><span class="hs-identifier hs-var hs-var">numPids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set PolicyID -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">(Set PolicyID -&gt; Int)
-&gt; ([PolicyID] -&gt; Set PolicyID) -&gt; [PolicyID] -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[PolicyID] -&gt; Set PolicyID
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([PolicyID] -&gt; Int) -&gt; [PolicyID] -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679279677"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279677"><span class="hs-identifier hs-var">pid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279677"><span class="hs-identifier hs-var">pid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID, AssetName, Integer) -&gt; PolicyID)
-&gt; [(PolicyID, AssetName, Integer)] -&gt; [PolicyID]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279671"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-719"></span><span>    </span><span id="local-6989586621679279681"><span class="annot"><span class="annottext">pidSize :: Int
</span><a href="#local-6989586621679279681"><span class="hs-identifier hs-var hs-var">pidSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ADDRHASH -&gt; Word
forall h (proxy :: * -&gt; *). HashAlgorithm h =&gt; proxy h -&gt; Word
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-crypto-class-2.2.3.1-587788bd0abb83ca86364e7e25fdd2cb1ce3c8f25ede4b71a1cb43e4a1d72f36/share/doc/html/src/Cardano.Crypto.Hash.Class.html#sizeHash"><span class="hs-identifier hs-var">Hash.sizeHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy ADDRHASH
forall {k} (t :: k). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Proxy</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ADDRHASH"><span class="hs-identifier hs-type">ADDRHASH</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>    </span><span id="local-6989586621679279673"><span class="annot"><span class="annottext">pidBlockSize :: Int
</span><a href="#local-6989586621679279673"><span class="hs-identifier hs-var hs-var">pidBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279676"><span class="hs-identifier hs-var">numPids</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279681"><span class="hs-identifier hs-var">pidSize</span></a></span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span>    </span><span id="local-6989586621679279682"><span class="annot"><span class="annottext">assetNames :: Set AssetName
</span><a href="#local-6989586621679279682"><span class="hs-identifier hs-var hs-var">assetNames</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[AssetName] -&gt; Set AssetName
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([AssetName] -&gt; Set AssetName) -&gt; [AssetName] -&gt; Set AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279683"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279683"><span class="hs-identifier hs-var">an</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279683"><span class="hs-identifier hs-var">an</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PolicyID, AssetName, Integer) -&gt; AssetName)
-&gt; [(PolicyID, AssetName, Integer)] -&gt; [AssetName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279671"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-723"></span><span>    </span><span id="local-6989586621679279674"><span class="annot"><span class="annottext">anameBlockSize :: Int
</span><a href="#local-6989586621679279674"><span class="hs-identifier hs-var hs-var">anameBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-724"></span><span>      </span><span class="annot"><span class="annottext">Sum Int -&gt; Int
forall a. Sum a -&gt; a
</span><span class="hs-identifier hs-var">Semigroup.getSum</span></span><span> </span><span class="annot"><span class="annottext">(Sum Int -&gt; Int) -&gt; Sum Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Sum Int) -&gt; Set AssetName -&gt; Sum Int
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Sum Int
forall a. a -&gt; Sum a
</span><span class="hs-identifier hs-var">Semigroup.Sum</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Sum Int) -&gt; (AssetName -&gt; Int) -&gt; AssetName -&gt; Sum Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><span class="hs-identifier hs-var">SBS.length</span></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Int)
-&gt; (AssetName -&gt; ShortByteString) -&gt; AssetName -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">AssetName -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#assetNameBytes"><span class="hs-identifier hs-var">assetNameBytes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set AssetName
</span><a href="#local-6989586621679279682"><span class="hs-identifier hs-var">assetNames</span></a></span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-type">from</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValue"><span class="hs-identifier hs-type">CompactValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span>
</span><span id="line-727"></span><span id="from"><span class="annot"><span class="annottext">from :: CompactValue -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var hs-var">from</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueAdaOnly"><span class="hs-identifier hs-type">CompactValueAdaOnly</span></a></span><span> </span><span id="local-6989586621679279684"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279684"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Coin
forall a. Compactible a =&gt; CompactForm a -&gt; a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-var">fromCompact</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279684"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#from"><span class="hs-identifier hs-var">from</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#CompactValueMultiAsset"><span class="hs-identifier hs-type">CompactValueMultiAsset</span></a></span><span> </span><span id="local-6989586621679279685"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279685"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679279686"><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279686"><span class="hs-identifier hs-var">numAssets</span></a></span></span><span> </span><span id="local-6989586621679279687"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279687"><span class="hs-identifier hs-var">rep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-729"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279688"><span class="annot"><span class="annottext">mv :: MaryValue
</span><a href="#local-6989586621679279688"><span class="hs-identifier hs-var">mv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679279689"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279689"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; [(PolicyID, AssetName, Integer)] -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier hs-var">valueFromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Coin
forall a. Compactible a =&gt; CompactForm a -&gt; a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-var">fromCompact</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679279685"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279690"><span class="hs-identifier hs-var">triples</span></a></span><span>
</span><span id="line-730"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; MaryValue -&gt; MaryValue
forall a. HasCallStack =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MultiAsset -&gt; Bool
</span><a href="Cardano.Ledger.Mary.Value.html#isMultiAssetSmallEnough"><span class="hs-identifier hs-var">isMultiAssetSmallEnough</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279689"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279688"><span class="hs-identifier hs-var">mv</span></a></span><span>
</span><span id="line-731"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-732"></span><span>    </span><span id="local-6989586621679279691"><span class="annot"><span class="annottext">n :: Int
</span><a href="#local-6989586621679279691"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279686"><span class="hs-identifier hs-var">numAssets</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>    </span><span id="local-6989586621679279692"><span class="annot"><span class="annottext">ba :: ByteArray
</span><a href="#local-6989586621679279692"><span class="hs-identifier hs-var hs-var">ba</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279687"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span>    </span><span class="annot"><a href="#local-6989586621679279693"><span class="hs-identifier hs-type">getTripleForIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>    </span><span id="local-6989586621679279693"><span class="annot"><span class="annottext">getTripleForIndex :: Int -&gt; (Word16, Word16, Word64)
</span><a href="#local-6989586621679279693"><span class="hs-identifier hs-var hs-var">getTripleForIndex</span></a></span></span><span> </span><span id="local-6989586621679279694"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279694"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-738"></span><span>      </span><span class="hs-comment">-- indexByteArray indices are in terms of the size of the value being indexed</span><span>
</span><span id="line-739"></span><span>      </span><span class="hs-comment">-- rather than byte offsets.</span><span>
</span><span id="line-740"></span><span>      </span><span class="hs-comment">-- The corresponding byte offsets are:</span><span>
</span><span id="line-741"></span><span>      </span><span class="hs-comment">-- q: 0 + 8i</span><span>
</span><span id="line-742"></span><span>      </span><span class="hs-comment">-- pidix: 8n + 2i</span><span>
</span><span id="line-743"></span><span>      </span><span class="hs-comment">-- anameix: 8n + 2n + 2i</span><span>
</span><span id="line-744"></span><span>      </span><span class="hs-comment">-- Dividing by the sized (resp 8,2,2) yields the indices below</span><span>
</span><span id="line-745"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279695"><span class="annot"><span class="annottext">q :: Word64
</span><a href="#local-6989586621679279695"><span class="hs-identifier hs-var hs-var">q</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Word64
forall a. Prim a =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#indexByteArray"><span class="hs-identifier hs-var">BA.indexByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621679279692"><span class="hs-identifier hs-var">ba</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279694"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-746"></span><span>          </span><span id="local-6989586621679279697"><span class="annot"><span class="annottext">pidix :: Word16
</span><a href="#local-6989586621679279697"><span class="hs-identifier hs-var hs-var">pidix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Word16
forall a. Prim a =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#indexByteArray"><span class="hs-identifier hs-var">BA.indexByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621679279692"><span class="hs-identifier hs-var">ba</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279691"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279694"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-747"></span><span>          </span><span id="local-6989586621679279698"><span class="annot"><span class="annottext">anameix :: Word16
</span><a href="#local-6989586621679279698"><span class="hs-identifier hs-var hs-var">anameix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Word16
forall a. Prim a =&gt; ByteArray -&gt; Int -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#indexByteArray"><span class="hs-identifier hs-var">BA.indexByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ByteArray
</span><a href="#local-6989586621679279692"><span class="hs-identifier hs-var">ba</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279691"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279694"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-748"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279697"><span class="hs-identifier hs-var">pidix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279698"><span class="hs-identifier hs-var">anameix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279695"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>
</span><span id="line-750"></span><span>    </span><span class="hs-comment">-- raw triples :: [(pid offset, asset name offset, quantity)]</span><span>
</span><span id="line-751"></span><span>    </span><span class="annot"><a href="#local-6989586621679279699"><span class="hs-identifier hs-type">rawTriples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-752"></span><span>    </span><span id="local-6989586621679279699"><span class="annot"><span class="annottext">rawTriples :: [(Word16, Word16, Word64)]
</span><a href="#local-6989586621679279699"><span class="hs-identifier hs-var hs-var">rawTriples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; (Word16, Word16, Word64))
-&gt; [Int] -&gt; [(Word16, Word16, Word64)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; (Word16, Word16, Word64)
</span><a href="#local-6989586621679279693"><span class="hs-identifier hs-var">getTripleForIndex</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Int) -&gt; Word32 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679279686"><span class="hs-identifier hs-var">numAssets</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Word32 -&gt; Word32
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span>    </span><span class="annot"><a href="#local-6989586621679279690"><span class="hs-identifier hs-type">triples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-755"></span><span>    </span><span id="local-6989586621679279690"><span class="annot"><span class="annottext">triples :: [(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279690"><span class="hs-identifier hs-var hs-var">triples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Word16, Word16, Word64) -&gt; (PolicyID, AssetName, Integer))
-&gt; [(Word16, Word16, Word64)] -&gt; [(PolicyID, AssetName, Integer)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Word16, Word16, Word64) -&gt; (PolicyID, AssetName, Integer)
</span><a href="#local-6989586621679279700"><span class="hs-identifier hs-var">convertTriple</span></a></span><span> </span><span class="annot"><span class="annottext">[(Word16, Word16, Word64)]
</span><a href="#local-6989586621679279699"><span class="hs-identifier hs-var">rawTriples</span></a></span><span>
</span><span id="line-756"></span><span>
</span><span id="line-757"></span><span>    </span><span class="hs-comment">-- Asset name length are calculated by subtracting the offset from the</span><span>
</span><span id="line-758"></span><span>    </span><span class="hs-comment">-- next greater offset (or from the end of the rep, if there is none.)</span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-comment">-- For an index pointing to the end of the array, the associated</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-comment">-- length will be: offset - length(rep) = 0</span><span>
</span><span id="line-761"></span><span>    </span><span id="local-6989586621679279701"><span class="annot"><span class="annottext">assetLens :: Map Word16 Int
</span><a href="#local-6989586621679279701"><span class="hs-identifier hs-var hs-var">assetLens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-762"></span><span>      </span><span class="hs-comment">-- This assumes that the triples are ordered by nondecreasing asset name offset</span><span>
</span><span id="line-763"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279703"><span class="annot"><span class="annottext">ixs :: [Word16]
</span><a href="#local-6989586621679279703"><span class="hs-identifier hs-var hs-var">ixs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word16] -&gt; [Word16]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="Cardano.Ledger.Mary.Value.html#nubOrd"><span class="hs-identifier hs-var">nubOrd</span></a></span><span> </span><span class="annot"><span class="annottext">([Word16] -&gt; [Word16]) -&gt; [Word16] -&gt; [Word16]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Word16, Word16, Word64) -&gt; Word16)
-&gt; [(Word16, Word16, Word64)] -&gt; [Word16]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279705"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279705"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279705"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Word16, Word16, Word64)]
</span><a href="#local-6989586621679279699"><span class="hs-identifier hs-var">rawTriples</span></a></span><span>
</span><span id="line-764"></span><span>          </span><span id="local-6989586621679279706"><span class="annot"><span class="annottext">ixPairs :: [(Word16, Word16)]
</span><a href="#local-6989586621679279706"><span class="hs-identifier hs-var hs-var">ixPairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Word16] -&gt; [Word16] -&gt; [(Word16, Word16)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621679279703"><span class="hs-identifier hs-var">ixs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; [Word16] -&gt; [Word16]
forall a. Int -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">drop</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">[Word16]
</span><a href="#local-6989586621679279703"><span class="hs-identifier hs-var">ixs</span></a></span><span> </span><span class="annot"><span class="annottext">[Word16] -&gt; [Word16] -&gt; [Word16]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int -&gt; Word16
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word16) -&gt; Int -&gt; Word16
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int
</span><span class="hs-identifier hs-var">SBS.length</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279687"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[(Word16, Int)] -&gt; Map Word16 Int
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(Word16, Int)] -&gt; Map Word16 Int)
-&gt; [(Word16, Int)] -&gt; Map Word16 Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679279708"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279708"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279709"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279709"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279708"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Int) -&gt; Word16 -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279709"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279708"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Word16, Word16) -&gt; (Word16, Int))
-&gt; [(Word16, Word16)] -&gt; [(Word16, Int)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Word16, Word16)]
</span><a href="#local-6989586621679279706"><span class="hs-identifier hs-var">ixPairs</span></a></span><span>
</span><span id="line-766"></span><span>    </span><span class="annot"><a href="#local-6989586621679279710"><span class="hs-identifier hs-type">assetLen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-767"></span><span>    </span><span id="local-6989586621679279710"><span class="annot"><span class="annottext">assetLen :: Word16 -&gt; Int
</span><a href="#local-6989586621679279710"><span class="hs-identifier hs-var hs-var">assetLen</span></a></span></span><span> </span><span id="local-6989586621679279711"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279711"><span class="hs-identifier hs-var">ix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Int -&gt; Int
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Map Word16 Int -&gt; Maybe Int
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279711"><span class="hs-identifier hs-var">ix</span></a></span><span> </span><span class="annot"><span class="annottext">Map Word16 Int
</span><a href="#local-6989586621679279701"><span class="hs-identifier hs-var">assetLens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>    </span><span class="annot"><a href="#local-6989586621679279700"><span class="hs-identifier hs-type">convertTriple</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-770"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-771"></span><span>    </span><span id="local-6989586621679279700"><span class="annot"><span class="annottext">convertTriple :: (Word16, Word16, Word64) -&gt; (PolicyID, AssetName, Integer)
</span><a href="#local-6989586621679279700"><span class="hs-identifier hs-var hs-var">convertTriple</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279712"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279712"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279713"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279713"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279714"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279714"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-772"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; PolicyID
</span><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-var">PolicyID</span></a></span><span> </span><span class="annot"><span class="annottext">(ScriptHash -&gt; PolicyID) -&gt; ScriptHash -&gt; PolicyID
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-773"></span><span>          </span><span class="annot"><span class="annottext">Hash ADDRHASH EraIndependentScript -&gt; ScriptHash
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-var">ScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Hash ADDRHASH EraIndependentScript -&gt; ScriptHash)
-&gt; Hash ADDRHASH EraIndependentScript -&gt; ScriptHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-774"></span><span>            </span><span class="annot"><span class="annottext">ShortByteString -&gt; Hash ADDRHASH EraIndependentScript
forall h a. HashAlgorithm h =&gt; ShortByteString -&gt; Hash h a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-crypto-class-2.2.3.1-587788bd0abb83ca86364e7e25fdd2cb1ce3c8f25ede4b71a1cb43e4a1d72f36/share/doc/html/src/Cardano.Crypto.Hash.Class.html#UnsafeHash"><span class="hs-identifier hs-var">Hash.UnsafeHash</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; Hash ADDRHASH EraIndependentScript)
-&gt; ShortByteString -&gt; Hash ADDRHASH EraIndependentScript
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-775"></span><span>              </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; Int -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-var">readShortByteString</span></a></span><span>
</span><span id="line-776"></span><span>                </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279687"><span class="hs-identifier hs-var">rep</span></a></span><span>
</span><span id="line-777"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279712"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">(Word -&gt; Int) -&gt; Word -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[ADDRHASH] -&gt; Word
forall h (proxy :: * -&gt; *). HashAlgorithm h =&gt; proxy h -&gt; Word
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-crypto-class-2.2.3.1-587788bd0abb83ca86364e7e25fdd2cb1ce3c8f25ede4b71a1cb43e4a1d72f36/share/doc/html/src/Cardano.Crypto.Hash.Class.html#sizeHash"><span class="hs-identifier hs-var">Hash.sizeHash</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ADDRHASH"><span class="hs-identifier hs-type">ADDRHASH</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-779"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; AssetName
</span><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-var">AssetName</span></a></span><span> </span><span class="annot"><span class="annottext">(ShortByteString -&gt; AssetName) -&gt; ShortByteString -&gt; AssetName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShortByteString -&gt; Int -&gt; Int -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-var">readShortByteString</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279687"><span class="hs-identifier hs-var">rep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279713"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16 -&gt; Int
</span><a href="#local-6989586621679279710"><span class="hs-identifier hs-var">assetLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679279713"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-780"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679279714"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-781"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span class="annot"><span class="hs-comment">-- | Strip out duplicates</span></span><span>
</span><span id="line-784"></span><span id="local-6989586621679277938"><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#nubOrd"><span class="hs-identifier hs-type">nubOrd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679277938"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679277938"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679277938"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-785"></span><span id="nubOrd"><span class="annot"><span class="annottext">nubOrd :: forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="Cardano.Ledger.Mary.Value.html#nubOrd"><span class="hs-identifier hs-var hs-var">nubOrd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-786"></span><span>  </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
forall {a}. Ord a =&gt; Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679279721"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-787"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-788"></span><span>    </span><span id="local-6989586621679279721"><span class="annot"><span class="annottext">loop :: Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679279721"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-789"></span><span>    </span><span class="annot"><a href="#local-6989586621679279721"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span id="local-6989586621679279727"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679279727"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279728"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279728"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679279729"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679279729"><span class="hs-keyword hs-var">as</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-790"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279728"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679279727"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679279721"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679279727"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679279729"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-791"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-792"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279731"><span class="annot"><span class="annottext">s' :: Set a
</span><a href="#local-6989586621679279731"><span class="hs-identifier hs-var hs-var">s'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Set a
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279728"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679279727"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679279731"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
forall a b. a -&gt; b -&gt; b
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279728"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; [a] -&gt; [a]
</span><a href="#local-6989586621679279721"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679279731"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679279729"><span class="hs-keyword hs-var">as</span></a></span><span>
</span><span id="line-793"></span><span>
</span><span id="line-794"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-type">sbsToByteArray</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BA.ByteArray</span></span><span>
</span><span id="line-795"></span><span id="sbsToByteArray"><span class="annot"><span class="annottext">sbsToByteArray :: ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var hs-var">sbsToByteArray</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SBS</span></span><span> </span><span id="local-6989586621679279733"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679279733"><span class="hs-identifier hs-var">bah</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; ByteArray
</span><span class="hs-identifier hs-var">BA.ByteArray</span></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679279733"><span class="hs-identifier hs-var">bah</span></a></span><span>
</span><span id="line-796"></span><span>
</span><span id="line-797"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-type">byteArrayToSbs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">BA.ByteArray</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortByteString</span></span><span>
</span><span id="line-798"></span><span id="byteArrayToSbs"><span class="annot"><span class="annottext">byteArrayToSbs :: ByteArray -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-var hs-var">byteArrayToSbs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BA.ByteArray</span></span><span> </span><span id="local-6989586621679279735"><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679279735"><span class="hs-identifier hs-var">bah</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteArray# -&gt; ShortByteString
</span><span class="hs-identifier hs-var">SBS</span></span><span> </span><span class="annot"><span class="annottext">ByteArray#
</span><a href="#local-6989586621679279735"><span class="hs-identifier hs-var">bah</span></a></span><span>
</span><span id="line-799"></span><span>
</span><span id="line-800"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-type">readShortByteString</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShortByteString</span></span><span>
</span><span id="line-801"></span><span id="readShortByteString"><span class="annot"><span class="annottext">readShortByteString :: ShortByteString -&gt; Int -&gt; Int -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#readShortByteString"><span class="hs-identifier hs-var hs-var">readShortByteString</span></a></span></span><span> </span><span id="local-6989586621679279736"><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279736"><span class="hs-identifier hs-var">sbs</span></a></span></span><span> </span><span id="local-6989586621679279737"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279737"><span class="hs-identifier hs-var">start</span></a></span></span><span> </span><span id="local-6989586621679279738"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279738"><span class="hs-identifier hs-var">len</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-802"></span><span>  </span><span class="annot"><span class="annottext">ByteArray -&gt; ShortByteString
</span><a href="Cardano.Ledger.Mary.Value.html#byteArrayToSbs"><span class="hs-identifier hs-var">byteArrayToSbs</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteArray -&gt; ShortByteString) -&gt; ByteArray -&gt; ShortByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ByteArray -&gt; Int -&gt; Int -&gt; ByteArray
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/primitive-0.9.1.0-07e69859799a82d0540493f0f6aadafdd50bb91316a3803e95fd79785038db46/share/doc/html/src/Data.Primitive.ByteArray.html#cloneByteArray"><span class="hs-identifier hs-var">BA.cloneByteArray</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShortByteString -&gt; ByteArray
</span><a href="Cardano.Ledger.Mary.Value.html#sbsToByteArray"><span class="hs-identifier hs-var">sbsToByteArray</span></a></span><span> </span><span class="annot"><span class="annottext">ShortByteString
</span><a href="#local-6989586621679279736"><span class="hs-identifier hs-var">sbs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279737"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679279738"><span class="hs-identifier hs-var">len</span></a></span><span>
</span><span id="line-803"></span><span>
</span><span id="line-804"></span><span class="hs-comment">-- ========================================================================</span><span>
</span><span id="line-805"></span><span class="hs-comment">-- Operations on Values</span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span class="hs-comment">-- | Extract the set of policies in the Value.</span><span>
</span><span id="line-808"></span><span class="hs-comment">--</span><span>
</span><span id="line-809"></span><span class="hs-comment">--   This function is equivalent to computing the support of the value in the</span><span>
</span><span id="line-810"></span><span class="hs-comment">--   spec.</span><span>
</span><span id="line-811"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#policies"><span class="hs-identifier hs-type">policies</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span>
</span><span id="line-812"></span><span id="policies"><span class="annot"><span class="annottext">policies :: MultiAsset -&gt; Set PolicyID
</span><a href="Cardano.Ledger.Mary.Value.html#policies"><span class="hs-identifier hs-var hs-var">policies</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279740"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279740"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; Set PolicyID
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279740"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#lookup"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-815"></span><span id="lookup"><span class="annot"><span class="annottext">lookup :: PolicyID -&gt; AssetName -&gt; MaryValue -&gt; Integer
</span><a href="Cardano.Ledger.Mary.Value.html#lookup"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PolicyID -&gt; AssetName -&gt; MaryValue -&gt; Integer
</span><a href="Cardano.Ledger.Mary.Value.html#lookupMultiAsset"><span class="hs-identifier hs-var">lookupMultiAsset</span></a></span><span>
</span><span id="line-816"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">lookup</span><span> </span><span class="hs-pragma">&quot;In favor of `lookupMultiAsset`&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#lookupMultiAsset"><span class="hs-identifier hs-type">lookupMultiAsset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span>
</span><span id="line-819"></span><span id="lookupMultiAsset"><span class="annot"><span class="annottext">lookupMultiAsset :: PolicyID -&gt; AssetName -&gt; MaryValue -&gt; Integer
</span><a href="Cardano.Ledger.Mary.Value.html#lookupMultiAsset"><span class="hs-identifier hs-var hs-var">lookupMultiAsset</span></a></span></span><span> </span><span id="local-6989586621679279742"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279742"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621679279743"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279743"><span class="hs-identifier hs-var">aid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279744"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279744"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PolicyID
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Maybe (Map AssetName Integer)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279742"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279744"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-821"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Map AssetName Integer)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679279745"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279745"><span class="hs-identifier hs-var">m2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; AssetName -&gt; Map AssetName Integer -&gt; Integer
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span><span class="hs-identifier hs-var">Map.findWithDefault</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279743"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279745"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span class="hs-comment">-- | insert comb policy asset n v,</span><span>
</span><span id="line-825"></span><span class="hs-comment">--   if comb = \ old new -&gt; old, the integer in the MultiAsset is prefered over n</span><span>
</span><span id="line-826"></span><span class="hs-comment">--   if comb = \ old new -&gt; new, then n is prefered over the integer in the MultiAsset</span><span>
</span><span id="line-827"></span><span class="hs-comment">--   if (comb old new) == 0, then that value should not be stored in the MultiAsset</span><span>
</span><span id="line-828"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#insert"><span class="hs-identifier hs-type">insert</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-829"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-830"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-831"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-832"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-833"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-834"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span>
</span><span id="line-835"></span><span id="insert"><span class="annot"><span class="annottext">insert :: (Integer -&gt; Integer -&gt; Integer)
-&gt; PolicyID -&gt; AssetName -&gt; Integer -&gt; MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#insert"><span class="hs-identifier hs-var hs-var">insert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer)
-&gt; PolicyID -&gt; AssetName -&gt; Integer -&gt; MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#insertMultiAsset"><span class="hs-identifier hs-var">insertMultiAsset</span></a></span><span>
</span><span id="line-836"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">insert</span><span> </span><span class="hs-pragma">&quot;In favor of `insertMultiAsset`&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-837"></span><span>
</span><span id="line-838"></span><span class="hs-comment">-- | insertMultiAsset comb policy asset n v,</span><span>
</span><span id="line-839"></span><span class="hs-comment">--   if comb = \ old new -&gt; old, the integer in the MultiAsset is prefered over n</span><span>
</span><span id="line-840"></span><span class="hs-comment">--   if comb = \ old new -&gt; new, then n is prefered over the integer in the MultiAsset</span><span>
</span><span id="line-841"></span><span class="hs-comment">--   if (comb old new) == 0, then that value should not be stored in the MultiAsset</span><span>
</span><span id="line-842"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#insertMultiAsset"><span class="hs-identifier hs-type">insertMultiAsset</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-843"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-844"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-845"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-846"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-847"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-848"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span>
</span><span id="line-849"></span><span id="insertMultiAsset"><span class="annot"><span class="annottext">insertMultiAsset :: (Integer -&gt; Integer -&gt; Integer)
-&gt; PolicyID -&gt; AssetName -&gt; Integer -&gt; MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#insertMultiAsset"><span class="hs-identifier hs-var hs-var">insertMultiAsset</span></a></span></span><span> </span><span id="local-6989586621679279747"><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621679279747"><span class="hs-identifier hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621679279748"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279748"><span class="hs-identifier hs-var">pid</span></a></span></span><span> </span><span id="local-6989586621679279749"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279749"><span class="hs-identifier hs-var">aid</span></a></span></span><span> </span><span id="local-6989586621679279750"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279750"><span class="hs-identifier hs-var">new</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279751"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279751"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-850"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PolicyID
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; (Map PolicyID (Map AssetName Integer),
    Maybe (Map AssetName Integer),
    Map PolicyID (Map AssetName Integer))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; (Map k a, Maybe a, Map k a)
</span><span class="hs-identifier hs-var">Map.splitLookup</span></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279748"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279751"><span class="hs-identifier hs-var">m1</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679279753"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279753"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679279754"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279754"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279755"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279755"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-852"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AssetName
-&gt; Map AssetName Integer
-&gt; (Map AssetName Integer, Maybe Integer, Map AssetName Integer)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; (Map k a, Maybe a, Map k a)
</span><span class="hs-identifier hs-var">Map.splitLookup</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279749"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279754"><span class="hs-identifier hs-var">m2</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-853"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679279756"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279756"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679279757"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279757"><span class="hs-identifier hs-var">old</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279758"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279758"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-854"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279759"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-855"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-856"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279760"><span class="annot"><span class="annottext">m3 :: Map AssetName Integer
</span><a href="#local-6989586621679279760"><span class="hs-identifier hs-var hs-var">m3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a. Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link2</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279756"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279758"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-857"></span><span>               </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279760"><span class="hs-identifier hs-var">m3</span></a></span><span>
</span><span id="line-858"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a. Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link2</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279753"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279755"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID
-&gt; Map AssetName Integer
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link</span></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279748"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279760"><span class="hs-identifier hs-var">m3</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279753"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279755"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID
-&gt; Map AssetName Integer
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link</span></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279748"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName
-&gt; Integer
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
-&gt; Map AssetName Integer
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279749"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279759"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279756"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279758"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279753"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279755"><span class="hs-identifier hs-var">l2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-862"></span><span>            </span><span id="local-6989586621679279759"><span class="annot"><span class="annottext">n :: Integer
</span><a href="#local-6989586621679279759"><span class="hs-identifier hs-var hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
</span><a href="#local-6989586621679279747"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279757"><span class="hs-identifier hs-var">old</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279750"><span class="hs-identifier hs-var">new</span></a></span><span>
</span><span id="line-863"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map AssetName Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Integer
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-864"></span><span>          </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span>
</span><span id="line-865"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">PolicyID
-&gt; Map AssetName Integer
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link</span></span><span>
</span><span id="line-866"></span><span>                </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279748"><span class="hs-identifier hs-var">pid</span></a></span><span>
</span><span id="line-867"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279750"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-868"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279754"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-869"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">AssetName
-&gt; Integer -&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279749"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279750"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279754"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-870"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>                </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279753"><span class="hs-identifier hs-var">l1</span></a></span><span>
</span><span id="line-872"></span><span>                </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279755"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-873"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-874"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679279762"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279762"><span class="hs-identifier hs-var">l1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Map AssetName Integer)
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279763"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279763"><span class="hs-identifier hs-var">l2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-875"></span><span>      </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span>
</span><span id="line-876"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279750"><span class="hs-identifier hs-var">new</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-877"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a. Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link2</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279762"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279763"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-878"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PolicyID
-&gt; Map AssetName Integer
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a. k -&gt; a -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">link</span></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279748"><span class="hs-identifier hs-var">pid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AssetName -&gt; Integer -&gt; Map AssetName Integer
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279749"><span class="hs-identifier hs-var">aid</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279750"><span class="hs-identifier hs-var">new</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279762"><span class="hs-identifier hs-var">l1</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279763"><span class="hs-identifier hs-var">l2</span></a></span><span>
</span><span id="line-879"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span class="hs-comment">-- ========================================================</span><span>
</span><span id="line-882"></span><span>
</span><span id="line-883"></span><span class="annot"><span class="hs-comment">-- | Remove 0 assets from a `MultiAsset`</span></span><span>
</span><span id="line-884"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#prune"><span class="hs-identifier hs-type">prune</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-885"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-886"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span id="prune"><span class="annot"><span class="annottext">prune :: Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
</span><a href="Cardano.Ledger.Mary.Value.html#prune"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span> </span><span id="local-6989586621679279765"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279765"><span class="hs-identifier hs-var">assets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-888"></span><span>  </span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Bool)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (Map AssetName Integer -&gt; Bool) -&gt; Map AssetName Integer -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Bool
forall a. Map AssetName a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map PolicyID (Map AssetName Integer)
 -&gt; Map PolicyID (Map AssetName Integer))
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Bool) -&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map AssetName Integer -&gt; Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279765"><span class="hs-identifier hs-var">assets</span></a></span><span>
</span><span id="line-889"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">prune</span><span> </span><span class="hs-pragma">&quot;In favor of `pruneZeroMultiAsset`&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-890"></span><span>
</span><span id="line-891"></span><span class="annot"><span class="hs-comment">-- | Remove all assets with that have zero amount specified</span></span><span>
</span><span id="line-892"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#pruneZeroMultiAsset"><span class="hs-identifier hs-type">pruneZeroMultiAsset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span>
</span><span id="line-893"></span><span id="pruneZeroMultiAsset"><span class="annot"><span class="annottext">pruneZeroMultiAsset :: MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#pruneZeroMultiAsset"><span class="hs-identifier hs-var hs-var">pruneZeroMultiAsset</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PolicyID -&gt; AssetName -&gt; Integer -&gt; Bool)
-&gt; MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#filterMultiAsset"><span class="hs-identifier hs-var">filterMultiAsset</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">PolicyID
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span class="annot"><span class="hs-comment">-- | Filter multi assets. Canonical form is preserved.</span></span><span>
</span><span id="line-896"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#filterMultiAsset"><span class="hs-identifier hs-type">filterMultiAsset</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-897"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Predicate that needs to return `True` whenever an asset should be retained.</span></span><span>
</span><span id="line-898"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-899"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-900"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span>
</span><span id="line-901"></span><span id="filterMultiAsset"><span class="annot"><span class="annottext">filterMultiAsset :: (PolicyID -&gt; AssetName -&gt; Integer -&gt; Bool)
-&gt; MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#filterMultiAsset"><span class="hs-identifier hs-var hs-var">filterMultiAsset</span></a></span></span><span> </span><span id="local-6989586621679279770"><span class="annot"><span class="annottext">PolicyID -&gt; AssetName -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679279770"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279771"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279771"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-902"></span><span>  </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(Map PolicyID (Map AssetName Integer) -&gt; MultiAsset)
-&gt; Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PolicyID
 -&gt; Map AssetName Integer -&gt; Maybe (Map AssetName Integer))
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a b. (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybeWithKey</span></span><span> </span><span class="annot"><span class="annottext">PolicyID -&gt; Map AssetName Integer -&gt; Maybe (Map AssetName Integer)
</span><a href="#local-6989586621679279773"><span class="hs-identifier hs-var">modifyAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279771"><span class="hs-identifier hs-var">ma</span></a></span><span>
</span><span id="line-903"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-904"></span><span>    </span><span id="local-6989586621679279773"><span class="annot"><span class="annottext">modifyAsset :: PolicyID -&gt; Map AssetName Integer -&gt; Maybe (Map AssetName Integer)
</span><a href="#local-6989586621679279773"><span class="hs-identifier hs-var hs-var">modifyAsset</span></a></span></span><span> </span><span id="local-6989586621679279774"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279774"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621679279775"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279775"><span class="hs-identifier hs-var">assetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-905"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279776"><span class="annot"><span class="annottext">newAssetMap :: Map AssetName Integer
</span><a href="#local-6989586621679279776"><span class="hs-identifier hs-var hs-var">newAssetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Integer -&gt; Bool)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filterWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID -&gt; AssetName -&gt; Integer -&gt; Bool
</span><a href="#local-6989586621679279770"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279774"><span class="hs-identifier hs-var">policyId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279775"><span class="hs-identifier hs-var">assetMap</span></a></span><span>
</span><span id="line-906"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Bool
forall a. Map AssetName a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279776"><span class="hs-identifier hs-var">newAssetMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span>      </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Maybe (Map AssetName Integer)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279776"><span class="hs-identifier hs-var">newAssetMap</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="hs-comment">-- | Map a function over each multi asset value while optionally filtering values</span><span>
</span><span id="line-910"></span><span class="hs-comment">-- out. Canonical form is preserved.</span><span>
</span><span id="line-911"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#mapMaybeMultiAsset"><span class="hs-identifier hs-type">mapMaybeMultiAsset</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-912"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-913"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-914"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span>
</span><span id="line-915"></span><span id="mapMaybeMultiAsset"><span class="annot"><span class="annottext">mapMaybeMultiAsset :: (PolicyID -&gt; AssetName -&gt; Integer -&gt; Maybe Integer)
-&gt; MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#mapMaybeMultiAsset"><span class="hs-identifier hs-var hs-var">mapMaybeMultiAsset</span></a></span></span><span> </span><span id="local-6989586621679279778"><span class="annot"><span class="annottext">PolicyID -&gt; AssetName -&gt; Integer -&gt; Maybe Integer
</span><a href="#local-6989586621679279778"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279779"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279779"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-916"></span><span>  </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-var">MultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">(Map PolicyID (Map AssetName Integer) -&gt; MultiAsset)
-&gt; Map PolicyID (Map AssetName Integer) -&gt; MultiAsset
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(PolicyID
 -&gt; Map AssetName Integer -&gt; Maybe (Map AssetName Integer))
-&gt; Map PolicyID (Map AssetName Integer)
-&gt; Map PolicyID (Map AssetName Integer)
forall k a b. (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybeWithKey</span></span><span> </span><span class="annot"><span class="annottext">PolicyID -&gt; Map AssetName Integer -&gt; Maybe (Map AssetName Integer)
</span><a href="#local-6989586621679279780"><span class="hs-identifier hs-var">modifyAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279779"><span class="hs-identifier hs-var">ma</span></a></span><span>
</span><span id="line-917"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-918"></span><span>    </span><span id="local-6989586621679279780"><span class="annot"><span class="annottext">modifyAsset :: PolicyID -&gt; Map AssetName Integer -&gt; Maybe (Map AssetName Integer)
</span><a href="#local-6989586621679279780"><span class="hs-identifier hs-var hs-var">modifyAsset</span></a></span></span><span> </span><span id="local-6989586621679279781"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279781"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621679279782"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279782"><span class="hs-identifier hs-var">assetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-919"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679279783"><span class="annot"><span class="annottext">newAssetMap :: Map AssetName Integer
</span><a href="#local-6989586621679279783"><span class="hs-identifier hs-var hs-var">newAssetMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AssetName -&gt; Integer -&gt; Maybe Integer)
-&gt; Map AssetName Integer -&gt; Map AssetName Integer
forall k a b. (k -&gt; a -&gt; Maybe b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.mapMaybeWithKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID -&gt; AssetName -&gt; Integer -&gt; Maybe Integer
</span><a href="#local-6989586621679279784"><span class="hs-identifier hs-var">modifyValue</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279781"><span class="hs-identifier hs-var">policyId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279782"><span class="hs-identifier hs-var">assetMap</span></a></span><span>
</span><span id="line-920"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Bool
forall a. Map AssetName a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279783"><span class="hs-identifier hs-var">newAssetMap</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>      </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; Maybe (Map AssetName Integer)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279783"><span class="hs-identifier hs-var">newAssetMap</span></a></span><span>
</span><span id="line-922"></span><span>    </span><span id="local-6989586621679279784"><span class="annot"><span class="annottext">modifyValue :: PolicyID -&gt; AssetName -&gt; Integer -&gt; Maybe Integer
</span><a href="#local-6989586621679279784"><span class="hs-identifier hs-var hs-var">modifyValue</span></a></span></span><span> </span><span id="local-6989586621679279785"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279785"><span class="hs-identifier hs-var">policyId</span></a></span></span><span> </span><span id="local-6989586621679279786"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279786"><span class="hs-identifier hs-var">assetName</span></a></span></span><span> </span><span id="local-6989586621679279787"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279787"><span class="hs-identifier hs-var">assetValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-923"></span><span>      </span><span id="local-6989586621679279788"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279788"><span class="hs-identifier hs-var">newAssetValue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PolicyID -&gt; AssetName -&gt; Integer -&gt; Maybe Integer
</span><a href="#local-6989586621679279778"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279785"><span class="hs-identifier hs-var">policyId</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279786"><span class="hs-identifier hs-var">assetName</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279787"><span class="hs-identifier hs-var">assetValue</span></a></span><span>
</span><span id="line-924"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279788"><span class="hs-identifier hs-var">newAssetValue</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>      </span><span class="annot"><span class="annottext">Integer -&gt; Maybe Integer
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279788"><span class="hs-identifier hs-var">newAssetValue</span></a></span><span>
</span><span id="line-926"></span><span>
</span><span id="line-927"></span><span class="hs-comment">-- | Rather than using prune to remove 0 assets, when can avoid adding them in the</span><span>
</span><span id="line-928"></span><span class="hs-comment">--   first place by using valueFromList to construct a MultiAsset</span><span>
</span><span id="line-929"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#multiAssetFromList"><span class="hs-identifier hs-type">multiAssetFromList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span>
</span><span id="line-930"></span><span id="multiAssetFromList"><span class="annot"><span class="annottext">multiAssetFromList :: [(PolicyID, AssetName, Integer)] -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#multiAssetFromList"><span class="hs-identifier hs-var hs-var">multiAssetFromList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((PolicyID, AssetName, Integer) -&gt; MultiAsset -&gt; MultiAsset)
-&gt; MultiAsset -&gt; [(PolicyID, AssetName, Integer)] -&gt; MultiAsset
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679279790"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279790"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279791"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279791"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279792"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279792"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679279793"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279793"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Integer)
-&gt; PolicyID -&gt; AssetName -&gt; Integer -&gt; MultiAsset -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#insertMultiAsset"><span class="hs-identifier hs-var">insertMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279790"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279791"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279792"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279793"><span class="hs-identifier hs-var">ans</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MultiAsset
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier hs-type">valueFromList</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span>
</span><span id="line-933"></span><span id="valueFromList"><span class="annot"><span class="annottext">valueFromList :: Coin -&gt; [(PolicyID, AssetName, Integer)] -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#valueFromList"><span class="hs-identifier hs-var hs-var">valueFromList</span></a></span></span><span> </span><span id="local-6989586621679279794"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279794"><span class="hs-identifier hs-var">ada</span></a></span></span><span> </span><span id="local-6989586621679279795"><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279795"><span class="hs-identifier hs-var">triples</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; MultiAsset -&gt; MaryValue
</span><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-var">MaryValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279794"><span class="hs-identifier hs-var">ada</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)] -&gt; MultiAsset
</span><a href="Cardano.Ledger.Mary.Value.html#multiAssetFromList"><span class="hs-identifier hs-var">multiAssetFromList</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279795"><span class="hs-identifier hs-var">triples</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span class="annot"><span class="hs-comment">-- | Display a MaryValue as a String, one token per line</span></span><span>
</span><span id="line-936"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#showValue"><span class="hs-identifier hs-type">showValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-937"></span><span id="showValue"><span class="annot"><span class="annottext">showValue :: MaryValue -&gt; [Char]
</span><a href="Cardano.Ledger.Mary.Value.html#showValue"><span class="hs-identifier hs-var hs-var">showValue</span></a></span></span><span> </span><span id="local-6989586621679279796"><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279796"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279797"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Context -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((PolicyID, AssetName, Integer) -&gt; [Char])
-&gt; [(PolicyID, AssetName, Integer)] -&gt; Context
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(PolicyID, AssetName, Integer) -&gt; [Char]
forall {a} {a}. (Show a, Show a) =&gt; (PolicyID, a, a) -&gt; [Char]
</span><a href="#local-6989586621679279799"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279800"><span class="hs-identifier hs-var">ts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-938"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-939"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679279797"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279797"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279800"><span class="annot"><span class="annottext">[(PolicyID, AssetName, Integer)]
</span><a href="#local-6989586621679279800"><span class="hs-identifier hs-var">ts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MaryValue -&gt; (Coin, [(PolicyID, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var">gettriples</span></a></span><span> </span><span class="annot"><span class="annottext">MaryValue
</span><a href="#local-6989586621679279796"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-940"></span><span>    </span><span id="local-6989586621679279799"><span class="annot"><span class="annottext">trans :: (PolicyID, a, a) -&gt; [Char]
</span><a href="#local-6989586621679279799"><span class="hs-identifier hs-var hs-var">trans</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span> </span><span id="local-6989586621679279809"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679279809"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279810"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279810"><span class="hs-identifier hs-var">hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279811"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279811"><span class="hs-identifier hs-var">cnt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-941"></span><span>      </span><span class="annot"><span class="annottext">ScriptHash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679279809"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-942"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;,  &quot;</span></span><span>
</span><span id="line-943"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279810"><span class="hs-identifier hs-var">hash</span></a></span><span>
</span><span id="line-944"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;,  &quot;</span></span><span>
</span><span id="line-945"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679279811"><span class="hs-identifier hs-var">cnt</span></a></span><span>
</span><span id="line-946"></span><span>
</span><span id="line-947"></span><span class="hs-comment">-- | Turn the nested 'MaryValue' map-of-maps representation into a flat sequence</span><span>
</span><span id="line-948"></span><span class="hs-comment">-- of policyID, asset name and quantity, plus separately the ada quantity.</span><span>
</span><span id="line-949"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-type">gettriples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-950"></span><span id="gettriples"><span class="annot"><span class="annottext">gettriples :: MaryValue -&gt; (Coin, [(PolicyID, AssetName, Integer)])
</span><a href="Cardano.Ledger.Mary.Value.html#gettriples"><span class="hs-identifier hs-var hs-var">gettriples</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MaryValue"><span class="hs-identifier hs-type">MaryValue</span></a></span><span> </span><span id="local-6989586621679279812"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279812"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679279813"><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279813"><span class="hs-identifier hs-var">ma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679279812"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MultiAsset -&gt; [(PolicyID, AssetName, Integer)]
</span><a href="Cardano.Ledger.Mary.Value.html#flattenMultiAsset"><span class="hs-identifier hs-var">flattenMultiAsset</span></a></span><span> </span><span class="annot"><span class="annottext">MultiAsset
</span><a href="#local-6989586621679279813"><span class="hs-identifier hs-var">ma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#flattenMultiAsset"><span class="hs-identifier hs-type">flattenMultiAsset</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#PolicyID"><span class="hs-identifier hs-type">PolicyID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#AssetName"><span class="hs-identifier hs-type">AssetName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-953"></span><span id="flattenMultiAsset"><span class="annot"><span class="annottext">flattenMultiAsset :: MultiAsset -&gt; [(PolicyID, AssetName, Integer)]
</span><a href="Cardano.Ledger.Mary.Value.html#flattenMultiAsset"><span class="hs-identifier hs-var hs-var">flattenMultiAsset</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Mary.Value.html#MultiAsset"><span class="hs-identifier hs-type">MultiAsset</span></a></span><span> </span><span id="local-6989586621679279814"><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279814"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279815"><span class="hs-identifier hs-var">policyId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279816"><span class="hs-identifier hs-var">aname</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279817"><span class="hs-identifier hs-var">amount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279815"><span class="annot"><span class="annottext">PolicyID
</span><a href="#local-6989586621679279815"><span class="hs-identifier hs-var">policyId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279818"><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279818"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
-&gt; [(PolicyID, Map AssetName Integer)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">assocs</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyID (Map AssetName Integer)
</span><a href="#local-6989586621679279814"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-956"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679279816"><span class="annot"><span class="annottext">AssetName
</span><a href="#local-6989586621679279816"><span class="hs-identifier hs-var">aname</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679279817"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679279817"><span class="hs-identifier hs-var">amount</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer -&gt; [(AssetName, Integer)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">assocs</span></span><span> </span><span class="annot"><span class="annottext">Map AssetName Integer
</span><a href="#local-6989586621679279818"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-958"></span></pre></body></html>