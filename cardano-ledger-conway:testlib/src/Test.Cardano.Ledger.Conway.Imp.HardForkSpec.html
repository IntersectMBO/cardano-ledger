<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLists #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Cardano.Ledger.Conway.Imp.HardForkSpec</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Conway.Imp.HardForkSpec.html#spec"><span class="hs-identifier">spec</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.Core.html"><span class="hs-identifier">Cardano.Ledger.Conway.Core</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.Governance.html"><span class="hs-identifier">Cardano.Ledger.Conway.Governance</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.PParams.html"><span class="hs-identifier">Cardano.Ledger.Conway.PParams</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.State.html"><span class="hs-identifier">Cardano.Ledger.Conway.State</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.html"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState</span></a></span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Rules</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Pool.html#ShelleyPoolPredFailure"><span class="hs-identifier">ShelleyPoolPredFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html"><span class="hs-identifier">Lens.Micro</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Conway.ImpTest.html"><span class="hs-identifier">Test.Cardano.Ledger.Conway.ImpTest</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html"><span class="hs-identifier">Test.Cardano.Ledger.Core.Rational</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Imp.Common.html"><span class="hs-identifier">Test.Cardano.Ledger.Imp.Common</span></a></span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="annot"><a href="Test.Cardano.Ledger.Conway.Imp.HardForkSpec.html#spec"><span class="hs-identifier hs-type">spec</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621686991565"><span class="annot"><a href="#local-6989586621686991565"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Conway.ImpTest.html#ConwayEraImp"><span class="hs-identifier hs-type">ConwayEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621686991565"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621686991565"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span id="spec"><span class="annot"><span class="annottext">spec :: forall era. ConwayEraImp era =&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Conway.Imp.HardForkSpec.html#spec"><span class="hs-identifier hs-var hs-var">spec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; ImpTestM era () -&gt; SpecWith (Arg (ImpTestM era ()))
forall a.
(HasCallStack, Example a) =&gt;
String -&gt; a -&gt; SpecWith (Arg a)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.html#it"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VRF Keyhashes get populated at v11 HardFork&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; SpecWith (Arg (ImpTestM era ())))
-&gt; ImpTestM era () -&gt; SpecWith (Arg (ImpTestM era ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-comment">-- Since we're testing the HardFork to 11, the test only makes sense for protocol version 10</span><span>
</span><span id="line-30"></span><span>    </span><span class="annot"><span class="annottext">forall (v :: Natural) era.
(EraGov era, KnownNat v, MinVersion &lt;= v, v &lt;= MaxVersion) =&gt;
ImpTestM era () -&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersion"><span class="hs-identifier hs-var">whenMajorVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-31"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621686993137"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993137"><span class="hs-identifier hs-var">kh1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621686993138"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993138"><span class="hs-identifier hs-var">vrf1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool
 -&gt; VRFVerKeyHash 'StakePoolVRF
 -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (KeyHash 'StakePool)
-&gt; ImpM
     (LedgerSpec era)
     (VRFVerKeyHash 'StakePoolVRF
      -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (VRFVerKeyHash 'StakePoolVRF
   -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
-&gt; ImpM
     (LedgerSpec era) (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF)
forall a b.
ImpM (LedgerSpec era) (a -&gt; b)
-&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var">freshKeyHashVRF</span></a></span><span>
</span><span id="line-32"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993137"><span class="hs-identifier hs-var">kh1</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993138"><span class="hs-identifier hs-var">vrf1</span></a></span><span>
</span><span id="line-33"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621686993143"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993143"><span class="hs-identifier hs-var">kh2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621686993144"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993144"><span class="hs-identifier hs-var">vrf2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool
 -&gt; VRFVerKeyHash 'StakePoolVRF
 -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (KeyHash 'StakePool)
-&gt; ImpM
     (LedgerSpec era)
     (VRFVerKeyHash 'StakePoolVRF
      -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (VRFVerKeyHash 'StakePoolVRF
   -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
-&gt; ImpM
     (LedgerSpec era) (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF)
forall a b.
ImpM (LedgerSpec era) (a -&gt; b)
-&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var">freshKeyHashVRF</span></a></span><span>
</span><span id="line-34"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993143"><span class="hs-identifier hs-var">kh2</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993144"><span class="hs-identifier hs-var">vrf2</span></a></span><span>
</span><span id="line-35"></span><span>      </span><span id="local-6989586621686993145"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993145"><span class="hs-identifier hs-var">vrf3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var">freshKeyHashVRF</span></a></span><span>
</span><span id="line-36"></span><span>      </span><span class="hs-comment">-- re-register with a new key, so vrf1 should not be present after the hard fork</span><span>
</span><span id="line-37"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993137"><span class="hs-identifier hs-var">kh1</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993145"><span class="hs-identifier hs-var">vrf3</span></a></span><span>
</span><span id="line-38"></span><span>      </span><span class="hs-comment">-- register a new pool with an existing vrf</span><span>
</span><span id="line-39"></span><span>      </span><span id="local-6989586621686993146"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993146"><span class="hs-identifier hs-var">kh3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span>
</span><span id="line-40"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993146"><span class="hs-identifier hs-var">kh3</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993144"><span class="hs-identifier hs-var">vrf2</span></a></span><span>
</span><span id="line-41"></span><span>      </span><span class="hs-comment">-- register and retire a pool before the hard fork, so vrf4 should not be present after the hard fork</span><span>
</span><span id="line-42"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621686993147"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993147"><span class="hs-identifier hs-var">kh4</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621686993148"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993148"><span class="hs-identifier hs-var">vrf4</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool
 -&gt; VRFVerKeyHash 'StakePoolVRF
 -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (KeyHash 'StakePool)
-&gt; ImpM
     (LedgerSpec era)
     (VRFVerKeyHash 'StakePoolVRF
      -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (VRFVerKeyHash 'StakePoolVRF
   -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
-&gt; ImpM
     (LedgerSpec era) (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF)
forall a b.
ImpM (LedgerSpec era) (a -&gt; b)
-&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var">freshKeyHashVRF</span></a></span><span>
</span><span id="line-43"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993147"><span class="hs-identifier hs-var">kh4</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993148"><span class="hs-identifier hs-var">vrf4</span></a></span><span>
</span><span id="line-44"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993149"><span class="hs-identifier hs-var">retireStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993147"><span class="hs-identifier hs-var">kh4</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; EpochInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochInterval"><span class="hs-identifier hs-var">EpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span>      </span><span class="hs-comment">-- register and schedule retirement for after the hard fork, so vrf5 should be present after the hard fork</span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621686993151"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993151"><span class="hs-identifier hs-var">kh5</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621686993152"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993152"><span class="hs-identifier hs-var">vrf5</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool
 -&gt; VRFVerKeyHash 'StakePoolVRF
 -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (KeyHash 'StakePool)
-&gt; ImpM
     (LedgerSpec era)
     (VRFVerKeyHash 'StakePoolVRF
      -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (VRFVerKeyHash 'StakePoolVRF
   -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
-&gt; ImpM
     (LedgerSpec era) (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF)
forall a b.
ImpM (LedgerSpec era) (a -&gt; b)
-&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var">freshKeyHashVRF</span></a></span><span>
</span><span id="line-47"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993151"><span class="hs-identifier hs-var">kh5</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993152"><span class="hs-identifier hs-var">vrf5</span></a></span><span>
</span><span id="line-48"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993149"><span class="hs-identifier hs-var">retireStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993151"><span class="hs-identifier hs-var">kh5</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; EpochInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochInterval"><span class="hs-identifier hs-var">EpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">5</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span>      </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)] -&gt; ImpTestM era ()
</span><a href="#local-6989586621686993153"><span class="hs-identifier hs-var">expectVRFs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- VRF keyhashes in PState is not yet populated</span><span>
</span><span id="line-51"></span><span>      </span><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621686993154"><span class="hs-identifier hs-var">enactHardForkV11</span></a></span><span>
</span><span id="line-52"></span><span>      </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)] -&gt; ImpTestM era ()
</span><a href="#local-6989586621686993153"><span class="hs-identifier hs-var">expectVRFs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993144"><span class="hs-identifier hs-var">vrf2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993145"><span class="hs-identifier hs-var">vrf3</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993152"><span class="hs-identifier hs-var">vrf5</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; ImpTestM era () -&gt; SpecWith (Arg (ImpTestM era ()))
forall a.
(HasCallStack, Example a) =&gt;
String -&gt; a -&gt; SpecWith (Arg a)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.html#it"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Retiring a stake pool with a duplicate VRF Keyhash after v11 HardFork&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; SpecWith (Arg (ImpTestM era ())))
-&gt; ImpTestM era () -&gt; SpecWith (Arg (ImpTestM era ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">forall (v :: Natural) era.
(EraGov era, KnownNat v, MinVersion &lt;= v, v &lt;= MaxVersion) =&gt;
ImpTestM era () -&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersion"><span class="hs-identifier hs-var">whenMajorVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">10</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-56"></span><span>      </span><span class="hs-comment">-- register two pools with the same vrf keyhash before the hard fork</span><span>
</span><span id="line-57"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621686993155"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993155"><span class="hs-identifier hs-var">kh1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621686993156"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool
 -&gt; VRFVerKeyHash 'StakePoolVRF
 -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (KeyHash 'StakePool)
-&gt; ImpM
     (LedgerSpec era)
     (VRFVerKeyHash 'StakePoolVRF
      -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (VRFVerKeyHash 'StakePoolVRF
   -&gt; (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF))
-&gt; ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
-&gt; ImpM
     (LedgerSpec era) (KeyHash 'StakePool, VRFVerKeyHash 'StakePoolVRF)
forall a b.
ImpM (LedgerSpec era) (a -&gt; b)
-&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (VRFVerKeyHash 'StakePoolVRF)
forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var">freshKeyHashVRF</span></a></span><span>
</span><span id="line-58"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993155"><span class="hs-identifier hs-var">kh1</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span>
</span><span id="line-59"></span><span>      </span><span id="local-6989586621686993157"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993157"><span class="hs-identifier hs-var">kh2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span>
</span><span id="line-60"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993157"><span class="hs-identifier hs-var">kh2</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span>
</span><span id="line-61"></span><span>      </span><span id="local-6989586621686993158"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993158"><span class="hs-identifier hs-var">kh3</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span>
</span><span id="line-62"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993158"><span class="hs-identifier hs-var">kh3</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span>      </span><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621686993154"><span class="hs-identifier hs-var">enactHardForkV11</span></a></span><span>
</span><span id="line-65"></span><span>      </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)] -&gt; ImpTestM era ()
</span><a href="#local-6989586621686993153"><span class="hs-identifier hs-var">expectVRFs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-66"></span><span>      </span><span class="hs-comment">-- retire one of the pools after the hard fork</span><span>
</span><span id="line-67"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993149"><span class="hs-identifier hs-var">retireStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993155"><span class="hs-identifier hs-var">kh1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; EpochInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochInterval"><span class="hs-identifier hs-var">EpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993149"><span class="hs-identifier hs-var">retireStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993157"><span class="hs-identifier hs-var">kh2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; EpochInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochInterval"><span class="hs-identifier hs-var">EpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>      </span><span class="annot"><span class="annottext">ImpTestM era ()
forall era. (ShelleyEraImp era, HasCallStack) =&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier hs-var">passEpoch</span></a></span><span>
</span><span id="line-70"></span><span>      </span><span class="hs-comment">-- the vrf keyhash should still be present, since another pool is registered with it</span><span>
</span><span id="line-71"></span><span>      </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)] -&gt; ImpTestM era ()
</span><a href="#local-6989586621686993153"><span class="hs-identifier hs-var">expectVRFs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span>      </span><span class="hs-comment">-- registration of the same vrf should be disallowed</span><span>
</span><span id="line-74"></span><span>      </span><span id="local-6989586621686993160"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993160"><span class="hs-identifier hs-var">kh4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) (Tx era)
forall {era} {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, EraTx era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) (Tx era)
</span><a href="#local-6989586621686993161"><span class="hs-identifier hs-var">registerStakePoolTx</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993160"><span class="hs-identifier hs-var">kh4</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (Tx era)
-&gt; (Tx era -&gt; ImpTestM era ()) -&gt; ImpTestM era ()
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621686993162"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621686993162"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-76"></span><span>        </span><span class="annot"><span class="annottext">Tx era
-&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; ImpTestM era ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era
-&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTx"><span class="hs-identifier hs-var">submitFailingTx</span></a></span><span>
</span><span id="line-77"></span><span>          </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621686993162"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-78"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ShelleyPoolPredFailure era -&gt; EraRuleFailure &quot;LEDGER&quot; era
forall (rule :: Symbol) (t :: * -&gt; *) era.
InjectRuleFailure rule t era =&gt;
t era -&gt; EraRuleFailure rule era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#injectFailure"><span class="hs-identifier hs-var">injectFailure</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyPoolPredFailure era -&gt; EraRuleFailure &quot;LEDGER&quot; era)
-&gt; ShelleyPoolPredFailure era -&gt; EraRuleFailure &quot;LEDGER&quot; era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ShelleyPoolPredFailure era
forall era.
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ShelleyPoolPredFailure era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Pool.html#VRFKeyHashAlreadyRegistered"><span class="hs-identifier hs-var">VRFKeyHashAlreadyRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993160"><span class="hs-identifier hs-var">kh4</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993149"><span class="hs-identifier hs-var">retireStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993158"><span class="hs-identifier hs-var">kh3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; EpochInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochInterval"><span class="hs-identifier hs-var">EpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>      </span><span class="annot"><span class="annottext">ImpTestM era ()
forall era. (ShelleyEraImp era, HasCallStack) =&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier hs-var">passEpoch</span></a></span><span>
</span><span id="line-82"></span><span>      </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)] -&gt; ImpTestM era ()
</span><a href="#local-6989586621686993153"><span class="hs-identifier hs-var">expectVRFs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpTestM era ()
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var">registerStakePool</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621686993160"><span class="hs-identifier hs-var">kh4</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)] -&gt; ImpTestM era ()
</span><a href="#local-6989586621686993153"><span class="hs-identifier hs-var">expectVRFs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621686993156"><span class="hs-identifier hs-var">vrf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>    </span><span id="local-6989586621686993154"><span class="annot"><span class="annottext">enactHardForkV11 :: ImpTestM era ()
</span><a href="#local-6989586621686993154"><span class="hs-identifier hs-var hs-var">enactHardForkV11</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-88"></span><span>      </span><span class="annot"><span class="annottext">(PParams era -&gt; PParams era) -&gt; ImpTestM era ()
forall era.
ShelleyEraImp era =&gt;
(PParams era -&gt; PParams era) -&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#modifyPParams"><span class="hs-identifier hs-var">modifyPParams</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; PParams era) -&gt; ImpTestM era ())
-&gt; (PParams era -&gt; PParams era) -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621687013141"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621687013141"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621687013141"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-90"></span><span>          </span><span class="annot"><span class="annottext">PParams era -&gt; (PParams era -&gt; PParams era) -&gt; PParams era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(DRepVotingThresholds -&gt; Identity DRepVotingThresholds)
-&gt; PParams era -&gt; Identity (PParams era)
forall era.
ConwayEraPParams era =&gt;
Lens' (PParams era) DRepVotingThresholds
Lens' (PParams era) DRepVotingThresholds
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.PParams.html#ppDRepVotingThresholdsL"><span class="hs-identifier hs-var">ppDRepVotingThresholdsL</span></a></span><span> </span><span class="annot"><span class="annottext">((DRepVotingThresholds -&gt; Identity DRepVotingThresholds)
 -&gt; PParams era -&gt; Identity (PParams era))
-&gt; ((UnitInterval -&gt; Identity UnitInterval)
    -&gt; DRepVotingThresholds -&gt; Identity DRepVotingThresholds)
-&gt; (UnitInterval -&gt; Identity UnitInterval)
-&gt; PParams era
-&gt; Identity (PParams era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(UnitInterval -&gt; Identity UnitInterval)
-&gt; DRepVotingThresholds -&gt; Identity DRepVotingThresholds
Lens' DRepVotingThresholds UnitInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.PParams.html#dvtHardForkInitiationL"><span class="hs-identifier hs-var">dvtHardForkInitiationL</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitInterval -&gt; Identity UnitInterval)
 -&gt; PParams era -&gt; Identity (PParams era))
-&gt; UnitInterval -&gt; PParams era -&gt; PParams era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; UnitInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-91"></span><span>          </span><span class="annot"><span class="annottext">PParams era -&gt; (PParams era -&gt; PParams era) -&gt; PParams era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PoolVotingThresholds -&gt; Identity PoolVotingThresholds)
-&gt; PParams era -&gt; Identity (PParams era)
forall era.
ConwayEraPParams era =&gt;
Lens' (PParams era) PoolVotingThresholds
Lens' (PParams era) PoolVotingThresholds
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.PParams.html#ppPoolVotingThresholdsL"><span class="hs-identifier hs-var">ppPoolVotingThresholdsL</span></a></span><span> </span><span class="annot"><span class="annottext">((PoolVotingThresholds -&gt; Identity PoolVotingThresholds)
 -&gt; PParams era -&gt; Identity (PParams era))
-&gt; ((UnitInterval -&gt; Identity UnitInterval)
    -&gt; PoolVotingThresholds -&gt; Identity PoolVotingThresholds)
-&gt; (UnitInterval -&gt; Identity UnitInterval)
-&gt; PParams era
-&gt; Identity (PParams era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(UnitInterval -&gt; Identity UnitInterval)
-&gt; PoolVotingThresholds -&gt; Identity PoolVotingThresholds
Lens' PoolVotingThresholds UnitInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.PParams.html#pvtHardForkInitiationL"><span class="hs-identifier hs-var">pvtHardForkInitiationL</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitInterval -&gt; Identity UnitInterval)
 -&gt; PParams era -&gt; Identity (PParams era))
-&gt; UnitInterval -&gt; PParams era -&gt; PParams era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; UnitInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span>
</span><span id="line-92"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687013155"><span class="annot"><span class="annottext">pv11 :: ProtVer
</span><a href="#local-6989586621687013155"><span class="hs-identifier hs-var hs-var">pv11</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Natural -&gt; ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-var">ProtVer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (v :: Natural).
(KnownNat v, MinVersion &lt;= v, v &lt;= MaxVersion) =&gt;
Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier hs-var">natVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">11</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-93"></span><span>      </span><span id="local-6989586621687013158"><span class="annot"><span class="annottext">NonEmpty (Credential 'HotCommitteeRole)
</span><a href="#local-6989586621687013158"><span class="hs-identifier hs-var">committee</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (NonEmpty (Credential 'HotCommitteeRole))
forall era.
(HasCallStack, ConwayEraImp era) =&gt;
ImpTestM era (NonEmpty (Credential 'HotCommitteeRole))
</span><a href="Test.Cardano.Ledger.Conway.ImpTest.html#registerInitialCommittee"><span class="hs-identifier hs-var">registerInitialCommittee</span></a></span><span>
</span><span id="line-94"></span><span>      </span><span id="local-6989586621687013160"><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621687013160"><span class="hs-identifier hs-var">govActionId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GovAction era -&gt; ImpTestM era GovActionId
forall era.
(ConwayEraImp era, HasCallStack) =&gt;
GovAction era -&gt; ImpTestM era GovActionId
</span><a href="Test.Cardano.Ledger.Conway.ImpTest.html#submitGovAction"><span class="hs-identifier hs-var">submitGovAction</span></a></span><span> </span><span class="annot"><span class="annottext">(GovAction era -&gt; ImpTestM era GovActionId)
-&gt; GovAction era -&gt; ImpTestM era GovActionId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId 'HardForkPurpose)
-&gt; ProtVer -&gt; GovAction era
forall era.
StrictMaybe (GovPurposeId 'HardForkPurpose)
-&gt; ProtVer -&gt; GovAction era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-conway-1.21.0.0/doc/html/cardano-ledger-conway/src/Cardano.Ledger.Conway.Governance.Procedures.html#HardForkInitiation"><span class="hs-identifier hs-var">HardForkInitiation</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId 'HardForkPurpose)
forall a. StrictMaybe a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621687013155"><span class="hs-identifier hs-var">pv11</span></a></span><span>
</span><span id="line-95"></span><span>      </span><span class="annot"><span class="annottext">NonEmpty (Credential 'HotCommitteeRole)
-&gt; GovActionId -&gt; ImpTestM era ()
forall era (f :: * -&gt; *).
(ConwayEraImp era, Foldable f) =&gt;
f (Credential 'HotCommitteeRole) -&gt; GovActionId -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Conway.ImpTest.html#submitYesVoteCCs_"><span class="hs-identifier hs-var">submitYesVoteCCs_</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Credential 'HotCommitteeRole)
</span><a href="#local-6989586621687013158"><span class="hs-identifier hs-var">committee</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621687013160"><span class="hs-identifier hs-var">govActionId</span></a></span><span>
</span><span id="line-96"></span><span>      </span><span class="annot"><span class="annottext">Natural -&gt; ImpTestM era ()
forall era. ShelleyEraImp era =&gt; Natural -&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochs"><span class="hs-identifier hs-var">passNEpochs</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">2</span></span><span>
</span><span id="line-97"></span><span>      </span><span class="annot"><span class="annottext">ImpTestM era ProtVer
forall era. EraGov era =&gt; ImpTestM era ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier hs-var">getProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestM era ProtVer -&gt; ProtVer -&gt; ImpTestM era ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
m a -&gt; a -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-expectations-lifted-0.10.0-3b9af14f4044ae8391bddf2d12815688264dd87b731d8f5b89bdb0b08f389286/share/doc/html/src/Test.Hspec.Expectations.Lifted.html#shouldReturn"><span class="hs-operator hs-var">`shouldReturn`</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621687013155"><span class="hs-identifier hs-var">pv11</span></a></span><span>
</span><span id="line-98"></span><span>    </span><span id="local-6989586621686993161"><span class="annot"><span class="annottext">registerStakePoolTx :: KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) (Tx era)
</span><a href="#local-6989586621686993161"><span class="hs-identifier hs-var hs-var">registerStakePoolTx</span></a></span></span><span> </span><span id="local-6989586621687016224"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621687016224"><span class="hs-identifier hs-var">kh</span></a></span></span><span> </span><span id="local-6989586621687016225"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621687016225"><span class="hs-identifier hs-var">vrf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-99"></span><span>      </span><span id="local-6989586621687016226"><span class="annot"><span class="annottext">PoolParams
</span><a href="#local-6989586621687016226"><span class="hs-identifier hs-var">pps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era RewardAccount
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
ImpTestM era RewardAccount
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#registerRewardAccount"><span class="hs-identifier hs-var">registerRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestM era RewardAccount
-&gt; (RewardAccount -&gt; ImpM (LedgerSpec era) PoolParams)
-&gt; ImpM (LedgerSpec era) PoolParams
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; RewardAccount -&gt; ImpM (LedgerSpec era) PoolParams
forall era.
ShelleyEraImp era =&gt;
KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era PoolParams
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#freshPoolParams"><span class="hs-identifier hs-var">freshPoolParams</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621687016224"><span class="hs-identifier hs-var">kh</span></a></span><span>
</span><span id="line-100"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-102"></span><span>          </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxCert era))
Lens' (TxBody era) (StrictSeq (TxCert era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#certsTxBodyL"><span class="hs-identifier hs-var">certsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxCert era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PoolParams -&gt; TxCert era
forall era. EraTxCert era =&gt; PoolParams -&gt; TxCert era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#RegPoolTxCert"><span class="hs-identifier hs-var">RegPoolTxCert</span></a></span><span> </span><span class="annot"><span class="annottext">(PoolParams -&gt; TxCert era) -&gt; PoolParams -&gt; TxCert era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PoolParams
</span><a href="#local-6989586621687016226"><span class="hs-identifier hs-var">pps</span></a></span><span> </span><span class="annot"><span class="annottext">PoolParams -&gt; (PoolParams -&gt; PoolParams) -&gt; PoolParams
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(VRFVerKeyHash 'StakePoolVRF
 -&gt; Identity (VRFVerKeyHash 'StakePoolVRF))
-&gt; PoolParams -&gt; Identity PoolParams
Lens' PoolParams (VRFVerKeyHash 'StakePoolVRF)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppVrfL"><span class="hs-identifier hs-var">ppVrfL</span></a></span><span> </span><span class="annot"><span class="annottext">((VRFVerKeyHash 'StakePoolVRF
  -&gt; Identity (VRFVerKeyHash 'StakePoolVRF))
 -&gt; PoolParams -&gt; Identity PoolParams)
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; PoolParams -&gt; PoolParams
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621687016225"><span class="hs-identifier hs-var">vrf</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>    </span><span id="local-6989586621686993142"><span class="annot"><span class="annottext">registerStakePool :: KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993142"><span class="hs-identifier hs-var hs-var">registerStakePool</span></a></span></span><span> </span><span id="local-6989586621687018908"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621687018908"><span class="hs-identifier hs-var">kh</span></a></span></span><span> </span><span id="local-6989586621687018909"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621687018909"><span class="hs-identifier hs-var">vrf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>      </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) (Tx era)
forall {era} {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 ShelleyEraImp era, EraTx era, Eq (Event (EraRule &quot;TICK&quot; era)),
 Eq (Event (EraRule &quot;LEDGER&quot; era)),
 NFData (Event (EraRule &quot;TICK&quot; era)),
 NFData (Event (EraRule &quot;LEDGER&quot; era)),
 Typeable (Event (EraRule &quot;TICK&quot; era)),
 Typeable (Event (EraRule &quot;LEDGER&quot; era)),
 ToExpr (Event (EraRule &quot;TICK&quot; era)),
 ToExpr (Event (EraRule &quot;LEDGER&quot; era))) =&gt;
KeyHash 'StakePool
-&gt; VRFVerKeyHash 'StakePoolVRF -&gt; ImpM (LedgerSpec era) (Tx era)
</span><a href="#local-6989586621686993161"><span class="hs-identifier hs-var">registerStakePoolTx</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621687018908"><span class="hs-identifier hs-var">kh</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621687018909"><span class="hs-identifier hs-var">vrf</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (Tx era)
-&gt; (Tx era -&gt; ImpM (LedgerSpec era) ()) -&gt; ImpM (LedgerSpec era) ()
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx_"><span class="hs-identifier hs-var">submitTx_</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span id="local-6989586621686993149"><span class="annot"><span class="annottext">retireStakePool :: KeyHash 'StakePool -&gt; EpochInterval -&gt; ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621686993149"><span class="hs-identifier hs-var hs-var">retireStakePool</span></a></span></span><span> </span><span id="local-6989586621687021759"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621687021759"><span class="hs-identifier hs-var">kh</span></a></span></span><span> </span><span id="local-6989586621687021760"><span class="annot"><span class="annottext">EpochInterval
</span><a href="#local-6989586621687021760"><span class="hs-identifier hs-var">retirementInterval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>      </span><span id="local-6989586621687021761"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621687021761"><span class="hs-identifier hs-var">curEpochNo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) EpochNo -&gt; ImpTestM era EpochNo
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; Const r EpochNo)
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
SimpleGetter (NewEpochState era) EpochNo
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochNo -&gt; f EpochNo)
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesELL"><span class="hs-identifier hs-var">nesELL</span></a></span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621687021766"><span class="annot"><span class="annottext">retirement :: EpochNo
</span><a href="#local-6989586621687021766"><span class="hs-identifier hs-var hs-var">retirement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochInterval -&gt; EpochNo
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#addEpochInterval"><span class="hs-identifier hs-var">addEpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621687021761"><span class="hs-identifier hs-var">curEpochNo</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInterval
</span><a href="#local-6989586621687021760"><span class="hs-identifier hs-var">retirementInterval</span></a></span><span>
</span><span id="line-108"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx_"><span class="hs-identifier hs-var">submitTx_</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpM (LedgerSpec era) ())
-&gt; Tx era -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-110"></span><span>          </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxCert era))
Lens' (TxBody era) (StrictSeq (TxCert era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#certsTxBodyL"><span class="hs-identifier hs-var">certsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxCert era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; EpochNo -&gt; TxCert era
forall era.
EraTxCert era =&gt;
KeyHash 'StakePool -&gt; EpochNo -&gt; TxCert era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#RetirePoolTxCert"><span class="hs-identifier hs-var">RetirePoolTxCert</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621687021759"><span class="hs-identifier hs-var">kh</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621687021766"><span class="hs-identifier hs-var">retirement</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621686993153"><span class="annot"><span class="annottext">expectVRFs :: [(VRFVerKeyHash 'StakePoolVRF, Word64)] -&gt; ImpTestM era ()
</span><a href="#local-6989586621686993153"><span class="hs-identifier hs-var hs-var">expectVRFs</span></a></span></span><span> </span><span id="local-6989586621687021769"><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)]
</span><a href="#local-6989586621687021769"><span class="hs-identifier hs-var">vrfs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-112"></span><span>      </span><span class="annot"><span class="annottext">PState era -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
forall era.
PState era -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psVRFKeyHashes"><span class="hs-identifier hs-var">psVRFKeyHashes</span></a></span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">(PState era -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
-&gt; ImpM (LedgerSpec era) (PState era)
-&gt; ImpM
     (LedgerSpec era)
     (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (PState era)
</span><a href="#local-6989586621687021771"><span class="hs-identifier hs-var">getPState</span></a></span><span>
</span><span id="line-114"></span><span>          </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; ImpTestM era ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
m a -&gt; a -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-expectations-lifted-0.10.0-3b9af14f4044ae8391bddf2d12815688264dd87b731d8f5b89bdb0b08f389286/share/doc/html/src/Test.Hspec.Expectations.Lifted.html#shouldReturn"><span class="hs-operator hs-var">`shouldReturn`</span></a></span><span> </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, NonZero Word64)]
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621687021773"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; NonZero Word64
forall a. a -&gt; NonZero a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#unsafeNonZero"><span class="hs-identifier hs-var">unsafeNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621687021775"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621687021773"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621687021773"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621687021775"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621687021775"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(VRFVerKeyHash 'StakePoolVRF, Word64)]
</span><a href="#local-6989586621687021769"><span class="hs-identifier hs-var">vrfs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621687021771"><span class="annot"><span class="annottext">getPState :: ImpM (LedgerSpec era) (PState era)
</span><a href="#local-6989586621687021771"><span class="hs-identifier hs-var hs-var">getPState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/l/testlib/doc/html/cardano-ledger-shelley/src/Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621686991565"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (PState era)
 -&gt; ImpM (LedgerSpec era) (PState era))
-&gt; SimpleGetter (NewEpochState era) (PState era)
-&gt; ImpM (LedgerSpec era) (PState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((PState era -&gt; Const r (PState era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (PState era -&gt; Const r (PState era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const r (LedgerState era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((LedgerState era -&gt; Const r (LedgerState era))
 -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; ((PState era -&gt; Const r (PState era))
    -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; (PState era -&gt; Const r (PState era))
-&gt; EpochState era
-&gt; Const r (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CertState era -&gt; Const r (CertState era))
-&gt; LedgerState era -&gt; Const r (LedgerState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(CertState era -&gt; f (CertState era))
-&gt; LedgerState era -&gt; f (LedgerState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertStateL"><span class="hs-identifier hs-var">lsCertStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((CertState era -&gt; Const r (CertState era))
 -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; ((PState era -&gt; Const r (PState era))
    -&gt; CertState era -&gt; Const r (CertState era))
-&gt; (PState era -&gt; Const r (PState era))
-&gt; LedgerState era
-&gt; Const r (LedgerState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PState era -&gt; Const r (PState era))
-&gt; CertState era -&gt; Const r (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (PState era)
Lens' (CertState era) (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certPStateL"><span class="hs-identifier hs-var">certPStateL</span></a></span><span>
</span><span id="line-116"></span></pre></body></html>