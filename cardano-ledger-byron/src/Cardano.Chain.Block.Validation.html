<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE NumDecimals #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Chain.Block.Validation</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#adoptedProtocolParameters"><span class="hs-identifier">UPI.adoptedProtocolParameters</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateBody"><span class="hs-identifier">updateBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateChainBlockOrBoundary"><span class="hs-identifier">updateChainBlockOrBoundary</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateChainBoundary"><span class="hs-identifier">updateChainBoundary</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#epochTransition"><span class="hs-identifier">epochTransition</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#headerIsValid"><span class="hs-identifier">headerIsValid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#validateHeaderMatchesBody"><span class="hs-identifier">validateHeaderMatchesBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateBlock"><span class="hs-identifier">updateBlock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier">BodyState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyEnvironment"><span class="hs-identifier">BodyEnvironment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#EpochEnvironment"><span class="hs-identifier">EpochEnvironment</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier">ChainValidationState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#initialChainValidationState"><span class="hs-identifier">initialChainValidationState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationError"><span class="hs-identifier">ChainValidationError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-comment">-- * UTxO</span></span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#HeapSize"><span class="hs-identifier">HeapSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#UTxOSize"><span class="hs-identifier">UTxOSize</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#calcUTxOSize"><span class="hs-identifier">calcUTxOSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#foldUTxO"><span class="hs-identifier">foldUTxO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#foldUTxOBlock"><span class="hs-identifier">foldUTxOBlock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Block.html"><span class="hs-identifier">Cardano.Chain.Block.Block</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlock"><span class="hs-identifier">ABlock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlockOrBoundary"><span class="hs-identifier">ABlockOrBoundary</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABoundaryBlock"><span class="hs-identifier">ABoundaryBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockAProtocolMagicId"><span class="hs-identifier">blockAProtocolMagicId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockDlgPayload"><span class="hs-identifier">blockDlgPayload</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockHashAnnotated"><span class="hs-identifier">blockHashAnnotated</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockHeader"><span class="hs-identifier">blockHeader</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockIssuer"><span class="hs-identifier">blockIssuer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockLength"><span class="hs-identifier">blockLength</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockProtocolMagicId"><span class="hs-identifier">blockProtocolMagicId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockProtocolVersion"><span class="hs-identifier">blockProtocolVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockSlot"><span class="hs-identifier">blockSlot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockTxPayload"><span class="hs-identifier">blockTxPayload</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockUpdatePayload"><span class="hs-identifier">blockUpdatePayload</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Body.html"><span class="hs-identifier">Cardano.Chain.Block.Body</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.Block.Body.html#ABody"><span class="hs-identifier">ABody</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html"><span class="hs-identifier">Cardano.Chain.Block.Header</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#ABoundaryHeader"><span class="hs-identifier">ABoundaryHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#AHeader"><span class="hs-identifier">AHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#BlockSignature"><span class="hs-identifier">BlockSignature</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier">HeaderHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#headerLength"><span class="hs-identifier">headerLength</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#headerProof"><span class="hs-identifier">headerProof</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#wrapBoundaryBytes"><span class="hs-identifier">wrapBoundaryBytes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Proof.html"><span class="hs-identifier">Cardano.Chain.Block.Proof</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.Block.Proof.html#Proof"><span class="hs-identifier">Proof</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Proof.html#ProofValidationError"><span class="hs-identifier">ProofValidationError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Common.html"><span class="hs-identifier">Cardano.Chain.Common</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Common.BlockCount.html#BlockCount"><span class="hs-identifier">BlockCount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Common.KeyHash.html#KeyHash"><span class="hs-identifier">KeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Common.KeyHash.html#hashKey"><span class="hs-identifier">hashKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Chain.Delegation.html"><span class="hs-identifier">Cardano.Chain.Delegation</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Delegation</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Interface.html"><span class="hs-identifier">Cardano.Chain.Delegation.Validation.Interface</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DI</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Scheduling.html"><span class="hs-identifier">Cardano.Chain.Delegation.Validation.Scheduling</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Scheduling</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Epoch.File.html"><span class="hs-identifier">Cardano.Chain.Epoch.File</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.Epoch.File.html#ParseError"><span class="hs-identifier">ParseError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.Epoch.File.html#mainnetEpochSlots"><span class="hs-identifier">mainnetEpochSlots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Genesis.html"><span class="hs-identifier">Cardano.Chain.Genesis</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Genesis</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#Config"><span class="hs-identifier">Config</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Hash.html#GenesisHash"><span class="hs-identifier">GenesisHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.KeyHashes.html#GenesisKeyHashes"><span class="hs-identifier">GenesisKeyHashes</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#configEpochSlots"><span class="hs-identifier">configEpochSlots</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#configGenesisKeyHashes"><span class="hs-identifier">configGenesisKeyHashes</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#configHeavyDelegation"><span class="hs-identifier">configHeavyDelegation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#configK"><span class="hs-identifier">configK</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#configProtocolMagicId"><span class="hs-identifier">configProtocolMagicId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.ProtocolConstants.html"><span class="hs-identifier">Cardano.Chain.ProtocolConstants</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.ProtocolConstants.html#kEpochSlots"><span class="hs-identifier">kEpochSlots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Slotting.html"><span class="hs-identifier">Cardano.Chain.Slotting</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#EpochAndSlotCount"><span class="hs-identifier">EpochAndSlotCount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Slotting.EpochNumber.html#EpochNumber"><span class="hs-identifier">EpochNumber</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Slotting.SlotNumber.html#SlotNumber"><span class="hs-identifier">SlotNumber</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#fromSlotNumber"><span class="hs-identifier">fromSlotNumber</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#slotNumberEpoch"><span class="hs-identifier">slotNumberEpoch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.html"><span class="hs-identifier">Cardano.Chain.UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.UTxO.TxPayload.html#ATxPayload"><span class="hs-identifier">ATxPayload</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier">UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.GenesisUTxO.html#genesisUtxo"><span class="hs-identifier">genesisUtxo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.TxProof.html#recoverTxProof"><span class="hs-identifier">recoverTxProof</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxOConfiguration.html"><span class="hs-identifier">Cardano.Chain.UTxO.UTxOConfiguration</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.UTxO.UTxOConfiguration.html#UTxOConfiguration"><span class="hs-identifier">UTxOConfiguration</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.Validation.html"><span class="hs-identifier">Cardano.Chain.UTxO.Validation</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Chain.Update.html"><span class="hs-identifier">Cardano.Chain.Update</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Update</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Endorsement.html"><span class="hs-identifier">Cardano.Chain.Update.Validation.Endorsement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.Update.Validation.Endorsement.html#Endorsement"><span class="hs-identifier">Endorsement</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html"><span class="hs-identifier">Cardano.Chain.Update.Validation.Interface</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UPI</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html"><span class="hs-identifier">Cardano.Chain.ValidationMode</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier">ValidationMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#orThrowErrorInBlockValidationMode"><span class="hs-identifier">orThrowErrorInBlockValidationMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#whenBlockValidation"><span class="hs-identifier">whenBlockValidation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#wrapErrorWithValidationMode"><span class="hs-identifier">wrapErrorWithValidationMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.html"><span class="hs-identifier">Cardano.Crypto</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#AProtocolMagic"><span class="hs-identifier">AProtocolMagic</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#ProtocolMagicId"><span class="hs-identifier">ProtocolMagicId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Signing.VerificationKey.html#VerificationKey"><span class="hs-identifier">VerificationKey</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Hashing.html#hashDecoded"><span class="hs-identifier">hashDecoded</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Hashing.html#hashRaw"><span class="hs-identifier">hashRaw</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/heapwords-0.1.0.2-b6417b7556a8e92d841bb3a7d489e50a628754cd86fcb83441bde6481e83fe38/share/doc/html/src/Cardano.HeapWords.html"><span class="hs-identifier">Cardano.HeapWords</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/heapwords-0.1.0.2-b6417b7556a8e92d841bb3a7d489e50a628754cd86fcb83441bde6481e83fe38/share/doc/html/src/Cardano.HeapWords.html#HeapWords"><span class="hs-identifier">HeapWords</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.html"><span class="hs-identifier">Cardano.Ledger.Binary</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Annotated.html#Annotated"><span class="hs-identifier">Annotated</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier">DecCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier">EncCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.FromCBOR.html#FromCBOR"><span class="hs-identifier">FromCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.ToCBOR.html#ToCBOR"><span class="hs-identifier">ToCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#byronProtVer"><span class="hs-identifier">byronProtVer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Encoder.html#encodeListLen"><span class="hs-identifier">encodeListLen</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#enforceSize"><span class="hs-identifier">enforceSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#fromByronCBOR"><span class="hs-identifier">fromByronCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.html#serialize%27"><span class="hs-identifier">serialize'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#toByronCBOR"><span class="hs-identifier">toByronCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.html"><span class="hs-identifier">Cardano.Prelude</span></a></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/resourcet-1.3.0-daaadf875bf5c7a54a4fddc6e9986d8365a90c01a64fc253eba10dff2e6b55df/share/doc/html/src/Control.Monad.Trans.Resource.html"><span class="hs-identifier">Control.Monad.Trans.Resource</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/resourcet-1.3.0-daaadf875bf5c7a54a4fddc6e9986d8365a90c01a64fc253eba10dff2e6b55df/share/doc/html/src/Control.Monad.Trans.Resource.Internal.html#ResIO"><span class="hs-identifier">ResIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BSL</span></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">coerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/formatting-7.2.0-ab7254b0c777b7703f417bd470ae12dd12f6a2982bb6692fc1dd1a70d31b3958/share/doc/html/src/Formatting.Buildable.html"><span class="hs-identifier">Formatting.Buildable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/formatting-7.2.0-ab7254b0c777b7703f417bd470ae12dd12f6a2982bb6692fc1dd1a70d31b3958/share/doc/html/src/Formatting.Buildable.html#Buildable"><span class="hs-identifier">Buildable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html"><span class="hs-identifier">NoThunks.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier">NoThunks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/streaming-0.2.4.0-84d69b3e7511d7733f5f51af7f55aaafcbbbdd85ab9da1daa0cd90489d713cdf/share/doc/html/src/Streaming.html"><span class="hs-identifier">Streaming</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/streaming-0.2.4.0-84d69b3e7511d7733f5f51af7f55aaafcbbbdd85ab9da1daa0cd90489d713cdf/share/doc/html/src/Data.Functor.Of.html#Of"><span class="hs-identifier">Of</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/streaming-0.2.4.0-84d69b3e7511d7733f5f51af7f55aaafcbbbdd85ab9da1daa0cd90489d713cdf/share/doc/html/src/Streaming.Internal.html#Stream"><span class="hs-identifier">Stream</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mmorph-1.2.1-96fd6e9262ea266d9268eb2bdbe806a66faa8c494b996a36a1074c3057d5d5a6/share/doc/html/src/Control.Monad.Morph.html#hoist"><span class="hs-identifier">hoist</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/streaming-0.2.4.0-84d69b3e7511d7733f5f51af7f55aaafcbbbdd85ab9da1daa0cd90489d713cdf/share/doc/html/src/Streaming.Prelude.html"><span class="hs-identifier">Streaming.Prelude</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-135"></span><span class="hs-comment">-- ChainValidationState</span><span>
</span><span id="line-136"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-keyword">data</span><span> </span><span id="ChainValidationState"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-var">ChainValidationState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ChainValidationState"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-var">ChainValidationState</span></a></span></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AcvsLastSlot%3AChainValidationState"><span class="annot"><span class="annottext">ChainValidationState -&gt; SlotNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsLastSlot%3AChainValidationState"><span class="hs-identifier hs-var hs-var">cvsLastSlot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Slotting.SlotNumber.html#SlotNumber"><span class="hs-identifier hs-type">SlotNumber</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcvsPreviousHash%3AChainValidationState"><span class="annot"><span class="annottext">ChainValidationState -&gt; Either GenesisHash HeaderHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsPreviousHash%3AChainValidationState"><span class="hs-identifier hs-var hs-var">cvsPreviousHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Genesis.Hash.html#GenesisHash"><span class="hs-identifier hs-type">GenesisHash</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-comment">-- ^ GenesisHash for the previous hash of the zeroth boundary block and</span><span>
</span><span id="line-142"></span><span>  </span><span class="hs-comment">--   HeaderHash for all others.</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcvsUtxo%3AChainValidationState"><span class="annot"><span class="annottext">ChainValidationState -&gt; UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUtxo%3AChainValidationState"><span class="hs-identifier hs-var hs-var">cvsUtxo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcvsUpdateState%3AChainValidationState"><span class="annot"><span class="annottext">ChainValidationState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUpdateState%3AChainValidationState"><span class="hs-identifier hs-var hs-var">cvsUpdateState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#State"><span class="hs-identifier hs-type">UPI.State</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcvsDelegationState%3AChainValidationState"><span class="annot"><span class="annottext">ChainValidationState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsDelegationState%3AChainValidationState"><span class="hs-identifier hs-var hs-var">cvsDelegationState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Interface.html#State"><span class="hs-identifier hs-type">DI.State</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679604182"><span id="local-6989586621679604196"><span class="annot"><span class="annottext">ChainValidationState -&gt; ChainValidationState -&gt; Bool
(ChainValidationState -&gt; ChainValidationState -&gt; Bool)
-&gt; (ChainValidationState -&gt; ChainValidationState -&gt; Bool)
-&gt; Eq ChainValidationState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ChainValidationState -&gt; ChainValidationState -&gt; Bool
== :: ChainValidationState -&gt; ChainValidationState -&gt; Bool
$c/= :: ChainValidationState -&gt; ChainValidationState -&gt; Bool
/= :: ChainValidationState -&gt; ChainValidationState -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604203"><span id="local-6989586621679604219"><span id="local-6989586621679604223"><span class="annot"><span class="annottext">Int -&gt; ChainValidationState -&gt; ShowS
[ChainValidationState] -&gt; ShowS
ChainValidationState -&gt; String
(Int -&gt; ChainValidationState -&gt; ShowS)
-&gt; (ChainValidationState -&gt; String)
-&gt; ([ChainValidationState] -&gt; ShowS)
-&gt; Show ChainValidationState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ChainValidationState -&gt; ShowS
showsPrec :: Int -&gt; ChainValidationState -&gt; ShowS
$cshow :: ChainValidationState -&gt; String
show :: ChainValidationState -&gt; String
$cshowList :: [ChainValidationState] -&gt; ShowS
showList :: [ChainValidationState] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604229"><span id="local-6989586621679604231"><span class="annot"><span class="annottext">(forall x. ChainValidationState -&gt; Rep ChainValidationState x)
-&gt; (forall x. Rep ChainValidationState x -&gt; ChainValidationState)
-&gt; Generic ChainValidationState
forall x. Rep ChainValidationState x -&gt; ChainValidationState
forall x. ChainValidationState -&gt; Rep ChainValidationState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. ChainValidationState -&gt; Rep ChainValidationState x
from :: forall x. ChainValidationState -&gt; Rep ChainValidationState x
$cto :: forall x. Rep ChainValidationState x -&gt; ChainValidationState
to :: forall x. Rep ChainValidationState x -&gt; ChainValidationState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604235"><span class="annot"><span class="annottext">ChainValidationState -&gt; ()
(ChainValidationState -&gt; ()) -&gt; NFData ChainValidationState
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: ChainValidationState -&gt; ()
rnf :: ChainValidationState -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604275"><span id="local-6989586621679604279"><span id="local-6989586621679604285"><span class="annot"><span class="annottext">Context -&gt; ChainValidationState -&gt; IO (Maybe ThunkInfo)
Proxy ChainValidationState -&gt; String
(Context -&gt; ChainValidationState -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; ChainValidationState -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy ChainValidationState -&gt; String)
-&gt; NoThunks ChainValidationState
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: Context -&gt; ChainValidationState -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; ChainValidationState -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; ChainValidationState -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; ChainValidationState -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: Proxy ChainValidationState -&gt; String
showTypeOf :: Proxy ChainValidationState -&gt; String
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679604353"><span id="local-6989586621679604357"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.ToCBOR.html#ToCBOR"><span class="hs-identifier hs-type">ToCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679604362"><span class="annot"><span class="annottext">toCBOR :: ChainValidationState -&gt; Encoding
</span><a href="#local-6989586621679604362"><span class="hs-identifier hs-var hs-var hs-var hs-var">toCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainValidationState -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#toByronCBOR"><span class="hs-identifier hs-var">toByronCBOR</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679604368"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-binary-1.7.2.0-a8823886ffd0b2d51904ce75fd27e0a08a953fdc80b3ee2bc40708ca6dbab289/share/doc/html/src/Cardano.Binary.FromCBOR.html#FromCBOR"><span class="hs-identifier hs-type">FromCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-153"></span><span>  </span><span id="local-6989586621679604374"><span class="annot"><span class="annottext">fromCBOR :: forall s. Decoder s ChainValidationState
</span><a href="#local-6989586621679604374"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decoder s ChainValidationState
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#fromByronCBOR"><span class="hs-identifier hs-var">fromByronCBOR</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679604380"><span id="local-6989586621679604383"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>  </span><span id="local-6989586621679604417"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s ChainValidationState
</span><a href="#local-6989586621679604417"><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; Int -&gt; Decoder s ()
forall s. Text -&gt; Int -&gt; Decoder s ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#enforceSize"><span class="hs-identifier hs-var">enforceSize</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ChainValidationState&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-158"></span><span>    </span><span class="annot"><span class="annottext">SlotNumber
-&gt; Either GenesisHash HeaderHash
-&gt; UTxO
-&gt; State
-&gt; State
-&gt; ChainValidationState
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-var">ChainValidationState</span></a></span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="annottext">(SlotNumber
 -&gt; Either GenesisHash HeaderHash
 -&gt; UTxO
 -&gt; State
 -&gt; State
 -&gt; ChainValidationState)
-&gt; Decoder s SlotNumber
-&gt; Decoder
     s
     (Either GenesisHash HeaderHash
      -&gt; UTxO -&gt; State -&gt; State -&gt; ChainValidationState)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s SlotNumber
forall s. Decoder s SlotNumber
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-160"></span><span>      </span><span class="annot"><span class="annottext">Decoder
  s
  (Either GenesisHash HeaderHash
   -&gt; UTxO -&gt; State -&gt; State -&gt; ChainValidationState)
-&gt; Decoder s (Either GenesisHash HeaderHash)
-&gt; Decoder s (UTxO -&gt; State -&gt; State -&gt; ChainValidationState)
forall a b. Decoder s (a -&gt; b) -&gt; Decoder s a -&gt; Decoder s b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s (Either GenesisHash HeaderHash)
forall s. Decoder s (Either GenesisHash HeaderHash)
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-161"></span><span>      </span><span class="annot"><span class="annottext">Decoder s (UTxO -&gt; State -&gt; State -&gt; ChainValidationState)
-&gt; Decoder s UTxO
-&gt; Decoder s (State -&gt; State -&gt; ChainValidationState)
forall a b. Decoder s (a -&gt; b) -&gt; Decoder s a -&gt; Decoder s b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s UTxO
forall s. Decoder s UTxO
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-162"></span><span>      </span><span class="annot"><span class="annottext">Decoder s (State -&gt; State -&gt; ChainValidationState)
-&gt; Decoder s State -&gt; Decoder s (State -&gt; ChainValidationState)
forall a b. Decoder s (a -&gt; b) -&gt; Decoder s a -&gt; Decoder s b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s State
forall s. Decoder s State
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">Decoder s (State -&gt; ChainValidationState)
-&gt; Decoder s State -&gt; Decoder s ChainValidationState
forall a b. Decoder s (a -&gt; b) -&gt; Decoder s a -&gt; Decoder s b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Decoder s State
forall s. Decoder s State
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679604424"><span id="local-6989586621679604427"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-type">EncCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>  </span><span id="local-6989586621679604455"><span class="annot"><span class="annottext">encCBOR :: ChainValidationState -&gt; Encoding
</span><a href="#local-6989586621679604455"><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></a></span></span><span> </span><span id="local-6989586621679604457"><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604457"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Encoder.html#encodeListLen"><span class="hs-identifier hs-var">encodeListLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">5</span></span><span>
</span><span id="line-168"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SlotNumber -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; SlotNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsLastSlot%3AChainValidationState"><span class="hs-identifier hs-var">cvsLastSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604457"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Either GenesisHash HeaderHash -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; Either GenesisHash HeaderHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsPreviousHash%3AChainValidationState"><span class="hs-identifier hs-var">cvsPreviousHash</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604457"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUtxo%3AChainValidationState"><span class="hs-identifier hs-var">cvsUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604457"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUpdateState%3AChainValidationState"><span class="hs-identifier hs-var">cvsUpdateState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604457"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsDelegationState%3AChainValidationState"><span class="hs-identifier hs-var">cvsDelegationState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604457"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | Create the state needed to validate the zeroth epoch of the chain. The</span><span>
</span><span id="line-175"></span><span class="hs-comment">--   zeroth epoch starts with a boundary block where the previous hash is the</span><span>
</span><span id="line-176"></span><span class="hs-comment">--   genesis hash.</span><span>
</span><span id="line-177"></span><span id="local-6989586621679603896"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#initialChainValidationState"><span class="hs-identifier hs-type">initialChainValidationState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Scheduling.html#Error"><span class="hs-identifier hs-type">Scheduling.Error</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603896"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#Config"><span class="hs-identifier hs-type">Genesis.Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="#local-6989586621679603896"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span><span>
</span><span id="line-181"></span><span id="initialChainValidationState"><span class="annot"><span class="annottext">initialChainValidationState :: forall (m :: * -&gt; *).
MonadError Error m =&gt;
Config -&gt; m ChainValidationState
</span><a href="Cardano.Chain.Block.Validation.html#initialChainValidationState"><span class="hs-identifier hs-var hs-var">initialChainValidationState</span></a></span></span><span> </span><span id="local-6989586621679604468"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>  </span><span id="local-6989586621679604469"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604469"><span class="hs-identifier hs-var">delegationState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Environment -&gt; GenesisDelegation -&gt; m State
forall (m :: * -&gt; *).
MonadError Error m =&gt;
Environment -&gt; GenesisDelegation -&gt; m State
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#initialState"><span class="hs-identifier hs-var">DI.initialState</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604471"><span class="hs-identifier hs-var">delegationEnv</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisDelegation
</span><a href="#local-6989586621679604472"><span class="hs-identifier hs-var">genesisDelegation</span></a></span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><span class="annottext">ChainValidationState -&gt; m ChainValidationState
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-184"></span><span>    </span><span class="annot"><span class="annottext">(ChainValidationState -&gt; m ChainValidationState)
-&gt; ChainValidationState -&gt; m ChainValidationState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:cvsLastSlot:ChainValidationState :: SlotNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsLastSlot%3AChainValidationState"><span class="hs-identifier hs-var">cvsLastSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNumber
</span><span class="hs-number">0</span></span><span>
</span><span id="line-186"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Ensure that we don't allow the internal value of this 'Left' to be</span><span>
</span><span id="line-187"></span><span>        </span><span class="hs-comment">-- lazy as we want to ensure that the 'ChainValidationState' is always</span><span>
</span><span id="line-188"></span><span>        </span><span class="hs-comment">-- in normal form.</span><span>
</span><span id="line-189"></span><span>        </span><span class="annot"><span class="annottext">$sel:cvsPreviousHash:ChainValidationState :: Either GenesisHash HeaderHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsPreviousHash%3AChainValidationState"><span class="hs-identifier hs-var">cvsPreviousHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenesisHash -&gt; Either GenesisHash HeaderHash
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(GenesisHash -&gt; Either GenesisHash HeaderHash)
-&gt; GenesisHash -&gt; Either GenesisHash HeaderHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$!</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; GenesisHash
</span><a href="Cardano.Chain.Genesis.Config.html#configGenesisHash"><span class="hs-identifier hs-var">configGenesisHash</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-190"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:cvsUtxo:ChainValidationState :: UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUtxo%3AChainValidationState"><span class="hs-identifier hs-var">cvsUtxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; UTxO
</span><a href="Cardano.Chain.UTxO.GenesisUTxO.html#genesisUtxo"><span class="hs-identifier hs-var">genesisUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-191"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:cvsUpdateState:ChainValidationState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUpdateState%3AChainValidationState"><span class="hs-identifier hs-var">cvsUpdateState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; State
</span><a href="Cardano.Chain.Update.Validation.Interface.html#initialState"><span class="hs-identifier hs-var">UPI.initialState</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-192"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:cvsDelegationState:ChainValidationState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsDelegationState%3AChainValidationState"><span class="hs-identifier hs-var">cvsDelegationState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604469"><span class="hs-identifier hs-var">delegationState</span></a></span><span>
</span><span id="line-193"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>    </span><span id="local-6989586621679604471"><span class="annot"><span class="annottext">delegationEnv :: Environment
</span><a href="#local-6989586621679604471"><span class="hs-identifier hs-var hs-var">delegationEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>      </span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Interface.html#Environment"><span class="hs-identifier hs-type">DI.Environment</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">protocolMagic :: Annotated ProtocolMagicId ByteString
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#protocolMagic"><span class="hs-identifier hs-var">DI.protocolMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolMagicId
-&gt; ByteString -&gt; Annotated ProtocolMagicId ByteString
forall b a. b -&gt; a -&gt; Annotated b a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Annotated.html#Annotated"><span class="hs-identifier hs-var">Annotated</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolMagicId
</span><a href="#local-6989586621679604484"><span class="hs-identifier hs-var">pm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; ProtocolMagicId -&gt; ByteString
forall a. EncCBOR a =&gt; Version -&gt; a -&gt; ByteString
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.html#serialize%27"><span class="hs-identifier hs-var">serialize'</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#byronProtVer"><span class="hs-identifier hs-var">byronProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolMagicId
</span><a href="#local-6989586621679604484"><span class="hs-identifier hs-var">pm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">allowedDelegators :: Set KeyHash
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#allowedDelegators"><span class="hs-identifier hs-var">DI.allowedDelegators</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenesisKeyHashes -&gt; Set KeyHash
</span><a href="Cardano.Chain.Genesis.KeyHashes.html#unGenesisKeyHashes"><span class="hs-identifier hs-var">unGenesisKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">(GenesisKeyHashes -&gt; Set KeyHash)
-&gt; GenesisKeyHashes -&gt; Set KeyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; GenesisKeyHashes
</span><a href="Cardano.Chain.Genesis.Config.html#configGenesisKeyHashes"><span class="hs-identifier hs-var">configGenesisKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">k :: BlockCount
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#k"><span class="hs-identifier hs-var">DI.k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; BlockCount
</span><a href="Cardano.Chain.Genesis.Config.html#configK"><span class="hs-identifier hs-var">configK</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentEpoch :: EpochNumber
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#currentEpoch"><span class="hs-identifier hs-var">DI.currentEpoch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; EpochNumber
</span><a href="Cardano.Chain.Slotting.EpochNumber.html#EpochNumber"><span class="hs-identifier hs-var">EpochNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentSlot :: SlotNumber
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#currentSlot"><span class="hs-identifier hs-var">DI.currentSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; SlotNumber
</span><a href="Cardano.Chain.Slotting.SlotNumber.html#SlotNumber"><span class="hs-identifier hs-var">SlotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621679604484"><span class="annot"><span class="annottext">pm :: ProtocolMagicId
</span><a href="#local-6989586621679604484"><span class="hs-identifier hs-var hs-var">pm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; ProtocolMagicId
</span><a href="Cardano.Chain.Genesis.Config.html#configProtocolMagicId"><span class="hs-identifier hs-var">configProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679604472"><span class="annot"><span class="annottext">genesisDelegation :: GenesisDelegation
</span><a href="#local-6989586621679604472"><span class="hs-identifier hs-var hs-var">genesisDelegation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; GenesisDelegation
</span><a href="Cardano.Chain.Genesis.Config.html#configHeavyDelegation"><span class="hs-identifier hs-var">configHeavyDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604468"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- ChainValidationError</span><span>
</span><span id="line-210"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-keyword">data</span><span> </span><span id="ChainValidationError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationError"><span class="hs-identifier hs-var">ChainValidationError</span></a></span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-comment">-- | The size of an epoch boundary block exceeds the limit</span></span><span>
</span><span id="line-214"></span><span>    </span><span id="ChainValidationBoundaryTooLarge"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationBoundaryTooLarge"><span class="hs-identifier hs-var">ChainValidationBoundaryTooLarge</span></a></span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The size of a block's attributes is non-zero</span></span><span>
</span><span id="line-216"></span><span>    </span><span id="ChainValidationBlockAttributesTooLarge"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationBlockAttributesTooLarge"><span class="hs-identifier hs-var">ChainValidationBlockAttributesTooLarge</span></a></span></span><span>
</span><span id="line-217"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The size of a regular block exceeds the limit</span></span><span>
</span><span id="line-218"></span><span>    </span><span id="ChainValidationBlockTooLarge"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationBlockTooLarge"><span class="hs-identifier hs-var">ChainValidationBlockTooLarge</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The size of a block header's attributes is non-zero</span></span><span>
</span><span id="line-220"></span><span>    </span><span id="ChainValidationHeaderAttributesTooLarge"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationHeaderAttributesTooLarge"><span class="hs-identifier hs-var">ChainValidationHeaderAttributesTooLarge</span></a></span></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The size of a block header exceeds the limit</span></span><span>
</span><span id="line-222"></span><span>    </span><span id="ChainValidationHeaderTooLarge"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationHeaderTooLarge"><span class="hs-identifier hs-var">ChainValidationHeaderTooLarge</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | There is a problem with the delegation payload signature</span></span><span>
</span><span id="line-224"></span><span>    </span><span id="ChainValidationDelegationPayloadError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationDelegationPayloadError"><span class="hs-identifier hs-var">ChainValidationDelegationPayloadError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The delegation used in the signature is not valid according to the ledger</span></span><span>
</span><span id="line-226"></span><span>    </span><span id="ChainValidationInvalidDelegation"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationInvalidDelegation"><span class="hs-identifier hs-var">ChainValidationInvalidDelegation</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Signing.VerificationKey.html#VerificationKey"><span class="hs-identifier hs-type">VerificationKey</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Signing.VerificationKey.html#VerificationKey"><span class="hs-identifier hs-type">VerificationKey</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Genesis hash mismatch</span></span><span>
</span><span id="line-228"></span><span>    </span><span id="ChainValidationGenesisHashMismatch"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationGenesisHashMismatch"><span class="hs-identifier hs-var">ChainValidationGenesisHashMismatch</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Genesis.Hash.html#GenesisHash"><span class="hs-identifier hs-type">GenesisHash</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Genesis.Hash.html#GenesisHash"><span class="hs-identifier hs-type">GenesisHash</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Expected GenesisHash but got HeaderHash</span></span><span>
</span><span id="line-230"></span><span>    </span><span id="ChainValidationExpectedGenesisHash"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationExpectedGenesisHash"><span class="hs-identifier hs-var">ChainValidationExpectedGenesisHash</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Genesis.Hash.html#GenesisHash"><span class="hs-identifier hs-type">GenesisHash</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Expected HeaderHash but GenesisHash</span></span><span>
</span><span id="line-232"></span><span>    </span><span id="ChainValidationExpectedHeaderHash"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationExpectedHeaderHash"><span class="hs-identifier hs-var">ChainValidationExpectedHeaderHash</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Genesis.Hash.html#GenesisHash"><span class="hs-identifier hs-type">GenesisHash</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The hash of the previous block does not match the value in the header</span></span><span>
</span><span id="line-234"></span><span>    </span><span id="ChainValidationInvalidHash"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationInvalidHash"><span class="hs-identifier hs-var">ChainValidationInvalidHash</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The hash of the previous block is missing and should be given hash.</span></span><span>
</span><span id="line-236"></span><span>    </span><span id="ChainValidationMissingHash"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationMissingHash"><span class="hs-identifier hs-var">ChainValidationMissingHash</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | There should not be a hash of the previous but there is.</span></span><span>
</span><span id="line-238"></span><span>    </span><span id="ChainValidationUnexpectedGenesisHash"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationUnexpectedGenesisHash"><span class="hs-identifier hs-var">ChainValidationUnexpectedGenesisHash</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The signature of the block is invalid</span></span><span>
</span><span id="line-240"></span><span>    </span><span id="ChainValidationInvalidSignature"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationInvalidSignature"><span class="hs-identifier hs-var">ChainValidationInvalidSignature</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#BlockSignature"><span class="hs-identifier hs-type">BlockSignature</span></a></span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | A delegation certificate failed validation in the ledger layer</span></span><span>
</span><span id="line-242"></span><span>    </span><span id="ChainValidationDelegationSchedulingError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationDelegationSchedulingError"><span class="hs-identifier hs-var">ChainValidationDelegationSchedulingError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Scheduling.html#Error"><span class="hs-identifier hs-type">Scheduling.Error</span></a></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The 'ProtocolMagic' in the block doesn't match the configured one</span></span><span>
</span><span id="line-244"></span><span>    </span><span id="ChainValidationProtocolMagicMismatch"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationProtocolMagicMismatch"><span class="hs-identifier hs-var">ChainValidationProtocolMagicMismatch</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#ProtocolMagicId"><span class="hs-identifier hs-type">ProtocolMagicId</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#ProtocolMagicId"><span class="hs-identifier hs-type">ProtocolMagicId</span></a></span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | A block is using unsupported lightweight delegation</span></span><span>
</span><span id="line-246"></span><span>    </span><span id="ChainValidationSignatureLight"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationSignatureLight"><span class="hs-identifier hs-var">ChainValidationSignatureLight</span></a></span></span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | The delegator for this block has delegated in too many recent blocks</span></span><span>
</span><span id="line-248"></span><span>    </span><span id="ChainValidationTooManyDelegations"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationTooManyDelegations"><span class="hs-identifier hs-var">ChainValidationTooManyDelegations</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Signing.VerificationKey.html#VerificationKey"><span class="hs-identifier hs-type">VerificationKey</span></a></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | Something failed to register in the update interface</span></span><span>
</span><span id="line-250"></span><span>    </span><span id="ChainValidationUpdateError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationUpdateError"><span class="hs-identifier hs-var">ChainValidationUpdateError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Slotting.SlotNumber.html#SlotNumber"><span class="hs-identifier hs-type">SlotNumber</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#Error"><span class="hs-identifier hs-type">UPI.Error</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | A transaction failed validation in the ledger layer</span></span><span>
</span><span id="line-252"></span><span>    </span><span id="ChainValidationUTxOValidationError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationUTxOValidationError"><span class="hs-identifier hs-var">ChainValidationUTxOValidationError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.Validation.html#UTxOValidationError"><span class="hs-identifier hs-type">UTxO.UTxOValidationError</span></a></span><span>
</span><span id="line-253"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-comment">-- | A payload proof did not match.</span></span><span>
</span><span id="line-254"></span><span>    </span><span id="ChainValidationProofValidationError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationProofValidationError"><span class="hs-identifier hs-var">ChainValidationProofValidationError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Proof.html#ProofValidationError"><span class="hs-identifier hs-type">ProofValidationError</span></a></span><span>
</span><span id="line-255"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679604514"><span id="local-6989586621679604552"><span class="annot"><span class="annottext">ChainValidationError -&gt; ChainValidationError -&gt; Bool
(ChainValidationError -&gt; ChainValidationError -&gt; Bool)
-&gt; (ChainValidationError -&gt; ChainValidationError -&gt; Bool)
-&gt; Eq ChainValidationError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: ChainValidationError -&gt; ChainValidationError -&gt; Bool
== :: ChainValidationError -&gt; ChainValidationError -&gt; Bool
$c/= :: ChainValidationError -&gt; ChainValidationError -&gt; Bool
/= :: ChainValidationError -&gt; ChainValidationError -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604557"><span id="local-6989586621679604612"><span id="local-6989586621679604616"><span class="annot"><span class="annottext">Int -&gt; ChainValidationError -&gt; ShowS
[ChainValidationError] -&gt; ShowS
ChainValidationError -&gt; String
(Int -&gt; ChainValidationError -&gt; ShowS)
-&gt; (ChainValidationError -&gt; String)
-&gt; ([ChainValidationError] -&gt; ShowS)
-&gt; Show ChainValidationError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; ChainValidationError -&gt; ShowS
showsPrec :: Int -&gt; ChainValidationError -&gt; ShowS
$cshow :: ChainValidationError -&gt; String
show :: ChainValidationError -&gt; String
$cshowList :: [ChainValidationError] -&gt; ShowS
showList :: [ChainValidationError] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- Validation Functions</span><span>
</span><span id="line-259"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span id="local-6989586621679603929"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateChainBlockOrBoundary"><span class="hs-identifier hs-type">updateChainBlockOrBoundary</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationError"><span class="hs-identifier hs-type">ChainValidationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603929"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-type">ValidationMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603929"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#Config"><span class="hs-identifier hs-type">Genesis.Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-265"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlockOrBoundary"><span class="hs-identifier hs-type">ABlockOrBoundary</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-266"></span><span>  </span><span class="annot"><a href="#local-6989586621679603929"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span><span>
</span><span id="line-267"></span><span id="updateChainBlockOrBoundary"><span class="annot"><span class="annottext">updateChainBlockOrBoundary :: forall (m :: * -&gt; *).
(MonadError ChainValidationError m,
 MonadReader ValidationMode m) =&gt;
Config
-&gt; ChainValidationState
-&gt; ABlockOrBoundary ByteString
-&gt; m ChainValidationState
</span><a href="Cardano.Chain.Block.Validation.html#updateChainBlockOrBoundary"><span class="hs-identifier hs-var hs-var">updateChainBlockOrBoundary</span></a></span></span><span> </span><span id="local-6989586621679604624"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604624"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679604625"><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604625"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span id="local-6989586621679604626"><span class="annot"><span class="annottext">ABlockOrBoundary ByteString
</span><a href="#local-6989586621679604626"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ABlockOrBoundary ByteString
</span><a href="#local-6989586621679604626"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABOBBoundary"><span class="hs-identifier hs-type">ABOBBoundary</span></a></span><span> </span><span id="local-6989586621679604628"><span class="annot"><span class="annottext">ABoundaryBlock ByteString
</span><a href="#local-6989586621679604628"><span class="hs-identifier hs-var">bvd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ChainValidationState
-&gt; ABoundaryBlock ByteString -&gt; m ChainValidationState
forall (m :: * -&gt; *).
MonadError ChainValidationError m =&gt;
ChainValidationState
-&gt; ABoundaryBlock ByteString -&gt; m ChainValidationState
</span><a href="Cardano.Chain.Block.Validation.html#updateChainBoundary"><span class="hs-identifier hs-var">updateChainBoundary</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604625"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ABoundaryBlock ByteString
</span><a href="#local-6989586621679604628"><span class="hs-identifier hs-var">bvd</span></a></span><span>
</span><span id="line-269"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABOBBlock"><span class="hs-identifier hs-type">ABOBBlock</span></a></span><span> </span><span id="local-6989586621679604630"><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604630"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Config
-&gt; ChainValidationState
-&gt; ABlock ByteString
-&gt; m ChainValidationState
forall (m :: * -&gt; *).
(MonadError ChainValidationError m,
 MonadReader ValidationMode m) =&gt;
Config
-&gt; ChainValidationState
-&gt; ABlock ByteString
-&gt; m ChainValidationState
</span><a href="Cardano.Chain.Block.Validation.html#updateBlock"><span class="hs-identifier hs-var">updateBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604624"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604625"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604630"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span id="local-6989586621679603933"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateChainBoundary"><span class="hs-identifier hs-type">updateChainBoundary</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationError"><span class="hs-identifier hs-type">ChainValidationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-273"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-274"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABoundaryBlock"><span class="hs-identifier hs-type">ABoundaryBlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-275"></span><span>  </span><span class="annot"><a href="#local-6989586621679603933"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span><span>
</span><span id="line-276"></span><span id="updateChainBoundary"><span class="annot"><span class="annottext">updateChainBoundary :: forall (m :: * -&gt; *).
MonadError ChainValidationError m =&gt;
ChainValidationState
-&gt; ABoundaryBlock ByteString -&gt; m ChainValidationState
</span><a href="Cardano.Chain.Block.Validation.html#updateChainBoundary"><span class="hs-identifier hs-var hs-var">updateChainBoundary</span></a></span></span><span> </span><span id="local-6989586621679604652"><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604652"><span class="hs-identifier hs-var">cvs</span></a></span></span><span> </span><span id="local-6989586621679604653"><span class="annot"><span class="annottext">ABoundaryBlock ByteString
</span><a href="#local-6989586621679604653"><span class="hs-identifier hs-var">bvd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; Either GenesisHash HeaderHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsPreviousHash%3AChainValidationState"><span class="hs-identifier hs-var">cvsPreviousHash</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604652"><span class="hs-identifier hs-var">cvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ABoundaryHeader ByteString -&gt; Either GenesisHash HeaderHash
forall a. ABoundaryHeader a -&gt; Either GenesisHash HeaderHash
</span><a href="Cardano.Chain.Block.Header.html#boundaryPrevHash"><span class="hs-identifier hs-var">boundaryPrevHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABoundaryBlock ByteString -&gt; ABoundaryHeader ByteString
forall a. ABoundaryBlock a -&gt; ABoundaryHeader a
</span><a href="Cardano.Chain.Block.Block.html#boundaryHeader"><span class="hs-identifier hs-var">boundaryHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ABoundaryBlock ByteString
</span><a href="#local-6989586621679604653"><span class="hs-identifier hs-var">bvd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679604656"><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604656"><span class="hs-identifier hs-var">expected</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679604657"><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604657"><span class="hs-identifier hs-var">actual</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604656"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisHash -&gt; GenesisHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604657"><span class="hs-identifier hs-var">actual</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ChainValidationError -&gt; m ()
forall e (m :: * -&gt; *). MonadError e m =&gt; Bool -&gt; e -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#orThrowError"><span class="hs-operator hs-var">`orThrowError`</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisHash -&gt; GenesisHash -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationGenesisHashMismatch"><span class="hs-identifier hs-var">ChainValidationGenesisHashMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604656"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604657"><span class="hs-identifier hs-var">actual</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679604659"><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604659"><span class="hs-identifier hs-var">expected</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679604660"><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604660"><span class="hs-identifier hs-var">actual</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604659"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash -&gt; HeaderHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604660"><span class="hs-identifier hs-var">actual</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ChainValidationError -&gt; m ()
forall e (m :: * -&gt; *). MonadError e m =&gt; Bool -&gt; e -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#orThrowError"><span class="hs-operator hs-var">`orThrowError`</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash -&gt; HeaderHash -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationInvalidHash"><span class="hs-identifier hs-var">ChainValidationInvalidHash</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604659"><span class="hs-identifier hs-var">expected</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604660"><span class="hs-identifier hs-var">actual</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679604661"><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604661"><span class="hs-identifier hs-var">gh</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679604662"><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604662"><span class="hs-identifier hs-var">hh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="annottext">ChainValidationError -&gt; m ()
forall a. ChainValidationError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ChainValidationError -&gt; m ()) -&gt; ChainValidationError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GenesisHash -&gt; HeaderHash -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationExpectedGenesisHash"><span class="hs-identifier hs-var">ChainValidationExpectedGenesisHash</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604661"><span class="hs-identifier hs-var">gh</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604662"><span class="hs-identifier hs-var">hh</span></a></span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679604664"><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604664"><span class="hs-identifier hs-var">hh</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679604665"><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604665"><span class="hs-identifier hs-var">gh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="annottext">ChainValidationError -&gt; m ()
forall a. ChainValidationError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ChainValidationError -&gt; m ()) -&gt; ChainValidationError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HeaderHash -&gt; GenesisHash -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationExpectedHeaderHash"><span class="hs-identifier hs-var">ChainValidationExpectedHeaderHash</span></a></span><span> </span><span class="annot"><span class="annottext">HeaderHash
</span><a href="#local-6989586621679604664"><span class="hs-identifier hs-var">hh</span></a></span><span> </span><span class="annot"><span class="annottext">GenesisHash
</span><a href="#local-6989586621679604665"><span class="hs-identifier hs-var">gh</span></a></span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>  </span><span class="hs-comment">-- Validate that the block is within the size bounds</span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABoundaryBlock ByteString -&gt; Int64
forall a. ABoundaryBlock a -&gt; Int64
</span><a href="Cardano.Chain.Block.Block.html#boundaryBlockLength"><span class="hs-identifier hs-var">boundaryBlockLength</span></a></span><span> </span><span class="annot"><span class="annottext">ABoundaryBlock ByteString
</span><a href="#local-6989586621679604653"><span class="hs-identifier hs-var">bvd</span></a></span><span> </span><span class="annot"><span class="annottext">Int64 -&gt; Int64 -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int64
</span><span class="hs-number">2e6</span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ChainValidationError -&gt; m ()
forall e (m :: * -&gt; *). MonadError e m =&gt; Bool -&gt; e -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#orThrowError"><span class="hs-operator hs-var">`orThrowError`</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationBoundaryTooLarge"><span class="hs-identifier hs-var">ChainValidationBoundaryTooLarge</span></a></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-comment">-- Update the previous hash</span><span>
</span><span id="line-294"></span><span>  </span><span class="annot"><span class="annottext">ChainValidationState -&gt; m ChainValidationState
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><span class="annottext">(ChainValidationState -&gt; m ChainValidationState)
-&gt; ChainValidationState -&gt; m ChainValidationState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604652"><span class="hs-identifier hs-var">cvs</span></a></span><span>
</span><span id="line-296"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsPreviousHash%3AChainValidationState"><span class="hs-identifier hs-var">cvsPreviousHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="#local-6989586621679604668"><span class="hs-identifier hs-type">previousHash</span></a></span><span>
</span><span id="line-297"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><a href="#local-6989586621679604668"><span class="hs-identifier hs-type">previousHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span id="local-6989586621679604668"><span class="annot"><span class="annottext">previousHash :: HeaderHash
</span><a href="#local-6989586621679604668"><span class="hs-identifier hs-var hs-var">previousHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>      </span><span class="annot"><span class="annottext">Hash Raw -&gt; HeaderHash
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><span class="annottext">(Hash Raw -&gt; HeaderHash)
-&gt; (ByteString -&gt; Hash Raw) -&gt; ByteString -&gt; HeaderHash
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Hash Raw
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Hashing.html#hashRaw"><span class="hs-identifier hs-var">hashRaw</span></a></span><span>
</span><span id="line-303"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; Hash Raw)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; Hash Raw
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">BSL.fromStrict</span></span><span>
</span><span id="line-304"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (ByteString -&gt; ByteString) -&gt; ByteString -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="Cardano.Chain.Block.Header.html#wrapBoundaryBytes"><span class="hs-identifier hs-var">wrapBoundaryBytes</span></a></span><span>
</span><span id="line-305"></span><span>        </span><span class="annot"><span class="annottext">(ByteString -&gt; HeaderHash) -&gt; ByteString -&gt; HeaderHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABoundaryHeader ByteString -&gt; ByteString
forall a. ABoundaryHeader a -&gt; a
</span><a href="Cardano.Chain.Block.Header.html#boundaryHeaderAnnotation"><span class="hs-identifier hs-var">boundaryHeaderAnnotation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABoundaryBlock ByteString -&gt; ABoundaryHeader ByteString
forall a. ABoundaryBlock a -&gt; ABoundaryHeader a
</span><a href="Cardano.Chain.Block.Block.html#boundaryHeader"><span class="hs-identifier hs-var">boundaryHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ABoundaryBlock ByteString
</span><a href="#local-6989586621679604653"><span class="hs-identifier hs-var">bvd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span id="local-6989586621679603956"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#validateHeaderMatchesBody"><span class="hs-identifier hs-type">validateHeaderMatchesBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Proof.html#ProofValidationError"><span class="hs-identifier hs-type">ProofValidationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603956"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#AHeader"><span class="hs-identifier hs-type">AHeader</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-310"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Body.html#ABody"><span class="hs-identifier hs-type">ABody</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-311"></span><span>  </span><span class="annot"><a href="#local-6989586621679603956"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-312"></span><span id="validateHeaderMatchesBody"><span class="annot"><span class="annottext">validateHeaderMatchesBody :: forall (m :: * -&gt; *).
MonadError ProofValidationError m =&gt;
AHeader ByteString -&gt; ABody ByteString -&gt; m ()
</span><a href="Cardano.Chain.Block.Validation.html#validateHeaderMatchesBody"><span class="hs-identifier hs-var hs-var">validateHeaderMatchesBody</span></a></span></span><span> </span><span id="local-6989586621679604687"><span class="annot"><span class="annottext">AHeader ByteString
</span><a href="#local-6989586621679604687"><span class="hs-identifier hs-var">hdr</span></a></span></span><span> </span><span id="local-6989586621679604688"><span class="annot"><span class="annottext">ABody ByteString
</span><a href="#local-6989586621679604688"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679604689"><span class="annot"><span class="annottext">hdrProof :: Proof
</span><a href="#local-6989586621679604689"><span class="hs-identifier hs-var hs-var">hdrProof</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AHeader ByteString -&gt; Proof
forall a. AHeader a -&gt; Proof
</span><a href="Cardano.Chain.Block.Header.html#headerProof"><span class="hs-identifier hs-var">headerProof</span></a></span><span> </span><span class="annot"><span class="annottext">AHeader ByteString
</span><a href="#local-6989586621679604687"><span class="hs-identifier hs-var">hdr</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-comment">-- Validate the delegation payload signature</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><span class="annottext">Proof -&gt; Hash Payload
</span><a href="Cardano.Chain.Block.Proof.html#proofDelegation"><span class="hs-identifier hs-var">proofDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">Proof
</span><a href="#local-6989586621679604689"><span class="hs-identifier hs-var">hdrProof</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span class="annot"><span class="annottext">Hash Payload -&gt; Hash Payload -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">APayload ByteString -&gt; Hash (BaseType (APayload ByteString))
forall t. Decoded t =&gt; t -&gt; Hash (BaseType t)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Hashing.html#hashDecoded"><span class="hs-identifier hs-var">hashDecoded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABody ByteString -&gt; APayload ByteString
forall a. ABody a -&gt; APayload a
</span><a href="Cardano.Chain.Block.Body.html#bodyDlgPayload"><span class="hs-identifier hs-var">bodyDlgPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABody ByteString
</span><a href="#local-6989586621679604688"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ProofValidationError -&gt; m ()
forall e (m :: * -&gt; *). MonadError e m =&gt; Bool -&gt; e -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#orThrowError"><span class="hs-operator hs-var">`orThrowError`</span></a></span><span> </span><span class="annot"><span class="annottext">ProofValidationError
</span><a href="Cardano.Chain.Block.Proof.html#DelegationProofValidationError"><span class="hs-identifier hs-var">DelegationProofValidationError</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-comment">-- Validate the transaction payload proof</span><span>
</span><span id="line-321"></span><span>  </span><span class="annot"><span class="annottext">Proof -&gt; TxProof
</span><a href="Cardano.Chain.Block.Proof.html#proofUTxO"><span class="hs-identifier hs-var">proofUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Proof
</span><a href="#local-6989586621679604689"><span class="hs-identifier hs-var">hdrProof</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="annot"><span class="annottext">TxProof -&gt; TxProof -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ATxPayload ByteString -&gt; TxProof
</span><a href="Cardano.Chain.UTxO.TxProof.html#recoverTxProof"><span class="hs-identifier hs-var">recoverTxProof</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABody ByteString -&gt; ATxPayload ByteString
forall a. ABody a -&gt; ATxPayload a
</span><a href="Cardano.Chain.Block.Body.html#bodyTxPayload"><span class="hs-identifier hs-var">bodyTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABody ByteString
</span><a href="#local-6989586621679604688"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ProofValidationError -&gt; m ()
forall e (m :: * -&gt; *). MonadError e m =&gt; Bool -&gt; e -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#orThrowError"><span class="hs-operator hs-var">`orThrowError`</span></a></span><span> </span><span class="annot"><span class="annottext">ProofValidationError
</span><a href="Cardano.Chain.Block.Proof.html#UTxOProofValidationError"><span class="hs-identifier hs-var">UTxOProofValidationError</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>  </span><span class="hs-comment">-- Validate the update payload proof</span><span>
</span><span id="line-326"></span><span>  </span><span class="annot"><span class="annottext">Proof -&gt; Proof
</span><a href="Cardano.Chain.Block.Proof.html#proofUpdate"><span class="hs-identifier hs-var">proofUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Proof
</span><a href="#local-6989586621679604689"><span class="hs-identifier hs-var">hdrProof</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><span class="annottext">Proof -&gt; Proof -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">APayload ByteString -&gt; Hash (BaseType (APayload ByteString))
forall t. Decoded t =&gt; t -&gt; Hash (BaseType t)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.Hashing.html#hashDecoded"><span class="hs-identifier hs-var">hashDecoded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABody ByteString -&gt; APayload ByteString
forall a. ABody a -&gt; APayload a
</span><a href="Cardano.Chain.Block.Body.html#bodyUpdatePayload"><span class="hs-identifier hs-var">bodyUpdatePayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABody ByteString
</span><a href="#local-6989586621679604688"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ProofValidationError -&gt; m ()
forall e (m :: * -&gt; *). MonadError e m =&gt; Bool -&gt; e -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#orThrowError"><span class="hs-operator hs-var">`orThrowError`</span></a></span><span> </span><span class="annot"><span class="annottext">ProofValidationError
</span><a href="Cardano.Chain.Block.Proof.html#UpdateProofValidationError"><span class="hs-identifier hs-var">UpdateProofValidationError</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span id="local-6989586621679603973"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#validateBlockProofs"><span class="hs-identifier hs-type">validateBlockProofs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-331"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Proof.html#ProofValidationError"><span class="hs-identifier hs-type">ProofValidationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603973"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-332"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlock"><span class="hs-identifier hs-type">ABlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-333"></span><span>  </span><span class="annot"><a href="#local-6989586621679603973"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-334"></span><span id="validateBlockProofs"><span class="annot"><span class="annottext">validateBlockProofs :: forall (m :: * -&gt; *).
MonadError ProofValidationError m =&gt;
ABlock ByteString -&gt; m ()
</span><a href="Cardano.Chain.Block.Validation.html#validateBlockProofs"><span class="hs-identifier hs-var hs-var">validateBlockProofs</span></a></span></span><span> </span><span id="local-6989586621679604702"><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604702"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-335"></span><span>  </span><span class="annot"><span class="annottext">AHeader ByteString -&gt; ABody ByteString -&gt; m ()
forall (m :: * -&gt; *).
MonadError ProofValidationError m =&gt;
AHeader ByteString -&gt; ABody ByteString -&gt; m ()
</span><a href="Cardano.Chain.Block.Validation.html#validateHeaderMatchesBody"><span class="hs-identifier hs-var">validateHeaderMatchesBody</span></a></span><span> </span><span class="annot"><span class="annottext">AHeader ByteString
</span><a href="#local-6989586621679604703"><span class="hs-identifier hs-var">blockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ABody ByteString
</span><a href="#local-6989586621679604704"><span class="hs-identifier hs-var">blockBody</span></a></span><span>
</span><span id="line-336"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlock"><span class="hs-identifier hs-type">ABlock</span></a></span><span>
</span><span id="line-338"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679604703"><span class="annot"><span class="annottext">AHeader ByteString
blockHeader :: forall a. ABlock a -&gt; AHeader a
blockHeader :: AHeader ByteString
</span><a href="Cardano.Chain.Block.Block.html#blockHeader"><span class="hs-identifier hs-var hs-var">blockHeader</span></a></span></span><span>
</span><span id="line-339"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604704"><span class="annot"><span class="annottext">ABody ByteString
blockBody :: ABody ByteString
blockBody :: forall a. ABlock a -&gt; ABody a
</span><a href="#local-6989586621679604704"><span class="hs-identifier hs-var hs-var">blockBody</span></a></span></span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604702"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-keyword">data</span><span> </span><span id="BodyEnvironment"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyEnvironment"><span class="hs-identifier hs-var">BodyEnvironment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BodyEnvironment"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyEnvironment"><span class="hs-identifier hs-var">BodyEnvironment</span></a></span></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AprotocolMagic%3ABodyEnvironment"><span class="annot"><span class="annottext">BodyEnvironment -&gt; AProtocolMagic ByteString
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolMagic%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">protocolMagic</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#AProtocolMagic"><span class="hs-identifier hs-type">AProtocolMagic</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AutxoConfiguration%3ABodyEnvironment"><span class="annot"><span class="annottext">BodyEnvironment -&gt; UTxOConfiguration
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AutxoConfiguration%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">utxoConfiguration</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.UTxO.UTxOConfiguration.html#UTxOConfiguration"><span class="hs-identifier hs-type">UTxOConfiguration</span></a></span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Ak%3ABodyEnvironment"><span class="annot"><span class="annottext">BodyEnvironment -&gt; BlockCount
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Ak%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Common.BlockCount.html#BlockCount"><span class="hs-identifier hs-type">BlockCount</span></a></span><span>
</span><span id="line-346"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AallowedDelegators%3ABodyEnvironment"><span class="annot"><span class="annottext">BodyEnvironment -&gt; Set KeyHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AallowedDelegators%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">allowedDelegators</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Common.KeyHash.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AprotocolParameters%3ABodyEnvironment"><span class="annot"><span class="annottext">BodyEnvironment -&gt; ProtocolParameters
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolParameters%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">protocolParameters</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Update.ProtocolParameters.html#ProtocolParameters"><span class="hs-identifier hs-type">Update.ProtocolParameters</span></a></span><span>
</span><span id="line-348"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcurrentEpoch%3ABodyEnvironment"><span class="annot"><span class="annottext">BodyEnvironment -&gt; EpochNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcurrentEpoch%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">currentEpoch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Slotting.EpochNumber.html#EpochNumber"><span class="hs-identifier hs-type">EpochNumber</span></a></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-keyword">data</span><span> </span><span id="BodyState"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-var">BodyState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BodyState"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-var">BodyState</span></a></span></span><span>
</span><span id="line-352"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3Autxo%3ABodyState"><span class="annot"><span class="annottext">BodyState -&gt; UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Autxo%3ABodyState"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AupdateState%3ABodyState"><span class="annot"><span class="annottext">BodyState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AupdateState%3ABodyState"><span class="hs-identifier hs-var hs-var">updateState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#State"><span class="hs-identifier hs-type">UPI.State</span></a></span><span>
</span><span id="line-354"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AdelegationState%3ABodyState"><span class="annot"><span class="annottext">BodyState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationState%3ABodyState"><span class="hs-identifier hs-var hs-var">delegationState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Interface.html#State"><span class="hs-identifier hs-type">DI.State</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- | This is an implementation of the BBODY rule as per the chain specification.</span><span>
</span><span id="line-358"></span><span class="hs-comment">--</span><span>
</span><span id="line-359"></span><span class="hs-comment">--   Compared to `updateChain`, this does not validate any header level checks,</span><span>
</span><span id="line-360"></span><span class="hs-comment">--   nor does it carry out anything which might be considered part of the</span><span>
</span><span id="line-361"></span><span class="hs-comment">--   protocol.</span><span>
</span><span id="line-362"></span><span id="local-6989586621679603982"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateBody"><span class="hs-identifier hs-type">updateBody</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-363"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationError"><span class="hs-identifier hs-type">ChainValidationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-type">ValidationMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603982"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-364"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyEnvironment"><span class="hs-identifier hs-type">BodyEnvironment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-type">BodyState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlock"><span class="hs-identifier hs-type">ABlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><a href="#local-6989586621679603982"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-type">BodyState</span></a></span></span><span>
</span><span id="line-368"></span><span id="updateBody"><span class="annot"><span class="annottext">updateBody :: forall (m :: * -&gt; *).
(MonadError ChainValidationError m,
 MonadReader ValidationMode m) =&gt;
BodyEnvironment -&gt; BodyState -&gt; ABlock ByteString -&gt; m BodyState
</span><a href="Cardano.Chain.Block.Validation.html#updateBody"><span class="hs-identifier hs-var hs-var">updateBody</span></a></span></span><span> </span><span id="local-6989586621679604752"><span class="annot"><span class="annottext">BodyEnvironment
</span><a href="#local-6989586621679604752"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679604753"><span class="annot"><span class="annottext">BodyState
</span><a href="#local-6989586621679604753"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621679604754"><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>  </span><span class="hs-comment">-- Validate the block size</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; Natural
</span><a href="Cardano.Chain.Block.Block.html#blockLength"><span class="hs-identifier hs-var">blockLength</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679604755"><span class="hs-identifier hs-var">maxBlockSize</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ChainValidationError -&gt; m ()
forall e (m :: * -&gt; *).
(MonadError e m, MonadReader ValidationMode m) =&gt;
Bool -&gt; e -&gt; m ()
</span><a href="Cardano.Chain.ValidationMode.html#orThrowErrorInBlockValidationMode"><span class="hs-operator hs-var">`orThrowErrorInBlockValidationMode`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationBlockTooLarge"><span class="hs-identifier hs-var">ChainValidationBlockTooLarge</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679604755"><span class="hs-identifier hs-var">maxBlockSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString -&gt; Natural
</span><a href="Cardano.Chain.Block.Block.html#blockLength"><span class="hs-identifier hs-var">blockLength</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>  </span><span class="hs-comment">-- Validate the delegation, transaction, and update payload proofs.</span><span>
</span><span id="line-375"></span><span>  </span><span class="annot"><span class="annottext">ReaderT ValidationMode (Either ProofValidationError) ()
-&gt; ReaderT ValidationMode (Either ProofValidationError) ()
forall err (m :: * -&gt; *).
(MonadError err m, MonadReader ValidationMode m) =&gt;
m () -&gt; m ()
</span><a href="Cardano.Chain.ValidationMode.html#whenBlockValidation"><span class="hs-identifier hs-var">whenBlockValidation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString
-&gt; ReaderT ValidationMode (Either ProofValidationError) ()
forall (m :: * -&gt; *).
MonadError ProofValidationError m =&gt;
ABlock ByteString -&gt; m ()
</span><a href="Cardano.Chain.Block.Validation.html#validateBlockProofs"><span class="hs-identifier hs-var">validateBlockProofs</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="annottext">ReaderT ValidationMode (Either ProofValidationError) ()
-&gt; (ProofValidationError -&gt; ChainValidationError) -&gt; m ()
forall e' (m :: * -&gt; *) e a.
(MonadError e' m, MonadReader ValidationMode m) =&gt;
ReaderT ValidationMode (Either e) a -&gt; (e -&gt; e') -&gt; m a
</span><a href="Cardano.Chain.ValidationMode.html#wrapErrorWithValidationMode"><span class="hs-operator hs-var">`wrapErrorWithValidationMode`</span></a></span><span> </span><span class="annot"><span class="annottext">ProofValidationError -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationProofValidationError"><span class="hs-identifier hs-var">ChainValidationProofValidationError</span></a></span><span>
</span><span id="line-377"></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-comment">-- Update the delegation state</span><span>
</span><span id="line-379"></span><span>  </span><span id="local-6989586621679604756"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604756"><span class="hs-identifier hs-var">delegationState'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-380"></span><span>    </span><span class="annot"><span class="annottext">Environment
-&gt; State -&gt; [ACertificate ByteString] -&gt; Either Error State
forall (m :: * -&gt; *).
MonadError Error m =&gt;
Environment -&gt; State -&gt; [ACertificate ByteString] -&gt; m State
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#updateDelegation"><span class="hs-identifier hs-var">DI.updateDelegation</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604758"><span class="hs-identifier hs-var">delegationEnv</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604759"><span class="hs-identifier hs-var">delegationState</span></a></span><span> </span><span class="annot"><span class="annottext">[ACertificate ByteString]
</span><a href="#local-6989586621679604760"><span class="hs-identifier hs-var">certificates</span></a></span><span>
</span><span id="line-381"></span><span>      </span><span class="annot"><span class="annottext">Either Error State -&gt; (Error -&gt; ChainValidationError) -&gt; m State
forall e' (m :: * -&gt; *) e a.
MonadError e' m =&gt;
Either e a -&gt; (e -&gt; e') -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#wrapError"><span class="hs-operator hs-var">`wrapError`</span></a></span><span> </span><span class="annot"><span class="annottext">Error -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationDelegationSchedulingError"><span class="hs-identifier hs-var">ChainValidationDelegationSchedulingError</span></a></span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-comment">-- Update the UTxO</span><span>
</span><span id="line-384"></span><span>  </span><span id="local-6989586621679604762"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604762"><span class="hs-identifier hs-var">utxo'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><span class="annottext">Environment
-&gt; UTxO
-&gt; [ATxAux ByteString]
-&gt; ReaderT ValidationMode (Either UTxOValidationError) UTxO
forall (m :: * -&gt; *).
(MonadError UTxOValidationError m, MonadReader ValidationMode m) =&gt;
Environment -&gt; UTxO -&gt; [ATxAux ByteString] -&gt; m UTxO
</span><a href="Cardano.Chain.UTxO.Validation.html#updateUTxO"><span class="hs-identifier hs-var">UTxO.updateUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604764"><span class="hs-identifier hs-var">utxoEnv</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604765"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">[ATxAux ByteString]
</span><a href="#local-6989586621679604766"><span class="hs-identifier hs-var">txs</span></a></span><span>
</span><span id="line-386"></span><span>      </span><span class="annot"><span class="annottext">ReaderT ValidationMode (Either UTxOValidationError) UTxO
-&gt; (UTxOValidationError -&gt; ChainValidationError) -&gt; m UTxO
forall e' (m :: * -&gt; *) e a.
(MonadError e' m, MonadReader ValidationMode m) =&gt;
ReaderT ValidationMode (Either e) a -&gt; (e -&gt; e') -&gt; m a
</span><a href="Cardano.Chain.ValidationMode.html#wrapErrorWithValidationMode"><span class="hs-operator hs-var">`wrapErrorWithValidationMode`</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOValidationError -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationUTxOValidationError"><span class="hs-identifier hs-var">ChainValidationUTxOValidationError</span></a></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>  </span><span class="hs-comment">-- Update the update state</span><span>
</span><span id="line-389"></span><span>  </span><span id="local-6989586621679604767"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604767"><span class="hs-identifier hs-var">updateState'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="annottext">Environment -&gt; State -&gt; Signal -&gt; Either Error State
forall (m :: * -&gt; *).
MonadError Error m =&gt;
Environment -&gt; State -&gt; Signal -&gt; m State
</span><a href="Cardano.Chain.Update.Validation.Interface.html#registerUpdate"><span class="hs-identifier hs-var">UPI.registerUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604769"><span class="hs-identifier hs-var">updateEnv</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604770"><span class="hs-identifier hs-var">updateState</span></a></span><span> </span><span class="annot"><span class="annottext">Signal
</span><a href="#local-6989586621679604771"><span class="hs-identifier hs-var">updateSignal</span></a></span><span>
</span><span id="line-391"></span><span>      </span><span class="annot"><span class="annottext">Either Error State -&gt; (Error -&gt; ChainValidationError) -&gt; m State
forall e' (m :: * -&gt; *) e a.
MonadError e' m =&gt;
Either e a -&gt; (e -&gt; e') -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Error.html#wrapError"><span class="hs-operator hs-var">`wrapError`</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNumber -&gt; Error -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationUpdateError"><span class="hs-identifier hs-var">ChainValidationUpdateError</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNumber
</span><a href="#local-6989586621679604772"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span>  </span><span class="annot"><span class="annottext">BodyState -&gt; m BodyState
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-394"></span><span>    </span><span class="annot"><span class="annottext">(BodyState -&gt; m BodyState) -&gt; BodyState -&gt; m BodyState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-type">BodyState</span></a></span><span>
</span><span id="line-395"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:utxo:BodyState :: UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Autxo%3ABodyState"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604762"><span class="hs-identifier hs-var">utxo'</span></a></span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:updateState:BodyState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AupdateState%3ABodyState"><span class="hs-identifier hs-var">updateState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604767"><span class="hs-identifier hs-var">updateState'</span></a></span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegationState:BodyState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationState%3ABodyState"><span class="hs-identifier hs-var">delegationState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604756"><span class="hs-identifier hs-var">delegationState'</span></a></span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-399"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-400"></span><span>    </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyEnvironment"><span class="hs-identifier hs-type">BodyEnvironment</span></a></span><span>
</span><span id="line-401"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679604773"><span class="annot"><span class="annottext">AProtocolMagic ByteString
$sel:protocolMagic:BodyEnvironment :: BodyEnvironment -&gt; AProtocolMagic ByteString
protocolMagic :: AProtocolMagic ByteString
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolMagic%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">protocolMagic</span></a></span></span><span>
</span><span id="line-402"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604774"><span class="annot"><span class="annottext">BlockCount
$sel:k:BodyEnvironment :: BodyEnvironment -&gt; BlockCount
k :: BlockCount
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Ak%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span>
</span><span id="line-403"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604775"><span class="annot"><span class="annottext">Set KeyHash
$sel:allowedDelegators:BodyEnvironment :: BodyEnvironment -&gt; Set KeyHash
allowedDelegators :: Set KeyHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AallowedDelegators%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">allowedDelegators</span></a></span></span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604776"><span class="annot"><span class="annottext">UTxOConfiguration
$sel:utxoConfiguration:BodyEnvironment :: BodyEnvironment -&gt; UTxOConfiguration
utxoConfiguration :: UTxOConfiguration
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AutxoConfiguration%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">utxoConfiguration</span></a></span></span><span>
</span><span id="line-405"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604777"><span class="annot"><span class="annottext">EpochNumber
$sel:currentEpoch:BodyEnvironment :: BodyEnvironment -&gt; EpochNumber
currentEpoch :: EpochNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcurrentEpoch%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">currentEpoch</span></a></span></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BodyEnvironment
</span><a href="#local-6989586621679604752"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span>    </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-type">BodyState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679604765"><span class="annot"><span class="annottext">UTxO
$sel:utxo:BodyState :: BodyState -&gt; UTxO
utxo :: UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Autxo%3ABodyState"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604770"><span class="annot"><span class="annottext">State
$sel:updateState:BodyState :: BodyState -&gt; State
updateState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AupdateState%3ABodyState"><span class="hs-identifier hs-var hs-var">updateState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604759"><span class="annot"><span class="annottext">State
$sel:delegationState:BodyState :: BodyState -&gt; State
delegationState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationState%3ABodyState"><span class="hs-identifier hs-var hs-var">delegationState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BodyState
</span><a href="#local-6989586621679604753"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>    </span><span id="local-6989586621679604755"><span class="annot"><span class="annottext">maxBlockSize :: Natural
</span><a href="#local-6989586621679604755"><span class="hs-identifier hs-var hs-var">maxBlockSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-411"></span><span>      </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Natural
</span><a href="Cardano.Chain.Update.ProtocolParameters.html#ppMaxBlockSize"><span class="hs-identifier hs-var">Update.ppMaxBlockSize</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Natural) -&gt; ProtocolParameters -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; ProtocolParameters
</span><a href="Cardano.Chain.Update.Validation.Interface.html#adoptedProtocolParameters"><span class="hs-identifier hs-var">UPI.adoptedProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604770"><span class="hs-identifier hs-var">updateState</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>    </span><span id="local-6989586621679604772"><span class="annot"><span class="annottext">currentSlot :: SlotNumber
</span><a href="#local-6989586621679604772"><span class="hs-identifier hs-var hs-var">currentSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; SlotNumber
forall a. ABlock a -&gt; SlotNumber
</span><a href="Cardano.Chain.Block.Block.html#blockSlot"><span class="hs-identifier hs-var">blockSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>    </span><span id="local-6989586621679604760"><span class="annot"><span class="annottext">certificates :: [ACertificate ByteString]
</span><a href="#local-6989586621679604760"><span class="hs-identifier hs-var hs-var">certificates</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">APayload ByteString -&gt; [ACertificate ByteString]
forall a. APayload a -&gt; [ACertificate a]
</span><a href="Cardano.Chain.Delegation.Payload.html#getPayload"><span class="hs-identifier hs-var">Delegation.getPayload</span></a></span><span> </span><span class="annot"><span class="annottext">(APayload ByteString -&gt; [ACertificate ByteString])
-&gt; APayload ByteString -&gt; [ACertificate ByteString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; APayload ByteString
forall a. ABlock a -&gt; APayload a
</span><a href="Cardano.Chain.Block.Block.html#blockDlgPayload"><span class="hs-identifier hs-var">blockDlgPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>    </span><span id="local-6989586621679604766"><span class="annot"><span class="annottext">txs :: [ATxAux ByteString]
</span><a href="#local-6989586621679604766"><span class="hs-identifier hs-var hs-var">txs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ATxPayload ByteString -&gt; [ATxAux ByteString]
forall a. ATxPayload a -&gt; [ATxAux a]
</span><a href="Cardano.Chain.UTxO.TxPayload.html#aUnTxPayload"><span class="hs-identifier hs-var">aUnTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">(ATxPayload ByteString -&gt; [ATxAux ByteString])
-&gt; ATxPayload ByteString -&gt; [ATxAux ByteString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; ATxPayload ByteString
forall a. ABlock a -&gt; ATxPayload a
</span><a href="Cardano.Chain.Block.Block.html#blockTxPayload"><span class="hs-identifier hs-var">blockTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-418"></span><span>
</span><span id="line-419"></span><span>    </span><span id="local-6989586621679604758"><span class="annot"><span class="annottext">delegationEnv :: Environment
</span><a href="#local-6989586621679604758"><span class="hs-identifier hs-var hs-var">delegationEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-420"></span><span>      </span><span class="annot"><a href="Cardano.Chain.Delegation.Validation.Interface.html#Environment"><span class="hs-identifier hs-type">DI.Environment</span></a></span><span>
</span><span id="line-421"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">protocolMagic :: Annotated ProtocolMagicId ByteString
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#protocolMagic"><span class="hs-identifier hs-var">DI.protocolMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AProtocolMagic ByteString -&gt; Annotated ProtocolMagicId ByteString
forall a. AProtocolMagic a -&gt; Annotated ProtocolMagicId a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#getAProtocolMagicId"><span class="hs-identifier hs-var">getAProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">AProtocolMagic ByteString
</span><a href="#local-6989586621679604773"><span class="hs-identifier hs-var">protocolMagic</span></a></span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">allowedDelegators :: Set KeyHash
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#allowedDelegators"><span class="hs-identifier hs-var">DI.allowedDelegators</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set KeyHash
</span><a href="#local-6989586621679604775"><span class="hs-identifier hs-var">allowedDelegators</span></a></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">k :: BlockCount
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#k"><span class="hs-identifier hs-var">DI.k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679604774"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentEpoch :: EpochNumber
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#currentEpoch"><span class="hs-identifier hs-var">DI.currentEpoch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNumber
</span><a href="#local-6989586621679604777"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span>
</span><span id="line-425"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentSlot :: SlotNumber
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#currentSlot"><span class="hs-identifier hs-var">DI.currentSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNumber
</span><a href="#local-6989586621679604772"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-426"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>    </span><span id="local-6989586621679604764"><span class="annot"><span class="annottext">utxoEnv :: Environment
</span><a href="#local-6989586621679604764"><span class="hs-identifier hs-var hs-var">utxoEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>      </span><span class="annot"><a href="Cardano.Chain.UTxO.Validation.html#Environment"><span class="hs-identifier hs-type">UTxO.Environment</span></a></span><span>
</span><span id="line-430"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">protocolMagic :: AProtocolMagic ByteString
</span><a href="Cardano.Chain.UTxO.Validation.html#protocolMagic"><span class="hs-identifier hs-var">UTxO.protocolMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AProtocolMagic ByteString
</span><a href="#local-6989586621679604773"><span class="hs-identifier hs-var">protocolMagic</span></a></span><span>
</span><span id="line-431"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">protocolParameters :: ProtocolParameters
</span><a href="Cardano.Chain.UTxO.Validation.html#protocolParameters"><span class="hs-identifier hs-var">UTxO.protocolParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; ProtocolParameters
</span><a href="Cardano.Chain.Update.Validation.Interface.html#adoptedProtocolParameters"><span class="hs-identifier hs-var">UPI.adoptedProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604770"><span class="hs-identifier hs-var">updateState</span></a></span><span>
</span><span id="line-432"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">utxoConfiguration :: UTxOConfiguration
</span><a href="Cardano.Chain.UTxO.Validation.html#utxoConfiguration"><span class="hs-identifier hs-var">UTxO.utxoConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOConfiguration
</span><a href="#local-6989586621679604776"><span class="hs-identifier hs-var">utxoConfiguration</span></a></span><span>
</span><span id="line-433"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>    </span><span id="local-6989586621679604769"><span class="annot"><span class="annottext">updateEnv :: Environment
</span><a href="#local-6989586621679604769"><span class="hs-identifier hs-var hs-var">updateEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-436"></span><span>      </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#Environment"><span class="hs-identifier hs-type">UPI.Environment</span></a></span><span>
</span><span id="line-437"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">protocolMagic :: Annotated ProtocolMagicId ByteString
</span><a href="Cardano.Chain.Update.Validation.Interface.html#protocolMagic"><span class="hs-identifier hs-var">UPI.protocolMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AProtocolMagic ByteString -&gt; Annotated ProtocolMagicId ByteString
forall a. AProtocolMagic a -&gt; Annotated ProtocolMagicId a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#getAProtocolMagicId"><span class="hs-identifier hs-var">getAProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">AProtocolMagic ByteString
</span><a href="#local-6989586621679604773"><span class="hs-identifier hs-var">protocolMagic</span></a></span><span>
</span><span id="line-438"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">k :: BlockCount
</span><a href="Cardano.Chain.Update.Validation.Interface.html#k"><span class="hs-identifier hs-var">UPI.k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679604774"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-439"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentSlot :: SlotNumber
</span><a href="Cardano.Chain.Update.Validation.Interface.html#currentSlot"><span class="hs-identifier hs-var">UPI.currentSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNumber
</span><a href="#local-6989586621679604772"><span class="hs-identifier hs-var">currentSlot</span></a></span><span>
</span><span id="line-440"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">numGenKeys :: Word8
</span><a href="Cardano.Chain.Update.Validation.Interface.html#numGenKeys"><span class="hs-identifier hs-var">UPI.numGenKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall n. Integral n =&gt; n -&gt; Word8
</span><a href="Cardano.Chain.Block.Validation.html#toNumGenKeys"><span class="hs-identifier hs-var">toNumGenKeys</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set KeyHash -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set KeyHash
</span><a href="#local-6989586621679604775"><span class="hs-identifier hs-var">allowedDelegators</span></a></span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">delegationMap :: Map
</span><a href="Cardano.Chain.Update.Validation.Interface.html#delegationMap"><span class="hs-identifier hs-var">UPI.delegationMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; Map
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#delegationMap"><span class="hs-identifier hs-var">DI.delegationMap</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604759"><span class="hs-identifier hs-var">delegationState</span></a></span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-443"></span><span>    </span><span id="local-6989586621679604771"><span class="annot"><span class="annottext">updateSignal :: Signal
</span><a href="#local-6989586621679604771"><span class="hs-identifier hs-var hs-var">updateSignal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (AProposal ByteString)
-&gt; [AVote ByteString] -&gt; Endorsement -&gt; Signal
</span><a href="Cardano.Chain.Update.Validation.Interface.html#Signal"><span class="hs-identifier hs-var">UPI.Signal</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (AProposal ByteString)
</span><a href="#local-6989586621679604798"><span class="hs-identifier hs-var">updateProposal</span></a></span><span> </span><span class="annot"><span class="annottext">[AVote ByteString]
</span><a href="#local-6989586621679604799"><span class="hs-identifier hs-var">updateVotes</span></a></span><span> </span><span class="annot"><span class="annottext">Endorsement
</span><a href="#local-6989586621679604800"><span class="hs-identifier hs-var">updateEndorsement</span></a></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>    </span><span id="local-6989586621679604798"><span class="annot"><span class="annottext">updateProposal :: Maybe (AProposal ByteString)
</span><a href="#local-6989586621679604798"><span class="hs-identifier hs-var hs-var">updateProposal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">APayload ByteString -&gt; Maybe (AProposal ByteString)
forall a. APayload a -&gt; Maybe (AProposal a)
</span><a href="Cardano.Chain.Update.Payload.html#payloadProposal"><span class="hs-identifier hs-var">Update.payloadProposal</span></a></span><span> </span><span class="annot"><span class="annottext">(APayload ByteString -&gt; Maybe (AProposal ByteString))
-&gt; APayload ByteString -&gt; Maybe (AProposal ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; APayload ByteString
forall a. ABlock a -&gt; APayload a
</span><a href="Cardano.Chain.Block.Block.html#blockUpdatePayload"><span class="hs-identifier hs-var">blockUpdatePayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621679604799"><span class="annot"><span class="annottext">updateVotes :: [AVote ByteString]
</span><a href="#local-6989586621679604799"><span class="hs-identifier hs-var hs-var">updateVotes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">APayload ByteString -&gt; [AVote ByteString]
forall a. APayload a -&gt; [AVote a]
</span><a href="Cardano.Chain.Update.Payload.html#payloadVotes"><span class="hs-identifier hs-var">Update.payloadVotes</span></a></span><span> </span><span class="annot"><span class="annottext">(APayload ByteString -&gt; [AVote ByteString])
-&gt; APayload ByteString -&gt; [AVote ByteString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; APayload ByteString
forall a. ABlock a -&gt; APayload a
</span><a href="Cardano.Chain.Block.Block.html#blockUpdatePayload"><span class="hs-identifier hs-var">blockUpdatePayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621679604800"><span class="annot"><span class="annottext">updateEndorsement :: Endorsement
</span><a href="#local-6989586621679604800"><span class="hs-identifier hs-var hs-var">updateEndorsement</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="annottext">ProtocolVersion -&gt; KeyHash -&gt; Endorsement
</span><a href="Cardano.Chain.Update.Validation.Endorsement.html#Endorsement"><span class="hs-identifier hs-var">Endorsement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString -&gt; ProtocolVersion
forall a. ABlock a -&gt; ProtocolVersion
</span><a href="Cardano.Chain.Block.Block.html#blockProtocolVersion"><span class="hs-identifier hs-var">blockProtocolVersion</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VerificationKey -&gt; KeyHash
</span><a href="Cardano.Chain.Common.KeyHash.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">(VerificationKey -&gt; KeyHash) -&gt; VerificationKey -&gt; KeyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; VerificationKey
forall a. ABlock a -&gt; VerificationKey
</span><a href="Cardano.Chain.Block.Block.html#blockIssuer"><span class="hs-identifier hs-var">blockIssuer</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604754"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>
</span><span id="line-450"></span><span id="local-6989586621679604016"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#toNumGenKeys"><span class="hs-identifier hs-type">toNumGenKeys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integral</span></span><span> </span><span class="annot"><a href="#local-6989586621679604016"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679604016"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span></span><span>
</span><span id="line-451"></span><span id="toNumGenKeys"><span class="annot"><span class="annottext">toNumGenKeys :: forall n. Integral n =&gt; n -&gt; Word8
</span><a href="Cardano.Chain.Block.Validation.html#toNumGenKeys"><span class="hs-identifier hs-var hs-var">toNumGenKeys</span></a></span></span><span> </span><span id="local-6989586621679604823"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679604823"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679604823"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">n -&gt; n -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Word8 -&gt; n
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word8</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Word8
forall a. HasCallStack =&gt; Text -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-prelude-0.2.1.0-a59cf9db2728e2b9c4e5b98de462f2c12b35f1d3360cd82a9f678672b897b0d2/share/doc/html/src/Cardano.Prelude.Panic.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;updateBody: Too many genesis keys&quot;</span></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n -&gt; Word8
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621679604823"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span class="hs-comment">-- | This is an implementation of the headerIsValid function from the Byron</span><span>
</span><span id="line-456"></span><span class="hs-comment">--   chain specification</span><span>
</span><span id="line-457"></span><span id="local-6989586621679604035"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#headerIsValid"><span class="hs-identifier hs-type">headerIsValid</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationError"><span class="hs-identifier hs-type">ChainValidationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679604035"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-type">ValidationMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679604035"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-459"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#State"><span class="hs-identifier hs-type">UPI.State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Header.html#AHeader"><span class="hs-identifier hs-type">AHeader</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-461"></span><span>  </span><span class="annot"><a href="#local-6989586621679604035"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-462"></span><span id="headerIsValid"><span class="annot"><span class="annottext">headerIsValid :: forall (m :: * -&gt; *).
(MonadError ChainValidationError m,
 MonadReader ValidationMode m) =&gt;
State -&gt; AHeader ByteString -&gt; m ()
</span><a href="Cardano.Chain.Block.Validation.html#headerIsValid"><span class="hs-identifier hs-var hs-var">headerIsValid</span></a></span></span><span> </span><span id="local-6989586621679604832"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604832"><span class="hs-identifier hs-var">updateState</span></a></span></span><span> </span><span id="local-6989586621679604833"><span class="annot"><span class="annottext">AHeader ByteString
</span><a href="#local-6989586621679604833"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-comment">-- Validate the header size</span><span>
</span><span id="line-464"></span><span>  </span><span class="annot"><span class="annottext">AHeader ByteString -&gt; Natural
</span><a href="Cardano.Chain.Block.Header.html#headerLength"><span class="hs-identifier hs-var">headerLength</span></a></span><span> </span><span class="annot"><span class="annottext">AHeader ByteString
</span><a href="#local-6989586621679604833"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679604834"><span class="hs-identifier hs-var">maxHeaderSize</span></a></span><span>
</span><span id="line-466"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ChainValidationError -&gt; m ()
forall e (m :: * -&gt; *).
(MonadError e m, MonadReader ValidationMode m) =&gt;
Bool -&gt; e -&gt; m ()
</span><a href="Cardano.Chain.ValidationMode.html#orThrowErrorInBlockValidationMode"><span class="hs-operator hs-var">`orThrowErrorInBlockValidationMode`</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationHeaderTooLarge"><span class="hs-identifier hs-var">ChainValidationHeaderTooLarge</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679604834"><span class="hs-identifier hs-var">maxHeaderSize</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AHeader ByteString -&gt; Natural
</span><a href="Cardano.Chain.Block.Header.html#headerLength"><span class="hs-identifier hs-var">headerLength</span></a></span><span> </span><span class="annot"><span class="annottext">AHeader ByteString
</span><a href="#local-6989586621679604833"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-468"></span><span>    </span><span id="local-6989586621679604834"><span class="annot"><span class="annottext">maxHeaderSize :: Natural
</span><a href="#local-6989586621679604834"><span class="hs-identifier hs-var hs-var">maxHeaderSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Natural
</span><a href="Cardano.Chain.Update.ProtocolParameters.html#ppMaxHeaderSize"><span class="hs-identifier hs-var">Update.ppMaxHeaderSize</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Natural) -&gt; ProtocolParameters -&gt; Natural
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State -&gt; ProtocolParameters
</span><a href="Cardano.Chain.Update.Validation.Interface.html#adoptedProtocolParameters"><span class="hs-identifier hs-var">UPI.adoptedProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604832"><span class="hs-identifier hs-var">updateState</span></a></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-keyword">data</span><span> </span><span id="EpochEnvironment"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#EpochEnvironment"><span class="hs-identifier hs-var">EpochEnvironment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="EpochEnvironment"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#EpochEnvironment"><span class="hs-identifier hs-var">EpochEnvironment</span></a></span></span><span>
</span><span id="line-471"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AprotocolMagic%3AEpochEnvironment"><span class="annot"><span class="annottext">EpochEnvironment -&gt; Annotated ProtocolMagicId ByteString
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolMagic%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">protocolMagic</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Annotated.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#ProtocolMagicId"><span class="hs-identifier hs-type">ProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3Ak%3AEpochEnvironment"><span class="annot"><span class="annottext">EpochEnvironment -&gt; BlockCount
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Ak%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Common.BlockCount.html#BlockCount"><span class="hs-identifier hs-type">BlockCount</span></a></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AallowedDelegators%3AEpochEnvironment"><span class="annot"><span class="annottext">EpochEnvironment -&gt; Set KeyHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AallowedDelegators%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">allowedDelegators</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Common.KeyHash.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-474"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AdelegationMap%3AEpochEnvironment"><span class="annot"><span class="annottext">EpochEnvironment -&gt; Map
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationMap%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">delegationMap</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Delegation.Map.html#Map"><span class="hs-identifier hs-type">Delegation.Map</span></a></span><span>
</span><span id="line-475"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AcurrentEpoch%3AEpochEnvironment"><span class="annot"><span class="annottext">EpochEnvironment -&gt; EpochNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcurrentEpoch%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">currentEpoch</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Chain.Slotting.EpochNumber.html#EpochNumber"><span class="hs-identifier hs-type">EpochNumber</span></a></span><span>
</span><span id="line-476"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span class="hs-comment">-- | Perform epoch transition if we have moved across the epoch boundary</span><span>
</span><span id="line-479"></span><span class="hs-comment">--</span><span>
</span><span id="line-480"></span><span class="hs-comment">--   We pass through to the update interface UPIEC rule, which adopts any</span><span>
</span><span id="line-481"></span><span class="hs-comment">--   confirmed proposals and cleans up the state. This corresponds to the EPOCH</span><span>
</span><span id="line-482"></span><span class="hs-comment">--   rules from the Byron chain specification.</span><span>
</span><span id="line-483"></span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#epochTransition"><span class="hs-identifier hs-type">epochTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-484"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#EpochEnvironment"><span class="hs-identifier hs-type">EpochEnvironment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-485"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#State"><span class="hs-identifier hs-type">UPI.State</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-486"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Slotting.SlotNumber.html#SlotNumber"><span class="hs-identifier hs-type">SlotNumber</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-487"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#State"><span class="hs-identifier hs-type">UPI.State</span></a></span><span>
</span><span id="line-488"></span><span id="epochTransition"><span class="annot"><span class="annottext">epochTransition :: EpochEnvironment -&gt; State -&gt; SlotNumber -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#epochTransition"><span class="hs-identifier hs-var hs-var">epochTransition</span></a></span></span><span> </span><span id="local-6989586621679604842"><span class="annot"><span class="annottext">EpochEnvironment
</span><a href="#local-6989586621679604842"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679604843"><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604843"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679604844"><span class="annot"><span class="annottext">SlotNumber
</span><a href="#local-6989586621679604844"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-489"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EpochNumber
</span><a href="#local-6989586621679604845"><span class="hs-identifier hs-var">nextEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNumber -&gt; EpochNumber -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">EpochNumber
</span><a href="#local-6989586621679604846"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Environment -&gt; State -&gt; EpochNumber -&gt; State
</span><a href="Cardano.Chain.Update.Validation.Interface.html#registerEpoch"><span class="hs-identifier hs-var">UPI.registerEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604848"><span class="hs-identifier hs-var">updateEnv</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604843"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNumber
</span><a href="#local-6989586621679604845"><span class="hs-identifier hs-var">nextEpoch</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604843"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-492"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-493"></span><span>    </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#EpochEnvironment"><span class="hs-identifier hs-type">EpochEnvironment</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679604849"><span class="annot"><span class="annottext">Annotated ProtocolMagicId ByteString
$sel:protocolMagic:EpochEnvironment :: EpochEnvironment -&gt; Annotated ProtocolMagicId ByteString
protocolMagic :: Annotated ProtocolMagicId ByteString
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolMagic%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">protocolMagic</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604850"><span class="annot"><span class="annottext">BlockCount
$sel:k:EpochEnvironment :: EpochEnvironment -&gt; BlockCount
k :: BlockCount
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Ak%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604851"><span class="annot"><span class="annottext">Set KeyHash
$sel:allowedDelegators:EpochEnvironment :: EpochEnvironment -&gt; Set KeyHash
allowedDelegators :: Set KeyHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AallowedDelegators%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">allowedDelegators</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604852"><span class="annot"><span class="annottext">Map
$sel:delegationMap:EpochEnvironment :: EpochEnvironment -&gt; Map
delegationMap :: Map
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationMap%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">delegationMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604846"><span class="annot"><span class="annottext">EpochNumber
$sel:currentEpoch:EpochEnvironment :: EpochEnvironment -&gt; EpochNumber
currentEpoch :: EpochNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcurrentEpoch%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">currentEpoch</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-494"></span><span>      </span><span class="annot"><span class="annottext">EpochEnvironment
</span><a href="#local-6989586621679604842"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span>    </span><span id="local-6989586621679604845"><span class="annot"><span class="annottext">nextEpoch :: EpochNumber
</span><a href="#local-6989586621679604845"><span class="hs-identifier hs-var hs-var">nextEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochSlots -&gt; SlotNumber -&gt; EpochNumber
</span><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#slotNumberEpoch"><span class="hs-identifier hs-var">slotNumberEpoch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlockCount -&gt; EpochSlots
</span><a href="Cardano.Chain.ProtocolConstants.html#kEpochSlots"><span class="hs-identifier hs-var">kEpochSlots</span></a></span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679604850"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SlotNumber
</span><a href="#local-6989586621679604844"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span>    </span><span id="local-6989586621679604848"><span class="annot"><span class="annottext">updateEnv :: Environment
</span><a href="#local-6989586621679604848"><span class="hs-identifier hs-var hs-var">updateEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><a href="Cardano.Chain.Update.Validation.Interface.html#Environment"><span class="hs-identifier hs-type">UPI.Environment</span></a></span><span>
</span><span id="line-500"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">protocolMagic :: Annotated ProtocolMagicId ByteString
</span><a href="Cardano.Chain.Update.Validation.Interface.html#protocolMagic"><span class="hs-identifier hs-var">UPI.protocolMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Annotated ProtocolMagicId ByteString
</span><a href="#local-6989586621679604849"><span class="hs-identifier hs-var">protocolMagic</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">k :: BlockCount
</span><a href="Cardano.Chain.Update.Validation.Interface.html#k"><span class="hs-identifier hs-var">UPI.k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BlockCount
</span><a href="#local-6989586621679604850"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-502"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">currentSlot :: SlotNumber
</span><a href="Cardano.Chain.Update.Validation.Interface.html#currentSlot"><span class="hs-identifier hs-var">UPI.currentSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNumber
</span><a href="#local-6989586621679604844"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">numGenKeys :: Word8
</span><a href="Cardano.Chain.Update.Validation.Interface.html#numGenKeys"><span class="hs-identifier hs-var">UPI.numGenKeys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Word8
forall n. Integral n =&gt; n -&gt; Word8
</span><a href="Cardano.Chain.Block.Validation.html#toNumGenKeys"><span class="hs-identifier hs-var">toNumGenKeys</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Word8) -&gt; Int -&gt; Word8
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set KeyHash -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set KeyHash
</span><a href="#local-6989586621679604851"><span class="hs-identifier hs-var">allowedDelegators</span></a></span><span>
</span><span id="line-504"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">delegationMap :: Map
</span><a href="Cardano.Chain.Update.Validation.Interface.html#delegationMap"><span class="hs-identifier hs-var">UPI.delegationMap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map
</span><a href="#local-6989586621679604852"><span class="hs-identifier hs-var">delegationMap</span></a></span><span>
</span><span id="line-505"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span class="hs-comment">-- | This represents the CHAIN rule. It is intended more for use in tests than</span><span>
</span><span id="line-508"></span><span class="hs-comment">--   in a real implementation, which will want to invoke its constituent rules</span><span>
</span><span id="line-509"></span><span class="hs-comment">--   directly.</span><span>
</span><span id="line-510"></span><span class="hs-comment">--</span><span>
</span><span id="line-511"></span><span class="hs-comment">--   Note that this also updates the previous block hash, which would usually be</span><span>
</span><span id="line-512"></span><span class="hs-comment">--   done as part of the PBFT rule.</span><span>
</span><span id="line-513"></span><span id="local-6989586621679603934"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#updateBlock"><span class="hs-identifier hs-type">updateBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-514"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationError"><span class="hs-identifier hs-type">ChainValidationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603934"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-type">ValidationMode</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679603934"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-515"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Genesis.Config.html#Config"><span class="hs-identifier hs-type">Genesis.Config</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-516"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-517"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlock"><span class="hs-identifier hs-type">ABlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-518"></span><span>  </span><span class="annot"><a href="#local-6989586621679603934"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ChainValidationState"><span class="hs-identifier hs-type">ChainValidationState</span></a></span></span><span>
</span><span id="line-519"></span><span id="updateBlock"><span class="annot"><span class="annottext">updateBlock :: forall (m :: * -&gt; *).
(MonadError ChainValidationError m,
 MonadReader ValidationMode m) =&gt;
Config
-&gt; ChainValidationState
-&gt; ABlock ByteString
-&gt; m ChainValidationState
</span><a href="Cardano.Chain.Block.Validation.html#updateBlock"><span class="hs-identifier hs-var hs-var">updateBlock</span></a></span></span><span> </span><span id="local-6989586621679604869"><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621679604870"><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604870"><span class="hs-identifier hs-var">cvs</span></a></span></span><span> </span><span id="local-6989586621679604871"><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-520"></span><span>  </span><span class="hs-comment">-- Compare the block's 'ProtocolMagic' to the configured value</span><span>
</span><span id="line-521"></span><span>  </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; ProtocolMagicId
forall a. ABlock a -&gt; ProtocolMagicId
</span><a href="Cardano.Chain.Block.Block.html#blockProtocolMagicId"><span class="hs-identifier hs-var">blockProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-522"></span><span>    </span><span class="annot"><span class="annottext">ProtocolMagicId -&gt; ProtocolMagicId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; ProtocolMagicId
</span><a href="Cardano.Chain.Genesis.Config.html#configProtocolMagicId"><span class="hs-identifier hs-var">configProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ChainValidationError -&gt; m ()
forall e (m :: * -&gt; *).
(MonadError e m, MonadReader ValidationMode m) =&gt;
Bool -&gt; e -&gt; m ()
</span><a href="Cardano.Chain.ValidationMode.html#orThrowErrorInBlockValidationMode"><span class="hs-operator hs-var">`orThrowErrorInBlockValidationMode`</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolMagicId -&gt; ProtocolMagicId -&gt; ChainValidationError
</span><a href="Cardano.Chain.Block.Validation.html#ChainValidationProtocolMagicMismatch"><span class="hs-identifier hs-var">ChainValidationProtocolMagicMismatch</span></a></span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString -&gt; ProtocolMagicId
forall a. ABlock a -&gt; ProtocolMagicId
</span><a href="Cardano.Chain.Block.Block.html#blockProtocolMagicId"><span class="hs-identifier hs-var">blockProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Config -&gt; ProtocolMagicId
</span><a href="Cardano.Chain.Genesis.Config.html#configProtocolMagicId"><span class="hs-identifier hs-var">configProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>  </span><span class="hs-comment">-- Process a potential epoch transition</span><span>
</span><span id="line-528"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679604872"><span class="annot"><span class="annottext">updateState' :: State
</span><a href="#local-6989586621679604872"><span class="hs-identifier hs-var hs-var">updateState'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochEnvironment -&gt; State -&gt; SlotNumber -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#epochTransition"><span class="hs-identifier hs-var">epochTransition</span></a></span><span> </span><span class="annot"><span class="annottext">EpochEnvironment
</span><a href="#local-6989586621679604873"><span class="hs-identifier hs-var">epochEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUpdateState%3AChainValidationState"><span class="hs-identifier hs-var">cvsUpdateState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604870"><span class="hs-identifier hs-var">cvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString -&gt; SlotNumber
forall a. ABlock a -&gt; SlotNumber
</span><a href="Cardano.Chain.Block.Block.html#blockSlot"><span class="hs-identifier hs-var">blockSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span>  </span><span class="hs-comment">-- Process header by checking its validity</span><span>
</span><span id="line-531"></span><span>  </span><span class="annot"><span class="annottext">State -&gt; AHeader ByteString -&gt; m ()
forall (m :: * -&gt; *).
(MonadError ChainValidationError m,
 MonadReader ValidationMode m) =&gt;
State -&gt; AHeader ByteString -&gt; m ()
</span><a href="Cardano.Chain.Block.Validation.html#headerIsValid"><span class="hs-identifier hs-var">headerIsValid</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604872"><span class="hs-identifier hs-var">updateState'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString -&gt; AHeader ByteString
forall a. ABlock a -&gt; AHeader a
</span><a href="Cardano.Chain.Block.Block.html#blockHeader"><span class="hs-identifier hs-var">blockHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679604874"><span class="annot"><span class="annottext">bodyEnv :: BodyEnvironment
</span><a href="#local-6989586621679604874"><span class="hs-identifier hs-var hs-var">bodyEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>        </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyEnvironment"><span class="hs-identifier hs-type">BodyEnvironment</span></a></span><span>
</span><span id="line-535"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:protocolMagic:BodyEnvironment :: AProtocolMagic ByteString
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolMagic%3ABodyEnvironment"><span class="hs-identifier hs-var">protocolMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-536"></span><span>              </span><span class="annot"><span class="annottext">Annotated ProtocolMagicId ByteString
-&gt; RequiresNetworkMagic -&gt; AProtocolMagic ByteString
forall a.
Annotated ProtocolMagicId a
-&gt; RequiresNetworkMagic -&gt; AProtocolMagic a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-crypto-wrapper-1.6.1.0/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#AProtocolMagic"><span class="hs-identifier hs-var">AProtocolMagic</span></a></span><span>
</span><span id="line-537"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString -&gt; Annotated ProtocolMagicId ByteString
forall a. ABlock a -&gt; Annotated ProtocolMagicId a
</span><a href="Cardano.Chain.Block.Block.html#blockAProtocolMagicId"><span class="hs-identifier hs-var">blockAProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Config -&gt; RequiresNetworkMagic
</span><a href="Cardano.Chain.Genesis.Config.html#configReqNetMagic"><span class="hs-identifier hs-var">configReqNetMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-539"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:k:BodyEnvironment :: BlockCount
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Ak%3ABodyEnvironment"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; BlockCount
</span><a href="Cardano.Chain.Genesis.Config.html#configK"><span class="hs-identifier hs-var">configK</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-540"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set KeyHash
$sel:allowedDelegators:BodyEnvironment :: Set KeyHash
allowedDelegators :: Set KeyHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AallowedDelegators%3ABodyEnvironment"><span class="hs-identifier hs-var hs-var">allowedDelegators</span></a></span><span>
</span><span id="line-541"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:protocolParameters:BodyEnvironment :: ProtocolParameters
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolParameters%3ABodyEnvironment"><span class="hs-identifier hs-var">protocolParameters</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; ProtocolParameters
</span><a href="Cardano.Chain.Update.Validation.Interface.html#adoptedProtocolParameters"><span class="hs-identifier hs-var">UPI.adoptedProtocolParameters</span></a></span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604872"><span class="hs-identifier hs-var">updateState'</span></a></span><span>
</span><span id="line-542"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:utxoConfiguration:BodyEnvironment :: UTxOConfiguration
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AutxoConfiguration%3ABodyEnvironment"><span class="hs-identifier hs-var">utxoConfiguration</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; UTxOConfiguration
</span><a href="Cardano.Chain.Genesis.Config.html#configUTxOConfiguration"><span class="hs-identifier hs-var">Genesis.configUTxOConfiguration</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-543"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:currentEpoch:BodyEnvironment :: EpochNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcurrentEpoch%3ABodyEnvironment"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochSlots -&gt; SlotNumber -&gt; EpochNumber
</span><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#slotNumberEpoch"><span class="hs-identifier hs-var">slotNumberEpoch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Config -&gt; EpochSlots
</span><a href="Cardano.Chain.Genesis.Config.html#configEpochSlots"><span class="hs-identifier hs-var">configEpochSlots</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ABlock ByteString -&gt; SlotNumber
forall a. ABlock a -&gt; SlotNumber
</span><a href="Cardano.Chain.Block.Block.html#blockSlot"><span class="hs-identifier hs-var">blockSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-544"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-545"></span><span>
</span><span id="line-546"></span><span>      </span><span id="local-6989586621679604879"><span class="annot"><span class="annottext">bs :: BodyState
</span><a href="#local-6989586621679604879"><span class="hs-identifier hs-var hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-547"></span><span>        </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-type">BodyState</span></a></span><span>
</span><span id="line-548"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:utxo:BodyState :: UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Autxo%3ABodyState"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainValidationState -&gt; UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUtxo%3AChainValidationState"><span class="hs-identifier hs-var">cvsUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604870"><span class="hs-identifier hs-var">cvs</span></a></span><span>
</span><span id="line-549"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:updateState:BodyState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AupdateState%3ABodyState"><span class="hs-identifier hs-var">updateState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State
</span><a href="#local-6989586621679604872"><span class="hs-identifier hs-var">updateState'</span></a></span><span>
</span><span id="line-550"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:delegationState:BodyState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationState%3ABodyState"><span class="hs-identifier hs-var">delegationState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainValidationState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsDelegationState%3AChainValidationState"><span class="hs-identifier hs-var">cvsDelegationState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604870"><span class="hs-identifier hs-var">cvs</span></a></span><span>
</span><span id="line-551"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#BodyState"><span class="hs-identifier hs-type">BodyState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679604880"><span class="annot"><span class="annottext">UTxO
$sel:utxo:BodyState :: BodyState -&gt; UTxO
utxo :: UTxO
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Autxo%3ABodyState"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604881"><span class="annot"><span class="annottext">State
$sel:updateState:BodyState :: BodyState -&gt; State
updateState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AupdateState%3ABodyState"><span class="hs-identifier hs-var hs-var">updateState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604882"><span class="annot"><span class="annottext">State
$sel:delegationState:BodyState :: BodyState -&gt; State
delegationState :: State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationState%3ABodyState"><span class="hs-identifier hs-var hs-var">delegationState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BodyEnvironment -&gt; BodyState -&gt; ABlock ByteString -&gt; m BodyState
forall (m :: * -&gt; *).
(MonadError ChainValidationError m,
 MonadReader ValidationMode m) =&gt;
BodyEnvironment -&gt; BodyState -&gt; ABlock ByteString -&gt; m BodyState
</span><a href="Cardano.Chain.Block.Validation.html#updateBody"><span class="hs-identifier hs-var">updateBody</span></a></span><span> </span><span class="annot"><span class="annottext">BodyEnvironment
</span><a href="#local-6989586621679604874"><span class="hs-identifier hs-var">bodyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">BodyState
</span><a href="#local-6989586621679604879"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>  </span><span class="annot"><span class="annottext">ChainValidationState -&gt; m ChainValidationState
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><span class="annottext">(ChainValidationState -&gt; m ChainValidationState)
-&gt; ChainValidationState -&gt; m ChainValidationState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604870"><span class="hs-identifier hs-var">cvs</span></a></span><span>
</span><span id="line-557"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsLastSlot%3AChainValidationState"><span class="hs-identifier hs-var">cvsLastSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockSlot"><span class="hs-identifier hs-type">blockSlot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679604871"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-558"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsPreviousHash%3AChainValidationState"><span class="hs-identifier hs-var">cvsPreviousHash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="hs-operator hs-type">$!</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#blockHashAnnotated"><span class="hs-identifier hs-type">blockHashAnnotated</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679604871"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-559"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUtxo%3AChainValidationState"><span class="hs-identifier hs-var">cvsUtxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679604880"><span class="hs-identifier hs-type">utxo</span></a></span><span>
</span><span id="line-560"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsUpdateState%3AChainValidationState"><span class="hs-identifier hs-var">cvsUpdateState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679604881"><span class="hs-identifier hs-type">updateState</span></a></span><span>
</span><span id="line-561"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsDelegationState%3AChainValidationState"><span class="hs-identifier hs-var">cvsDelegationState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679604882"><span class="hs-identifier hs-type">delegationState</span></a></span><span>
</span><span id="line-562"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-564"></span><span>    </span><span id="local-6989586621679604873"><span class="annot"><span class="annottext">epochEnv :: EpochEnvironment
</span><a href="#local-6989586621679604873"><span class="hs-identifier hs-var hs-var">epochEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-565"></span><span>      </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#EpochEnvironment"><span class="hs-identifier hs-type">EpochEnvironment</span></a></span><span>
</span><span id="line-566"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">$sel:protocolMagic:EpochEnvironment :: Annotated ProtocolMagicId ByteString
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AprotocolMagic%3AEpochEnvironment"><span class="hs-identifier hs-var">protocolMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; Annotated ProtocolMagicId ByteString
forall a. ABlock a -&gt; Annotated ProtocolMagicId a
</span><a href="Cardano.Chain.Block.Block.html#blockAProtocolMagicId"><span class="hs-identifier hs-var">blockAProtocolMagicId</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604871"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:k:EpochEnvironment :: BlockCount
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3Ak%3AEpochEnvironment"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Config -&gt; BlockCount
</span><a href="Cardano.Chain.Genesis.Config.html#configK"><span class="hs-identifier hs-var">configK</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set KeyHash
$sel:allowedDelegators:EpochEnvironment :: Set KeyHash
allowedDelegators :: Set KeyHash
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AallowedDelegators%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">allowedDelegators</span></a></span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map
$sel:delegationMap:EpochEnvironment :: Map
delegationMap :: Map
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AdelegationMap%3AEpochEnvironment"><span class="hs-identifier hs-var hs-var">delegationMap</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">$sel:currentEpoch:EpochEnvironment :: EpochNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcurrentEpoch%3AEpochEnvironment"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochSlots -&gt; SlotNumber -&gt; EpochNumber
</span><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#slotNumberEpoch"><span class="hs-identifier hs-var">slotNumberEpoch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Config -&gt; EpochSlots
</span><a href="Cardano.Chain.Genesis.Config.html#configEpochSlots"><span class="hs-identifier hs-var">configEpochSlots</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainValidationState -&gt; SlotNumber
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsLastSlot%3AChainValidationState"><span class="hs-identifier hs-var">cvsLastSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604870"><span class="hs-identifier hs-var">cvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>    </span><span class="annot"><a href="#local-6989586621679604877"><span class="hs-identifier hs-type">allowedDelegators</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Common.KeyHash.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span id="local-6989586621679604877"><span class="annot"><span class="annottext">allowedDelegators :: Set KeyHash
</span><a href="#local-6989586621679604877"><span class="hs-identifier hs-var hs-var">allowedDelegators</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenesisKeyHashes -&gt; Set KeyHash
</span><a href="Cardano.Chain.Genesis.KeyHashes.html#unGenesisKeyHashes"><span class="hs-identifier hs-var">unGenesisKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">(GenesisKeyHashes -&gt; Set KeyHash)
-&gt; GenesisKeyHashes -&gt; Set KeyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Config -&gt; GenesisKeyHashes
</span><a href="Cardano.Chain.Genesis.Config.html#configGenesisKeyHashes"><span class="hs-identifier hs-var">configGenesisKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Config
</span><a href="#local-6989586621679604869"><span class="hs-identifier hs-var">config</span></a></span><span>
</span><span id="line-575"></span><span>
</span><span id="line-576"></span><span>    </span><span id="local-6989586621679604883"><span class="annot"><span class="annottext">delegationMap :: Map
</span><a href="#local-6989586621679604883"><span class="hs-identifier hs-var hs-var">delegationMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State -&gt; Map
</span><a href="Cardano.Chain.Delegation.Validation.Interface.html#delegationMap"><span class="hs-identifier hs-var">DI.delegationMap</span></a></span><span> </span><span class="annot"><span class="annottext">(State -&gt; Map) -&gt; State -&gt; Map
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ChainValidationState -&gt; State
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AcvsDelegationState%3AChainValidationState"><span class="hs-identifier hs-var">cvsDelegationState</span></a></span><span> </span><span class="annot"><span class="annottext">ChainValidationState
</span><a href="#local-6989586621679604870"><span class="hs-identifier hs-var">cvs</span></a></span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-579"></span><span class="hs-comment">-- UTxO</span><span>
</span><span id="line-580"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-581"></span><span>
</span><span id="line-582"></span><span class="hs-keyword">data</span><span> </span><span id="Error"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#Error"><span class="hs-identifier hs-var">Error</span></a></span></span><span>
</span><span id="line-583"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ErrorParseError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ErrorParseError"><span class="hs-identifier hs-var">ErrorParseError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Epoch.File.html#ParseError"><span class="hs-identifier hs-type">ParseError</span></a></span><span>
</span><span id="line-584"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="ErrorUTxOValidationError"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#ErrorUTxOValidationError"><span class="hs-identifier hs-var">ErrorUTxOValidationError</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#EpochAndSlotCount"><span class="hs-identifier hs-type">EpochAndSlotCount</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.Validation.html#UTxOValidationError"><span class="hs-identifier hs-type">UTxO.UTxOValidationError</span></a></span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679604887"><span id="local-6989586621679604894"><span class="annot"><span class="annottext">Error -&gt; Error -&gt; Bool
(Error -&gt; Error -&gt; Bool) -&gt; (Error -&gt; Error -&gt; Bool) -&gt; Eq Error
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Error -&gt; Error -&gt; Bool
== :: Error -&gt; Error -&gt; Bool
$c/= :: Error -&gt; Error -&gt; Bool
/= :: Error -&gt; Error -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679604898"><span id="local-6989586621679604907"><span id="local-6989586621679604911"><span class="annot"><span class="annottext">Int -&gt; Error -&gt; ShowS
[Error] -&gt; ShowS
Error -&gt; String
(Int -&gt; Error -&gt; ShowS)
-&gt; (Error -&gt; String) -&gt; ([Error] -&gt; ShowS) -&gt; Show Error
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Error -&gt; ShowS
showsPrec :: Int -&gt; Error -&gt; ShowS
$cshow :: Error -&gt; String
show :: Error -&gt; String
$cshowList :: [Error] -&gt; ShowS
showList :: [Error] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span class="annot"><span class="hs-comment">-- | Fold transaction validation over a 'Stream' of 'Block's</span></span><span>
</span><span id="line-588"></span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#foldUTxO"><span class="hs-identifier hs-type">foldUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-589"></span><span>  </span><span class="annot"><a href="Cardano.Chain.UTxO.Validation.html#Environment"><span class="hs-identifier hs-type">UTxO.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-591"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/streaming-0.2.4.0-84d69b3e7511d7733f5f51af7f55aaafcbbbdd85ab9da1daa0cd90489d713cdf/share/doc/html/src/Streaming.Internal.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/streaming-0.2.4.0-84d69b3e7511d7733f5f51af7f55aaafcbbbdd85ab9da1daa0cd90489d713cdf/share/doc/html/src/Data.Functor.Of.html#Of"><span class="hs-identifier hs-type">Of</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlock"><span class="hs-identifier hs-type">ABlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Epoch.File.html#ParseError"><span class="hs-identifier hs-type">ParseError</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/resourcet-1.3.0-daaadf875bf5c7a54a4fddc6e9986d8365a90c01a64fc253eba10dff2e6b55df/share/doc/html/src/Control.Monad.Trans.Resource.Internal.html#ResIO"><span class="hs-identifier hs-type">ResIO</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-592"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-type">ValidationMode</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/resourcet-1.3.0-daaadf875bf5c7a54a4fddc6e9986d8365a90c01a64fc253eba10dff2e6b55df/share/doc/html/src/Control.Monad.Trans.Resource.Internal.html#ResIO"><span class="hs-identifier hs-type">ResIO</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span>
</span><span id="line-593"></span><span id="foldUTxO"><span class="annot"><span class="annottext">foldUTxO :: Environment
-&gt; UTxO
-&gt; Stream (Of (ABlock ByteString)) (ExceptT ParseError ResIO) ()
-&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
</span><a href="Cardano.Chain.Block.Validation.html#foldUTxO"><span class="hs-identifier hs-var hs-var">foldUTxO</span></a></span></span><span> </span><span id="local-6989586621679604913"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604913"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679604914"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604914"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679604915"><span class="annot"><span class="annottext">Stream (Of (ABlock ByteString)) (ExceptT ParseError ResIO) ()
</span><a href="#local-6989586621679604915"><span class="hs-identifier hs-var">blocks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-594"></span><span>  </span><span class="annot"><span class="annottext">(UTxO
 -&gt; ABlock ByteString
 -&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO)
-&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
-&gt; (UTxO -&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO)
-&gt; Stream
     (Of (ABlock ByteString))
     (ExceptT Error (ReaderT ValidationMode ResIO))
     (Stream (Of (ABlock ByteString)) (ExceptT Error ResIO) ())
-&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
forall (m :: * -&gt; *) x a b r.
Monad m =&gt;
(x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m b) -&gt; Stream (Of a) m r -&gt; m b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/streaming-0.2.4.0-84d69b3e7511d7733f5f51af7f55aaafcbbbdd85ab9da1daa0cd90489d713cdf/share/doc/html/src/Streaming.Prelude.html#foldM_"><span class="hs-identifier hs-var">S.foldM_</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment
-&gt; UTxO
-&gt; ABlock ByteString
-&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
</span><a href="Cardano.Chain.Block.Validation.html#foldUTxOBlock"><span class="hs-identifier hs-var">foldUTxOBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604913"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxO -&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
forall a. a -&gt; ExceptT Error (ReaderT ValidationMode ResIO) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604914"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>    </span><span class="annot"><span class="annottext">UTxO -&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
forall a. a -&gt; ExceptT Error (ReaderT ValidationMode ResIO) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-598"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stream (Of (ABlock ByteString)) (ExceptT Error ResIO) ()
-&gt; Stream
     (Of (ABlock ByteString))
     (ExceptT Error (ReaderT ValidationMode ResIO))
     (Stream (Of (ABlock ByteString)) (ExceptT Error ResIO) ())
forall a.
a
-&gt; Stream
     (Of (ABlock ByteString))
     (ExceptT Error (ReaderT ValidationMode ResIO))
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall a. ExceptT ParseError ResIO a -&gt; ExceptT Error ResIO a)
-&gt; Stream (Of (ABlock ByteString)) (ExceptT ParseError ResIO) ()
-&gt; Stream (Of (ABlock ByteString)) (ExceptT Error ResIO) ()
forall {k} (t :: (* -&gt; *) -&gt; k -&gt; *) (m :: * -&gt; *) (n :: * -&gt; *)
       (b :: k).
(MFunctor t, Monad m) =&gt;
(forall a. m a -&gt; n a) -&gt; t m b -&gt; t n b
forall (m :: * -&gt; *) (n :: * -&gt; *) b.
Monad m =&gt;
(forall a. m a -&gt; n a)
-&gt; Stream (Of (ABlock ByteString)) m b
-&gt; Stream (Of (ABlock ByteString)) n b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/mmorph-1.2.1-96fd6e9262ea266d9268eb2bdbe806a66faa8c494b996a36a1074c3057d5d5a6/share/doc/html/src/Control.Monad.Morph.html#hoist"><span class="hs-identifier hs-var">hoist</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ParseError -&gt; Error)
-&gt; ExceptT ParseError ResIO a -&gt; ExceptT Error ResIO a
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span> </span><span class="annot"><span class="annottext">ParseError -&gt; Error
</span><a href="Cardano.Chain.Block.Validation.html#ErrorParseError"><span class="hs-identifier hs-var">ErrorParseError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stream (Of (ABlock ByteString)) (ExceptT ParseError ResIO) ()
</span><a href="#local-6989586621679604915"><span class="hs-identifier hs-var">blocks</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="annot"><span class="hs-comment">-- | Fold 'updateUTxO' over the transactions in a single 'Block'</span></span><span>
</span><span id="line-601"></span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#foldUTxOBlock"><span class="hs-identifier hs-type">foldUTxOBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-602"></span><span>  </span><span class="annot"><a href="Cardano.Chain.UTxO.Validation.html#Environment"><span class="hs-identifier hs-type">UTxO.Environment</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-603"></span><span>  </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-604"></span><span>  </span><span class="annot"><a href="Cardano.Chain.Block.Block.html#ABlock"><span class="hs-identifier hs-type">ABlock</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-605"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ExceptT</span></span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="annot"><a href="Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-type">ValidationMode</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/resourcet-1.3.0-daaadf875bf5c7a54a4fddc6e9986d8365a90c01a64fc253eba10dff2e6b55df/share/doc/html/src/Control.Monad.Trans.Resource.Internal.html#ResIO"><span class="hs-identifier hs-type">ResIO</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span>
</span><span id="line-606"></span><span id="foldUTxOBlock"><span class="annot"><span class="annottext">foldUTxOBlock :: Environment
-&gt; UTxO
-&gt; ABlock ByteString
-&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
</span><a href="Cardano.Chain.Block.Validation.html#foldUTxOBlock"><span class="hs-identifier hs-var hs-var">foldUTxOBlock</span></a></span></span><span> </span><span id="local-6989586621679604919"><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604919"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679604920"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604920"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679604921"><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604921"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-607"></span><span>  </span><span class="annot"><span class="annottext">(UTxOValidationError -&gt; Error)
-&gt; ExceptT UTxOValidationError (ReaderT ValidationMode ResIO) UTxO
-&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
forall (m :: * -&gt; *) e e' a.
Functor m =&gt;
(e -&gt; e') -&gt; ExceptT e m a -&gt; ExceptT e' m a
</span><span class="hs-identifier hs-var">withExceptT</span></span><span>
</span><span id="line-608"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">EpochAndSlotCount -&gt; UTxOValidationError -&gt; Error
</span><a href="Cardano.Chain.Block.Validation.html#ErrorUTxOValidationError"><span class="hs-identifier hs-var">ErrorUTxOValidationError</span></a></span><span>
</span><span id="line-609"></span><span>        </span><span class="annot"><span class="annottext">(EpochAndSlotCount -&gt; UTxOValidationError -&gt; Error)
-&gt; (SlotNumber -&gt; EpochAndSlotCount)
-&gt; SlotNumber
-&gt; UTxOValidationError
-&gt; Error
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">EpochSlots -&gt; SlotNumber -&gt; EpochAndSlotCount
</span><a href="Cardano.Chain.Slotting.EpochAndSlotCount.html#fromSlotNumber"><span class="hs-identifier hs-var">fromSlotNumber</span></a></span><span> </span><span class="annot"><span class="annottext">EpochSlots
</span><a href="Cardano.Chain.Epoch.File.html#mainnetEpochSlots"><span class="hs-identifier hs-var">mainnetEpochSlots</span></a></span><span>
</span><span id="line-610"></span><span>        </span><span class="annot"><span class="annottext">(SlotNumber -&gt; UTxOValidationError -&gt; Error)
-&gt; SlotNumber -&gt; UTxOValidationError -&gt; Error
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; SlotNumber
forall a. ABlock a -&gt; SlotNumber
</span><a href="Cardano.Chain.Block.Block.html#blockSlot"><span class="hs-identifier hs-var">blockSlot</span></a></span><span>
</span><span id="line-611"></span><span>          </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604921"><span class="hs-identifier hs-var">block</span></a></span><span>
</span><span id="line-612"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-613"></span><span>    </span><span class="annot"><span class="annottext">(ExceptT UTxOValidationError (ReaderT ValidationMode ResIO) UTxO
 -&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO)
-&gt; ExceptT UTxOValidationError (ReaderT ValidationMode ResIO) UTxO
-&gt; ExceptT Error (ReaderT ValidationMode ResIO) UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Environment
-&gt; UTxO
-&gt; [ATxAux ByteString]
-&gt; ExceptT UTxOValidationError (ReaderT ValidationMode ResIO) UTxO
forall (m :: * -&gt; *).
(MonadError UTxOValidationError m, MonadReader ValidationMode m) =&gt;
Environment -&gt; UTxO -&gt; [ATxAux ByteString] -&gt; m UTxO
</span><a href="Cardano.Chain.UTxO.Validation.html#updateUTxO"><span class="hs-identifier hs-var">UTxO.updateUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">Environment
</span><a href="#local-6989586621679604919"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604920"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ATxPayload ByteString -&gt; [ATxAux ByteString]
forall a. ATxPayload a -&gt; [ATxAux a]
</span><a href="Cardano.Chain.UTxO.TxPayload.html#aUnTxPayload"><span class="hs-identifier hs-var">aUnTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">(ATxPayload ByteString -&gt; [ATxAux ByteString])
-&gt; ATxPayload ByteString -&gt; [ATxAux ByteString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString -&gt; ATxPayload ByteString
forall a. ABlock a -&gt; ATxPayload a
</span><a href="Cardano.Chain.Block.Block.html#blockTxPayload"><span class="hs-identifier hs-var">blockTxPayload</span></a></span><span> </span><span class="annot"><span class="annottext">ABlock ByteString
</span><a href="#local-6989586621679604921"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="annot"><span class="hs-comment">-- | Size of a heap value, in words</span></span><span>
</span><span id="line-616"></span><span class="hs-keyword">newtype</span><span> </span><span id="HeapSize"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#HeapSize"><span class="hs-identifier hs-var">HeapSize</span></a></span></span><span> </span><span id="local-6989586621679604061"><span class="annot"><a href="#local-6989586621679604061"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="HeapSize"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#HeapSize"><span class="hs-identifier hs-var">HeapSize</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AunHeapSize%3AHeapSize"><span class="annot"><span class="annottext">forall a. HeapSize a -&gt; Int
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AunHeapSize%3AHeapSize"><span class="hs-identifier hs-var hs-var">unHeapSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">}</span><span>
</span><span id="line-617"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679604925"><span id="local-6989586621679604930"><span id="local-6989586621679604934"><span class="annot"><span class="annottext">Int -&gt; HeapSize a -&gt; ShowS
[HeapSize a] -&gt; ShowS
HeapSize a -&gt; String
(Int -&gt; HeapSize a -&gt; ShowS)
-&gt; (HeapSize a -&gt; String)
-&gt; ([HeapSize a] -&gt; ShowS)
-&gt; Show (HeapSize a)
forall a. Int -&gt; HeapSize a -&gt; ShowS
forall a. [HeapSize a] -&gt; ShowS
forall a. HeapSize a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Int -&gt; HeapSize a -&gt; ShowS
showsPrec :: Int -&gt; HeapSize a -&gt; ShowS
$cshow :: forall a. HeapSize a -&gt; String
show :: HeapSize a -&gt; String
$cshowList :: forall a. [HeapSize a] -&gt; ShowS
showList :: [HeapSize a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679604937"><span class="annot"><span class="annottext">HeapSize a -&gt; Builder
(HeapSize a -&gt; Builder) -&gt; Buildable (HeapSize a)
forall a. HeapSize a -&gt; Builder
forall p. (p -&gt; Builder) -&gt; Buildable p
$cbuild :: forall a. HeapSize a -&gt; Builder
build :: HeapSize a -&gt; Builder
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/formatting-7.2.0-ab7254b0c777b7703f417bd470ae12dd12f6a2982bb6692fc1dd1a70d31b3958/share/doc/html/src/Formatting.Buildable.html#Buildable"><span class="hs-identifier hs-var hs-var hs-var hs-var">Buildable</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span class="annot"><span class="hs-comment">-- | Number of entries in the UTxO</span></span><span>
</span><span id="line-621"></span><span class="hs-keyword">newtype</span><span> </span><span id="UTxOSize"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#UTxOSize"><span class="hs-identifier hs-var">UTxOSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="UTxOSize"><span class="annot"><a href="Cardano.Chain.Block.Validation.html#UTxOSize"><span class="hs-identifier hs-var">UTxOSize</span></a></span></span><span> </span><span class="hs-special">{</span><span id="%24sel%3AunUTxOSize%3AUTxOSize"><span class="annot"><span class="annottext">UTxOSize -&gt; Int
</span><a href="Cardano.Chain.Block.Validation.html#%24sel%3AunUTxOSize%3AUTxOSize"><span class="hs-identifier hs-var hs-var">unUTxOSize</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">}</span><span>
</span><span id="line-622"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679604946"><span id="local-6989586621679604950"><span id="local-6989586621679604954"><span class="annot"><span class="annottext">Int -&gt; UTxOSize -&gt; ShowS
[UTxOSize] -&gt; ShowS
UTxOSize -&gt; String
(Int -&gt; UTxOSize -&gt; ShowS)
-&gt; (UTxOSize -&gt; String) -&gt; ([UTxOSize] -&gt; ShowS) -&gt; Show UTxOSize
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; UTxOSize -&gt; ShowS
showsPrec :: Int -&gt; UTxOSize -&gt; ShowS
$cshow :: UTxOSize -&gt; String
show :: UTxOSize -&gt; String
$cshowList :: [UTxOSize] -&gt; ShowS
showList :: [UTxOSize] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679604957"><span class="annot"><span class="annottext">UTxOSize -&gt; Builder
(UTxOSize -&gt; Builder) -&gt; Buildable UTxOSize
forall p. (p -&gt; Builder) -&gt; Buildable p
$cbuild :: UTxOSize -&gt; Builder
build :: UTxOSize -&gt; Builder
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/formatting-7.2.0-ab7254b0c777b7703f417bd470ae12dd12f6a2982bb6692fc1dd1a70d31b3958/share/doc/html/src/Formatting.Buildable.html#Buildable"><span class="hs-identifier hs-var hs-var hs-var hs-var">Buildable</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#calcUTxOSize"><span class="hs-identifier hs-type">calcUTxOSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#HeapSize"><span class="hs-identifier hs-type">HeapSize</span></a></span><span> </span><span class="annot"><a href="Cardano.Chain.UTxO.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Chain.Block.Validation.html#UTxOSize"><span class="hs-identifier hs-type">UTxOSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span id="calcUTxOSize"><span class="annot"><span class="annottext">calcUTxOSize :: UTxO -&gt; (HeapSize UTxO, UTxOSize)
</span><a href="Cardano.Chain.Block.Validation.html#calcUTxOSize"><span class="hs-identifier hs-var hs-var">calcUTxOSize</span></a></span></span><span> </span><span id="local-6989586621679604961"><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604961"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-627"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; HeapSize UTxO
forall a. Int -&gt; HeapSize a
</span><a href="Cardano.Chain.Block.Validation.html#HeapSize"><span class="hs-identifier hs-var">HeapSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; HeapSize UTxO)
-&gt; (Map CompactTxIn CompactTxOut -&gt; Int)
-&gt; Map CompactTxIn CompactTxOut
-&gt; HeapSize UTxO
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map CompactTxIn CompactTxOut -&gt; Int
forall a. HeapWords a =&gt; a -&gt; Int
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/heapwords-0.1.0.2-b6417b7556a8e92d841bb3a7d489e50a628754cd86fcb83441bde6481e83fe38/share/doc/html/src/Cardano.HeapWords.html#heapWords"><span class="hs-identifier hs-var">heapWords</span></a></span><span> </span><span class="annot"><span class="annottext">(Map CompactTxIn CompactTxOut -&gt; HeapSize UTxO)
-&gt; Map CompactTxIn CompactTxOut -&gt; HeapSize UTxO
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Map CompactTxIn CompactTxOut
</span><a href="Cardano.Chain.UTxO.UTxO.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604961"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-628"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; UTxOSize
</span><a href="Cardano.Chain.Block.Validation.html#UTxOSize"><span class="hs-identifier hs-var">UTxOSize</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; UTxOSize)
-&gt; (Map CompactTxIn CompactTxOut -&gt; Int)
-&gt; Map CompactTxIn CompactTxOut
-&gt; UTxOSize
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
forall {k} (cat :: k -&gt; k -&gt; *) (b :: k) (c :: k) (a :: k).
Category cat =&gt;
cat b c -&gt; cat a b -&gt; cat a c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map CompactTxIn CompactTxOut -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">M.size</span></span><span> </span><span class="annot"><span class="annottext">(Map CompactTxIn CompactTxOut -&gt; UTxOSize)
-&gt; Map CompactTxIn CompactTxOut -&gt; UTxOSize
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">UTxO -&gt; Map CompactTxIn CompactTxOut
</span><a href="Cardano.Chain.UTxO.UTxO.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="#local-6989586621679604961"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-629"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-630"></span></pre></body></html>