cabal-version:      3.0
name:               cardano-ledger-test
version:            1.1.0.0
license:            Apache-2.0
maintainer:         operations@iohk.io
author:             IOHK
synopsis:
    Testing harness, tests and benchmarks for Shelley style cardano ledgers

build-type:         Simple
extra-source-files: CHANGELOG.md

source-repository head
    type:     git
    location: https://github.com/input-output-hk/cardano-ledger
    subdir:   libs/cardano-ledger-test

library
    exposed-modules:
        Test.Cardano.Ledger.Alonzo.Tools
        Test.Cardano.Ledger.Constrained.Ast
        Test.Cardano.Ledger.Constrained.Classes
        Test.Cardano.Ledger.Constrained.Combinators
        Test.Cardano.Ledger.Constrained.Env
        Test.Cardano.Ledger.Constrained.Examples
        Test.Cardano.Ledger.Constrained.Lenses
        Test.Cardano.Ledger.Constrained.Monad
        Test.Cardano.Ledger.Constrained.Spec
        Test.Cardano.Ledger.Constrained.Tests
        Test.Cardano.Ledger.Constrained.TypeRep
        Test.Cardano.Ledger.Constrained.Vars
        Test.Cardano.Ledger.Constrained.Rewrite
        Test.Cardano.Ledger.Constrained.Size
        Test.Cardano.Ledger.Constrained.Solver
        Test.Cardano.Ledger.Examples.BabbageFeatures
        Test.Cardano.Ledger.Examples.AlonzoValidTxUTXOW
        Test.Cardano.Ledger.Examples.AlonzoInvalidTxUTXOW
        Test.Cardano.Ledger.Examples.AlonzoBBODY
        Test.Cardano.Ledger.Examples.AlonzoCollectInputs
        Test.Cardano.Ledger.Examples.AlonzoAPI
        Test.Cardano.Ledger.Examples.STSTestUtils
        Test.Cardano.Ledger.Generic.AggPropTests
        Test.Cardano.Ledger.Generic.ApplyTx
        Test.Cardano.Ledger.Generic.Indexed
        Test.Cardano.Ledger.Generic.Fields
        Test.Cardano.Ledger.Generic.Functions
        Test.Cardano.Ledger.Generic.GenState
        Test.Cardano.Ledger.Generic.TxGen
        Test.Cardano.Ledger.Generic.Proof
        Test.Cardano.Ledger.Generic.MockChain
        Test.Cardano.Ledger.Generic.ModelState
        Test.Cardano.Ledger.Generic.PrettyCore
        Test.Cardano.Ledger.Generic.Properties
        Test.Cardano.Ledger.Generic.Same
        Test.Cardano.Ledger.Generic.Scriptic
        Test.Cardano.Ledger.Generic.Trace
        Test.Cardano.Ledger.Generic.Updaters
        Test.Cardano.Ledger.NoThunks
        Test.Cardano.Ledger.Rational
        Test.Cardano.Ledger.TestableEra
        Test.Cardano.Ledger.ValueFromList
        Test.Cardano.Ledger.Tickf

    hs-source-dirs:   src
    default-language: Haskell2010
    ghc-options:
        -Wall -Wcompat -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wpartial-fields -Wredundant-constraints
        -Wunused-packages

    build-depends:
        array,
        base >=4.14 && <4.19,
        bytestring,
        cardano-data,
        cardano-crypto-class,
        cardano-ledger-allegra,
        cardano-ledger-alonzo:{cardano-ledger-alonzo, testlib},
        cardano-ledger-alonzo-test,
        cardano-ledger-api,
        cardano-ledger-babbage:{cardano-ledger-babbage, testlib},
        cardano-ledger-babbage-test,
        cardano-ledger-binary:{cardano-ledger-binary, testlib},
        cardano-ledger-conway:{cardano-ledger-conway, testlib},
        cardano-ledger-core:{cardano-ledger-core, testlib},
        cardano-ledger-pretty,
        cardano-ledger-mary,
        cardano-ledger-shelley:{cardano-ledger-shelley, testlib},
        cardano-ledger-shelley-test,
        cardano-ledger-shelley-ma-test,
        cardano-protocol-tpraos:{cardano-protocol-tpraos, testlib} >=1.0,
        cardano-slotting,
        containers,
        groups,
        vector-map,
        data-default-class,
        microlens,
        mtl,
        nothunks,
        plutus-core,
        hspec,
        plutus-ledger-api ^>=1.7,
        prettyprinter,
        QuickCheck,
        small-steps,
        small-steps-test,
        set-algebra,
        cardano-strict-containers,
        tasty,
        tasty-hunit,
        tasty-quickcheck,
        text,
        time,
        transformers,
        vector

test-suite cardano-ledger-test
    type:             exitcode-stdio-1.0
    main-is:          Tests.hs
    hs-source-dirs:   test
    default-language: Haskell2010
    ghc-options:
        -Wall -Wcompat -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wpartial-fields -Wredundant-constraints
        -Wunused-packages -rtsopts -threaded

    build-depends:
        base,
        cardano-ledger-test,
        tasty,
        data-default-class

benchmark bench
    type:             exitcode-stdio-1.0
    main-is:          Main.hs
    hs-source-dirs:   bench
    other-modules:
        Bench.Cardano.Ledger.ApplyTx
        Bench.Cardano.Ledger.ApplyTx.Gen
        Bench.Cardano.Ledger.EpochBoundary
        Bench.Cardano.Ledger.Serialisation.Generators
        Bench.Cardano.Ledger.SumStake
        Bench.Cardano.Ledger.TxOut
        Bench.Cardano.Ledger.StakeDistr

    default-language: Haskell2010
    ghc-options:
        -Wall -Wcompat -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wpartial-fields -Wredundant-constraints
        -Wunused-packages -threaded -rtsopts -O2

    build-depends:
        base,
        aeson,
        bytestring,
        cardano-crypto-class,
        cardano-ledger-allegra,
        cardano-ledger-alonzo,
        cardano-ledger-alonzo-test,
        cardano-ledger-binary,
        cardano-ledger-test,
        cardano-ledger-core,
        cardano-ledger-shelley-ma-test,
        cardano-ledger-mary:{cardano-ledger-mary, testlib},
        vector-map,
        containers,
        criterion,
        data-default-class,
        deepseq,
        QuickCheck,
        cardano-ledger-shelley:{cardano-ledger-shelley, testlib},
        cardano-ledger-shelley-test,
        cardano-slotting,
        microlens,
        mtl,
        random,
        small-steps,
        small-steps-test,
        cardano-strict-containers >=0.1.1,
        text

benchmark benchProperty
    type:             exitcode-stdio-1.0
    main-is:          Main.hs
    hs-source-dirs:   benchProperty
    default-language: Haskell2010
    ghc-options:
        -Wall -Wcompat -Wincomplete-record-updates
        -Wincomplete-uni-patterns -Wpartial-fields -Wredundant-constraints
        -Wunused-packages -threaded -rtsopts -O2

    build-depends:
        base,
        cardano-ledger-alonzo,
        cardano-ledger-alonzo-test,
        cardano-ledger-shelley-ma-test,
        small-steps,
        cardano-ledger-shelley,
        cardano-ledger-shelley-test,
        tasty
