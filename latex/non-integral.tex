In the ledger there are several cases where non-integral calculations are
required. This does concern the delegation transitions, not value transactions.

\subsection{Types of Non-Integral Calculations}
\label{sec:types-non-integral}

The specification employs non-integral calculations for different mathematical
operations. Table~\ref{tab:func-non-integral} shows the function and transition
rules that use non-integral calculations and which type.

\begin{table}[ht]
  \centering
  \begin{tabular}{lccccc}
    \toprule
    name & page & multiplication & division & exponential function & exponentiation \\
    \midrule
    \fun{refund}
         & \pageref{fig:functions:deposits-refunds} & \checkmark & & \checkmark & \\
    \fun{maxPool}
         & \pageref{fig:functions:rewards} & \checkmark & \checkmark & & \\
    \fun{movingAvg}
         & \pageref{fig:functions:rewards} & \checkmark & \checkmark && \\
    \fun{poolReward}
         & \pageref{fig:functions:rewards} & \checkmark & & \checkmark &
                                                                         \checkmark \\
    \fun{r_{leader}}
         & \pageref{fig:functions:reward-splitting} & \checkmark & \checkmark &&\\
    \fun{mReward}
         & \pageref{fig:functions:reward-splitting} & \checkmark & \checkmark
                                            &&\\
    \fun{rewardOnePool}
         & \pageref{fig:functions:reward-calc} & \checkmark & \checkmark && \\
    \fun{updateAvgs}
         & \pageref{fig:functions:epoch} & \checkmark & \checkmark &&\\
    \fun{ACCNT}
         &\pageref{fig:rules:accnt} & \checkmark &&& \\
    \bottomrule
  \end{tabular}
  \caption{Functions with Non-Integral Calculation}
  \label{tab:func-non-integral}
\end{table}

The transcendental exponential function is used in reward and refund calculation
to model the decay of the deposit values. The pool reward uses exponentiation to
calculate a pool's ranking.

The domain for the exponential function are the non-negative reals, more
precisely the distribution parameter $\lambda \in (0, \infty)$ multiplied by a
discrete non-negative duration $\delta$.

The domain of the base of the exponentiation in $\fun{poolReward}$ are the
non-negative reals resulting from the calculation in $\fun{movingAvg}$, the
exponent $\gamma$ is a constant take from the protocol parameters.

\subsection{Implementation of Non-Integer Calculations}
\label{sec:impl-non-integ}

The large part consists of multiplication and division which can easily be done
using fractional arithmetic to the desired precision. The precision necessary is
bounded by the ability to represent a single lovelace in all calculations.

\subsubsection{Function Simplification}
\label{sec:funct-simpl}

The transcendental function $e^{x}$ can be approximated using different
approaches, depending on the desired accuracy. In general, one uses the
exponential laws $e^{x} = 1/e^{-x}$ and
$e^{x} = \left(e^{\frac{x}{n}} \right)^{n}, n \in \mathbb{N}$ to reduce the
approximation to the unit interval and apply fast integral exponentiation
afterwards.

Exponentiation is implemented using the law
$a^{b} = e^{\ln(a^{b})}= e^{b\ln(a)}$. This therefore requires being able to
calculate $e^{x}$ and $\ln(x)$. The approximation of the natural logarithm can
be approximated using different approaches, again, depending on the desired
accuracy. Most approximations work for $\ln(x), x \in [1, c)$ with some $c >
0$. One then uses the law $\log_{b}(x) = \log_{b}(\frac{x}{b^{n}}b^{n})$ where
$n \in \mathbb{N}$ is chosen in such a way that $\frac{x}{b^{n}} \in [1,
c)$. Using this, one can separate the calculation of the integral and decimal
part as follows:

\begin{equation*}
  \log_{b}(\frac{x}{b^{n}}b^{n})=\log_{b}(b^{n}) + \log_{b}(\frac{x}{b^{n}})=
  n + \log(\frac{x}{b^{n}})
\end{equation*}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "ledger-spec"
%%% End:
