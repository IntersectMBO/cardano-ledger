<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE EmptyDataDeriving #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Shelley.Rules.PoolReap</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier">ShelleyPOOLREAP</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapEvent"><span class="hs-identifier">ShelleyPoolreapEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier">ShelleyPoolreapState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertStateL"><span class="hs-identifier">prCertStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prChainAccountStateL"><span class="hs-identifier">prChainAccountStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOStateL"><span class="hs-identifier">prUTxOStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier">PredicateFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html"><span class="hs-identifier">Cardano.Ledger.Address</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier">CompactForm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html"><span class="hs-identifier">Cardano.Ledger.Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier">fromCompact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier">Credential</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier">ShelleyEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier">ShelleyPOOLREAP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.html"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#UTxOState"><span class="hs-identifier">UTxOState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#allObligations"><span class="hs-identifier">allObligations</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosGovStateL"><span class="hs-identifier">utxosGovStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#potEqualsObligation"><span class="hs-identifier">potEqualsObligation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.html"><span class="hs-identifier">Cardano.Ledger.State</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C-%3E"><span class="hs-operator">(&lt;-&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.html"><span class="hs-identifier">Control.State.Transition</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Assertion"><span class="hs-identifier">Assertion</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#AssertionViolation"><span class="hs-identifier">AssertionViolation</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TransitionRule"><span class="hs-identifier">TransitionRule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#judgmentContext"><span class="hs-identifier">judgmentContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#tellEvent"><span class="hs-identifier">tellEvent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.html"><span class="hs-identifier">Data.Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier">Default</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fold</span></span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Merge.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Void</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html"><span class="hs-identifier">Lens.Micro</span></a></span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-keyword">data</span><span> </span><span id="ShelleyPoolreapState"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-var">ShelleyPoolreapState</span></a></span></span><span> </span><span id="local-6989586621679527860"><span class="annot"><a href="#local-6989586621679527860"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PoolreapState"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#PoolreapState"><span class="hs-identifier hs-var">PoolreapState</span></a></span></span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="prUTxOSt"><span class="annot"><span class="annottext">forall era. ShelleyPoolreapState era -&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOSt"><span class="hs-identifier hs-var hs-var">prUTxOSt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#UTxOState"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527860"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="prChainAccountState"><span class="annot"><span class="annottext">forall era. ShelleyPoolreapState era -&gt; ChainAccountState
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prChainAccountState"><span class="hs-identifier hs-var hs-var">prChainAccountState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.ChainAccount.html#ChainAccountState"><span class="hs-identifier hs-type">ChainAccountState</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="prCertState"><span class="annot"><span class="annottext">forall era. ShelleyPoolreapState era -&gt; CertState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertState"><span class="hs-identifier hs-var hs-var">prCertState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#CertState"><span class="hs-identifier hs-type">CertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527860"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span id="local-6989586621679528179"><span id="local-6989586621679528187"><span id="local-6989586621679528191"><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679527871"><span class="annot"><a href="#local-6989586621679527871"><span class="hs-keyword hs-type">stock</span></a></span></span><span> </span><span class="hs-keyword">instance</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#UTxOState"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527871"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#CertState"><span class="hs-identifier hs-type">CertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527871"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527871"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span id="local-6989586621679527873"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOStateL"><span class="hs-identifier hs-type">prUTxOStateL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527873"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#UTxOState"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527873"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-73"></span><span id="prUTxOStateL"><span class="annot"><span class="annottext">prUTxOStateL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(UTxOState era -&gt; f (UTxOState era))
-&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOStateL"><span class="hs-identifier hs-var hs-var">prUTxOStateL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ShelleyPoolreapState era -&gt; UTxOState era)
-&gt; (ShelleyPoolreapState era
    -&gt; UTxOState era -&gt; ShelleyPoolreapState era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (UTxOState era -&gt; f (UTxOState era))
   -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; UTxOState era
forall era. ShelleyPoolreapState era -&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOSt"><span class="hs-identifier hs-var">prUTxOSt</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyPoolreapState era
  -&gt; UTxOState era -&gt; ShelleyPoolreapState era)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (UTxOState era -&gt; f (UTxOState era))
    -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era))
-&gt; (ShelleyPoolreapState era
    -&gt; UTxOState era -&gt; ShelleyPoolreapState era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (UTxOState era -&gt; f (UTxOState era))
   -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679528197"><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528197"><span class="hs-identifier hs-var">sprs</span></a></span></span><span> </span><span id="local-6989586621679528198"><span class="annot"><span class="annottext">UTxOState era
</span><a href="#local-6989586621679528198"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528197"><span class="hs-identifier hs-var">sprs</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOSt"><span class="hs-identifier hs-var">prUTxOSt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679528198"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span id="local-6989586621679527885"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prChainAccountStateL"><span class="hs-identifier hs-type">prChainAccountStateL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527885"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.ChainAccount.html#ChainAccountState"><span class="hs-identifier hs-type">ChainAccountState</span></a></span></span><span>
</span><span id="line-76"></span><span id="prChainAccountStateL"><span class="annot"><span class="annottext">prChainAccountStateL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(ChainAccountState -&gt; f ChainAccountState)
-&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prChainAccountStateL"><span class="hs-identifier hs-var hs-var">prChainAccountStateL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ShelleyPoolreapState era -&gt; ChainAccountState)
-&gt; (ShelleyPoolreapState era
    -&gt; ChainAccountState -&gt; ShelleyPoolreapState era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (ChainAccountState -&gt; f ChainAccountState)
   -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; ChainAccountState
forall era. ShelleyPoolreapState era -&gt; ChainAccountState
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prChainAccountState"><span class="hs-identifier hs-var">prChainAccountState</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyPoolreapState era
  -&gt; ChainAccountState -&gt; ShelleyPoolreapState era)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (ChainAccountState -&gt; f ChainAccountState)
    -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era))
-&gt; (ShelleyPoolreapState era
    -&gt; ChainAccountState -&gt; ShelleyPoolreapState era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (ChainAccountState -&gt; f ChainAccountState)
   -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679528201"><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528201"><span class="hs-identifier hs-var">sprs</span></a></span></span><span> </span><span id="local-6989586621679528202"><span class="annot"><span class="annottext">ChainAccountState
</span><a href="#local-6989586621679528202"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528201"><span class="hs-identifier hs-var">sprs</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prChainAccountState"><span class="hs-identifier hs-var">prChainAccountState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679528202"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span id="local-6989586621679527889"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertStateL"><span class="hs-identifier hs-type">prCertStateL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527889"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#CertState"><span class="hs-identifier hs-type">CertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527889"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-79"></span><span id="prCertStateL"><span class="annot"><span class="annottext">prCertStateL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(CertState era -&gt; f (CertState era))
-&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertStateL"><span class="hs-identifier hs-var hs-var">prCertStateL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ShelleyPoolreapState era -&gt; CertState era)
-&gt; (ShelleyPoolreapState era
    -&gt; CertState era -&gt; ShelleyPoolreapState era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (CertState era -&gt; f (CertState era))
   -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; CertState era
forall era. ShelleyPoolreapState era -&gt; CertState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertState"><span class="hs-identifier hs-var">prCertState</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyPoolreapState era
  -&gt; CertState era -&gt; ShelleyPoolreapState era)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (CertState era -&gt; f (CertState era))
    -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era))
-&gt; (ShelleyPoolreapState era
    -&gt; CertState era -&gt; ShelleyPoolreapState era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (CertState era -&gt; f (CertState era))
   -&gt; ShelleyPoolreapState era -&gt; f (ShelleyPoolreapState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679528205"><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528205"><span class="hs-identifier hs-var">sprs</span></a></span></span><span> </span><span id="local-6989586621679528206"><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679528206"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528205"><span class="hs-identifier hs-var">sprs</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertState"><span class="hs-identifier hs-var">prCertState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679528206"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="ShelleyPoolreapEvent"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapEvent"><span class="hs-identifier hs-var">ShelleyPoolreapEvent</span></a></span></span><span> </span><span id="local-6989586621679527893"><span class="annot"><a href="#local-6989586621679527893"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RetiredPools"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#RetiredPools"><span class="hs-identifier hs-var">RetiredPools</span></a></span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="refundPools"><span class="annot"><span class="annottext">forall era.
ShelleyPoolreapEvent era
-&gt; Map
     (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#refundPools"><span class="hs-identifier hs-var hs-var">refundPools</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-83"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="unclaimedPools"><span class="annot"><span class="annottext">forall era.
ShelleyPoolreapEvent era
-&gt; Map
     (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#unclaimedPools"><span class="hs-identifier hs-var hs-var">unclaimedPools</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-85"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="epochNo"><span class="annot"><span class="annottext">forall era. ShelleyPoolreapEvent era -&gt; EpochNo
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#epochNo"><span class="hs-identifier hs-var hs-var">epochNo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679528212"><span id="local-6989586621679528214"><span class="annot"><span class="annottext">(forall x.
 ShelleyPoolreapEvent era -&gt; Rep (ShelleyPoolreapEvent era) x)
-&gt; (forall x.
    Rep (ShelleyPoolreapEvent era) x -&gt; ShelleyPoolreapEvent era)
-&gt; Generic (ShelleyPoolreapEvent era)
forall x.
Rep (ShelleyPoolreapEvent era) x -&gt; ShelleyPoolreapEvent era
forall x.
ShelleyPoolreapEvent era -&gt; Rep (ShelleyPoolreapEvent era) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall era x.
Rep (ShelleyPoolreapEvent era) x -&gt; ShelleyPoolreapEvent era
forall era x.
ShelleyPoolreapEvent era -&gt; Rep (ShelleyPoolreapEvent era) x
$cfrom :: forall era x.
ShelleyPoolreapEvent era -&gt; Rep (ShelleyPoolreapEvent era) x
from :: forall x.
ShelleyPoolreapEvent era -&gt; Rep (ShelleyPoolreapEvent era) x
$cto :: forall era x.
Rep (ShelleyPoolreapEvent era) x -&gt; ShelleyPoolreapEvent era
to :: forall x.
Rep (ShelleyPoolreapEvent era) x -&gt; ShelleyPoolreapEvent era
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621679527918"><span id="local-6989586621679528218"><span id="local-6989586621679528227"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapEvent"><span class="hs-identifier hs-type">ShelleyPoolreapEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527918"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679527939"><span id="local-6989586621679528237"><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapEvent"><span class="hs-identifier hs-type">ShelleyPoolreapEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527939"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679527943"><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-type">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#UTxOState"><span class="hs-identifier hs-type">UTxOState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527943"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-type">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#CertState"><span class="hs-identifier hs-type">CertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527943"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-type">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527943"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679528275"><span class="annot"><span class="annottext">def :: ShelleyPoolreapState era
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOState era
-&gt; ChainAccountState -&gt; CertState era -&gt; ShelleyPoolreapState era
forall era.
UTxOState era
-&gt; ChainAccountState -&gt; CertState era -&gt; ShelleyPoolreapState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#PoolreapState"><span class="hs-identifier hs-var">PoolreapState</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOState era
forall a. Default a =&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">ChainAccountState
forall a. Default a =&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">CertState era
forall a. Default a =&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="EraRuleEvent"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-var">EraRuleEvent</span></a></span></span><span> </span><span class="annot"><span class="hs-string">&quot;POOLREAP&quot;</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapEvent"><span class="hs-identifier hs-type">ShelleyPoolreapEvent</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-100"></span><span>  </span><span id="local-6989586621679527973"><span id="local-6989586621679528295"><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-type">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="State"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-var">State</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Signal"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-var">Signal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Environment"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-var">Environment</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="BaseM"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-var">BaseM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="PredicateFailure"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-var">PredicateFailure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Event"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-var">Event</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapEvent"><span class="hs-identifier hs-type">ShelleyPoolreapEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527973"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621679528321"><span class="annot"><span class="annottext">transitionRules :: [TransitionRule (ShelleyPOOLREAP era)]
</span><a href="#local-6989586621679528321"><span class="hs-identifier hs-var hs-var hs-var hs-var">transitionRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TransitionRule (ShelleyPOOLREAP era)
forall era.
EraCertState era =&gt;
TransitionRule (ShelleyPOOLREAP era)
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#poolReapTransition"><span class="hs-identifier hs-var">poolReapTransition</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>  </span><span id="local-6989586621679528328"><span class="annot"><span class="annottext">renderAssertionViolation :: AssertionViolation (ShelleyPOOLREAP era) -&gt; String
</span><a href="#local-6989586621679528328"><span class="hs-identifier hs-var hs-var hs-var hs-var">renderAssertionViolation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssertionViolation (ShelleyPOOLREAP era) -&gt; String
forall era t.
(EraGov era, State t ~ ShelleyPoolreapState era,
 EraCertState era) =&gt;
AssertionViolation t -&gt; String
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#renderPoolReapViolation"><span class="hs-identifier hs-var">renderPoolReapViolation</span></a></span><span>
</span><span id="line-116"></span><span>  </span><span id="local-6989586621679528343"><span class="annot"><span class="annottext">assertions :: [Assertion (ShelleyPOOLREAP era)]
</span><a href="#local-6989586621679528343"><span class="hs-identifier hs-var hs-var hs-var hs-var">assertions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (TRC (ShelleyPOOLREAP era)
    -&gt; State (ShelleyPOOLREAP era) -&gt; Bool)
-&gt; Assertion (ShelleyPOOLREAP era)
forall sts.
String -&gt; (TRC sts -&gt; State sts -&gt; Bool) -&gt; Assertion sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PostCondition"><span class="hs-identifier hs-var">PostCondition</span></a></span><span>
</span><span id="line-118"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Deposit pot must equal obligation (PoolReap)&quot;</span></span><span>
</span><span id="line-119"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679528346"><span class="annot"><span class="annottext">TRC (ShelleyPOOLREAP era)
</span><a href="#local-6989586621679528346"><span class="hs-identifier hs-var">_trc</span></a></span></span><span> </span><span id="local-6989586621679528347"><span class="annot"><span class="annottext">State (ShelleyPOOLREAP era)
</span><a href="#local-6989586621679528347"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><span class="annottext">CertState era -&gt; UTxOState era -&gt; Bool
forall era.
(EraGov era, EraCertState era) =&gt;
CertState era -&gt; UTxOState era -&gt; Bool
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#potEqualsObligation"><span class="hs-identifier hs-var">potEqualsObligation</span></a></span><span>
</span><span id="line-121"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; CertState era
forall era. ShelleyPoolreapState era -&gt; CertState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertState"><span class="hs-identifier hs-var">prCertState</span></a></span><span> </span><span class="annot"><span class="annottext">State (ShelleyPOOLREAP era)
ShelleyPoolreapState era
</span><a href="#local-6989586621679528347"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; UTxOState era
forall era. ShelleyPoolreapState era -&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOSt"><span class="hs-identifier hs-var">prUTxOSt</span></a></span><span> </span><span class="annot"><span class="annottext">State (ShelleyPOOLREAP era)
ShelleyPoolreapState era
</span><a href="#local-6989586621679528347"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (TRC (ShelleyPOOLREAP era)
    -&gt; State (ShelleyPOOLREAP era) -&gt; Bool)
-&gt; Assertion (ShelleyPOOLREAP era)
forall sts.
String -&gt; (TRC sts -&gt; State sts -&gt; Bool) -&gt; Assertion sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PostCondition"><span class="hs-identifier hs-var">PostCondition</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;PoolReap may not create or remove reward accounts&quot;</span></span><span>
</span><span id="line-126"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment (ShelleyPOOLREAP era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679528349"><span class="annot"><span class="annottext">State (ShelleyPOOLREAP era)
</span><a href="#local-6989586621679528349"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signal (ShelleyPOOLREAP era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679528350"><span class="annot"><span class="annottext">State (ShelleyPOOLREAP era)
</span><a href="#local-6989586621679528350"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679528517"><span class="annot"><span class="annottext">accountsCount :: ShelleyPoolreapState era -&gt; Int
</span><a href="#local-6989586621679528517"><span class="hs-identifier hs-var hs-var">accountsCount</span></a></span></span><span> </span><span id="local-6989586621679528518"><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528518"><span class="hs-identifier hs-var">prState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>                  </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (AccountState era) -&gt; Int
forall k a. Map k a -&gt; Int
</span><span class="hs-identifier hs-var">Map.size</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; CertState era
forall era. ShelleyPoolreapState era -&gt; CertState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertState"><span class="hs-identifier hs-var">prCertState</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era
</span><a href="#local-6989586621679528518"><span class="hs-identifier hs-var">prState</span></a></span><span> </span><span class="annot"><span class="annottext">CertState era
-&gt; Getting
     (Map (Credential 'Staking) (AccountState era))
     (CertState era)
     (Map (Credential 'Staking) (AccountState era))
-&gt; Map (Credential 'Staking) (AccountState era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(DState era
 -&gt; Const
      (Map (Credential 'Staking) (AccountState era)) (DState era))
-&gt; CertState era
-&gt; Const
     (Map (Credential 'Staking) (AccountState era)) (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (DState era)
Lens' (CertState era) (DState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certDStateL"><span class="hs-identifier hs-var">certDStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((DState era
  -&gt; Const
       (Map (Credential 'Staking) (AccountState era)) (DState era))
 -&gt; CertState era
 -&gt; Const
      (Map (Credential 'Staking) (AccountState era)) (CertState era))
-&gt; ((Map (Credential 'Staking) (AccountState era)
     -&gt; Const
          (Map (Credential 'Staking) (AccountState era))
          (Map (Credential 'Staking) (AccountState era)))
    -&gt; DState era
    -&gt; Const
         (Map (Credential 'Staking) (AccountState era)) (DState era))
-&gt; Getting
     (Map (Credential 'Staking) (AccountState era))
     (CertState era)
     (Map (Credential 'Staking) (AccountState era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Accounts era
 -&gt; Const
      (Map (Credential 'Staking) (AccountState era)) (Accounts era))
-&gt; DState era
-&gt; Const
     (Map (Credential 'Staking) (AccountState era)) (DState era)
forall era. Lens' (DState era) (Accounts era)
forall (t :: * -&gt; *) era.
CanSetAccounts t =&gt;
Lens' (t era) (Accounts era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsL"><span class="hs-identifier hs-var">accountsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Accounts era
  -&gt; Const
       (Map (Credential 'Staking) (AccountState era)) (Accounts era))
 -&gt; DState era
 -&gt; Const
      (Map (Credential 'Staking) (AccountState era)) (DState era))
-&gt; ((Map (Credential 'Staking) (AccountState era)
     -&gt; Const
          (Map (Credential 'Staking) (AccountState era))
          (Map (Credential 'Staking) (AccountState era)))
    -&gt; Accounts era
    -&gt; Const
         (Map (Credential 'Staking) (AccountState era)) (Accounts era))
-&gt; (Map (Credential 'Staking) (AccountState era)
    -&gt; Const
         (Map (Credential 'Staking) (AccountState era))
         (Map (Credential 'Staking) (AccountState era)))
-&gt; DState era
-&gt; Const
     (Map (Credential 'Staking) (AccountState era)) (DState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (Credential 'Staking) (AccountState era)
 -&gt; Const
      (Map (Credential 'Staking) (AccountState era))
      (Map (Credential 'Staking) (AccountState era)))
-&gt; Accounts era
-&gt; Const
     (Map (Credential 'Staking) (AccountState era)) (Accounts era)
forall era.
EraAccounts era =&gt;
Lens' (Accounts era) (Map (Credential 'Staking) (AccountState era))
Lens' (Accounts era) (Map (Credential 'Staking) (AccountState era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsMapL"><span class="hs-identifier hs-var">accountsMapL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>             </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; Int
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 EraCertState era) =&gt;
ShelleyPoolreapState era -&gt; Int
</span><a href="#local-6989586621679528517"><span class="hs-identifier hs-var">accountsCount</span></a></span><span> </span><span class="annot"><span class="annottext">State (ShelleyPOOLREAP era)
ShelleyPoolreapState era
</span><a href="#local-6989586621679528349"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; Int
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat MinVersion (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 EraCertState era) =&gt;
ShelleyPoolreapState era -&gt; Int
</span><a href="#local-6989586621679528517"><span class="hs-identifier hs-var">accountsCount</span></a></span><span> </span><span class="annot"><span class="annottext">State (ShelleyPOOLREAP era)
ShelleyPoolreapState era
</span><a href="#local-6989586621679528350"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-130"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#poolReapTransition"><span class="hs-identifier hs-type">poolReapTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679527974"><span class="annot"><a href="#local-6989586621679527974"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527974"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TransitionRule"><span class="hs-identifier hs-type">TransitionRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyPOOLREAP"><span class="hs-identifier hs-type">ShelleyPOOLREAP</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527974"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span id="poolReapTransition"><span class="annot"><span class="annottext">poolReapTransition :: forall era.
EraCertState era =&gt;
TransitionRule (ShelleyPOOLREAP era)
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#poolReapTransition"><span class="hs-identifier hs-var hs-var">poolReapTransition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment (ShelleyPOOLREAP era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#PoolreapState"><span class="hs-identifier hs-type">PoolreapState</span></a></span><span> </span><span id="local-6989586621679528594"><span class="annot"><span class="annottext">UTxOState era
</span><a href="#local-6989586621679528594"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span id="local-6989586621679528595"><span class="annot"><span class="annottext">ChainAccountState
</span><a href="#local-6989586621679528595"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621679528596"><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679528596"><span class="hs-identifier hs-var">cs0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679528597"><span class="annot"><span class="annottext">Signal (ShelleyPOOLREAP era)
</span><a href="#local-6989586621679528597"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Rule
  (ShelleyPOOLREAP era)
  'Transition
  (RuleContext 'Transition (ShelleyPOOLREAP era))
F (Clause (ShelleyPOOLREAP era) 'Transition)
  (TRC (ShelleyPOOLREAP era))
forall sts (rtype :: RuleType).
Rule sts rtype (RuleContext rtype sts)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#judgmentContext"><span class="hs-identifier hs-var">judgmentContext</span></a></span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-137"></span><span>    </span><span id="local-6989586621679528598"><span class="annot"><span class="annottext">ps0 :: PState era
</span><a href="#local-6989586621679528598"><span class="hs-identifier hs-var hs-var">ps0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679528596"><span class="hs-identifier hs-var">cs0</span></a></span><span> </span><span class="annot"><span class="annottext">CertState era
-&gt; Getting (PState era) (CertState era) (PState era) -&gt; PState era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (PState era) (CertState era) (PState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (PState era)
Lens' (CertState era) (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certPStateL"><span class="hs-identifier hs-var">certPStateL</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">-- find the set of VRF key hashes that are no longer relevant, since they have been overwritten</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-comment">-- via pool re-registration</span><span>
</span><span id="line-140"></span><span>    </span><span id="local-6989586621679528600"><span class="annot"><span class="annottext">danglingVRFKeyHashes :: Set (VRFVerKeyHash 'StakePoolVRF)
</span><a href="#local-6989586621679528600"><span class="hs-identifier hs-var hs-var">danglingVRFKeyHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><span class="annottext">[VRFVerKeyHash 'StakePoolVRF] -&gt; Set (VRFVerKeyHash 'StakePoolVRF)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([VRFVerKeyHash 'StakePoolVRF]
 -&gt; Set (VRFVerKeyHash 'StakePoolVRF))
-&gt; [VRFVerKeyHash 'StakePoolVRF]
-&gt; Set (VRFVerKeyHash 'StakePoolVRF)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-142"></span><span>        </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) (VRFVerKeyHash 'StakePoolVRF)
-&gt; [VRFVerKeyHash 'StakePoolVRF]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool) (VRFVerKeyHash 'StakePoolVRF)
 -&gt; [VRFVerKeyHash 'StakePoolVRF])
-&gt; Map (KeyHash 'StakePool) (VRFVerKeyHash 'StakePoolVRF)
-&gt; [VRFVerKeyHash 'StakePoolVRF]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><span class="annottext">SimpleWhenMissing
  (KeyHash 'StakePool) StakePoolState (VRFVerKeyHash 'StakePoolVRF)
-&gt; SimpleWhenMissing
     (KeyHash 'StakePool) StakePoolState (VRFVerKeyHash 'StakePoolVRF)
-&gt; SimpleWhenMatched
     (KeyHash 'StakePool)
     StakePoolState
     StakePoolState
     (VRFVerKeyHash 'StakePoolVRF)
-&gt; Map (KeyHash 'StakePool) StakePoolState
-&gt; Map (KeyHash 'StakePool) StakePoolState
-&gt; Map (KeyHash 'StakePool) (VRFVerKeyHash 'StakePoolVRF)
forall k a c b.
Ord k =&gt;
SimpleWhenMissing k a c
-&gt; SimpleWhenMissing k b c
-&gt; SimpleWhenMatched k a b c
-&gt; Map k a
-&gt; Map k b
-&gt; Map k c
</span><span class="hs-identifier hs-var">Map.merge</span></span><span>
</span><span id="line-144"></span><span>            </span><span class="annot"><span class="annottext">SimpleWhenMissing
  (KeyHash 'StakePool) StakePoolState (VRFVerKeyHash 'StakePoolVRF)
forall (f :: * -&gt; *) k x y. Applicative f =&gt; WhenMissing f k x y
</span><span class="hs-identifier hs-var">Map.dropMissing</span></span><span>
</span><span id="line-145"></span><span>            </span><span class="annot"><span class="annottext">SimpleWhenMissing
  (KeyHash 'StakePool) StakePoolState (VRFVerKeyHash 'StakePoolVRF)
forall (f :: * -&gt; *) k x y. Applicative f =&gt; WhenMissing f k x y
</span><span class="hs-identifier hs-var">Map.dropMissing</span></span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool
 -&gt; StakePoolState
 -&gt; StakePoolState
 -&gt; Maybe (VRFVerKeyHash 'StakePoolVRF))
-&gt; SimpleWhenMatched
     (KeyHash 'StakePool)
     StakePoolState
     StakePoolState
     (VRFVerKeyHash 'StakePoolVRF)
forall (f :: * -&gt; *) k x y z.
Applicative f =&gt;
(k -&gt; x -&gt; y -&gt; Maybe z) -&gt; WhenMatched f k x y z
</span><span class="hs-identifier hs-var">Map.zipWithMaybeMatched</span></span><span> </span><span class="annot"><span class="annottext">((KeyHash 'StakePool
  -&gt; StakePoolState
  -&gt; StakePoolState
  -&gt; Maybe (VRFVerKeyHash 'StakePoolVRF))
 -&gt; SimpleWhenMatched
      (KeyHash 'StakePool)
      StakePoolState
      StakePoolState
      (VRFVerKeyHash 'StakePoolVRF))
-&gt; (KeyHash 'StakePool
    -&gt; StakePoolState
    -&gt; StakePoolState
    -&gt; Maybe (VRFVerKeyHash 'StakePoolVRF))
-&gt; SimpleWhenMatched
     (KeyHash 'StakePool)
     StakePoolState
     StakePoolState
     (VRFVerKeyHash 'StakePoolVRF)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679528606"><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528606"><span class="hs-identifier hs-var">sps</span></a></span></span><span> </span><span id="local-6989586621679528607"><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528607"><span class="hs-identifier hs-var">spsF</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528606"><span class="hs-identifier hs-var">sps</span></a></span><span> </span><span class="annot"><span class="annottext">StakePoolState
-&gt; Getting
     (VRFVerKeyHash 'StakePoolVRF)
     StakePoolState
     (VRFVerKeyHash 'StakePoolVRF)
-&gt; VRFVerKeyHash 'StakePoolVRF
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (VRFVerKeyHash 'StakePoolVRF)
  StakePoolState
  (VRFVerKeyHash 'StakePoolVRF)
Lens' StakePoolState (VRFVerKeyHash 'StakePoolVRF)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsVrfL"><span class="hs-identifier hs-var">spsVrfL</span></a></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF -&gt; VRFVerKeyHash 'StakePoolVRF -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528607"><span class="hs-identifier hs-var">spsF</span></a></span><span> </span><span class="annot"><span class="annottext">StakePoolState
-&gt; Getting
     (VRFVerKeyHash 'StakePoolVRF)
     StakePoolState
     (VRFVerKeyHash 'StakePoolVRF)
-&gt; VRFVerKeyHash 'StakePoolVRF
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (VRFVerKeyHash 'StakePoolVRF)
  StakePoolState
  (VRFVerKeyHash 'StakePoolVRF)
Lens' StakePoolState (VRFVerKeyHash 'StakePoolVRF)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsVrfL"><span class="hs-identifier hs-var">spsVrfL</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF -&gt; Maybe (VRFVerKeyHash 'StakePoolVRF)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528606"><span class="hs-identifier hs-var">sps</span></a></span><span> </span><span class="annot"><span class="annottext">StakePoolState
-&gt; Getting
     (VRFVerKeyHash 'StakePoolVRF)
     StakePoolState
     (VRFVerKeyHash 'StakePoolVRF)
-&gt; VRFVerKeyHash 'StakePoolVRF
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (VRFVerKeyHash 'StakePoolVRF)
  StakePoolState
  (VRFVerKeyHash 'StakePoolVRF)
Lens' StakePoolState (VRFVerKeyHash 'StakePoolVRF)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsVrfL"><span class="hs-identifier hs-var">spsVrfL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (VRFVerKeyHash 'StakePoolVRF)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState era
</span><a href="#local-6989586621679528598"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">PState era
-&gt; Getting
     (Map (KeyHash 'StakePool) StakePoolState)
     (PState era)
     (Map (KeyHash 'StakePool) StakePoolState)
-&gt; Map (KeyHash 'StakePool) StakePoolState
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map (KeyHash 'StakePool) StakePoolState)
  (PState era)
  (Map (KeyHash 'StakePool) StakePoolState)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (KeyHash 'StakePool) StakePoolState
 -&gt; f (Map (KeyHash 'StakePool) StakePoolState))
-&gt; PState era -&gt; f (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psStakePoolsL"><span class="hs-identifier hs-var">psStakePoolsL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState era
</span><a href="#local-6989586621679528598"><span class="hs-identifier hs-var">ps0</span></a></span><span> </span><span class="annot"><span class="annottext">PState era
-&gt; Getting
     (Map (KeyHash 'StakePool) StakePoolState)
     (PState era)
     (Map (KeyHash 'StakePool) StakePoolState)
-&gt; Map (KeyHash 'StakePool) StakePoolState
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map (KeyHash 'StakePool) StakePoolState)
  (PState era)
  (Map (KeyHash 'StakePool) StakePoolState)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (KeyHash 'StakePool) StakePoolState
 -&gt; f (Map (KeyHash 'StakePool) StakePoolState))
-&gt; PState era -&gt; f (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psFutureStakePoolsL"><span class="hs-identifier hs-var">psFutureStakePoolsL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-comment">-- activate future stakePools</span><span>
</span><span id="line-153"></span><span>    </span><span id="local-6989586621679528612"><span class="annot"><span class="annottext">ps :: PState era
</span><a href="#local-6989586621679528612"><span class="hs-identifier hs-var hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>      </span><span class="annot"><span class="annottext">PState era
</span><a href="#local-6989586621679528598"><span class="hs-identifier hs-var">ps0</span></a></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psStakePools"><span class="hs-identifier hs-var">psStakePools</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679528598"><span class="hs-identifier hs-type">ps0</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psFutureStakePoolsL"><span class="hs-identifier hs-type">psFutureStakePoolsL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679528598"><span class="hs-identifier hs-type">ps0</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-type">^.</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psStakePoolsL"><span class="hs-identifier hs-type">psStakePoolsL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psFutureStakePools"><span class="hs-identifier hs-var">psFutureStakePools</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.empty</span></span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679528617"><span class="annot"><span class="annottext">cs :: CertState era
</span><a href="#local-6989586621679528617"><span class="hs-identifier hs-var hs-var">cs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679528596"><span class="hs-identifier hs-var">cs0</span></a></span><span> </span><span class="annot"><span class="annottext">CertState era -&gt; (CertState era -&gt; CertState era) -&gt; CertState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PState era -&gt; Identity (PState era))
-&gt; CertState era -&gt; Identity (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (PState era)
Lens' (CertState era) (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certPStateL"><span class="hs-identifier hs-var">certPStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PState era -&gt; Identity (PState era))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; PState era -&gt; CertState era -&gt; CertState era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">PState era
</span><a href="#local-6989586621679528612"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679528620"><span class="annot"><span class="annottext">ds :: DState era
</span><a href="#local-6989586621679528620"><span class="hs-identifier hs-var hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679528617"><span class="hs-identifier hs-var">cs</span></a></span><span> </span><span class="annot"><span class="annottext">CertState era
-&gt; Getting (DState era) (CertState era) (DState era) -&gt; DState era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (DState era) (CertState era) (DState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (DState era)
Lens' (CertState era) (DState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certDStateL"><span class="hs-identifier hs-var">certDStateL</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-comment">-- The set of pools retiring this epoch</span><span>
</span><span id="line-162"></span><span>    </span><span class="annot"><a href="#local-6989586621679528621"><span class="hs-identifier hs-type">retired</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>    </span><span id="local-6989586621679528621"><span class="annot"><span class="annottext">retired :: Set (KeyHash 'StakePool)
</span><a href="#local-6989586621679528621"><span class="hs-identifier hs-var hs-var">retired</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[KeyHash 'StakePool] -&gt; Set (KeyHash 'StakePool)
forall a. [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromDistinctAscList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679528623"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679528623"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679528623"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679528624"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679528624"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) EpochNo -&gt; [(KeyHash 'StakePool, EpochNo)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toAscList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState era -&gt; Map (KeyHash 'StakePool) EpochNo
forall era. PState era -&gt; Map (KeyHash 'StakePool) EpochNo
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psRetiring"><span class="hs-identifier hs-var">psRetiring</span></a></span><span> </span><span class="annot"><span class="annottext">PState era
</span><a href="#local-6989586621679528612"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679528624"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
Signal (ShelleyPOOLREAP era)
</span><a href="#local-6989586621679528597"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-comment">-- The Map of pools retiring this epoch</span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><a href="#local-6989586621679528627"><span class="hs-identifier hs-type">retiringPools</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#StakePoolState"><span class="hs-identifier hs-type">StakePoolState</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621679528627"><span class="annot"><span class="annottext">retiringPools :: Map (KeyHash 'StakePool) StakePoolState
</span><a href="#local-6989586621679528627"><span class="hs-identifier hs-var hs-var">retiringPools</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState
-&gt; Set (KeyHash 'StakePool)
-&gt; Map (KeyHash 'StakePool) StakePoolState
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.restrictKeys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState era -&gt; Map (KeyHash 'StakePool) StakePoolState
forall era. PState era -&gt; Map (KeyHash 'StakePool) StakePoolState
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psStakePools"><span class="hs-identifier hs-var">psStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">PState era
</span><a href="#local-6989586621679528612"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'StakePool)
</span><a href="#local-6989586621679528621"><span class="hs-identifier hs-var">retired</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-comment">-- collect all accounts for stake pools that will retire</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679528631"><span class="annot"><span class="annottext">retiredVRFKeyHashes :: [VRFVerKeyHash 'StakePoolVRF]
</span><a href="#local-6989586621679528631"><span class="hs-identifier hs-var hs-var">retiredVRFKeyHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StakePoolState -&gt; VRFVerKeyHash 'StakePoolVRF
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsVrf"><span class="hs-identifier hs-var">spsVrf</span></a></span><span> </span><span class="annot"><span class="annottext">(StakePoolState -&gt; VRFVerKeyHash 'StakePoolVRF)
-&gt; [StakePoolState] -&gt; [VRFVerKeyHash 'StakePoolVRF]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState -&gt; [StakePoolState]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState
</span><a href="#local-6989586621679528627"><span class="hs-identifier hs-var">retiringPools</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-comment">-- collect all of the potential refunds</span><span>
</span><span id="line-171"></span><span>    </span><span class="annot"><a href="#local-6989586621679528634"><span class="hs-identifier hs-type">accountRefunds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>    </span><span id="local-6989586621679528634"><span class="annot"><span class="annottext">accountRefunds :: Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679528634"><span class="hs-identifier hs-var hs-var">accountRefunds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-173"></span><span>      </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin)
-&gt; [(Credential 'Staking, CompactForm Coin)]
-&gt; Map (Credential 'Staking) (CompactForm Coin)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span>
</span><span id="line-175"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">RewardAccount -&gt; Credential 'Staking
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#raCredential"><span class="hs-identifier hs-var">raCredential</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; Credential 'Staking)
-&gt; RewardAccount -&gt; Credential 'Staking
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StakePoolState -&gt; RewardAccount
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsRewardAccount"><span class="hs-identifier hs-var">spsRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528638"><span class="hs-identifier hs-var">sps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StakePoolState -&gt; CompactForm Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsDeposit"><span class="hs-identifier hs-var">spsDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528638"><span class="hs-identifier hs-var">sps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679528638"><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528638"><span class="hs-identifier hs-var">sps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState -&gt; [StakePoolState]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState
</span><a href="#local-6989586621679528627"><span class="hs-identifier hs-var">retiringPools</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621679528640"><span class="annot"><span class="annottext">accounts :: Accounts era
</span><a href="#local-6989586621679528640"><span class="hs-identifier hs-var hs-var">accounts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DState era
</span><a href="#local-6989586621679528620"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">DState era
-&gt; Getting (Accounts era) (DState era) (Accounts era)
-&gt; Accounts era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Accounts era) (DState era) (Accounts era)
forall era. Lens' (DState era) (Accounts era)
forall (t :: * -&gt; *) era.
CanSetAccounts t =&gt;
Lens' (t era) (Accounts era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsL"><span class="hs-identifier hs-var">accountsL</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-comment">-- Deposits that can be refunded and those that are unclaimed (to be deposited into the treasury).</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="#local-6989586621679528641"><span class="hs-identifier hs-type">refunds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679528642"><span class="hs-identifier hs-type">unclaimedDeposits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679528641"><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679528641"><span class="hs-identifier hs-var">refunds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679528642"><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679528642"><span class="hs-identifier hs-var">unclaimedDeposits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-180"></span><span>      </span><span class="annot"><span class="annottext">(Credential 'Staking -&gt; CompactForm Coin -&gt; Bool)
-&gt; Map (Credential 'Staking) (CompactForm Coin)
-&gt; (Map (Credential 'Staking) (CompactForm Coin),
    Map (Credential 'Staking) (CompactForm Coin))
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; (Map k a, Map k a)
</span><span class="hs-identifier hs-var">Map.partitionWithKey</span></span><span>
</span><span id="line-181"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679528644"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679528644"><span class="hs-identifier hs-var">stakeCred</span></a></span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; Accounts era -&gt; Bool
forall era.
EraAccounts era =&gt;
Credential 'Staking -&gt; Accounts era -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#isAccountRegistered"><span class="hs-identifier hs-var">isAccountRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679528644"><span class="hs-identifier hs-var">stakeCred</span></a></span><span> </span><span class="annot"><span class="annottext">Accounts era
</span><a href="#local-6989586621679528640"><span class="hs-identifier hs-var">accounts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (k &#8712; dom (rewards ds))</span><span>
</span><span id="line-182"></span><span>        </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679528634"><span class="hs-identifier hs-var">accountRefunds</span></a></span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621679528650"><span class="annot"><span class="annottext">refunded :: CompactForm Coin
</span><a href="#local-6989586621679528650"><span class="hs-identifier hs-var hs-var">refunded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin) -&gt; CompactForm Coin
forall m. Monoid m =&gt; Map (Credential 'Staking) m -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679528641"><span class="hs-identifier hs-var">refunds</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span id="local-6989586621679528653"><span class="annot"><span class="annottext">unclaimed :: CompactForm Coin
</span><a href="#local-6989586621679528653"><span class="hs-identifier hs-var hs-var">unclaimed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin) -&gt; CompactForm Coin
forall m. Monoid m =&gt; Map (Credential 'Staking) m -&gt; m
forall (t :: * -&gt; *) m. (Foldable t, Monoid m) =&gt; t m -&gt; m
</span><span class="hs-identifier hs-var">fold</span></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679528642"><span class="hs-identifier hs-var">unclaimedDeposits</span></a></span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><span class="annottext">Event (ShelleyPOOLREAP era)
-&gt; Rule (ShelleyPOOLREAP era) 'Transition ()
forall sts (ctx :: RuleType). Event sts -&gt; Rule sts ctx ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#tellEvent"><span class="hs-identifier hs-var">tellEvent</span></a></span><span> </span><span class="annot"><span class="annottext">(Event (ShelleyPOOLREAP era)
 -&gt; Rule (ShelleyPOOLREAP era) 'Transition ())
-&gt; Event (ShelleyPOOLREAP era)
-&gt; Rule (ShelleyPOOLREAP era) 'Transition ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679528657"><span class="annot"><span class="annottext">rewardAccountsWithPool :: Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="#local-6989586621679528657"><span class="hs-identifier hs-var hs-var">rewardAccountsWithPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>          </span><span class="annot"><span class="annottext">(KeyHash 'StakePool
 -&gt; StakePoolState
 -&gt; Map
      (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
 -&gt; Map
      (Credential 'Staking)
      (Map (KeyHash 'StakePool) (CompactForm Coin)))
-&gt; Map
     (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
-&gt; Map (KeyHash 'StakePool) StakePoolState
-&gt; Map
     (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
forall k a b. (k -&gt; a -&gt; b -&gt; b) -&gt; b -&gt; Map k a -&gt; b
</span><span class="hs-identifier hs-var">Map.foldrWithKey'</span></span><span>
</span><span id="line-190"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679528659"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679528659"><span class="hs-identifier hs-var">poolId</span></a></span></span><span> </span><span id="local-6989586621679528660"><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528660"><span class="hs-identifier hs-var">sps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-191"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679528661"><span class="annot"><span class="annottext">cred :: Credential 'Staking
</span><a href="#local-6989586621679528661"><span class="hs-identifier hs-var hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; Credential 'Staking
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#raCredential"><span class="hs-identifier hs-var">raCredential</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; Credential 'Staking)
-&gt; RewardAccount -&gt; Credential 'Staking
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StakePoolState -&gt; RewardAccount
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsRewardAccount"><span class="hs-identifier hs-var">spsRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528660"><span class="hs-identifier hs-var">sps</span></a></span><span>
</span><span id="line-192"></span><span>                 </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool) (CompactForm Coin)
 -&gt; Map (KeyHash 'StakePool) (CompactForm Coin)
 -&gt; Map (KeyHash 'StakePool) (CompactForm Coin))
-&gt; Credential 'Staking
-&gt; Map (KeyHash 'StakePool) (CompactForm Coin)
-&gt; Map
     (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
-&gt; Map
     (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin)
-&gt; Map (KeyHash 'StakePool) (CompactForm Coin)
-&gt; Map (KeyHash 'StakePool) (CompactForm Coin)
-&gt; Map (KeyHash 'StakePool) (CompactForm Coin)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679528661"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; CompactForm Coin -&gt; Map (KeyHash 'StakePool) (CompactForm Coin)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679528659"><span class="hs-identifier hs-var">poolId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakePoolState -&gt; CompactForm Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#spsDeposit"><span class="hs-identifier hs-var">spsDeposit</span></a></span><span> </span><span class="annot"><span class="annottext">StakePoolState
</span><a href="#local-6989586621679528660"><span class="hs-identifier hs-var">sps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>            </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-195"></span><span>            </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState
</span><a href="#local-6989586621679528627"><span class="hs-identifier hs-var">retiringPools</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679528665"><span class="annot"><span class="annottext">Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="#local-6989586621679528665"><span class="hs-identifier hs-var">refundPools'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679528666"><span class="annot"><span class="annottext">Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="#local-6989586621679528666"><span class="hs-identifier hs-var">unclaimedPools'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>          </span><span class="annot"><span class="annottext">(Credential 'Staking
 -&gt; Map (KeyHash 'StakePool) (CompactForm Coin) -&gt; Bool)
-&gt; Map
     (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
-&gt; (Map
      (Credential 'Staking)
      (Map (KeyHash 'StakePool) (CompactForm Coin)),
    Map
      (Credential 'Staking)
      (Map (KeyHash 'StakePool) (CompactForm Coin)))
forall k a. (k -&gt; a -&gt; Bool) -&gt; Map k a -&gt; (Map k a, Map k a)
</span><span class="hs-identifier hs-var">Map.partitionWithKey</span></span><span>
</span><span id="line-198"></span><span>            </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679528667"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679528667"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) (CompactForm Coin)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; Accounts era -&gt; Bool
forall era.
EraAccounts era =&gt;
Credential 'Staking -&gt; Accounts era -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#isAccountRegistered"><span class="hs-identifier hs-var">isAccountRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679528667"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">Accounts era
</span><a href="#local-6989586621679528640"><span class="hs-identifier hs-var">accounts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>            </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="#local-6989586621679528657"><span class="hs-identifier hs-var">rewardAccountsWithPool</span></a></span><span>
</span><span id="line-200"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#RetiredPools"><span class="hs-identifier hs-type">RetiredPools</span></a></span><span>
</span><span id="line-201"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">refundPools :: Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#refundPools"><span class="hs-identifier hs-var">refundPools</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="#local-6989586621679528665"><span class="hs-identifier hs-var">refundPools'</span></a></span><span>
</span><span id="line-202"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">unclaimedPools :: Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#unclaimedPools"><span class="hs-identifier hs-var">unclaimedPools</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking) (Map (KeyHash 'StakePool) (CompactForm Coin))
</span><a href="#local-6989586621679528666"><span class="hs-identifier hs-var">unclaimedPools'</span></a></span><span>
</span><span id="line-203"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">epochNo :: EpochNo
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#epochNo"><span class="hs-identifier hs-var">epochNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNo
Signal (ShelleyPOOLREAP era)
</span><a href="#local-6989586621679528597"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-204"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>  </span><span class="annot"><span class="annottext">ShelleyPoolreapState era
-&gt; F (Clause (ShelleyPOOLREAP era) 'Transition)
     (ShelleyPoolreapState era)
forall a. a -&gt; F (Clause (ShelleyPOOLREAP era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ShelleyPoolreapState era
 -&gt; F (Clause (ShelleyPOOLREAP era) 'Transition)
      (ShelleyPoolreapState era))
-&gt; ShelleyPoolreapState era
-&gt; F (Clause (ShelleyPOOLREAP era) 'Transition)
     (ShelleyPoolreapState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">UTxOState era
-&gt; ChainAccountState -&gt; CertState era -&gt; ShelleyPoolreapState era
forall era.
UTxOState era
-&gt; ChainAccountState -&gt; CertState era -&gt; ShelleyPoolreapState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#PoolreapState"><span class="hs-identifier hs-var">PoolreapState</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">UTxOState era
</span><a href="#local-6989586621679528594"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosDeposited"><span class="hs-identifier hs-var">utxosDeposited</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosDeposited"><span class="hs-identifier hs-var">utxosDeposited</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679528594"><span class="hs-identifier hs-type">us</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C-%3E"><span class="hs-operator hs-type">&lt;-&gt;</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-type">fromCompact</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679528653"><span class="hs-identifier hs-type">unclaimed</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;&gt;</span></span><span> </span><span class="annot"><a href="#local-6989586621679528650"><span class="hs-identifier hs-type">refunded</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">ChainAccountState
</span><a href="#local-6989586621679528595"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.ChainAccount.html#casTreasury"><span class="hs-identifier hs-var">casTreasury</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.ChainAccount.html#casTreasury"><span class="hs-identifier hs-var">casTreasury</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679528595"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator hs-type">&lt;+&gt;</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-type">fromCompact</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679528653"><span class="hs-identifier hs-type">unclaimed</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679528617"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-210"></span><span>          </span><span class="annot"><span class="annottext">CertState era -&gt; (CertState era -&gt; CertState era) -&gt; CertState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(DState era -&gt; Identity (DState era))
-&gt; CertState era -&gt; Identity (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (DState era)
Lens' (CertState era) (DState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certDStateL"><span class="hs-identifier hs-var">certDStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((DState era -&gt; Identity (DState era))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; ((Accounts era -&gt; Identity (Accounts era))
    -&gt; DState era -&gt; Identity (DState era))
-&gt; (Accounts era -&gt; Identity (Accounts era))
-&gt; CertState era
-&gt; Identity (CertState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Accounts era -&gt; Identity (Accounts era))
-&gt; DState era -&gt; Identity (DState era)
forall era. Lens' (DState era) (Accounts era)
forall (t :: * -&gt; *) era.
CanSetAccounts t =&gt;
Lens' (t era) (Accounts era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsL"><span class="hs-identifier hs-var">accountsL</span></a></span><span>
</span><span id="line-211"></span><span>            </span><span class="annot"><span class="annottext">((Accounts era -&gt; Identity (Accounts era))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; (Accounts era -&gt; Accounts era) -&gt; CertState era -&gt; CertState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'StakePool) -&gt; Accounts era -&gt; Accounts era
forall era.
EraAccounts era =&gt;
Set (KeyHash 'StakePool) -&gt; Accounts era -&gt; Accounts era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#removeStakePoolDelegations"><span class="hs-identifier hs-var">removeStakePoolDelegations</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'StakePool)
</span><a href="#local-6989586621679528621"><span class="hs-identifier hs-var">retired</span></a></span><span> </span><span class="annot"><span class="annottext">(Accounts era -&gt; Accounts era)
-&gt; (Accounts era -&gt; Accounts era) -&gt; Accounts era -&gt; Accounts era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
-&gt; Accounts era -&gt; Accounts era
forall era.
EraAccounts era =&gt;
Map (Credential 'Staking) (CompactForm Coin)
-&gt; Accounts era -&gt; Accounts era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#addToBalanceAccounts"><span class="hs-identifier hs-var">addToBalanceAccounts</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679528641"><span class="hs-identifier hs-var">refunds</span></a></span><span>
</span><span id="line-212"></span><span>          </span><span class="annot"><span class="annottext">CertState era -&gt; (CertState era -&gt; CertState era) -&gt; CertState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PState era -&gt; Identity (PState era))
-&gt; CertState era -&gt; Identity (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (PState era)
Lens' (CertState era) (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certPStateL"><span class="hs-identifier hs-var">certPStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PState era -&gt; Identity (PState era))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; ((Map (KeyHash 'StakePool) StakePoolState
     -&gt; Identity (Map (KeyHash 'StakePool) StakePoolState))
    -&gt; PState era -&gt; Identity (PState era))
-&gt; (Map (KeyHash 'StakePool) StakePoolState
    -&gt; Identity (Map (KeyHash 'StakePool) StakePoolState))
-&gt; CertState era
-&gt; Identity (CertState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool) StakePoolState
 -&gt; Identity (Map (KeyHash 'StakePool) StakePoolState))
-&gt; PState era -&gt; Identity (PState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (KeyHash 'StakePool) StakePoolState
 -&gt; f (Map (KeyHash 'StakePool) StakePoolState))
-&gt; PState era -&gt; f (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psStakePoolsL"><span class="hs-identifier hs-var">psStakePoolsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (KeyHash 'StakePool) StakePoolState
  -&gt; Identity (Map (KeyHash 'StakePool) StakePoolState))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; (Map (KeyHash 'StakePool) StakePoolState
    -&gt; Map (KeyHash 'StakePool) StakePoolState)
-&gt; CertState era
-&gt; CertState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState
-&gt; Set (KeyHash 'StakePool)
-&gt; Map (KeyHash 'StakePool) StakePoolState
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.withoutKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'StakePool)
</span><a href="#local-6989586621679528621"><span class="hs-identifier hs-var">retired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>          </span><span class="annot"><span class="annottext">CertState era -&gt; (CertState era -&gt; CertState era) -&gt; CertState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PState era -&gt; Identity (PState era))
-&gt; CertState era -&gt; Identity (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (PState era)
Lens' (CertState era) (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certPStateL"><span class="hs-identifier hs-var">certPStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PState era -&gt; Identity (PState era))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; ((Map (KeyHash 'StakePool) EpochNo
     -&gt; Identity (Map (KeyHash 'StakePool) EpochNo))
    -&gt; PState era -&gt; Identity (PState era))
-&gt; (Map (KeyHash 'StakePool) EpochNo
    -&gt; Identity (Map (KeyHash 'StakePool) EpochNo))
-&gt; CertState era
-&gt; Identity (CertState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool) EpochNo
 -&gt; Identity (Map (KeyHash 'StakePool) EpochNo))
-&gt; PState era -&gt; Identity (PState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (KeyHash 'StakePool) EpochNo
 -&gt; f (Map (KeyHash 'StakePool) EpochNo))
-&gt; PState era -&gt; f (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psRetiringL"><span class="hs-identifier hs-var">psRetiringL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (KeyHash 'StakePool) EpochNo
  -&gt; Identity (Map (KeyHash 'StakePool) EpochNo))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; (Map (KeyHash 'StakePool) EpochNo
    -&gt; Map (KeyHash 'StakePool) EpochNo)
-&gt; CertState era
-&gt; CertState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) EpochNo
-&gt; Set (KeyHash 'StakePool) -&gt; Map (KeyHash 'StakePool) EpochNo
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.withoutKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'StakePool)
</span><a href="#local-6989586621679528621"><span class="hs-identifier hs-var">retired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>          </span><span class="annot"><span class="annottext">CertState era -&gt; (CertState era -&gt; CertState era) -&gt; CertState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PState era -&gt; Identity (PState era))
-&gt; CertState era -&gt; Identity (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (PState era)
Lens' (CertState era) (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certPStateL"><span class="hs-identifier hs-var">certPStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PState era -&gt; Identity (PState era))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; ((Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
     -&gt; Identity (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)))
    -&gt; PState era -&gt; Identity (PState era))
-&gt; (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
    -&gt; Identity (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)))
-&gt; CertState era
-&gt; Identity (CertState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
 -&gt; Identity (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)))
-&gt; PState era -&gt; Identity (PState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
 -&gt; f (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)))
-&gt; PState era -&gt; f (PState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#psVRFKeyHashesL"><span class="hs-identifier hs-var">psVRFKeyHashesL</span></a></span><span>
</span><span id="line-215"></span><span>            </span><span class="annot"><span class="annottext">((Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
  -&gt; Identity (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)))
 -&gt; CertState era -&gt; Identity (CertState era))
-&gt; (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
    -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
-&gt; CertState era
-&gt; CertState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[VRFVerKeyHash 'StakePoolVRF]
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
</span><a href="#local-6989586621679528676"><span class="hs-identifier hs-var">removeVRFKeyHashOccurrences</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VRFVerKeyHash 'StakePoolVRF]
</span><a href="#local-6989586621679528631"><span class="hs-identifier hs-var">retiredVRFKeyHashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>                   </span><span class="annot"><span class="annottext">(Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
 -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
-&gt; (Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
    -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; Set (VRFVerKeyHash 'StakePoolVRF)
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.withoutKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set (VRFVerKeyHash 'StakePoolVRF)
</span><a href="#local-6989586621679528600"><span class="hs-identifier hs-var">danglingVRFKeyHashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>               </span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="#local-6989586621679528676"><span class="hs-identifier hs-type">removeVRFKeyHashOccurrences</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#VRFVerKeyHash"><span class="hs-identifier hs-type">VRFVerKeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#StakePoolVRF"><span class="hs-identifier hs-type">StakePoolVRF</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#VRFVerKeyHash"><span class="hs-identifier hs-type">VRFVerKeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#StakePoolVRF"><span class="hs-identifier hs-type">StakePoolVRF</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#NonZero"><span class="hs-identifier hs-type">NonZero</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-223"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#VRFVerKeyHash"><span class="hs-identifier hs-type">VRFVerKeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#StakePoolVRF"><span class="hs-identifier hs-type">StakePoolVRF</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#NonZero"><span class="hs-identifier hs-type">NonZero</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span id="local-6989586621679528676"><span class="annot"><span class="annottext">removeVRFKeyHashOccurrences :: [VRFVerKeyHash 'StakePoolVRF]
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
</span><a href="#local-6989586621679528676"><span class="hs-identifier hs-var hs-var">removeVRFKeyHashOccurrences</span></a></span></span><span> </span><span id="local-6989586621679528677"><span class="annot"><span class="annottext">[VRFVerKeyHash 'StakePoolVRF]
</span><a href="#local-6989586621679528677"><span class="hs-identifier hs-var">vrfs</span></a></span></span><span> </span><span id="local-6989586621679528678"><span class="annot"><span class="annottext">Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
</span><a href="#local-6989586621679528678"><span class="hs-identifier hs-var">vrfsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
 -&gt; VRFVerKeyHash 'StakePoolVRF
 -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; [VRFVerKeyHash 'StakePoolVRF]
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">F.foldl'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VRFVerKeyHash 'StakePoolVRF
 -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
 -&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64))
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; VRFVerKeyHash 'StakePoolVRF
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
</span><a href="#local-6989586621679528680"><span class="hs-identifier hs-var">removeVRFKeyHashOccurrence</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
</span><a href="#local-6989586621679528678"><span class="hs-identifier hs-var">vrfsMap</span></a></span><span> </span><span class="annot"><span class="annottext">[VRFVerKeyHash 'StakePoolVRF]
</span><a href="#local-6989586621679528677"><span class="hs-identifier hs-var">vrfs</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span id="local-6989586621679528680"><span class="annot"><span class="annottext">removeVRFKeyHashOccurrence :: VRFVerKeyHash 'StakePoolVRF
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
</span><a href="#local-6989586621679528680"><span class="hs-identifier hs-var hs-var">removeVRFKeyHashOccurrence</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-226"></span><span>      </span><span class="hs-comment">-- Removes the key from the map if the value drops to 0</span><span>
</span><span id="line-227"></span><span>      </span><span class="annot"><span class="annottext">(NonZero Word64 -&gt; Maybe (NonZero Word64))
-&gt; VRFVerKeyHash 'StakePoolVRF
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
-&gt; Map (VRFVerKeyHash 'StakePoolVRF) (NonZero Word64)
forall k a. Ord k =&gt; (a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.update</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Word64 -&gt; Word64) -&gt; NonZero Word64 -&gt; Maybe (NonZero Word64)
forall b a.
(Eq b, HasZero b) =&gt;
(a -&gt; b) -&gt; NonZero a -&gt; Maybe (NonZero b)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#mapNonZero"><span class="hs-identifier hs-var">mapNonZero</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679528692"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679528692"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679528692"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span id="local-6989586621679527978"><span id="local-6989586621679527979"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#renderPoolReapViolation"><span class="hs-identifier hs-type">renderPoolReapViolation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527978"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527979"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#ShelleyPoolreapState"><span class="hs-identifier hs-type">ShelleyPoolreapState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527978"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527978"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#AssertionViolation"><span class="hs-identifier hs-type">AssertionViolation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679527979"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span></span></span><span>
</span><span id="line-236"></span><span id="renderPoolReapViolation"><span class="annot"><span class="annottext">renderPoolReapViolation :: forall era t.
(EraGov era, State t ~ ShelleyPoolreapState era,
 EraCertState era) =&gt;
AssertionViolation t -&gt; String
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#renderPoolReapViolation"><span class="hs-identifier hs-var hs-var">renderPoolReapViolation</span></a></span></span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#AssertionViolation"><span class="hs-identifier hs-type">AssertionViolation</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679528712"><span class="annot"><span class="annottext">String
avSTS :: String
avSTS :: forall sts. AssertionViolation sts -&gt; String
</span><a href="#local-6989586621679528712"><span class="hs-identifier hs-var hs-var">avSTS</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679528714"><span class="annot"><span class="annottext">String
avMsg :: String
avMsg :: forall sts. AssertionViolation sts -&gt; String
</span><a href="#local-6989586621679528714"><span class="hs-identifier hs-var hs-var">avMsg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">avCtx :: forall sts. AssertionViolation sts -&gt; TRC sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#avCtx"><span class="hs-identifier hs-var">avCtx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment t
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679528717"><span class="annot"><span class="annottext">State t
</span><a href="#local-6989586621679528717"><span class="hs-identifier hs-var">poolreapst</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signal t
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679528718"><span class="annot"><span class="annottext">obligations :: Obligations
</span><a href="#local-6989586621679528718"><span class="hs-identifier hs-var hs-var">obligations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>          </span><span class="annot"><span class="annottext">CertState era -&gt; GovState era -&gt; Obligations
forall era.
(EraGov era, EraCertState era) =&gt;
CertState era -&gt; GovState era -&gt; Obligations
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#allObligations"><span class="hs-identifier hs-var">allObligations</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; CertState era
forall era. ShelleyPoolreapState era -&gt; CertState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prCertState"><span class="hs-identifier hs-var">prCertState</span></a></span><span> </span><span class="annot"><span class="annottext">State t
ShelleyPoolreapState era
</span><a href="#local-6989586621679528717"><span class="hs-identifier hs-var">poolreapst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; UTxOState era
forall era. ShelleyPoolreapState era -&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOSt"><span class="hs-identifier hs-var">prUTxOSt</span></a></span><span> </span><span class="annot"><span class="annottext">State t
ShelleyPoolreapState era
</span><a href="#local-6989586621679528717"><span class="hs-identifier hs-var">poolreapst</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOState era
-&gt; Getting (GovState era) (UTxOState era) (GovState era)
-&gt; GovState era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (GovState era) (UTxOState era) (GovState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovState era -&gt; f (GovState era))
-&gt; UTxOState era -&gt; f (UTxOState era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosGovStateL"><span class="hs-identifier hs-var">utxosGovStateL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n\nAssertionViolation (&quot;</span></span><span>
</span><span id="line-241"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679528712"><span class="hs-identifier hs-var">avSTS</span></a></span><span>
</span><span id="line-242"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)\n   &quot;</span></span><span>
</span><span id="line-243"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679528714"><span class="hs-identifier hs-var">avMsg</span></a></span><span>
</span><span id="line-244"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\npot (utxosDeposited) = &quot;</span></span><span>
</span><span id="line-245"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxOState era -&gt; Coin
forall era. UTxOState era -&gt; Coin
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosDeposited"><span class="hs-identifier hs-var">utxosDeposited</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyPoolreapState era -&gt; UTxOState era
forall era. ShelleyPoolreapState era -&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.Rules.PoolReap.html#prUTxOSt"><span class="hs-identifier hs-var">prUTxOSt</span></a></span><span> </span><span class="annot"><span class="annottext">State t
ShelleyPoolreapState era
</span><a href="#local-6989586621679528717"><span class="hs-identifier hs-var">poolreapst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Obligations -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Obligations
</span><a href="#local-6989586621679528718"><span class="hs-identifier hs-var">obligations</span></a></span><span>
</span><span id="line-247"></span></pre></body></html>