\section{Transactions}
\label{sec:transactions}

Transactions are defined in Figure~\ref{fig:defs:utxo-shelley}.
A transaction body, $\TxBody$, is made up of seven pieces:

\begin{itemize}
  \item A set of transaction inputs.
    This derived type identifies an output from a previous transaction.
    It consists of a transaction id and an index to uniquely identify the output.
  \item  An indexed collection of transaction outputs.
    The $\TxOut$ type is an address paired with a coin value.
  \item A list of certificates, which will be explained in detail in
    Section~\ref{sec:delegation-shelley}.
  \item The transaction fee. This value will be added to the fee pot and eventually handed out
    as stake rewards.
  \item A time to live. A transaction will be deemed invalid if processed after this slot.
  \item A mapping of reward account withdrawals.  The type $\Wdrl$ is a finite map that maps
    a reward address to the coin value to be withdrawn. The coin value must be equal
    to the full value contained in the account. Explicitly stating these values ensures
    that error messages can be precise about why a transaction is invalid.
    For reward calculation rules, see Section \ref{sec:reward-overview},
    and for the rule for collecting rewards, see Section \ref{sec:utxo-trans}.
  \item Update proposals for protocol parameters and software
\end{itemize}

The update proposal type $\Update$ is a pair of

\begin{itemize}
  \item $\PPUpdate$, the protocol parameter upates
  \item $\AVUpdate$, the updates to Shelley software (applications)
\end{itemize}

Note that both are finite maps indexed by the entities proposing the given
update, the $\VKeyGen$ keys. This is because updates
can only be proposed and voted on by the owners of the genesis keys.
(see Section \ref{sec:update}).
A transaction, $\Tx$, consists of:

\begin{itemize}
  \item The transaction body
  \item A collection of witnesses, represented as a finite map from payment verification keys
    to signatures.
\end{itemize}

Additionally, the $\UTxO$ type will be used by the ledger state to store all the
unspent transaction outputs. It is a finite map from transaction inputs
to transaction outputs that are available to be spent.

Finally, $\fun{txid}$ computes the transaction id of a given transaction.
This function must produce a unique id for each unique transaction.

\begin{figure*}[htb]
  \emph{Abstract types}
  %
  \begin{equation*}
    \begin{array}{r@{~\in~}lr}
      \var{txid} & \TxId & \text{transaction id}\\
      \var{an} & \ApName & \text{application name}\\
      \var{st} & \SystemTag & \text{system tag}\\
      \var{ud} & \UpdateData & \text{update data}\\
    \end{array}
  \end{equation*}
  \emph{Derived types}
  %
  \begin{equation*}
    \begin{array}{r@{~\in~}l@{\qquad=\qquad}lr}
      (\var{txid}, \var{ix})
      & \TxIn
      & \TxId \times \Ix
      & \text{transaction input}
      \\
      (\var{addr}, c)
      & \type{TxOut}
      & \Addr \times \Coin
      & \text{transaction output}
      \\
      \var{utxo}
      & \UTxO
      & \TxIn \mapsto \TxOut
      & \text{unspent tx outputs}
      \\
      \var{wdrl}
      & \Wdrl
      & \AddrRWD \mapsto \Coin
      & \text{reward withdrawal}
      \\
      \var{pup}
      & \PPUpdate
      & \VKeyGen \mapsto \Ppm \mapsto \Seed
      & \text{protocol parameter update}
      \\
      \var{av}
      & \ApVer
      & \N
      & \text{application versions}
      \\
      \var{md}
      & \Metadata
      & \SystemTag\mapsto\UpdateData
      & \text{application metadata}
      \\
      \var{apps}
      & \Applications
      & \ApName \mapsto (\ApVer \times \Metadata)
      & \text{application versions}
      \\
      \var{aup}
      & \AVUpdate
      & \VKeyGen \mapsto \Applications
      & \text{application update}
      \\
      \var{up}
      & \Update
      & \PPUpdate \times \AVUpdate
      & \text{update proposal}
    \end{array}
  \end{equation*}
  %
  \emph{Transaction Types}
  %
  \begin{equation*}
    \begin{array}{r@{~\in~}l@{\qquad=\qquad}l}
      \var{txbody}
      & \TxBody
      & \powerset{\TxIn} \times (\Ix \mapsto \TxOut) \times \seqof{\DCert}
        \times \Coin \times \Slot \times \Wdrl \times \Update
      \\
      \var{tx}
      & \Tx
      & \TxBody \times (\VKey \mapsto \Sig)
      \\
    \end{array}
  \end{equation*}
  %
  \emph{Accessor Functions}
  \begin{equation*}
    \begin{array}{r@{~\in~}lr}
      \fun{txins} & \Tx \to \powerset{\TxIn} & \text{transaction inputs} \\
      \fun{txouts} & \Tx \to (\Ix \mapsto \TxOut) & \text{transaction outputs} \\
      \fun{txcerts} & \Tx \to \seqof{\DCert} & \text{delegation certificates} \\
      \fun{txfee} & \Tx \to \Coin & \text{transaction fee} \\
      \fun{txttl} & \Tx \to \Slot & \text{time to live} \\
      \fun{txwdrls} & \Tx \to \Wdrl & \text{withdrawals} \\
      \fun{txbody} & \Tx \to \TxBody & \text{transaction body}\\
      \fun{txwits} & \Tx \to (\VKey \mapsto \Sig) & \text{witnesses} \\
      \fun{txup} & \Tx \to \Update & \text{protocol parameter update} \\
    \end{array}
  \end{equation*}
  %
  \emph{Abstract Functions}
  \begin{equation*}
    \begin{array}{r@{~\in~}lr}
      \txid{} & \Tx \to \TxId & \text{compute transaction id}\\
    \end{array}
  \end{equation*}
  \caption{Definitions used in the UTxO transition system}
  \label{fig:defs:utxo-shelley}
\end{figure*}

\clearpage
