<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DuplicateRecordFields #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- Module      : EpochBoundary</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- Description : Functions and definitions for rules at epoch boundary.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- This modules implements the necessary functions for the changes that can happen at epoch boundaries.</span><span>
</span><span id="line-22"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.State.SnapShots</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier">Stake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumAllStake"><span class="hs-identifier">sumAllStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumAllStakeCompact"><span class="hs-identifier">sumAllStakeCompact</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumStakePerPool"><span class="hs-identifier">sumStakePerPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier">SnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier">SnapShots</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShot"><span class="hs-identifier">emptySnapShot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShots"><span class="hs-identifier">emptySnapShots</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#poolStake"><span class="hs-identifier">poolStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#maxPool"><span class="hs-identifier">maxPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#maxPool%27"><span class="hs-identifier">maxPool'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr"><span class="hs-identifier">calculatePoolDistr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr%27"><span class="hs-identifier">calculatePoolDistr'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolStake"><span class="hs-identifier">calculatePoolStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeMarkL"><span class="hs-identifier">ssStakeMarkL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeMarkPoolDistrL"><span class="hs-identifier">ssStakeMarkPoolDistrL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeSetL"><span class="hs-identifier">ssStakeSetL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeGoL"><span class="hs-identifier">ssStakeGoL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssFeeL"><span class="hs-identifier">ssFeeL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeL"><span class="hs-identifier">ssStakeL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeDistrL"><span class="hs-identifier">ssStakeDistrL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssDelegationsL"><span class="hs-identifier">ssDelegationsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssPoolParamsL"><span class="hs-identifier">ssPoolParamsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#BoundedRational"><span class="hs-identifier">BoundedRational</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#KeyValuePairs"><span class="hs-identifier">KeyValuePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#NonNegativeInterval"><span class="hs-identifier">NonNegativeInterval</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#NonZero"><span class="hs-identifier">NonZero</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#ToKeyValuePairs"><span class="hs-identifier">ToKeyValuePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#knownNonZeroBounded"><span class="hs-identifier">knownNonZeroBounded</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#nonZeroOr"><span class="hs-identifier">nonZeroOr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#recipNonZero"><span class="hs-identifier">recipNonZero</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#toIntegerNonZero"><span class="hs-identifier">toIntegerNonZero</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#toRatioNonZero"><span class="hs-identifier">toRatioNonZero</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#%25."><span class="hs-operator">(%.)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#%2F."><span class="hs-operator">(/.)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.html"><span class="hs-identifier">Cardano.Ledger.Binary</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier">DecCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier">decCBOR</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#DecShareCBOR"><span class="hs-identifier">DecShareCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier">EncCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier">encCBOR</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier">Interns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decNoShareCBOR"><span class="hs-identifier">decNoShareCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusLensCBOR"><span class="hs-identifier">decSharePlusLensCBOR</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeRecordNamedT"><span class="hs-identifier">decodeRecordNamedT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Encoder.html#encodeListLen"><span class="hs-identifier">encodeListLen</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#toMemptyLens"><span class="hs-identifier">toMemptyLens</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier">CompactForm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#coinToRational"><span class="hs-identifier">coinToRational</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#compactCoinNonZero"><span class="hs-identifier">compactCoinNonZero</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#fromCompactCoinNonZero"><span class="hs-identifier">fromCompactCoinNonZero</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#rationalToCoinViaFloor"><span class="hs-identifier">rationalToCoinViaFloor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#unCoinNonZero"><span class="hs-identifier">unCoinNonZero</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Compactible.html"><span class="hs-identifier">Cardano.Ledger.Compactible</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Core.html"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Credential.html"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier">Credential</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.PoolDistr.html"><span class="hs-identifier">Cardano.Ledger.State.PoolDistr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.PoolDistr.html#IndividualPoolStake"><span class="hs-identifier">IndividualPoolStake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.PoolDistr.html#PoolDistr"><span class="hs-identifier">PoolDistr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.StakePool.html"><span class="hs-identifier">Cardano.Ledger.State.StakePool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.StakePool.html#PoolParams"><span class="hs-identifier">PoolParams</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.StakePool.html#ppVrf"><span class="hs-identifier">ppVrf</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Val.html"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier">ToJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.html"><span class="hs-identifier">Data.Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier">Default</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier">def</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html"><span class="hs-identifier">Data.VMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">VMap</span></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word16</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Word</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Word64</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html"><span class="hs-identifier">Lens.Micro</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier">Lens'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier">lens</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator">(^.)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Internal.html#_1"><span class="hs-identifier">_1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Internal.html#_2"><span class="hs-identifier">_2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html"><span class="hs-identifier">NoThunks.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#AllowThunksIn"><span class="hs-identifier">AllowThunksIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier">NoThunks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | Type of stake as map from staking credential to coins associated. Any staking credential that</span><span>
</span><span id="line-103"></span><span class="hs-comment">-- has no stake will not appear in this Map, even if it is registered. For this reason, this data</span><span>
</span><span id="line-104"></span><span class="hs-comment">-- type should not be used for infering whether credential is registered or not.</span><span>
</span><span id="line-105"></span><span class="hs-keyword">newtype</span><span> </span><span id="Stake"><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stake"><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AunStake%3AStake"><span class="annot"><span class="annottext">Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var hs-var">unStake</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VP"><span class="hs-identifier hs-type">VP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679463795"><span id="local-6989586621679463803"><span id="local-6989586621679463807"><span class="annot"><span class="annottext">Int -&gt; Stake -&gt; ShowS
[Stake] -&gt; ShowS
Stake -&gt; String
(Int -&gt; Stake -&gt; ShowS)
-&gt; (Stake -&gt; String) -&gt; ([Stake] -&gt; ShowS) -&gt; Show Stake
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Stake -&gt; ShowS
showsPrec :: Int -&gt; Stake -&gt; ShowS
$cshow :: Stake -&gt; String
show :: Stake -&gt; String
$cshowList :: [Stake] -&gt; ShowS
showList :: [Stake] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463813"><span id="local-6989586621679463820"><span class="annot"><span class="annottext">Stake -&gt; Stake -&gt; Bool
(Stake -&gt; Stake -&gt; Bool) -&gt; (Stake -&gt; Stake -&gt; Bool) -&gt; Eq Stake
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Stake -&gt; Stake -&gt; Bool
== :: Stake -&gt; Stake -&gt; Bool
$c/= :: Stake -&gt; Stake -&gt; Bool
/= :: Stake -&gt; Stake -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463836"><span class="annot"><span class="annottext">Stake -&gt; ()
(Stake -&gt; ()) -&gt; NFData Stake
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: Stake -&gt; ()
rnf :: Stake -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463849"><span id="local-6989586621679463851"><span class="annot"><span class="annottext">(forall x. Stake -&gt; Rep Stake x)
-&gt; (forall x. Rep Stake x -&gt; Stake) -&gt; Generic Stake
forall x. Rep Stake x -&gt; Stake
forall x. Stake -&gt; Rep Stake x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Stake -&gt; Rep Stake x
from :: forall x. Stake -&gt; Rep Stake x
$cto :: forall x. Rep Stake x -&gt; Stake
to :: forall x. Rep Stake x -&gt; Stake
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463855"><span id="local-6989586621679463862"><span id="local-6989586621679463868"><span id="local-6989586621679463874"><span id="local-6989586621679463880"><span class="annot"><span class="annottext">[Stake] -&gt; Value
[Stake] -&gt; Encoding
Stake -&gt; Bool
Stake -&gt; Value
Stake -&gt; Encoding
(Stake -&gt; Value)
-&gt; (Stake -&gt; Encoding)
-&gt; ([Stake] -&gt; Value)
-&gt; ([Stake] -&gt; Encoding)
-&gt; (Stake -&gt; Bool)
-&gt; ToJSON Stake
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: Stake -&gt; Value
toJSON :: Stake -&gt; Value
$ctoEncoding :: Stake -&gt; Encoding
toEncoding :: Stake -&gt; Encoding
$ctoJSONList :: [Stake] -&gt; Value
toJSONList :: [Stake] -&gt; Value
$ctoEncodingList :: [Stake] -&gt; Encoding
toEncodingList :: [Stake] -&gt; Encoding
$comitField :: Stake -&gt; Bool
omitField :: Stake -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463890"><span id="local-6989586621679463901"><span id="local-6989586621679463911"><span class="annot"><span class="annottext">Context -&gt; Stake -&gt; IO (Maybe ThunkInfo)
Proxy Stake -&gt; String
(Context -&gt; Stake -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; Stake -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy Stake -&gt; String)
-&gt; NoThunks Stake
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: Context -&gt; Stake -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; Stake -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; Stake -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; Stake -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: Proxy Stake -&gt; String
showTypeOf :: Proxy Stake -&gt; String
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679463946"><span id="local-6989586621679463957"><span id="local-6989586621679463967"><span class="annot"><span class="annottext">Typeable Stake
Typeable Stake =&gt;
(Stake -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy Stake -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size)
    -&gt; Proxy [Stake] -&gt; Size)
-&gt; EncCBOR Stake
Stake -&gt; Encoding
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [Stake] -&gt; Size
(forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy Stake -&gt; Size
forall a.
Typeable a =&gt;
(a -&gt; Encoding)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy a -&gt; Size)
-&gt; ((forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [a] -&gt; Size)
-&gt; EncCBOR a
$cencCBOR :: Stake -&gt; Encoding
encCBOR :: Stake -&gt; Encoding
$cencodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy Stake -&gt; Size
encodedSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy Stake -&gt; Size
$cencodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [Stake] -&gt; Size
encodedListSizeExpr :: (forall t. EncCBOR t =&gt; Proxy t -&gt; Size) -&gt; Proxy [Stake] -&gt; Size
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">EncCBOR</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679463987"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#DecShareCBOR"><span class="hs-identifier hs-type">DecShareCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Share"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Share"><span class="hs-identifier hs-var">Share</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Share"><span class="hs-identifier hs-type">Share</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VP"><span class="hs-identifier hs-type">VP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>  </span><span id="local-6989586621679463999"><span class="annot"><span class="annottext">getShare :: Stake -&gt; Share Stake
</span><a href="#local-6989586621679463999"><span class="hs-identifier hs-var hs-var hs-var hs-var">getShare</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin)
-&gt; Share (VMap VB VP (Credential 'Staking) (CompactForm Coin))
VMap VB VP (Credential 'Staking) (CompactForm Coin)
-&gt; Interns (Credential 'Staking)
forall a. DecShareCBOR a =&gt; a -&gt; Share a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#getShare"><span class="hs-identifier hs-var">getShare</span></a></span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking) (CompactForm Coin)
 -&gt; Interns (Credential 'Staking))
-&gt; (Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin))
-&gt; Stake
-&gt; Interns (Credential 'Staking)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span>
</span><span id="line-113"></span><span>  </span><span id="local-6989586621679464008"><span class="annot"><span class="annottext">decShareCBOR :: forall s. Share Stake -&gt; Decoder s Stake
</span><a href="#local-6989586621679464008"><span class="hs-identifier hs-var hs-var hs-var hs-var">decShareCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking) (CompactForm Coin) -&gt; Stake)
-&gt; Decoder s (VMap VB VP (Credential 'Staking) (CompactForm Coin))
-&gt; Decoder s Stake
forall a b. (a -&gt; b) -&gt; Decoder s a -&gt; Decoder s b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin) -&gt; Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span><span> </span><span class="annot"><span class="annottext">(Decoder s (VMap VB VP (Credential 'Staking) (CompactForm Coin))
 -&gt; Decoder s Stake)
-&gt; (Interns (Credential 'Staking)
    -&gt; Decoder s (VMap VB VP (Credential 'Staking) (CompactForm Coin)))
-&gt; Interns (Credential 'Staking)
-&gt; Decoder s Stake
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Share (VMap VB VP (Credential 'Staking) (CompactForm Coin))
-&gt; Decoder s (VMap VB VP (Credential 'Staking) (CompactForm Coin))
Interns (Credential 'Staking)
-&gt; Decoder s (VMap VB VP (Credential 'Staking) (CompactForm Coin))
forall a s. DecShareCBOR a =&gt; Share a -&gt; Decoder s a
forall s.
Share (VMap VB VP (Credential 'Staking) (CompactForm Coin))
-&gt; Decoder s (VMap VB VP (Credential 'Staking) (CompactForm Coin))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decShareCBOR"><span class="hs-identifier hs-var">decShareCBOR</span></a></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumAllStake"><span class="hs-identifier hs-type">sumAllStake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-116"></span><span id="sumAllStake"><span class="annot"><span class="annottext">sumAllStake :: Stake -&gt; Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#sumAllStake"><span class="hs-identifier hs-var hs-var">sumAllStake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Coin
forall a. Compactible a =&gt; CompactForm a -&gt; a
</span><a href="Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-var">fromCompact</span></a></span><span> </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; Coin)
-&gt; (Stake -&gt; CompactForm Coin) -&gt; Stake -&gt; Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stake -&gt; CompactForm Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#sumAllStakeCompact"><span class="hs-identifier hs-var">sumAllStakeCompact</span></a></span><span>
</span><span id="line-117"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumAllStake"><span class="hs-pragma hs-type">sumAllStake</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumAllStakeCompact"><span class="hs-identifier hs-type">sumAllStakeCompact</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-120"></span><span id="sumAllStakeCompact"><span class="annot"><span class="annottext">sumAllStakeCompact :: Stake -&gt; CompactForm Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#sumAllStakeCompact"><span class="hs-identifier hs-var hs-var">sumAllStakeCompact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin)
-&gt; CompactForm Coin
-&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
-&gt; CompactForm Coin
forall (vv :: * -&gt; *) v a (kv :: * -&gt; *) k.
Vector vv v =&gt;
(a -&gt; v -&gt; a) -&gt; a -&gt; VMap kv vv k v -&gt; a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#foldl"><span class="hs-identifier hs-var">VMap.foldl</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(&lt;&gt;)</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking) (CompactForm Coin)
 -&gt; CompactForm Coin)
-&gt; (Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin))
-&gt; Stake
-&gt; CompactForm Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span>
</span><span id="line-121"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumAllStakeCompact"><span class="hs-pragma hs-type">sumAllStakeCompact</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="annot"><span class="hs-comment">-- | Get stake of one pool</span></span><span>
</span><span id="line-124"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#poolStake"><span class="hs-identifier hs-type">poolStake</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span>
</span><span id="line-129"></span><span id="poolStake"><span class="annot"><span class="annottext">poolStake :: KeyHash 'StakePool
-&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; Stake
-&gt; Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#poolStake"><span class="hs-identifier hs-var hs-var">poolStake</span></a></span></span><span> </span><span id="local-6989586621679464012"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679464012"><span class="hs-identifier hs-var">hk</span></a></span></span><span> </span><span id="local-6989586621679464013"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464013"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span id="local-6989586621679464014"><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679464014"><span class="hs-identifier hs-var">stake</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-comment">-- Stake $ (eval (dom (delegs &#9655; setSingleton hk) &#9665; stake))</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin) -&gt; Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span><span> </span><span class="annot"><span class="annottext">(VMap VB VP (Credential 'Staking) (CompactForm Coin) -&gt; Stake)
-&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin) -&gt; Stake
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking -&gt; CompactForm Coin -&gt; Bool)
-&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
-&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
(k -&gt; v -&gt; Bool) -&gt; VMap kv vv k v -&gt; VMap kv vv k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#filter"><span class="hs-identifier hs-var">VMap.filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464016"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679464016"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
-&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; Maybe (KeyHash 'StakePool)
forall k (kv :: * -&gt; *) (vv :: * -&gt; *) v.
(Ord k, Vector kv k, Vector vv v) =&gt;
k -&gt; VMap kv vv k v -&gt; Maybe v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#lookup"><span class="hs-identifier hs-var">VMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679464016"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464013"><span class="hs-identifier hs-var">delegs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (KeyHash 'StakePool) -&gt; Maybe (KeyHash 'StakePool) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; Maybe (KeyHash 'StakePool)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679464012"><span class="hs-identifier hs-var">hk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679464014"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">-- | Compute amount of stake each pool has. Any registered stake pool that has no stake will not be</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- inlcuded in the resulting map</span><span>
</span><span id="line-135"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#sumStakePerPool"><span class="hs-identifier hs-type">sumStakePerPool</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-139"></span><span id="sumStakePerPool"><span class="annot"><span class="annottext">sumStakePerPool :: VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; Stake -&gt; Map (KeyHash 'StakePool) Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#sumStakePerPool"><span class="hs-identifier hs-var hs-var">sumStakePerPool</span></a></span></span><span> </span><span id="local-6989586621679464018"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464018"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span id="local-6989586621679464019"><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679464019"><span class="hs-identifier hs-var">stake</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool) Coin
 -&gt; Credential 'Staking
 -&gt; CompactForm Coin
 -&gt; Map (KeyHash 'StakePool) Coin)
-&gt; Map (KeyHash 'StakePool) Coin
-&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
-&gt; Map (KeyHash 'StakePool) Coin
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v a.
(Vector kv k, Vector vv v) =&gt;
(a -&gt; k -&gt; v -&gt; a) -&gt; a -&gt; VMap kv vv k v -&gt; a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#foldlWithKey"><span class="hs-identifier hs-var">VMap.foldlWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Coin
-&gt; Credential 'Staking
-&gt; CompactForm Coin
-&gt; Map (KeyHash 'StakePool) Coin
</span><a href="#local-6989586621679464021"><span class="hs-identifier hs-var">accum</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Coin
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679464019"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-141"></span><span>    </span><span id="local-6989586621679464021"><span class="annot"><span class="annottext">accum :: Map (KeyHash 'StakePool) Coin
-&gt; Credential 'Staking
-&gt; CompactForm Coin
-&gt; Map (KeyHash 'StakePool) Coin
</span><a href="#local-6989586621679464021"><span class="hs-identifier hs-var hs-var">accum</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679464023"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Coin
</span><a href="#local-6989586621679464023"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679464024"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679464024"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621679464025"><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679464025"><span class="hs-identifier hs-var">compactCoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
-&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; Maybe (KeyHash 'StakePool)
forall k (kv :: * -&gt; *) (vv :: * -&gt; *) v.
(Ord k, Vector kv k, Vector vv v) =&gt;
k -&gt; VMap kv vv k v -&gt; Maybe v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#lookup"><span class="hs-identifier hs-var">VMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679464024"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464018"><span class="hs-identifier hs-var">delegs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">Maybe (KeyHash 'StakePool)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Coin
</span><a href="#local-6989586621679464023"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-144"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679464026"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679464026"><span class="hs-identifier hs-var">kh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Coin -&gt; Coin)
-&gt; KeyHash 'StakePool
-&gt; Coin
-&gt; Map (KeyHash 'StakePool) Coin
-&gt; Map (KeyHash 'StakePool) Coin
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator hs-var">(&lt;+&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679464026"><span class="hs-identifier hs-var">kh</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Coin
forall a. Compactible a =&gt; CompactForm a -&gt; a
</span><a href="Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-var">fromCompact</span></a></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
</span><a href="#local-6989586621679464025"><span class="hs-identifier hs-var">compactCoin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Coin
</span><a href="#local-6989586621679464023"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="annot"><span class="hs-comment">-- | Calculate maximal pool reward</span></span><span>
</span><span id="line-147"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#maxPool%27"><span class="hs-identifier hs-type">maxPool'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#NonNegativeInterval"><span class="hs-identifier hs-type">NonNegativeInterval</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.NonZero.html#NonZero"><span class="hs-identifier hs-type">NonZero</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-154"></span><span id="maxPool%27"><span class="annot"><span class="annottext">maxPool' :: NonNegativeInterval
-&gt; NonZero Word16 -&gt; Coin -&gt; Rational -&gt; Rational -&gt; Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#maxPool%27"><span class="hs-identifier hs-var hs-var">maxPool'</span></a></span></span><span> </span><span id="local-6989586621679464028"><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679464028"><span class="hs-identifier hs-var">a0</span></a></span></span><span> </span><span id="local-6989586621679464029"><span class="annot"><span class="annottext">NonZero Word16
</span><a href="#local-6989586621679464029"><span class="hs-identifier hs-var">nOpt</span></a></span></span><span> </span><span id="local-6989586621679464030"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464030"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679464031"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464031"><span class="hs-identifier hs-var">sigma</span></a></span></span><span> </span><span id="local-6989586621679464032"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464032"><span class="hs-identifier hs-var">pR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Coin
</span><a href="Cardano.Ledger.Coin.html#rationalToCoinViaFloor"><span class="hs-identifier hs-var">rationalToCoinViaFloor</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Coin) -&gt; Rational -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464033"><span class="hs-identifier hs-var">factor1</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464035"><span class="hs-identifier hs-var">factor2</span></a></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621679464036"><span class="annot"><span class="annottext">nonZeroZ0 :: NonZero Rational
</span><a href="#local-6989586621679464036"><span class="hs-identifier hs-var hs-var">nonZeroZ0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonZero Rational -&gt; NonZero Rational
forall a. Integral a =&gt; NonZero (Ratio a) -&gt; NonZero (Ratio a)
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#recipNonZero"><span class="hs-identifier hs-var">recipNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">(NonZero Rational -&gt; NonZero Rational)
-&gt; (NonZero Integer -&gt; NonZero Rational)
-&gt; NonZero Integer
-&gt; NonZero Rational
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonZero Integer -&gt; NonZero Rational
forall a. Integral a =&gt; NonZero a -&gt; NonZero (Ratio a)
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#toRatioNonZero"><span class="hs-identifier hs-var">toRatioNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">(NonZero Integer -&gt; NonZero Rational)
-&gt; NonZero Integer -&gt; NonZero Rational
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonZero Word16 -&gt; NonZero Integer
forall a. Integral a =&gt; NonZero a -&gt; NonZero Integer
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#toIntegerNonZero"><span class="hs-identifier hs-var">toIntegerNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero Word16
</span><a href="#local-6989586621679464029"><span class="hs-identifier hs-var">nOpt</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span id="local-6989586621679464037"><span class="annot"><span class="annottext">z0 :: Rational
</span><a href="#local-6989586621679464037"><span class="hs-identifier hs-var hs-var">z0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonZero Rational -&gt; Rational
forall a. NonZero a -&gt; a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#unNonZero"><span class="hs-identifier hs-var">unNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero Rational
</span><a href="#local-6989586621679464036"><span class="hs-identifier hs-var">nonZeroZ0</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span id="local-6989586621679464039"><span class="annot"><span class="annottext">sigma' :: Rational
</span><a href="#local-6989586621679464039"><span class="hs-identifier hs-var hs-var">sigma'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464031"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464037"><span class="hs-identifier hs-var">z0</span></a></span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679464041"><span class="annot"><span class="annottext">p' :: Rational
</span><a href="#local-6989586621679464041"><span class="hs-identifier hs-var hs-var">p'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464032"><span class="hs-identifier hs-var">pR</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464037"><span class="hs-identifier hs-var">z0</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679464033"><span class="annot"><span class="annottext">factor1 :: Rational
</span><a href="#local-6989586621679464033"><span class="hs-identifier hs-var hs-var">factor1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>      </span><span class="hs-comment">-- This division is safe, because a0 is non-negative and we're adding one</span><span>
</span><span id="line-162"></span><span>      </span><span class="hs-comment">-- to it</span><span>
</span><span id="line-163"></span><span>      </span><span class="annot"><span class="annottext">Coin -&gt; Rational
</span><a href="Cardano.Ledger.Coin.html#coinToRational"><span class="hs-identifier hs-var">coinToRational</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464030"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval -&gt; Rational
forall r. BoundedRational r =&gt; r -&gt; Rational
</span><a href="Cardano.Ledger.BaseTypes.html#unboundRational"><span class="hs-identifier hs-var">unboundRational</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679464028"><span class="hs-identifier hs-var">a0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621679464035"><span class="annot"><span class="annottext">factor2 :: Rational
</span><a href="#local-6989586621679464035"><span class="hs-identifier hs-var hs-var">factor2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464039"><span class="hs-identifier hs-var">sigma'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464041"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval -&gt; Rational
forall r. BoundedRational r =&gt; r -&gt; Rational
</span><a href="Cardano.Ledger.BaseTypes.html#unboundRational"><span class="hs-identifier hs-var">unboundRational</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679464028"><span class="hs-identifier hs-var">a0</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464045"><span class="hs-identifier hs-var">factor3</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621679464045"><span class="annot"><span class="annottext">factor3 :: Rational
</span><a href="#local-6989586621679464045"><span class="hs-identifier hs-var hs-var">factor3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464039"><span class="hs-identifier hs-var">sigma'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464041"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464046"><span class="hs-identifier hs-var">factor4</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; NonZero Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; NonZero a -&gt; a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#%2F."><span class="hs-operator hs-var">/.</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero Rational
</span><a href="#local-6989586621679464036"><span class="hs-identifier hs-var">nonZeroZ0</span></a></span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621679464046"><span class="annot"><span class="annottext">factor4 :: Rational
</span><a href="#local-6989586621679464046"><span class="hs-identifier hs-var hs-var">factor4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464037"><span class="hs-identifier hs-var">z0</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464039"><span class="hs-identifier hs-var">sigma'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; NonZero Rational -&gt; Rational
forall a. Fractional a =&gt; a -&gt; NonZero a -&gt; a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#%2F."><span class="hs-operator hs-var">/.</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero Rational
</span><a href="#local-6989586621679464036"><span class="hs-identifier hs-var">nonZeroZ0</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="annot"><span class="hs-comment">-- | Version of `maxPool'` that extracts `ppA0L` and `ppNOptL` from a `PParams`</span></span><span>
</span><span id="line-169"></span><span id="local-6989586621679463458"><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#maxPool"><span class="hs-identifier hs-type">maxPool</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-170"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463458"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-171"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679463458"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-172"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-173"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-174"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-176"></span><span id="maxPool"><span class="annot"><span class="annottext">maxPool :: forall era.
EraPParams era =&gt;
PParams era -&gt; Coin -&gt; Rational -&gt; Rational -&gt; Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#maxPool"><span class="hs-identifier hs-var hs-var">maxPool</span></a></span></span><span> </span><span id="local-6989586621679464063"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679464063"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621679464064"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464064"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621679464065"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464065"><span class="hs-identifier hs-var">sigma</span></a></span></span><span> </span><span id="local-6989586621679464066"><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464066"><span class="hs-identifier hs-var">pR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
-&gt; NonZero Word16 -&gt; Coin -&gt; Rational -&gt; Rational -&gt; Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#maxPool%27"><span class="hs-identifier hs-var">maxPool'</span></a></span><span> </span><span class="annot"><span class="annottext">NonNegativeInterval
</span><a href="#local-6989586621679464067"><span class="hs-identifier hs-var">a0</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero Word16
</span><a href="#local-6989586621679464068"><span class="hs-identifier hs-var">nOpt</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464064"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464065"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679464066"><span class="hs-identifier hs-var">pR</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>    </span><span id="local-6989586621679464067"><span class="annot"><span class="annottext">a0 :: NonNegativeInterval
</span><a href="#local-6989586621679464067"><span class="hs-identifier hs-var hs-var">a0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679464063"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
-&gt; Getting NonNegativeInterval (PParams era) NonNegativeInterval
-&gt; NonNegativeInterval
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting NonNegativeInterval (PParams era) NonNegativeInterval
forall era.
EraPParams era =&gt;
Lens' (PParams era) NonNegativeInterval
Lens' (PParams era) NonNegativeInterval
</span><a href="Cardano.Ledger.Core.PParams.html#ppA0L"><span class="hs-identifier hs-var">ppA0L</span></a></span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621679464068"><span class="annot"><span class="annottext">nOpt :: NonZero Word16
</span><a href="#local-6989586621679464068"><span class="hs-identifier hs-var hs-var">nOpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679464063"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; Getting Word16 (PParams era) Word16 -&gt; Word16
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Word16 (PParams era) Word16
forall era. EraPParams era =&gt; Lens' (PParams era) Word16
Lens' (PParams era) Word16
</span><a href="Cardano.Ledger.Core.PParams.html#ppNOptL"><span class="hs-identifier hs-var">ppNOptL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; NonZero Word16 -&gt; NonZero Word16
forall a. HasZero a =&gt; a -&gt; NonZero a -&gt; NonZero a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#nonZeroOr"><span class="hs-operator hs-var">`nonZeroOr`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (n :: Natural) a.
(KnownNat n, 1 &lt;= n, WithinBounds n a, Num a) =&gt;
NonZero a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#knownNonZeroBounded"><span class="hs-identifier hs-var">knownNonZeroBounded</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="annot"><span class="hs-comment">-- | Snapshot of the stake distribution.</span></span><span>
</span><span id="line-182"></span><span class="hs-keyword">data</span><span> </span><span id="SnapShot"><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-var">SnapShot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SnapShot"><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-var">SnapShot</span></a></span></span><span>
</span><span id="line-183"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AssStake%3ASnapShot"><span class="annot"><span class="annottext">SnapShot -&gt; Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssStake</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssDelegations%3ASnapShot"><span class="annot"><span class="annottext">SnapShot -&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssDelegations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssPoolParams%3ASnapShot"><span class="annot"><span class="annottext">SnapShot -&gt; VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssPoolParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.StakePool.html#PoolParams"><span class="hs-identifier hs-type">PoolParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464074"><span id="local-6989586621679464083"><span id="local-6989586621679464087"><span class="annot"><span class="annottext">Int -&gt; SnapShot -&gt; ShowS
[SnapShot] -&gt; ShowS
SnapShot -&gt; String
(Int -&gt; SnapShot -&gt; ShowS)
-&gt; (SnapShot -&gt; String) -&gt; ([SnapShot] -&gt; ShowS) -&gt; Show SnapShot
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; SnapShot -&gt; ShowS
showsPrec :: Int -&gt; SnapShot -&gt; ShowS
$cshow :: SnapShot -&gt; String
show :: SnapShot -&gt; String
$cshowList :: [SnapShot] -&gt; ShowS
showList :: [SnapShot] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464092"><span id="local-6989586621679464100"><span class="annot"><span class="annottext">SnapShot -&gt; SnapShot -&gt; Bool
(SnapShot -&gt; SnapShot -&gt; Bool)
-&gt; (SnapShot -&gt; SnapShot -&gt; Bool) -&gt; Eq SnapShot
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: SnapShot -&gt; SnapShot -&gt; Bool
== :: SnapShot -&gt; SnapShot -&gt; Bool
$c/= :: SnapShot -&gt; SnapShot -&gt; Bool
/= :: SnapShot -&gt; SnapShot -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464107"><span id="local-6989586621679464109"><span class="annot"><span class="annottext">(forall x. SnapShot -&gt; Rep SnapShot x)
-&gt; (forall x. Rep SnapShot x -&gt; SnapShot) -&gt; Generic SnapShot
forall x. Rep SnapShot x -&gt; SnapShot
forall x. SnapShot -&gt; Rep SnapShot x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. SnapShot -&gt; Rep SnapShot x
from :: forall x. SnapShot -&gt; Rep SnapShot x
$cto :: forall x. Rep SnapShot x -&gt; SnapShot
to :: forall x. Rep SnapShot x -&gt; SnapShot
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464112"><span id="local-6989586621679464118"><span id="local-6989586621679464123"><span id="local-6989586621679464128"><span id="local-6989586621679464133"><span class="annot"><span class="annottext">[SnapShot] -&gt; Value
[SnapShot] -&gt; Encoding
SnapShot -&gt; Bool
SnapShot -&gt; Value
SnapShot -&gt; Encoding
(SnapShot -&gt; Value)
-&gt; (SnapShot -&gt; Encoding)
-&gt; ([SnapShot] -&gt; Value)
-&gt; ([SnapShot] -&gt; Encoding)
-&gt; (SnapShot -&gt; Bool)
-&gt; ToJSON SnapShot
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: SnapShot -&gt; Value
toJSON :: SnapShot -&gt; Value
$ctoEncoding :: SnapShot -&gt; Encoding
toEncoding :: SnapShot -&gt; Encoding
$ctoJSONList :: [SnapShot] -&gt; Value
toJSONList :: [SnapShot] -&gt; Value
$ctoEncodingList :: [SnapShot] -&gt; Encoding
toEncodingList :: [SnapShot] -&gt; Encoding
$comitField :: SnapShot -&gt; Bool
omitField :: SnapShot -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#KeyValuePairs"><span class="hs-identifier hs-type">KeyValuePairs</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464140"><span id="local-6989586621679464144"><span id="local-6989586621679464150"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-type">NoThunks</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span></span></span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464208"><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464241"><span id="local-6989586621679464245"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-type">EncCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621679464263"><span class="annot"><span class="annottext">encCBOR :: SnapShot -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679464264"><span class="annot"><span class="annottext">Stake
$sel:ssStake:SnapShot :: SnapShot -&gt; Stake
ssStake :: Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssStake</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464265"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
$sel:ssDelegations:SnapShot :: SnapShot -&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
ssDelegations :: VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssDelegations</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464266"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
$sel:ssPoolParams:SnapShot :: SnapShot -&gt; VMap VB VB (KeyHash 'StakePool) PoolParams
ssPoolParams :: VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssPoolParams</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-196"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Encoder.html#encodeListLen"><span class="hs-identifier hs-var">encodeListLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">3</span></span><span>
</span><span id="line-197"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Stake -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464264"><span class="hs-identifier hs-var">ssStake</span></a></span><span>
</span><span id="line-198"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool) -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464265"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span>
</span><span id="line-199"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="#local-6989586621679464266"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464271"><span id="local-6989586621679464275"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#DecShareCBOR"><span class="hs-identifier hs-type">DecShareCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Share"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Share"><span class="hs-identifier hs-var">Share</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier hs-type">Interns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier hs-type">Interns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span id="local-6989586621679464310"><span class="annot"><span class="annottext">decSharePlusCBOR :: forall s. StateT (Share SnapShot) (Decoder s) SnapShot
</span><a href="#local-6989586621679464310"><span class="hs-identifier hs-var hs-var hs-var hs-var">decSharePlusCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; (SnapShot -&gt; Int)
-&gt; StateT (Share SnapShot) (Decoder s) SnapShot
-&gt; StateT (Share SnapShot) (Decoder s) SnapShot
forall (m :: (* -&gt; *) -&gt; * -&gt; *) s a.
(MonadTrans m, Monad (m (Decoder s))) =&gt;
Text -&gt; (a -&gt; Int) -&gt; m (Decoder s) a -&gt; m (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeRecordNamedT"><span class="hs-identifier hs-var">decodeRecordNamedT</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SnapShot&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SnapShot -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT (Share SnapShot) (Decoder s) SnapShot
 -&gt; StateT (Share SnapShot) (Decoder s) SnapShot)
-&gt; StateT (Share SnapShot) (Decoder s) SnapShot
-&gt; StateT (Share SnapShot) (Decoder s) SnapShot
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621679464313"><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464313"><span class="hs-identifier hs-var">ssStake</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens'
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Share Stake)
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Decoder s)
     Stake
forall b bs s.
DecShareCBOR b =&gt;
Lens' bs (Share b) -&gt; StateT bs (Decoder s) b
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusLensCBOR"><span class="hs-identifier hs-var">decSharePlusLensCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">(Share Stake -&gt; f (Share Stake))
-&gt; (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
-&gt; f (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
(Interns (Credential 'Staking)
 -&gt; f (Interns (Credential 'Staking)))
-&gt; (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
-&gt; f (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens'
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Share Stake)
Lens
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Interns (Credential 'Staking))
  (Interns (Credential 'Staking))
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Internal.html#_1"><span class="hs-identifier hs-var">_1</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621679464318"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464318"><span class="hs-identifier hs-var">ssDelegations</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Decoder s)
  (VMap VB VB (Credential 'Staking) (KeyHash 'StakePool))
StateT
  (Share (VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)))
  (Decoder s)
  (VMap VB VB (Credential 'Staking) (KeyHash 'StakePool))
forall s.
StateT
  (Share (VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)))
  (Decoder s)
  (VMap VB VB (Credential 'Staking) (KeyHash 'StakePool))
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusCBOR"><span class="hs-identifier hs-var">decSharePlusCBOR</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679464319"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="#local-6989586621679464319"><span class="hs-identifier hs-var">ssPoolParams</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Lens'
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Share (VMap VB VB (KeyHash 'StakePool) PoolParams))
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Decoder s)
     (VMap VB VB (KeyHash 'StakePool) PoolParams)
forall b bs s.
DecShareCBOR b =&gt;
Lens' bs (Share b) -&gt; StateT bs (Decoder s) b
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusLensCBOR"><span class="hs-identifier hs-var">decSharePlusLensCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Lens'
  (Interns (KeyHash 'StakePool), Interns PoolParams)
  (Interns (KeyHash 'StakePool))
-&gt; Lens'
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Interns (KeyHash 'StakePool))
-&gt; Lens'
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Interns (KeyHash 'StakePool), Interns PoolParams)
forall a b c. Monoid a =&gt; Lens' a b -&gt; Lens' c b -&gt; Lens' c a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#toMemptyLens"><span class="hs-identifier hs-var">toMemptyLens</span></a></span><span> </span><span class="annot"><span class="annottext">(Interns (KeyHash 'StakePool) -&gt; f (Interns (KeyHash 'StakePool)))
-&gt; (Interns (KeyHash 'StakePool), Interns PoolParams)
-&gt; f (Interns (KeyHash 'StakePool), Interns PoolParams)
forall s t a b. Field1 s t a b =&gt; Lens s t a b
Lens'
  (Interns (KeyHash 'StakePool), Interns PoolParams)
  (Interns (KeyHash 'StakePool))
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Internal.html#_1"><span class="hs-identifier hs-var">_1</span></a></span><span> </span><span class="annot"><span class="annottext">(Interns (KeyHash 'StakePool) -&gt; f (Interns (KeyHash 'StakePool)))
-&gt; (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
-&gt; f (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
forall s t a b. Field2 s t a b =&gt; Lens s t a b
Lens'
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Interns (KeyHash 'StakePool))
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Internal.html#_2"><span class="hs-identifier hs-var">_2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">SnapShot
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Decoder s)
     SnapShot
forall a.
a
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Decoder s)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">Stake
$sel:ssStake:SnapShot :: Stake
ssStake :: Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssStake</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
$sel:ssDelegations:SnapShot :: VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
ssDelegations :: VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssDelegations</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
$sel:ssPoolParams:SnapShot :: VMap VB VB (KeyHash 'StakePool) PoolParams
ssPoolParams :: VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var hs-var">ssPoolParams</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#ToKeyValuePairs"><span class="hs-identifier hs-type">ToKeyValuePairs</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-210"></span><span>  </span><span id="local-6989586621679464352"><span class="annot"><span class="annottext">toKeyValuePairs :: forall e kv. KeyValue e kv =&gt; SnapShot -&gt; [kv]
</span><a href="#local-6989586621679464352"><span class="hs-identifier hs-var hs-var hs-var hs-var">toKeyValuePairs</span></a></span></span><span> </span><span id="local-6989586621679464354"><span class="annot"><span class="annottext">ss :: SnapShot
</span><a href="#local-6989586621679464354"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679464355"><span id="local-6989586621679464356"><span id="local-6989586621679464357"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
Stake
$sel:ssStake:SnapShot :: SnapShot -&gt; Stake
$sel:ssDelegations:SnapShot :: SnapShot -&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
$sel:ssPoolParams:SnapShot :: SnapShot -&gt; VMap VB VB (KeyHash 'StakePool) PoolParams
ssStake :: Stake
ssDelegations :: VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
ssPoolParams :: VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464354"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-212"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;stake&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Stake -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464355"><span class="hs-identifier hs-var">ssStake</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;delegations&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool) -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464356"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;poolParams&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; VMap VB VB (KeyHash 'StakePool) PoolParams -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="#local-6989586621679464357"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Snapshots of the stake distribution.</span><span>
</span><span id="line-218"></span><span class="hs-comment">--</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- Note that ssStakeMark and ssStakeMarkPoolDistr are lazy on</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- purpose since we only want to force the thunk after one stability window</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- when we know that they are stable (so that we do not compute them if we do not have to).</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- See more info in the [Optimize TICKF ADR](https://github.com/intersectmbo/cardano-ledger/blob/master/docs/adr/2022-12-12_007-optimize-ledger-view.md)</span><span>
</span><span id="line-223"></span><span class="hs-keyword">data</span><span> </span><span id="SnapShots"><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-var">SnapShots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SnapShots"><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-var">SnapShots</span></a></span></span><span>
</span><span id="line-224"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="%24sel%3AssStakeMark%3ASnapShots"><span class="annot"><span class="annottext">SnapShots -&gt; SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-comment">-- Lazy on purpose</span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="annot"><span class="annottext">SnapShots -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistr</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span> </span><span class="hs-comment">-- Lazy on purpose</span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssStakeSet%3ASnapShots"><span class="annot"><span class="annottext">SnapShots -&gt; SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-227"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssStakeGo%3ASnapShots"><span class="annot"><span class="annottext">SnapShots -&gt; SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="%24sel%3AssFee%3ASnapShots"><span class="annot"><span class="annottext">SnapShots -&gt; Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464365"><span id="local-6989586621679464375"><span id="local-6989586621679464379"><span class="annot"><span class="annottext">Int -&gt; SnapShots -&gt; ShowS
[SnapShots] -&gt; ShowS
SnapShots -&gt; String
(Int -&gt; SnapShots -&gt; ShowS)
-&gt; (SnapShots -&gt; String)
-&gt; ([SnapShots] -&gt; ShowS)
-&gt; Show SnapShots
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; SnapShots -&gt; ShowS
showsPrec :: Int -&gt; SnapShots -&gt; ShowS
$cshow :: SnapShots -&gt; String
show :: SnapShots -&gt; String
$cshowList :: [SnapShots] -&gt; ShowS
showList :: [SnapShots] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464382"><span id="local-6989586621679464391"><span class="annot"><span class="annottext">SnapShots -&gt; SnapShots -&gt; Bool
(SnapShots -&gt; SnapShots -&gt; Bool)
-&gt; (SnapShots -&gt; SnapShots -&gt; Bool) -&gt; Eq SnapShots
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: SnapShots -&gt; SnapShots -&gt; Bool
== :: SnapShots -&gt; SnapShots -&gt; Bool
$c/= :: SnapShots -&gt; SnapShots -&gt; Bool
/= :: SnapShots -&gt; SnapShots -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464395"><span id="local-6989586621679464397"><span class="annot"><span class="annottext">(forall x. SnapShots -&gt; Rep SnapShots x)
-&gt; (forall x. Rep SnapShots x -&gt; SnapShots) -&gt; Generic SnapShots
forall x. Rep SnapShots x -&gt; SnapShots
forall x. SnapShots -&gt; Rep SnapShots x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. SnapShots -&gt; Rep SnapShots x
from :: forall x. SnapShots -&gt; Rep SnapShots x
$cto :: forall x. Rep SnapShots x -&gt; SnapShots
to :: forall x. Rep SnapShots x -&gt; SnapShots
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464400"><span id="local-6989586621679464405"><span id="local-6989586621679464410"><span id="local-6989586621679464415"><span id="local-6989586621679464420"><span class="annot"><span class="annottext">[SnapShots] -&gt; Value
[SnapShots] -&gt; Encoding
SnapShots -&gt; Bool
SnapShots -&gt; Value
SnapShots -&gt; Encoding
(SnapShots -&gt; Value)
-&gt; (SnapShots -&gt; Encoding)
-&gt; ([SnapShots] -&gt; Value)
-&gt; ([SnapShots] -&gt; Encoding)
-&gt; (SnapShots -&gt; Bool)
-&gt; ToJSON SnapShots
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; (a -&gt; Bool)
-&gt; ToJSON a
$ctoJSON :: SnapShots -&gt; Value
toJSON :: SnapShots -&gt; Value
$ctoEncoding :: SnapShots -&gt; Encoding
toEncoding :: SnapShots -&gt; Encoding
$ctoJSONList :: [SnapShots] -&gt; Value
toJSONList :: [SnapShots] -&gt; Value
$ctoEncodingList :: [SnapShots] -&gt; Encoding
toEncodingList :: [SnapShots] -&gt; Encoding
$comitField :: SnapShots -&gt; Bool
omitField :: SnapShots -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#KeyValuePairs"><span class="hs-identifier hs-type">KeyValuePairs</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-comment">-- TODO: switch `AllowThunksIn` to `OnlyCheckWhnfNamed`</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679464427"><span id="local-6989586621679464436"><span id="local-6989586621679464444"><span class="annot"><span class="annottext">Context -&gt; SnapShots -&gt; IO (Maybe ThunkInfo)
Proxy SnapShots -&gt; String
(Context -&gt; SnapShots -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; SnapShots -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy SnapShots -&gt; String)
-&gt; NoThunks SnapShots
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: Context -&gt; SnapShots -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; SnapShots -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: Context -&gt; SnapShots -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; SnapShots -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: Proxy SnapShots -&gt; String
showTypeOf :: Proxy SnapShots -&gt; String
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#AllowThunksIn"><span class="hs-identifier hs-type">AllowThunksIn</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="annot"><span class="hs-string">&quot;ssStakeMark&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-string">&quot;ssStakeMarkPoolDistr&quot;</span></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464556"><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464584"><span id="local-6989586621679464588"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-type">EncCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-238"></span><span>  </span><span id="local-6989586621679464599"><span class="annot"><span class="annottext">encCBOR :: SnapShots -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679464600"><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeMark:SnapShots :: SnapShots -&gt; SnapShot
ssStakeMark :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464601"><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeSet:SnapShots :: SnapShots -&gt; SnapShot
ssStakeSet :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464602"><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeGo:SnapShots :: SnapShots -&gt; SnapShot
ssStakeGo :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464603"><span class="annot"><span class="annottext">Coin
$sel:ssFee:SnapShots :: SnapShots -&gt; Coin
ssFee :: Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="annottext">Word -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.Encoder.html#encodeListLen"><span class="hs-identifier hs-var">encodeListLen</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">4</span></span><span>
</span><span id="line-240"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464600"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-comment">-- We intentionaly do not serialize the redundant ssStakeMarkPoolDistr</span><span>
</span><span id="line-242"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464601"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span>
</span><span id="line-243"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464602"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span>
</span><span id="line-244"></span><span>      </span><span class="annot"><span class="annottext">Encoding -&gt; Encoding -&gt; Encoding
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464603"><span class="hs-identifier hs-var">ssFee</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464608"><span id="local-6989586621679464612"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>  </span><span id="local-6989586621679464617"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s SnapShots
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decoder s SnapShots
forall a s. DecShareCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decNoShareCBOR"><span class="hs-identifier hs-var">decNoShareCBOR</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679464622"><span id="local-6989586621679464625"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#DecShareCBOR"><span class="hs-identifier hs-type">DecShareCBOR</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Share"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Share"><span class="hs-identifier hs-var">Share</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Share"><span class="hs-identifier hs-type">Share</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621679464650"><span class="annot"><span class="annottext">decSharePlusCBOR :: forall s. StateT (Share SnapShots) (Decoder s) SnapShots
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusCBOR"><span class="hs-identifier hs-var hs-var hs-var hs-var">decSharePlusCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; (SnapShots -&gt; Int)
-&gt; StateT (Share SnapShots) (Decoder s) SnapShots
-&gt; StateT (Share SnapShots) (Decoder s) SnapShots
forall (m :: (* -&gt; *) -&gt; * -&gt; *) s a.
(MonadTrans m, Monad (m (Decoder s))) =&gt;
Text -&gt; (a -&gt; Int) -&gt; m (Decoder s) a -&gt; m (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeRecordNamedT"><span class="hs-identifier hs-var">decodeRecordNamedT</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;SnapShots&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SnapShots -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT (Share SnapShots) (Decoder s) SnapShots
 -&gt; StateT (Share SnapShots) (Decoder s) SnapShots)
-&gt; StateT (Share SnapShots) (Decoder s) SnapShots
-&gt; StateT (Share SnapShots) (Decoder s) SnapShots
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-glyph">!</span><span id="local-6989586621679464651"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464651"><span class="hs-identifier hs-var">ssStakeMark</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Decoder s)
  SnapShot
StateT (Share SnapShot) (Decoder s) SnapShot
forall s. StateT (Share SnapShot) (Decoder s) SnapShot
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusCBOR"><span class="hs-identifier hs-var">decSharePlusCBOR</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621679464652"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464652"><span class="hs-identifier hs-var">ssStakeSet</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Decoder s)
  SnapShot
StateT (Share SnapShot) (Decoder s) SnapShot
forall s. StateT (Share SnapShot) (Decoder s) SnapShot
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusCBOR"><span class="hs-identifier hs-var">decSharePlusCBOR</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679464653"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464653"><span class="hs-identifier hs-var">ssStakeGo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
  (Decoder s)
  SnapShot
StateT (Share SnapShot) (Decoder s) SnapShot
forall s. StateT (Share SnapShot) (Decoder s) SnapShot
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusCBOR"><span class="hs-identifier hs-var">decSharePlusCBOR</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679464654"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464654"><span class="hs-identifier hs-var">ssFee</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s Coin
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Decoder s)
     Coin
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool)) m a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">Decoder s Coin
forall s. Decoder s Coin
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679464655"><span class="annot"><span class="annottext">ssStakeMarkPoolDistr :: PoolDistr
</span><a href="#local-6989586621679464655"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr"><span class="hs-identifier hs-var">calculatePoolDistr</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464651"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">SnapShots
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Decoder s)
     SnapShots
forall a.
a
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool))
     (Decoder s)
     a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeMark:SnapShots :: SnapShot
ssStakeMark :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PoolDistr
$sel:ssStakeMarkPoolDistr:SnapShots :: PoolDistr
ssStakeMarkPoolDistr :: PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeSet:SnapShots :: SnapShot
ssStakeSet :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeGo:SnapShots :: SnapShot
ssStakeGo :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coin
$sel:ssFee:SnapShots :: Coin
ssFee :: Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-type">Default</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>  </span><span id="local-6989586621679464659"><span class="annot"><span class="annottext">def :: SnapShots
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var hs-var hs-var hs-var">def</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShots
</span><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShots"><span class="hs-identifier hs-var">emptySnapShots</span></a></span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Cardano.Ledger.BaseTypes.html#ToKeyValuePairs"><span class="hs-identifier hs-type">ToKeyValuePairs</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>  </span><span id="local-6989586621679464675"><span class="annot"><span class="annottext">toKeyValuePairs :: forall e kv. KeyValue e kv =&gt; SnapShots -&gt; [kv]
</span><a href="Cardano.Ledger.BaseTypes.html#toKeyValuePairs"><span class="hs-identifier hs-var hs-var hs-var hs-var">toKeyValuePairs</span></a></span></span><span> </span><span id="local-6989586621679464676"><span class="annot"><span class="annottext">ss :: SnapShots
</span><a href="#local-6989586621679464676"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-glyph">!</span><span class="annot"><span class="annottext">SnapShot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PoolDistr
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>    </span><span class="hs-comment">-- ssStakeMarkPoolDistr is omitted on purpose</span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679464677"><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeMark:SnapShots :: SnapShots -&gt; SnapShot
ssStakeMark :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeMark</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464678"><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeSet:SnapShots :: SnapShots -&gt; SnapShot
ssStakeSet :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeSet</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464679"><span class="annot"><span class="annottext">SnapShot
$sel:ssStakeGo:SnapShots :: SnapShots -&gt; SnapShot
ssStakeGo :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssStakeGo</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679464680"><span class="annot"><span class="annottext">Coin
$sel:ssFee:SnapShots :: SnapShots -&gt; Coin
ssFee :: Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var hs-var">ssFee</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464676"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-266"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;pstakeMark&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SnapShot -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464677"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;pstakeSet&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SnapShot -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464678"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;pstakeGo&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; SnapShot -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464679"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;feeSS&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Coin -&gt; kv
forall v. ToJSON v =&gt; Key -&gt; v -&gt; kv
forall e kv v. (KeyValue e kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464680"><span class="hs-identifier hs-var">ssFee</span></a></span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShot"><span class="hs-identifier hs-type">emptySnapShot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-273"></span><span id="emptySnapShot"><span class="annot"><span class="annottext">emptySnapShot :: SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShot"><span class="hs-identifier hs-var hs-var">emptySnapShot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stake
-&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; VMap VB VB (KeyHash 'StakePool) PoolParams
-&gt; SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-var">SnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin) -&gt; Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-var">Stake</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#empty"><span class="hs-identifier hs-var">VMap.empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#empty"><span class="hs-identifier hs-var">VMap.empty</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#empty"><span class="hs-identifier hs-var">VMap.empty</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShots"><span class="hs-identifier hs-type">emptySnapShots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span>
</span><span id="line-276"></span><span id="emptySnapShots"><span class="annot"><span class="annottext">emptySnapShots :: SnapShots
</span><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShots"><span class="hs-identifier hs-var hs-var">emptySnapShots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-277"></span><span>  </span><span class="annot"><span class="annottext">SnapShot -&gt; PoolDistr -&gt; SnapShot -&gt; SnapShot -&gt; Coin -&gt; SnapShots
</span><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-var">SnapShots</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SnapShot -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr"><span class="hs-identifier hs-var">calculatePoolDistr</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#emptySnapShot"><span class="hs-identifier hs-var">emptySnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- =======================================</span><span>
</span><span id="line-280"></span><span>
</span><span id="line-281"></span><span class="annot"><span class="hs-comment">-- | Sum up the Coin (as CompactForm Coin = Word64) for each StakePool</span></span><span>
</span><span id="line-282"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolStake"><span class="hs-identifier hs-type">calculatePoolStake</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-283"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word64</span></span><span>
</span><span id="line-287"></span><span id="calculatePoolStake"><span class="annot"><span class="annottext">calculatePoolStake :: (KeyHash 'StakePool -&gt; Bool)
-&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; Stake
-&gt; Map (KeyHash 'StakePool) Word64
</span><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolStake"><span class="hs-identifier hs-var hs-var">calculatePoolStake</span></a></span></span><span> </span><span id="local-6989586621679464683"><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; Bool
</span><a href="#local-6989586621679464683"><span class="hs-identifier hs-var">includeHash</span></a></span></span><span> </span><span id="local-6989586621679464684"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464684"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span id="local-6989586621679464685"><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464685"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool) Word64
 -&gt; Credential 'Staking
 -&gt; KeyHash 'StakePool
 -&gt; Map (KeyHash 'StakePool) Word64)
-&gt; Map (KeyHash 'StakePool) Word64
-&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; Map (KeyHash 'StakePool) Word64
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v a.
(Vector kv k, Vector vv v) =&gt;
(a -&gt; k -&gt; v -&gt; a) -&gt; a -&gt; VMap kv vv k v -&gt; a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#foldlWithKey"><span class="hs-identifier hs-var">VMap.foldlWithKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Word64
-&gt; Credential 'Staking
-&gt; KeyHash 'StakePool
-&gt; Map (KeyHash 'StakePool) Word64
</span><a href="#local-6989586621679464686"><span class="hs-identifier hs-var">accum</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Word64
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464684"><span class="hs-identifier hs-var">delegs</span></a></span><span>
</span><span id="line-288"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679464686"><span class="annot"><span class="annottext">accum :: Map (KeyHash 'StakePool) Word64
-&gt; Credential 'Staking
-&gt; KeyHash 'StakePool
-&gt; Map (KeyHash 'StakePool) Word64
</span><a href="#local-6989586621679464686"><span class="hs-identifier hs-var hs-var">accum</span></a></span></span><span> </span><span id="local-6989586621679464687"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Word64
</span><a href="#local-6989586621679464687"><span class="hs-identifier hs-var">ans</span></a></span></span><span> </span><span id="local-6989586621679464688"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679464688"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621679464689"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679464689"><span class="hs-identifier hs-var">keyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; Bool
</span><a href="#local-6989586621679464683"><span class="hs-identifier hs-var">includeHash</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679464689"><span class="hs-identifier hs-var">keyHash</span></a></span><span>
</span><span id="line-291"></span><span>        </span><span class="hs-keyword">then</span><span>
</span><span id="line-292"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679464691"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679464691"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Maybe (CompactForm Coin) -&gt; CompactForm Coin
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">CompactForm Coin
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (CompactForm Coin) -&gt; CompactForm Coin)
-&gt; Maybe (CompactForm Coin) -&gt; CompactForm Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
-&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
-&gt; Maybe (CompactForm Coin)
forall k (kv :: * -&gt; *) (vv :: * -&gt; *) v.
(Ord k, Vector kv k, Vector vv v) =&gt;
k -&gt; VMap kv vv k v -&gt; Maybe v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#lookup"><span class="hs-identifier hs-var">VMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679464688"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464685"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; Word64 -&gt; Word64)
-&gt; KeyHash 'StakePool
-&gt; Word64
-&gt; Map (KeyHash 'StakePool) Word64
-&gt; Map (KeyHash 'StakePool) Word64
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(+)</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679464689"><span class="hs-identifier hs-var">keyHash</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679464691"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Word64
</span><a href="#local-6989586621679464687"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-294"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Word64
</span><a href="#local-6989586621679464687"><span class="hs-identifier hs-var">ans</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr"><span class="hs-identifier hs-type">calculatePoolDistr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span>
</span><span id="line-297"></span><span id="calculatePoolDistr"><span class="annot"><span class="annottext">calculatePoolDistr :: SnapShot -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr"><span class="hs-identifier hs-var hs-var">calculatePoolDistr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool -&gt; Bool) -&gt; SnapShot -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr%27"><span class="hs-identifier hs-var">calculatePoolDistr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; KeyHash 'StakePool -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>
</span><span id="line-299"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr%27"><span class="hs-identifier hs-type">calculatePoolDistr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span>
</span><span id="line-300"></span><span id="calculatePoolDistr%27"><span class="annot"><span class="annottext">calculatePoolDistr' :: (KeyHash 'StakePool -&gt; Bool) -&gt; SnapShot -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolDistr%27"><span class="hs-identifier hs-var hs-var">calculatePoolDistr'</span></a></span></span><span> </span><span id="local-6989586621679464692"><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; Bool
</span><a href="#local-6989586621679464692"><span class="hs-identifier hs-var">includeHash</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span id="local-6989586621679464693"><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464693"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span id="local-6989586621679464694"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464694"><span class="hs-identifier hs-var">delegs</span></a></span></span><span> </span><span id="local-6989586621679464695"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="#local-6989586621679464695"><span class="hs-identifier hs-var">poolParams</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679464696"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679464696"><span class="hs-identifier hs-var">total</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stake -&gt; CompactForm Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#sumAllStakeCompact"><span class="hs-identifier hs-var">sumAllStakeCompact</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464693"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-comment">-- total could be zero (in particular when shrinking)</span><span>
</span><span id="line-303"></span><span>      </span><span id="local-6989586621679464697"><span class="annot"><span class="annottext">nonZeroTotalCompact :: NonZero (CompactForm Coin)
</span><a href="#local-6989586621679464697"><span class="hs-identifier hs-var hs-var">nonZeroTotalCompact</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonZero Word64 -&gt; NonZero (CompactForm Coin)
</span><a href="Cardano.Ledger.Coin.html#compactCoinNonZero"><span class="hs-identifier hs-var">compactCoinNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">(NonZero Word64 -&gt; NonZero (CompactForm Coin))
-&gt; NonZero Word64 -&gt; NonZero (CompactForm Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679464696"><span class="hs-identifier hs-var">total</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; NonZero Word64 -&gt; NonZero Word64
forall a. HasZero a =&gt; a -&gt; NonZero a -&gt; NonZero a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#nonZeroOr"><span class="hs-operator hs-var">`nonZeroOr`</span></a></span><span> </span><span class="annot"><span class="annottext">forall (n :: Natural) a.
(KnownNat n, 1 &lt;= n, WithinBounds n a, Num a) =&gt;
NonZero a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#knownNonZeroBounded"><span class="hs-identifier hs-var">knownNonZeroBounded</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">1</span></span><span>
</span><span id="line-304"></span><span>      </span><span id="local-6989586621679464698"><span class="annot"><span class="annottext">nonZeroTotalInteger :: NonZero Integer
</span><a href="#local-6989586621679464698"><span class="hs-identifier hs-var hs-var">nonZeroTotalInteger</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonZero Coin -&gt; NonZero Integer
</span><a href="Cardano.Ledger.Coin.html#unCoinNonZero"><span class="hs-identifier hs-var">unCoinNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">(NonZero Coin -&gt; NonZero Integer)
-&gt; NonZero Coin -&gt; NonZero Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonZero (CompactForm Coin) -&gt; NonZero Coin
</span><a href="Cardano.Ledger.Coin.html#fromCompactCoinNonZero"><span class="hs-identifier hs-var">fromCompactCoinNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero (CompactForm Coin)
</span><a href="#local-6989586621679464697"><span class="hs-identifier hs-var">nonZeroTotalCompact</span></a></span><span>
</span><span id="line-305"></span><span>      </span><span id="local-6989586621679464699"><span class="annot"><span class="annottext">poolStakeMap :: Map (KeyHash 'StakePool) Word64
</span><a href="#local-6989586621679464699"><span class="hs-identifier hs-var hs-var">poolStakeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'StakePool -&gt; Bool)
-&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
-&gt; Stake
-&gt; Map (KeyHash 'StakePool) Word64
</span><a href="Cardano.Ledger.State.SnapShots.html#calculatePoolStake"><span class="hs-identifier hs-var">calculatePoolStake</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; Bool
</span><a href="#local-6989586621679464692"><span class="hs-identifier hs-var">includeHash</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464694"><span class="hs-identifier hs-var">delegs</span></a></span><span> </span><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464693"><span class="hs-identifier hs-var">stake</span></a></span><span>
</span><span id="line-306"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) IndividualPoolStake
-&gt; CompactForm Coin -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-var">PoolDistr</span></a></span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">(Word64 -&gt; PoolParams -&gt; IndividualPoolStake)
-&gt; Map (KeyHash 'StakePool) Word64
-&gt; Map (KeyHash 'StakePool) PoolParams
-&gt; Map (KeyHash 'StakePool) IndividualPoolStake
forall k a b c.
Ord k =&gt;
(a -&gt; b -&gt; c) -&gt; Map k a -&gt; Map k b -&gt; Map k c
</span><span class="hs-identifier hs-var">Map.intersectionWith</span></span><span>
</span><span id="line-308"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679464702"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679464702"><span class="hs-identifier hs-var">word64</span></a></span></span><span> </span><span id="local-6989586621679464703"><span class="annot"><span class="annottext">PoolParams
</span><a href="#local-6989586621679464703"><span class="hs-identifier hs-var">poolparam</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-309"></span><span>                </span><span class="annot"><span class="annottext">Rational
-&gt; CompactForm Coin
-&gt; VRFVerKeyHash 'StakePoolVRF
-&gt; IndividualPoolStake
</span><a href="Cardano.Ledger.State.PoolDistr.html#IndividualPoolStake"><span class="hs-identifier hs-var">IndividualPoolStake</span></a></span><span>
</span><span id="line-310"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679464702"><span class="hs-identifier hs-var">word64</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; NonZero Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; NonZero a -&gt; Ratio a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#%25."><span class="hs-operator hs-var">%.</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero Integer
</span><a href="#local-6989586621679464698"><span class="hs-identifier hs-var">nonZeroTotalInteger</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-311"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; CompactForm Coin
</span><a href="Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-var">CompactCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679464702"><span class="hs-identifier hs-var">word64</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolParams -&gt; VRFVerKeyHash 'StakePoolVRF
</span><a href="Cardano.Ledger.State.StakePool.html#ppVrf"><span class="hs-identifier hs-var">ppVrf</span></a></span><span> </span><span class="annot"><span class="annottext">PoolParams
</span><a href="#local-6989586621679464703"><span class="hs-identifier hs-var">poolparam</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-314"></span><span>            </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Word64
</span><a href="#local-6989586621679464699"><span class="hs-identifier hs-var">poolStakeMap</span></a></span><span>
</span><span id="line-315"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
-&gt; Map (KeyHash 'StakePool) PoolParams
forall (kv :: * -&gt; *) k (vv :: * -&gt; *) v.
(Vector kv k, Vector vv v) =&gt;
VMap kv vv k v -&gt; Map k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#toMap"><span class="hs-identifier hs-var">VMap.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="#local-6989586621679464695"><span class="hs-identifier hs-var">poolParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-316"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonZero (CompactForm Coin) -&gt; CompactForm Coin
forall a. NonZero a -&gt; a
</span><a href="Cardano.Ledger.BaseTypes.NonZero.html#unNonZero"><span class="hs-identifier hs-var">unNonZero</span></a></span><span> </span><span class="annot"><span class="annottext">NonZero (CompactForm Coin)
</span><a href="#local-6989586621679464697"><span class="hs-identifier hs-var">nonZeroTotalCompact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- ======================================================</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- Lenses</span><span>
</span><span id="line-321"></span><span class="hs-comment">-- ===============================================</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span class="hs-comment">-- SnapShots</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeMarkL"><span class="hs-identifier hs-type">ssStakeMarkL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-326"></span><span id="ssStakeMarkL"><span class="annot"><span class="annottext">ssStakeMarkL :: Lens' SnapShots SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#ssStakeMarkL"><span class="hs-identifier hs-var hs-var">ssStakeMarkL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots -&gt; SnapShot)
-&gt; (SnapShots -&gt; SnapShot -&gt; SnapShots) -&gt; Lens' SnapShots SnapShot
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShots -&gt; SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464708"><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464708"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464709"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464709"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464708"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMark%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMark</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464709"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeMarkPoolDistrL"><span class="hs-identifier hs-type">ssStakeMarkPoolDistrL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span>
</span><span id="line-329"></span><span id="ssStakeMarkPoolDistrL"><span class="annot"><span class="annottext">ssStakeMarkPoolDistrL :: Lens' SnapShots PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#ssStakeMarkPoolDistrL"><span class="hs-identifier hs-var hs-var">ssStakeMarkPoolDistrL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots -&gt; PoolDistr)
-&gt; (SnapShots -&gt; PoolDistr -&gt; SnapShots)
-&gt; Lens' SnapShots PoolDistr
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShots -&gt; PoolDistr
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMarkPoolDistr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464712"><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464712"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464713"><span class="annot"><span class="annottext">PoolDistr
</span><a href="#local-6989586621679464713"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464712"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeMarkPoolDistr%3ASnapShots"><span class="hs-identifier hs-var">ssStakeMarkPoolDistr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464713"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeSetL"><span class="hs-identifier hs-type">ssStakeSetL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-332"></span><span id="ssStakeSetL"><span class="annot"><span class="annottext">ssStakeSetL :: Lens' SnapShots SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#ssStakeSetL"><span class="hs-identifier hs-var hs-var">ssStakeSetL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots -&gt; SnapShot)
-&gt; (SnapShots -&gt; SnapShot -&gt; SnapShots) -&gt; Lens' SnapShots SnapShot
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShots -&gt; SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464716"><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464716"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464717"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464717"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464716"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeSet%3ASnapShots"><span class="hs-identifier hs-var">ssStakeSet</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464717"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeGoL"><span class="hs-identifier hs-type">ssStakeGoL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span>
</span><span id="line-335"></span><span id="ssStakeGoL"><span class="annot"><span class="annottext">ssStakeGoL :: Lens' SnapShots SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#ssStakeGoL"><span class="hs-identifier hs-var hs-var">ssStakeGoL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots -&gt; SnapShot)
-&gt; (SnapShots -&gt; SnapShot -&gt; SnapShots) -&gt; Lens' SnapShots SnapShot
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShots -&gt; SnapShot
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464720"><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464720"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464721"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464721"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464720"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStakeGo%3ASnapShots"><span class="hs-identifier hs-var">ssStakeGo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464721"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssFeeL"><span class="hs-identifier hs-type">ssFeeL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShots"><span class="hs-identifier hs-type">SnapShots</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span>
</span><span id="line-338"></span><span id="ssFeeL"><span class="annot"><span class="annottext">ssFeeL :: Lens' SnapShots Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#ssFeeL"><span class="hs-identifier hs-var hs-var">ssFeeL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShots -&gt; Coin)
-&gt; (SnapShots -&gt; Coin -&gt; SnapShots) -&gt; Lens' SnapShots Coin
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShots -&gt; Coin
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var">ssFee</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464724"><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464724"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464725"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679464725"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShots
</span><a href="#local-6989586621679464724"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssFee%3ASnapShots"><span class="hs-identifier hs-var">ssFee</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464725"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-comment">-- SnapShot</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeL"><span class="hs-identifier hs-type">ssStakeL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span>
</span><span id="line-343"></span><span id="ssStakeL"><span class="annot"><span class="annottext">ssStakeL :: Lens' SnapShot Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#ssStakeL"><span class="hs-identifier hs-var hs-var">ssStakeL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot -&gt; Stake)
-&gt; (SnapShot -&gt; Stake -&gt; SnapShot) -&gt; Lens' SnapShot Stake
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464728"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464728"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464729"><span class="annot"><span class="annottext">Stake
</span><a href="#local-6989586621679464729"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464728"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464729"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssStakeDistrL"><span class="hs-identifier hs-type">ssStakeDistrL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VP"><span class="hs-identifier hs-type">VP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span id="ssStakeDistrL"><span class="annot"><span class="annottext">ssStakeDistrL :: Lens'
  SnapShot (VMap VB VP (Credential 'Staking) (CompactForm Coin))
</span><a href="Cardano.Ledger.State.SnapShots.html#ssStakeDistrL"><span class="hs-identifier hs-var hs-var">ssStakeDistrL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin))
-&gt; (SnapShot
    -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin) -&gt; SnapShot)
-&gt; Lens'
     SnapShot (VMap VB VP (Credential 'Staking) (CompactForm Coin))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AunStake%3AStake"><span class="hs-identifier hs-var">unStake</span></a></span><span> </span><span class="annot"><span class="annottext">(Stake -&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin))
-&gt; (SnapShot -&gt; Stake)
-&gt; SnapShot
-&gt; VMap VB VP (Credential 'Staking) (CompactForm Coin)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; Stake
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464732"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464732"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464733"><span class="annot"><span class="annottext">VMap VB VP (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679464733"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464732"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssStake%3ASnapShot"><span class="hs-identifier hs-var">ssStake</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#Stake"><span class="hs-identifier hs-type">Stake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679464733"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>
</span><span id="line-348"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssDelegationsL"><span class="hs-identifier hs-type">ssDelegationsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span id="ssDelegationsL"><span class="annot"><span class="annottext">ssDelegationsL :: Lens'
  SnapShot (VMap VB VB (Credential 'Staking) (KeyHash 'StakePool))
</span><a href="Cardano.Ledger.State.SnapShots.html#ssDelegationsL"><span class="hs-identifier hs-var hs-var">ssDelegationsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot -&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool))
-&gt; (SnapShot
    -&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
    -&gt; SnapShot)
-&gt; Lens'
     SnapShot (VMap VB VB (Credential 'Staking) (KeyHash 'StakePool))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464736"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464736"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464737"><span class="annot"><span class="annottext">VMap VB VB (Credential 'Staking) (KeyHash 'StakePool)
</span><a href="#local-6989586621679464737"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464736"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssDelegations%3ASnapShot"><span class="hs-identifier hs-var">ssDelegations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464737"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#ssPoolParamsL"><span class="hs-identifier hs-type">ssPoolParamsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#SnapShot"><span class="hs-identifier hs-type">SnapShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VMap"><span class="hs-identifier hs-type">VMap</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/vector-map-1.1.0.1/doc/html/vector-map/src/Data.VMap.html#VB"><span class="hs-identifier hs-type">VB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.State.StakePool.html#PoolParams"><span class="hs-identifier hs-type">PoolParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span id="ssPoolParamsL"><span class="annot"><span class="annottext">ssPoolParamsL :: Lens' SnapShot (VMap VB VB (KeyHash 'StakePool) PoolParams)
</span><a href="Cardano.Ledger.State.SnapShots.html#ssPoolParamsL"><span class="hs-identifier hs-var hs-var">ssPoolParamsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SnapShot -&gt; VMap VB VB (KeyHash 'StakePool) PoolParams)
-&gt; (SnapShot
    -&gt; VMap VB VB (KeyHash 'StakePool) PoolParams -&gt; SnapShot)
-&gt; Lens' SnapShot (VMap VB VB (KeyHash 'StakePool) PoolParams)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">SnapShot -&gt; VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679464740"><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464740"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span id="local-6989586621679464741"><span class="annot"><span class="annottext">VMap VB VB (KeyHash 'StakePool) PoolParams
</span><a href="#local-6989586621679464741"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SnapShot
</span><a href="#local-6989586621679464740"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.State.SnapShots.html#%24sel%3AssPoolParams%3ASnapShot"><span class="hs-identifier hs-var">ssPoolParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679464741"><span class="hs-identifier hs-type">u</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-353"></span></pre></body></html>