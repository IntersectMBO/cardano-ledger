<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DefaultSignatures #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ImplicitParams #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ImpredicativeTypes #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE OverloadedLists #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE PatternSynonyms #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilyDependencies #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-23"></span><span class="hs-pragma">{-# LANGUAGE UndecidableSuperClasses #-}</span><span>
</span><span id="line-24"></span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Cardano.Ledger.Shelley.ImpTest</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier">ImpTestM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier">LedgerSpec</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#EraSpecificSpec"><span class="hs-identifier">EraSpecificSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier">SomeSTSEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier">ImpTestState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier">ImpTestEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpException"><span class="hs-identifier">ImpException</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier">ShelleyEraImp</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Plutus.ScriptTestContext.html#PlutusArgs"><span class="hs-identifier">PlutusArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Plutus.ScriptTestContext.html#ScriptTestContext"><span class="hs-identifier">ScriptTestContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impWitsVKeyNeeded"><span class="hs-identifier">impWitsVKeyNeeded</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyPrevPParams"><span class="hs-identifier">modifyPrevPParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier">passEpoch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochs"><span class="hs-identifier">passNEpochs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochsChecking"><span class="hs-identifier">passNEpochsChecking</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passTick"><span class="hs-identifier">passTick</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr"><span class="hs-identifier">freshKeyAddr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr_"><span class="hs-identifier">freshKeyAddr_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier">freshKeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyPair"><span class="hs-identifier">freshKeyPair</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getKeyPair"><span class="hs-identifier">getKeyPair</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshByronKeyHash"><span class="hs-identifier">freshByronKeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshBootstapAddress"><span class="hs-identifier">freshBootstapAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getByronKeyPair"><span class="hs-identifier">getByronKeyPair</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshSafeHash"><span class="hs-identifier">freshSafeHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier">freshKeyHashVRF</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx"><span class="hs-identifier">submitTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx_"><span class="hs-identifier">submitTx_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn"><span class="hs-identifier">submitTxAnn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn_"><span class="hs-identifier">submitTxAnn_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTx"><span class="hs-identifier">submitFailingTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTxM"><span class="hs-identifier">submitFailingTxM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#trySubmitTx"><span class="hs-identifier">trySubmitTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impShelleyExpectTxSuccess"><span class="hs-identifier">impShelleyExpectTxSuccess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyNES"><span class="hs-identifier">modifyNES</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier">getProtVer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier">getsNES</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier">getUTxO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impAddNativeScript"><span class="hs-identifier">impAddNativeScript</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier">impAnn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnnDoc"><span class="hs-identifier">impAnnDoc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLogToExpr"><span class="hs-identifier">impLogToExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runImpRule"><span class="hs-identifier">runImpRule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule"><span class="hs-identifier">tryRunImpRule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRuleNoAssertions"><span class="hs-identifier">tryRunImpRuleNoAssertions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#delegateStake"><span class="hs-identifier">delegateStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerRewardAccount"><span class="hs-identifier">registerRewardAccount</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerStakeCredential"><span class="hs-identifier">registerStakeCredential</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getRewardAccountFor"><span class="hs-identifier">getRewardAccountFor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getReward"><span class="hs-identifier">getReward</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupReward"><span class="hs-identifier">lookupReward</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshPoolParams"><span class="hs-identifier">freshPoolParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPool"><span class="hs-identifier">registerPool</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPoolWithRewardAccount"><span class="hs-identifier">registerPoolWithRewardAccount</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerAndRetirePoolToMakeReward"><span class="hs-identifier">registerAndRetirePoolToMakeReward</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getBalance"><span class="hs-identifier">getBalance</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupBalance"><span class="hs-identifier">lookupBalance</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getAccountBalance"><span class="hs-identifier">getAccountBalance</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupAccountBalance"><span class="hs-identifier">lookupAccountBalance</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getRewardAccountAmount"><span class="hs-identifier">getRewardAccountAmount</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyFixupTx"><span class="hs-identifier">shelleyFixupTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getImpRootTxOut"><span class="hs-identifier">getImpRootTxOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo"><span class="hs-identifier">sendValueTo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo_"><span class="hs-identifier">sendValueTo_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendCoinTo"><span class="hs-identifier">sendCoinTo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendCoinTo_"><span class="hs-identifier">sendCoinTo_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectUTxOContent"><span class="hs-identifier">expectUTxOContent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectRegisteredRewardAddress"><span class="hs-identifier">expectRegisteredRewardAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectNotRegisteredRewardAddress"><span class="hs-identifier">expectNotRegisteredRewardAddress</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectTreasury"><span class="hs-identifier">expectTreasury</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableTreasuryExpansion"><span class="hs-identifier">disableTreasuryExpansion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#updateAddrTxWits"><span class="hs-identifier">updateAddrTxWits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addNativeScriptTxWits"><span class="hs-identifier">addNativeScriptTxWits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addRootTxIn"><span class="hs-identifier">addRootTxIn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupTxOuts"><span class="hs-identifier">fixupTxOuts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupFees"><span class="hs-identifier">fixupFees</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupAuxDataHash"><span class="hs-identifier">fixupAuxDataHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLookupNativeScript"><span class="hs-identifier">impLookupNativeScript</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGetUTxO"><span class="hs-identifier">impGetUTxO</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitNewEpochState"><span class="hs-identifier">defaultInitNewEpochState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitImpTestState"><span class="hs-identifier">defaultInitImpTestState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEraStartEpochNo"><span class="hs-identifier">impEraStartEpochNo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impSetSeed"><span class="hs-identifier">impSetSeed</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyModifyImpInitProtVer"><span class="hs-identifier">shelleyModifyImpInitProtVer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostSubmitTxHook"><span class="hs-identifier">modifyImpInitPostSubmitTxHook</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostSubmitTxHook"><span class="hs-identifier">disableImpInitPostSubmitTxHook</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostEpochBoundaryHook"><span class="hs-identifier">modifyImpInitPostEpochBoundaryHook</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostEpochBoundaryHook"><span class="hs-identifier">disableImpInitPostEpochBoundaryHook</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableInConformanceIt"><span class="hs-identifier">disableInConformanceIt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#minorFollow"><span class="hs-identifier">minorFollow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#majorFollow"><span class="hs-identifier">majorFollow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#cantFollow"><span class="hs-identifier">cantFollow</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersion"><span class="hs-identifier">whenMajorVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersionAtLeast"><span class="hs-identifier">whenMajorVersionAtLeast</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersionAtMost"><span class="hs-identifier">whenMajorVersionAtMost</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#unlessMajorVersion"><span class="hs-identifier">unlessMajorVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsPParams"><span class="hs-identifier">getsPParams</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withEachEraVersion"><span class="hs-identifier">withEachEraVersion</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyMNativeScripts"><span class="hs-identifier">impSatisfyMNativeScripts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfySignature"><span class="hs-identifier">impSatisfySignature</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenRegTxCert"><span class="hs-identifier">shelleyGenRegTxCert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenUnRegTxCert"><span class="hs-identifier">shelleyGenUnRegTxCert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Logging</span></span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/prettyprinter-1.7.1-318bfdf9d6702b01d9e5968bc160c179db42096d98c6a62c9b2a9c2ecaf4b7ee/share/doc/html/src/Prettyprinter.Internal.html#Doc"><span class="hs-identifier">Doc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/prettyprinter-ansi-terminal-1.1.3-a24411d18619b5d689908d5d4f76fb9930e56a7348a141a734e42bdce42c3c2c/share/doc/html/src/Prettyprinter.Render.Terminal.Internal.html#AnsiStyle"><span class="hs-identifier">AnsiStyle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logDoc"><span class="hs-identifier">logDoc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logText"><span class="hs-identifier">logText</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logString"><span class="hs-identifier">logString</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logToExpr"><span class="hs-identifier">logToExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logInstantStake"><span class="hs-identifier">logInstantStake</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logFeeMismatch"><span class="hs-identifier">logFeeMismatch</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Combinators</span></span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withCustomFixup"><span class="hs-identifier">withCustomFixup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withFixup"><span class="hs-identifier">withFixup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withNoFixup"><span class="hs-identifier">withNoFixup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withPostFixup"><span class="hs-identifier">withPostFixup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withPreFixup"><span class="hs-identifier">withPreFixup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier">impNESL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier">impGlobalsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickG"><span class="hs-identifier">impLastTickG</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairsG"><span class="hs-identifier">impKeyPairsG</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-149"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsG"><span class="hs-identifier">impNativeScriptsG</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-150"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#produceScript"><span class="hs-identifier">produceScript</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-151"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#advanceToPointOfNoReturn"><span class="hs-identifier">advanceToPointOfNoReturn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#simulateThenRestore"><span class="hs-identifier">simulateThenRestore</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>  </span><span class="annot"><span class="hs-comment">-- * ImpSpec re-exports</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier">ImpM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-156"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier">ImpInit</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.Common.html"><span class="hs-identifier">Cardano.Chain.Common</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Byron</span></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.UTxO.html"><span class="hs-identifier">Cardano.Chain.UTxO</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Byron</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.UTxO.UTxO.html#empty"><span class="hs-identifier">empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html"><span class="hs-identifier">Cardano.Ledger.Address</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-162"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier">Addr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier">BootstrapAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-164"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier">RewardAccount</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-165"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#bootstrapKeyHash"><span class="hs-identifier">bootstrapKeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BHeaderView.html"><span class="hs-identifier">Cardano.Ledger.BHeaderView</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BHeaderView.html#BHeaderView"><span class="hs-identifier">BHeaderView</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.html"><span class="hs-identifier">Cardano.Ledger.Binary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier">DecCBOR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier">EncCBOR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Block.html"><span class="hs-identifier">Cardano.Ledger.Block</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Block.html#Block"><span class="hs-identifier">Block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html"><span class="hs-identifier">Cardano.Ledger.Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier">fromCompact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier">Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Ptr"><span class="hs-identifier">Ptr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#StakeReference"><span class="hs-identifier">StakeReference</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#credToText"><span class="hs-identifier">credToText</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html"><span class="hs-identifier">Cardano.Ledger.Genesis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#EraGenesis"><span class="hs-identifier">EraGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#NoGenesis"><span class="hs-identifier">NoGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.html"><span class="hs-identifier">Cardano.Ledger.Keys</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#HasKeyRole"><span class="hs-identifier">HasKeyRole</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#asWitness"><span class="hs-identifier">asWitness</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Bootstrap.html#bootstrapWitKeyHash"><span class="hs-identifier">bootstrapWitKeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Bootstrap.html#makeBootstrapWitness"><span class="hs-identifier">makeBootstrapWitness</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.WitVKey.html#witVKeyHash"><span class="hs-identifier">witVKeyHash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-181"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.html"><span class="hs-identifier">Cardano.Ledger.Shelley</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier">ShelleyEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.API.ByronTranslation.html"><span class="hs-identifier">Cardano.Ledger.Shelley.API.ByronTranslation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.API.ByronTranslation.html#translateToShelleyLedgerStateFromUtxo"><span class="hs-identifier">translateToShelleyLedgerStateFromUtxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.AdaPots.html"><span class="hs-identifier">Cardano.Ledger.Shelley.AdaPots</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.AdaPots.html#sumAdaPots"><span class="hs-identifier">sumAdaPots</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.AdaPots.html#totalAdaPotsES"><span class="hs-identifier">totalAdaPotsES</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Core.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Core</span></a></span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Genesis</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier">ShelleyGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#describeValidationErr"><span class="hs-identifier">describeValidationErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#fromNominalDiffTimeMicro"><span class="hs-identifier">fromNominalDiffTimeMicro</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-190"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#mkShelleyGlobals"><span class="hs-identifier">mkShelleyGlobals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-191"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#validateGenesis"><span class="hs-identifier">validateGenesis</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-192"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.html"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-194"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#LedgerState"><span class="hs-identifier">LedgerState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier">NewEpochState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-196"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier">curPParamsEpochStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier">esLStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertStateL"><span class="hs-identifier">lsCertStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-199"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsUTxOStateL"><span class="hs-identifier">lsUTxOStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesELL"><span class="hs-identifier">nesELL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier">nesEsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#prevPParamsEpochStateL"><span class="hs-identifier">prevPParamsEpochStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-203"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.UTxO.html#produced"><span class="hs-identifier">produced</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#utxosDonationL"><span class="hs-identifier">utxosDonationL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-205"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Rules</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Bbody.html#BbodyEnv"><span class="hs-identifier">BbodyEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#LedgerEnv"><span class="hs-identifier">LedgerEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-209"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Bbody.html#ShelleyBbodyState"><span class="hs-identifier">ShelleyBbodyState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-210"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Deleg.html#ShelleyDelegPredFailure"><span class="hs-identifier">ShelleyDelegPredFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Pool.html#ShelleyPoolPredFailure"><span class="hs-identifier">ShelleyPoolPredFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-212"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Utxo.html#ShelleyUtxoPredFailure"><span class="hs-identifier">ShelleyUtxoPredFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Utxow.html#ShelleyUtxowPredFailure"><span class="hs-identifier">ShelleyUtxowPredFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html#epochFromSlot"><span class="hs-identifier">epochFromSlot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Scripts</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#ShelleyEraScript"><span class="hs-identifier">ShelleyEraScript</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireAllOf"><span class="hs-identifier">RequireAllOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireAnyOf"><span class="hs-identifier">RequireAnyOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireMOf"><span class="hs-identifier">RequireMOf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-keyword">pattern</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireSignature"><span class="hs-identifier">RequireSignature</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.State.html"><span class="hs-identifier">Cardano.Ledger.Shelley.State</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#balance"><span class="hs-identifier">balance</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Translation.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Translation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Translation.html#toFromByronTranslationContext"><span class="hs-identifier">toFromByronTranslationContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html"><span class="hs-identifier">Cardano.Ledger.Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html#epochInfoFirst"><span class="hs-identifier">epochInfoFirst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html#getTheSlotOfNoReturn"><span class="hs-identifier">getTheSlotOfNoReturn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Tools.html"><span class="hs-identifier">Cardano.Ledger.Tools</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Tools.html#calcMinFeeTxNativeScriptWits"><span class="hs-identifier">calcMinFeeTxNativeScriptWits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Tools.html#ensureMinCoinTxOut"><span class="hs-identifier">ensureMinCoinTxOut</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html"><span class="hs-identifier">Cardano.Ledger.TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxId"><span class="hs-identifier">TxId</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#Val"><span class="hs-identifier">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.EpochInfo.html"><span class="hs-identifier">Cardano.Slotting.EpochInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.EpochInfo.Impl.html#fixedEpochInfo"><span class="hs-identifier">fixedEpochInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Time.html"><span class="hs-identifier">Cardano.Slotting.Time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Time.html#mkSlotLength"><span class="hs-identifier">mkSlotLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">)</span><span>
</span><span id="line-235"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.IO.Class</span></span><span>
</span><span id="line-236"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalStateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/FailT-0.1.2.0-a6bfc8b1703d475e2ae00d40307128c8b38b30577dae60bdff0e62519ebdc06b/share/doc/html/src/Control.Monad.Trans.Fail.String.html"><span class="hs-identifier">Control.Monad.Trans.Fail.String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/FailT-0.1.2.0-a6bfc8b1703d475e2ae00d40307128c8b38b30577dae60bdff0e62519ebdc06b/share/doc/html/src/Control.Monad.Trans.Fail.String.html#errorFail"><span class="hs-identifier">errorFail</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Writer.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadWriter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.html"><span class="hs-identifier">Control.State.Transition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#applySTSOptsEither"><span class="hs-identifier">applySTSOptsEither</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html"><span class="hs-identifier">Control.State.Transition.Extended</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-243"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#ApplySTSOpts"><span class="hs-identifier">ApplySTSOpts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#AssertionPolicy"><span class="hs-identifier">AssertionPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#SingEP"><span class="hs-identifier">SingEP</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-246"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#ValidationPolicy"><span class="hs-identifier">ValidationPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-247"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">first</span></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Coerce</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">coerce</span></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Data</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Proxy</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(:~:)</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.html"><span class="hs-identifier">Data.Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">traverse_</span></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">($&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Functor.Identity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Identity</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-255"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List.NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NonEmpty</span></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-258"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isNothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Ratio</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(%)</span></span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html"><span class="hs-identifier">Data.Sequence.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#StrictSeq"><span class="hs-identifier">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html"><span class="hs-identifier">Data.Sequence.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SSeq</span></span><span>
</span><span id="line-262"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-263"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-264"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Time.Format.ISO8601</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">iso8601ParseM</span></span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.html"><span class="hs-identifier">Data.TreeDiff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Pretty.html#ansiWlExpr"><span class="hs-identifier">ansiWlExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Type.Equality</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TestEquality</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span>
</span><span id="line-268"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TypeLits</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">KnownNat</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">KnownSymbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Symbol</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">symbolVal</span></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="annot"><span class="hs-operator">(&lt;=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html"><span class="hs-identifier">Lens.Micro</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier">Lens'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#SimpleGetter"><span class="hs-identifier">SimpleGetter</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier">lens</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#to"><span class="hs-identifier">to</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator">(%~)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&amp;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator">(.~)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%3C%3E~"><span class="hs-operator">(&lt;&gt;~)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator">(^.)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html"><span class="hs-identifier">Lens.Micro.Mtl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier">use</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#view"><span class="hs-identifier">view</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#%25%3D"><span class="hs-operator">(%=)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#%2B%3D"><span class="hs-operator">(+=)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#.%3D"><span class="hs-operator">(.=)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Numeric.Natural</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Natural</span></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/prettyprinter-1.7.1-318bfdf9d6702b01d9e5968bc160c179db42096d98c6a62c9b2a9c2ecaf4b7ee/share/doc/html/src/Prettyprinter.html"><span class="hs-identifier">Prettyprinter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/prettyprinter-1.7.1-318bfdf9d6702b01d9e5968bc160c179db42096d98c6a62c9b2a9c2ecaf4b7ee/share/doc/html/src/Prettyprinter.Internal.html#Doc"><span class="hs-identifier">Doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/prettyprinter-ansi-terminal-1.1.3-a24411d18619b5d689908d5d4f76fb9930e56a7348a141a734e42bdce42c3c2c/share/doc/html/src/Prettyprinter.Render.Terminal.html"><span class="hs-identifier">Prettyprinter.Render.Terminal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/prettyprinter-ansi-terminal-1.1.3-a24411d18619b5d689908d5d4f76fb9930e56a7348a141a734e42bdce42c3c2c/share/doc/html/src/Prettyprinter.Render.Terminal.Internal.html#AnsiStyle"><span class="hs-identifier">AnsiStyle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/random-1.3.1-e6c7b1cee032ca76f261bba1d8d9702b7461826df6d9c477db22a249d249c097/share/doc/html/src/System.Random.Stateful.html"><span class="hs-identifier">System.Random.Stateful</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-275"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Arbitrary.html"><span class="hs-identifier">Test.Cardano.Ledger.Core.Arbitrary</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Binary.RoundTrip.html"><span class="hs-identifier">Test.Cardano.Ledger.Core.Binary.RoundTrip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Binary.RoundTrip.html#roundTripEraExpectation"><span class="hs-identifier">roundTripEraExpectation</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html"><span class="hs-identifier">Test.Cardano.Ledger.Core.KeyPair</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#ByronKeyPair"><span class="hs-identifier">ByronKeyPair</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkStakeRef"><span class="hs-identifier">mkStakeRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkWitnessesVKey"><span class="hs-identifier">mkWitnessesVKey</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html"><span class="hs-identifier">Test.Cardano.Ledger.Core.Rational</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator">(%!)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Utils.html"><span class="hs-identifier">Test.Cardano.Ledger.Core.Utils</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Utils.html#mkDummySafeHash"><span class="hs-identifier">mkDummySafeHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Utils.html#txInAt"><span class="hs-identifier">txInAt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Imp.Common.html"><span class="hs-identifier">Test.Cardano.Ledger.Imp.Common</span></a></span><span>
</span><span id="line-281"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Plutus.html"><span class="hs-identifier">Test.Cardano.Ledger.Plutus</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Plutus.ScriptTestContext.html#PlutusArgs"><span class="hs-identifier">PlutusArgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Plutus.ScriptTestContext.html#ScriptTestContext"><span class="hs-identifier">ScriptTestContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.Era.html"><span class="hs-identifier">Test.Cardano.Ledger.Shelley.Era</span></a></span><span>
</span><span id="line-283"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.TreeDiff.html"><span class="hs-identifier">Test.Cardano.Ledger.Shelley.TreeDiff</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Expr.html#Expr"><span class="hs-identifier">Expr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-l-testlib-19de88297209d951ba64f90e0ca040d80a228f9bb6bb64c3a3f507c1a30868e8/share/doc/html/src/Test.Cardano.Slotting.Numeric.html"><span class="hs-identifier">Test.Cardano.Slotting.Numeric</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.html"><span class="hs-identifier">Test.ImpSpec</span></a></span><span>
</span><span id="line-286"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Type.Reflection</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Typeable</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeOf</span></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/unliftio-0.2.25.1-e4f789ba556ee5560c772d9621453215296e4bfb0cb6d914d78127017dc8538a/share/doc/html/src/UnliftIO.html"><span class="hs-identifier">UnliftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/unliftio-0.2.25.1-e4f789ba556ee5560c772d9621453215296e4bfb0cb6d914d78127017dc8538a/share/doc/html/src/UnliftIO.Exception.html#evaluateDeep"><span class="hs-identifier">evaluateDeep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="hs-keyword">type</span><span> </span><span id="ImpTestM"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-var">ImpTestM</span></a></span></span><span> </span><span id="local-6989586621679713742"><span class="annot"><a href="#local-6989586621679713742"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713742"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-keyword">data</span><span> </span><span id="LedgerSpec"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-var">LedgerSpec</span></a></span></span><span> </span><span id="local-6989586621679713743"><span class="annot"><a href="#local-6989586621679713743"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679712192"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712192"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpSpec"><span class="hs-identifier hs-type">ImpSpec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712192"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ImpSpecEnv"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpSpecEnv"><span class="hs-identifier hs-var">ImpSpecEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712192"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier hs-type">ImpTestEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712192"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="ImpSpecState"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpSpecState"><span class="hs-identifier hs-var">ImpSpecState</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712192"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712192"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-296"></span><span>  </span><span id="local-6989586621679713789"><span class="annot"><span class="annottext">impInitIO :: QCGen -&gt; IO (ImpInit (LedgerSpec era))
</span><a href="#local-6989586621679713789"><span class="hs-identifier hs-var hs-var hs-var hs-var">impInitIO</span></a></span></span><span> </span><span id="local-6989586621679713791"><span class="annot"><span class="annottext">QCGen
</span><a href="#local-6989586621679713791"><span class="hs-identifier hs-var">qcGen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621679713792"><span class="annot"><span class="annottext">IOGenM QCGen
</span><a href="#local-6989586621679713792"><span class="hs-identifier hs-var">ioGen</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QCGen -&gt; IO (IOGenM QCGen)
forall (m :: * -&gt; *) g. MonadIO m =&gt; g -&gt; m (IOGenM g)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/random-1.3.1-e6c7b1cee032ca76f261bba1d8d9702b7461826df6d9c477db22a249d249c097/share/doc/html/src/System.Random.Stateful.html#newIOGenM"><span class="hs-identifier hs-var">R.newIOGenM</span></a></span><span> </span><span class="annot"><span class="annottext">QCGen
</span><a href="#local-6989586621679713791"><span class="hs-identifier hs-var">qcGen</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621679713794"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713794"><span class="hs-identifier hs-var">initState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT ImpPrepState IO (ImpTestState era)
-&gt; ImpPrepState -&gt; IO (ImpTestState era)
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m a
</span><span class="hs-identifier hs-var">evalStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReaderT (IOGenM QCGen) (StateT ImpPrepState IO) (ImpTestState era)
-&gt; IOGenM QCGen -&gt; StateT ImpPrepState IO (ImpTestState era)
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ReaderT (IOGenM QCGen) (StateT ImpPrepState IO) (ImpTestState era)
forall era s (m :: * -&gt; *) g.
(ShelleyEraImp era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
m (ImpTestState era)
forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadFail m) =&gt;
m (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initImpTestState"><span class="hs-identifier hs-var">initImpTestState</span></a></span><span> </span><span class="annot"><span class="annottext">IOGenM QCGen
</span><a href="#local-6989586621679713792"><span class="hs-identifier hs-var">ioGen</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImpPrepState
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-type">ImpPrepState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">ImpInit (LedgerSpec era) -&gt; IO (ImpInit (LedgerSpec era))
forall a. a -&gt; IO a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ImpInit (LedgerSpec era) -&gt; IO (ImpInit (LedgerSpec era)))
-&gt; ImpInit (LedgerSpec era) -&gt; IO (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-300"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span>
</span><span id="line-301"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">impInitEnv :: ImpSpecEnv (LedgerSpec era)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitEnv"><span class="hs-identifier hs-var">impInitEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-302"></span><span>            </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier hs-type">ImpTestEnv</span></a></span><span>
</span><span id="line-303"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">iteFixup :: Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixup"><span class="hs-identifier hs-var">iteFixup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupTx"><span class="hs-identifier hs-var">fixupTx</span></a></span><span>
</span><span id="line-304"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">itePostSubmitTxHook :: forall t.
Globals
-&gt; TRC (EraRule &quot;LEDGER&quot; era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
     (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
-&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHook"><span class="hs-identifier hs-var">itePostSubmitTxHook</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Globals
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TRC (EraRule &quot;LEDGER&quot; era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
  (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ImpM t ()
forall a. a -&gt; ImpM t a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">itePostEpochBoundaryHook :: forall t.
Globals
-&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHook"><span class="hs-identifier hs-var">itePostEpochBoundaryHook</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Globals
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TRC (EraRule &quot;NEWEPOCH&quot; era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;NEWEPOCH&quot; era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ImpM t ()
forall a. a -&gt; ImpM t a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-307"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impInitState :: ImpSpecState (LedgerSpec era)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitState"><span class="hs-identifier hs-var">impInitState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpSpecState (LedgerSpec era)
ImpTestState era
</span><a href="#local-6989586621679713794"><span class="hs-identifier hs-var">initState</span></a></span><span>
</span><span id="line-308"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-comment">-- There is an important step here of running TICK rule. This is necessary as a final</span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-comment">-- step of `era` initialization, because on the very first TICK of an era the</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-comment">-- `futurePParams` are applied and the epoch number is updated to the first epoch</span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-comment">-- number of the current era</span><span>
</span><span id="line-314"></span><span>  </span><span id="local-6989586621679713811"><span class="annot"><span class="annottext">impPrepAction :: ImpM (LedgerSpec era) ()
</span><a href="#local-6989586621679713811"><span class="hs-identifier hs-var hs-var hs-var hs-var">impPrepAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) ()
forall era. (HasCallStack, ShelleyEraImp era) =&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passTick"><span class="hs-identifier hs-var">passTick</span></a></span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="hs-keyword">class</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Era.html#EraTest"><span class="hs-identifier hs-type">EraTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712261"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span id="EraSpecificSpec"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#EraSpecificSpec"><span class="hs-identifier hs-var">EraSpecificSpec</span></a></span></span><span> </span><span id="local-6989586621679712261"><span class="annot"><a href="#local-6989586621679712261"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>  </span><span id="eraSpecificSpec"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#eraSpecificSpec"><span class="hs-identifier hs-type">eraSpecificSpec</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712261"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>  </span><span id="local-6989586621679713816"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#eraSpecificSpec"><span class="hs-identifier hs-var hs-var">eraSpecificSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; SpecWith (ImpInit (LedgerSpec era))
forall a. a -&gt; SpecM (ImpInit (LedgerSpec era)) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-keyword">data</span><span> </span><span id="SomeSTSEvent"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-var">SomeSTSEvent</span></a></span></span><span> </span><span id="local-6989586621679713188"><span class="annot"><a href="#local-6989586621679713188"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-321"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679713819"><span class="annot"><a href="#local-6989586621679713819"><span class="hs-identifier hs-type">rule</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Symbol</span></span><span class="hs-special">)</span><span class="hs-operator">.</span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713819"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713188"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713819"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713188"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713819"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713188"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-326"></span><span>    </span><span id="SomeSTSEvent"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-var">SomeSTSEvent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713819"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713188"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679712270"><span id="local-6989586621679713823"><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712270"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-329"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span id="local-6989586621679713830"><span class="annot"><span class="annottext">Event (EraRule rule era)
</span><a href="#local-6989586621679713830"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713831"><span class="annot"><span class="annottext">== :: SomeSTSEvent era -&gt; SomeSTSEvent era -&gt; Bool
</span><span class="hs-operator hs-var hs-var hs-var hs-var">==</span></span></span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span id="local-6989586621679713839"><span class="annot"><span class="annottext">Event (EraRule rule era)
</span><a href="#local-6989586621679713839"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Event (EraRule rule era) :~: Event (EraRule rule era)
</span><span class="hs-identifier hs-var">Refl</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeRep (Event (EraRule rule era))
-&gt; TypeRep (Event (EraRule rule era))
-&gt; Maybe (Event (EraRule rule era) :~: Event (EraRule rule era))
forall a b. TypeRep a -&gt; TypeRep b -&gt; Maybe (a :~: b)
forall {k} (f :: k -&gt; *) (a :: k) (b :: k).
TestEquality f =&gt;
f a -&gt; f b -&gt; Maybe (a :~: b)
</span><span class="hs-identifier hs-var">testEquality</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event (EraRule rule era) -&gt; TypeRep (Event (EraRule rule era))
forall a. Typeable a =&gt; a -&gt; TypeRep a
</span><span class="hs-identifier hs-var">typeOf</span></span><span> </span><span class="annot"><span class="annottext">Event (EraRule rule era)
</span><a href="#local-6989586621679713830"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Event (EraRule rule era) -&gt; TypeRep (Event (EraRule rule era))
forall a. Typeable a =&gt; a -&gt; TypeRep a
</span><span class="hs-identifier hs-var">typeOf</span></span><span> </span><span class="annot"><span class="annottext">Event (EraRule rule era)
</span><a href="#local-6989586621679713839"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event (EraRule rule era)
</span><a href="#local-6989586621679713830"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Event (EraRule rule era) -&gt; Event (EraRule rule era) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Event (EraRule rule era)
Event (EraRule rule era)
</span><a href="#local-6989586621679713839"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679712285"><span id="local-6989586621679713846"><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712285"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-334"></span><span>  </span><span id="local-6989586621679713850"><span class="annot"><span class="annottext">toExpr :: SomeSTSEvent era -&gt; Expr
</span><a href="#local-6989586621679713850"><span class="hs-identifier hs-var hs-var hs-var hs-var">toExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span id="local-6989586621679713858"><span class="annot"><span class="annottext">Event (EraRule rule era)
</span><a href="#local-6989586621679713858"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Expr] -&gt; Expr
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Expr.html#App"><span class="hs-identifier hs-var">App</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;SomeSTSEvent&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Event (EraRule rule era) -&gt; Expr
forall a. ToExpr a =&gt; a -&gt; Expr
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#toExpr"><span class="hs-identifier hs-var">toExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Event (EraRule rule era)
</span><a href="#local-6989586621679713858"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-keyword">data</span><span> </span><span id="ImpTestState"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-var">ImpTestState</span></a></span></span><span> </span><span id="local-6989586621679712289"><span class="annot"><a href="#local-6989586621679712289"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ImpTestState"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-var">ImpTestState</span></a></span></span><span>
</span><span id="line-337"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="impNES"><span class="annot"><span class="annottext">forall era. ImpTestState era -&gt; NewEpochState era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNES"><span class="hs-identifier hs-var hs-var">impNES</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712289"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impRootTxIn"><span class="annot"><span class="annottext">forall era. ImpTestState era -&gt; TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxIn"><span class="hs-identifier hs-var hs-var">impRootTxIn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impKeyPairs"><span class="annot"><span class="annottext">forall era.
ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairs"><span class="hs-identifier hs-var hs-var">impKeyPairs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impByronKeyPairs"><span class="annot"><span class="annottext">forall era. ImpTestState era -&gt; Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impByronKeyPairs"><span class="hs-identifier hs-var hs-var">impByronKeyPairs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-type">BootstrapAddress</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#ByronKeyPair"><span class="hs-identifier hs-type">ByronKeyPair</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impNativeScripts"><span class="annot"><span class="annottext">forall era. ImpTestState era -&gt; Map ScriptHash (NativeScript era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScripts"><span class="hs-identifier hs-var hs-var">impNativeScripts</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712289"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impLastTick"><span class="annot"><span class="annottext">forall era. ImpTestState era -&gt; SlotNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTick"><span class="hs-identifier hs-var hs-var">impLastTick</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-343"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impGlobals"><span class="annot"><span class="annottext">forall era. ImpTestState era -&gt; Globals
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobals"><span class="hs-identifier hs-var hs-var">impGlobals</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span><span>
</span><span id="line-344"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impEvents"><span class="annot"><span class="annottext">forall era. ImpTestState era -&gt; [SomeSTSEvent era]
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEvents"><span class="hs-identifier hs-var hs-var">impEvents</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712289"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-345"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-346"></span><span>
</span><span id="line-347"></span><span class="annot"><span class="hs-comment">-- | This is a preliminary state that is used to prepare the actual `ImpTestState`</span></span><span>
</span><span id="line-348"></span><span class="hs-keyword">data</span><span> </span><span id="ImpPrepState"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-var">ImpPrepState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ImpPrepState"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-var">ImpPrepState</span></a></span></span><span>
</span><span id="line-349"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="impPrepKeyPairs"><span class="annot"><span class="annottext">ImpPrepState -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepKeyPairs"><span class="hs-identifier hs-var hs-var">impPrepKeyPairs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="impPrepByronKeyPairs"><span class="annot"><span class="annottext">ImpPrepState -&gt; Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepByronKeyPairs"><span class="hs-identifier hs-var hs-var">impPrepByronKeyPairs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-type">BootstrapAddress</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#ByronKeyPair"><span class="hs-identifier hs-type">ByronKeyPair</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-352"></span><span>
</span><span id="line-353"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679713874"><span id="local-6989586621679713878"><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-type">ImpPrepState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-354"></span><span>  </span><span id="local-6989586621679713890"><span class="annot"><span class="annottext">&lt;&gt; :: ImpPrepState -&gt; ImpPrepState -&gt; ImpPrepState
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span id="local-6989586621679713891"><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713891"><span class="hs-identifier hs-var">ips1</span></a></span></span><span> </span><span id="local-6989586621679713892"><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713892"><span class="hs-identifier hs-var">ips2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-355"></span><span>    </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-type">ImpPrepState</span></a></span><span>
</span><span id="line-356"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">impPrepKeyPairs :: Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepKeyPairs"><span class="hs-identifier hs-var">impPrepKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpPrepState -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepKeyPairs"><span class="hs-identifier hs-var">impPrepKeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713891"><span class="hs-identifier hs-var">ips1</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpPrepState -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepKeyPairs"><span class="hs-identifier hs-var">impPrepKeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713892"><span class="hs-identifier hs-var">ips2</span></a></span><span>
</span><span id="line-357"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impPrepByronKeyPairs :: Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepByronKeyPairs"><span class="hs-identifier hs-var">impPrepByronKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpPrepState -&gt; Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepByronKeyPairs"><span class="hs-identifier hs-var">impPrepByronKeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713891"><span class="hs-identifier hs-var">ips1</span></a></span><span> </span><span class="annot"><span class="annottext">Map BootstrapAddress ByronKeyPair
-&gt; Map BootstrapAddress ByronKeyPair
-&gt; Map BootstrapAddress ByronKeyPair
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpPrepState -&gt; Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepByronKeyPairs"><span class="hs-identifier hs-var">impPrepByronKeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713892"><span class="hs-identifier hs-var">ips2</span></a></span><span>
</span><span id="line-358"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679713897"><span id="local-6989586621679713900"><span class="annot"><span class="hs-identifier hs-type">Monoid</span></span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-type">ImpPrepState</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-361"></span><span>  </span><span id="local-6989586621679713908"><span class="annot"><span class="annottext">mempty :: ImpPrepState
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-362"></span><span>    </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-type">ImpPrepState</span></a></span><span>
</span><span id="line-363"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">impPrepKeyPairs :: Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepKeyPairs"><span class="hs-identifier hs-var">impPrepKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-364"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impPrepByronKeyPairs :: Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepByronKeyPairs"><span class="hs-identifier hs-var">impPrepByronKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map BootstrapAddress ByronKeyPair
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-365"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="hs-keyword">class</span><span> </span><span id="HasKeyPairs"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-var">HasKeyPairs</span></a></span></span><span> </span><span id="local-6989586621679712321"><span class="annot"><a href="#local-6989586621679712321"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-368"></span><span>  </span><span id="keyPairsL"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsL"><span class="hs-identifier hs-type">keyPairsL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712321"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>  </span><span id="keyPairsByronL"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsByronL"><span class="hs-identifier hs-type">keyPairsByronL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712321"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-type">BootstrapAddress</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#ByronKeyPair"><span class="hs-identifier hs-type">ByronKeyPair</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679712322"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#Era"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712322"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712322"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-372"></span><span>  </span><span id="local-6989586621679713918"><span class="annot"><span class="annottext">keyPairsL :: Lens'
  (ImpTestState era) (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsL"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyPairsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; (ImpTestState era
    -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness) -&gt; ImpTestState era)
-&gt; Lens'
     (ImpTestState era) (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall era.
ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairs"><span class="hs-identifier hs-var">impKeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713919"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713919"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713920"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679713920"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713919"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairs"><span class="hs-identifier hs-var">impKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713920"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>  </span><span id="local-6989586621679713923"><span class="annot"><span class="annottext">keyPairsByronL :: Lens' (ImpTestState era) (Map BootstrapAddress ByronKeyPair)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsByronL"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyPairsByronL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; Map BootstrapAddress ByronKeyPair)
-&gt; (ImpTestState era
    -&gt; Map BootstrapAddress ByronKeyPair -&gt; ImpTestState era)
-&gt; Lens' (ImpTestState era) (Map BootstrapAddress ByronKeyPair)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; Map BootstrapAddress ByronKeyPair
forall era. ImpTestState era -&gt; Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impByronKeyPairs"><span class="hs-identifier hs-var">impByronKeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713924"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713924"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713925"><span class="annot"><span class="annottext">Map BootstrapAddress ByronKeyPair
</span><a href="#local-6989586621679713925"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713924"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impByronKeyPairs"><span class="hs-identifier hs-var">impByronKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713925"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpPrepState"><span class="hs-identifier hs-type">ImpPrepState</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-376"></span><span>  </span><span id="local-6989586621679713930"><span class="annot"><span class="annottext">keyPairsL :: Lens' ImpPrepState (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsL"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyPairsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpPrepState -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; (ImpPrepState
    -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness) -&gt; ImpPrepState)
-&gt; Lens' ImpPrepState (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpPrepState -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepKeyPairs"><span class="hs-identifier hs-var">impPrepKeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713931"><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713931"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713932"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679713932"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713931"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepKeyPairs"><span class="hs-identifier hs-var">impPrepKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713932"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>  </span><span id="local-6989586621679713935"><span class="annot"><span class="annottext">keyPairsByronL :: Lens' ImpPrepState (Map BootstrapAddress ByronKeyPair)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsByronL"><span class="hs-identifier hs-var hs-var hs-var hs-var">keyPairsByronL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpPrepState -&gt; Map BootstrapAddress ByronKeyPair)
-&gt; (ImpPrepState
    -&gt; Map BootstrapAddress ByronKeyPair -&gt; ImpPrepState)
-&gt; Lens' ImpPrepState (Map BootstrapAddress ByronKeyPair)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpPrepState -&gt; Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepByronKeyPairs"><span class="hs-identifier hs-var">impPrepByronKeyPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713936"><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713936"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713937"><span class="annot"><span class="annottext">Map BootstrapAddress ByronKeyPair
</span><a href="#local-6989586621679713937"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpPrepState
</span><a href="#local-6989586621679713936"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impPrepByronKeyPairs"><span class="hs-identifier hs-var">impPrepByronKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713937"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>
</span><span id="line-379"></span><span id="local-6989586621679712333"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-type">impGlobalsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712333"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span></span><span>
</span><span id="line-380"></span><span id="impGlobalsL"><span class="annot"><span class="annottext">impGlobalsL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var hs-var">impGlobalsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; Globals)
-&gt; (ImpTestState era -&gt; Globals -&gt; ImpTestState era)
-&gt; Lens (ImpTestState era) (ImpTestState era) Globals Globals
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; Globals
forall era. ImpTestState era -&gt; Globals
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobals"><span class="hs-identifier hs-var">impGlobals</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713940"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713940"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713941"><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679713941"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713940"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobals"><span class="hs-identifier hs-var">impGlobals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713941"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span id="local-6989586621679712336"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier hs-type">impNESL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712336"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712336"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-383"></span><span id="impNESL"><span class="annot"><span class="annottext">impNESL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(NewEpochState era -&gt; f (NewEpochState era))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier hs-var hs-var">impNESL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; NewEpochState era)
-&gt; (ImpTestState era -&gt; NewEpochState era -&gt; ImpTestState era)
-&gt; Lens
     (ImpTestState era)
     (ImpTestState era)
     (NewEpochState era)
     (NewEpochState era)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; NewEpochState era
forall era. ImpTestState era -&gt; NewEpochState era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNES"><span class="hs-identifier hs-var">impNES</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713944"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713944"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713945"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679713945"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713944"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNES"><span class="hs-identifier hs-var">impNES</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713945"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span id="local-6989586621679712339"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickL"><span class="hs-identifier hs-type">impLastTickL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712339"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a></span></span><span>
</span><span id="line-386"></span><span id="impLastTickL"><span class="annot"><span class="annottext">impLastTickL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(SlotNo -&gt; f SlotNo) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickL"><span class="hs-identifier hs-var hs-var">impLastTickL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; SlotNo)
-&gt; (ImpTestState era -&gt; SlotNo -&gt; ImpTestState era)
-&gt; Lens (ImpTestState era) (ImpTestState era) SlotNo SlotNo
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; SlotNo
forall era. ImpTestState era -&gt; SlotNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTick"><span class="hs-identifier hs-var">impLastTick</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713949"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713949"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713950"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679713950"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713949"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTick"><span class="hs-identifier hs-var">impLastTick</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713950"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span id="local-6989586621679712343"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickG"><span class="hs-identifier hs-type">impLastTickG</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#SimpleGetter"><span class="hs-identifier hs-type">SimpleGetter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712343"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a></span></span><span>
</span><span id="line-389"></span><span id="impLastTickG"><span class="annot"><span class="annottext">impLastTickG :: forall era r. Getting r (ImpTestState era) SlotNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickG"><span class="hs-identifier hs-var hs-var">impLastTickG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotNo -&gt; Const r SlotNo)
-&gt; ImpTestState era -&gt; Const r (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(SlotNo -&gt; f SlotNo) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickL"><span class="hs-identifier hs-var">impLastTickL</span></a></span><span>
</span><span id="line-390"></span><span>
</span><span id="line-391"></span><span id="local-6989586621679712349"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxInL"><span class="hs-identifier hs-type">impRootTxInL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712349"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span></span><span>
</span><span id="line-392"></span><span id="impRootTxInL"><span class="annot"><span class="annottext">impRootTxInL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(TxIn -&gt; f TxIn) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxInL"><span class="hs-identifier hs-var hs-var">impRootTxInL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; TxIn)
-&gt; (ImpTestState era -&gt; TxIn -&gt; ImpTestState era)
-&gt; Lens (ImpTestState era) (ImpTestState era) TxIn TxIn
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; TxIn
forall era. ImpTestState era -&gt; TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxIn"><span class="hs-identifier hs-var">impRootTxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713956"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713956"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713957"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679713957"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713956"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxIn"><span class="hs-identifier hs-var">impRootTxIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713957"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span id="local-6989586621679712352"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairsG"><span class="hs-identifier hs-type">impKeyPairsG</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-395"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#SimpleGetter"><span class="hs-identifier hs-type">SimpleGetter</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712352"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-398"></span><span id="impKeyPairsG"><span class="annot"><span class="annottext">impKeyPairsG :: forall era r.
Getting
  r (ImpTestState era) (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairsG"><span class="hs-identifier hs-var hs-var">impKeyPairsG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; SimpleGetter
     (ImpTestState era) (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall era.
ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairs"><span class="hs-identifier hs-var">impKeyPairs</span></a></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span id="local-6989586621679712358"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsL"><span class="hs-identifier hs-type">impNativeScriptsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712358"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712358"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-401"></span><span id="impNativeScriptsL"><span class="annot"><span class="annottext">impNativeScriptsL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(Map ScriptHash (NativeScript era)
 -&gt; f (Map ScriptHash (NativeScript era)))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsL"><span class="hs-identifier hs-var hs-var">impNativeScriptsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; Map ScriptHash (NativeScript era))
-&gt; (ImpTestState era
    -&gt; Map ScriptHash (NativeScript era) -&gt; ImpTestState era)
-&gt; Lens
     (ImpTestState era)
     (ImpTestState era)
     (Map ScriptHash (NativeScript era))
     (Map ScriptHash (NativeScript era))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; Map ScriptHash (NativeScript era)
forall era. ImpTestState era -&gt; Map ScriptHash (NativeScript era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScripts"><span class="hs-identifier hs-var">impNativeScripts</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713961"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713961"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713962"><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679713962"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713961"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScripts"><span class="hs-identifier hs-var">impNativeScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713962"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span id="local-6989586621679712361"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsG"><span class="hs-identifier hs-type">impNativeScriptsG</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-404"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#SimpleGetter"><span class="hs-identifier hs-type">SimpleGetter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712361"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712361"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-405"></span><span id="impNativeScriptsG"><span class="annot"><span class="annottext">impNativeScriptsG :: forall era r.
Getting r (ImpTestState era) (Map ScriptHash (NativeScript era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsG"><span class="hs-identifier hs-var hs-var">impNativeScriptsG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map ScriptHash (NativeScript era)
 -&gt; Const r (Map ScriptHash (NativeScript era)))
-&gt; ImpTestState era -&gt; Const r (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map ScriptHash (NativeScript era)
 -&gt; f (Map ScriptHash (NativeScript era)))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsL"><span class="hs-identifier hs-var">impNativeScriptsL</span></a></span><span>
</span><span id="line-406"></span><span>
</span><span id="line-407"></span><span id="local-6989586621679712364"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEventsL"><span class="hs-identifier hs-type">impEventsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712364"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712364"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-408"></span><span id="impEventsL"><span class="annot"><span class="annottext">impEventsL :: forall era (f :: * -&gt; *).
Functor f =&gt;
([SomeSTSEvent era] -&gt; f [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEventsL"><span class="hs-identifier hs-var hs-var">impEventsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; [SomeSTSEvent era])
-&gt; (ImpTestState era -&gt; [SomeSTSEvent era] -&gt; ImpTestState era)
-&gt; Lens
     (ImpTestState era)
     (ImpTestState era)
     [SomeSTSEvent era]
     [SomeSTSEvent era]
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; [SomeSTSEvent era]
forall era. ImpTestState era -&gt; [SomeSTSEvent era]
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEvents"><span class="hs-identifier hs-var">impEvents</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679713967"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713967"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679713968"><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679713968"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679713967"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEvents"><span class="hs-identifier hs-var">impEvents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679713968"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span class="hs-keyword">class</span><span>
</span><span id="line-411"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.Era.html#ShelleyEraTest"><span class="hs-identifier hs-type">ShelleyEraTest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- For BBODY rule</span><span>
</span><span id="line-413"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-type">BaseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span>
</span><span id="line-415"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Bbody.html#BbodyEnv"><span class="hs-identifier hs-type">BbodyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Bbody.html#ShelleyBbodyState"><span class="hs-identifier hs-type">ShelleyBbodyState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Block.html#Block"><span class="hs-identifier hs-type">Block</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BHeaderView.html#BHeaderView"><span class="hs-identifier hs-type">BHeaderView</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGERS&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#LedgerState"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-420"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- For the LEDGER rule</span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-type">BaseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span>
</span><span id="line-423"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-424"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#LedgerState"><span class="hs-identifier hs-type">LedgerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#LedgerEnv"><span class="hs-identifier hs-type">LedgerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-428"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-429"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-type">EncCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-432"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- For the TICK rule</span><span>
</span><span id="line-438"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-type">BaseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a></span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-446"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-447"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-448"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleEvent"><span class="hs-identifier hs-type">EraRuleEvent</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;UTXOW&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-452"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span>
</span><span id="line-453"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleFailure"><span class="hs-identifier hs-type">EraRuleFailure</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;BBODY&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-454"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRuleFailure"><span class="hs-identifier hs-type">EraRuleFailure</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#InjectRuleFailure"><span class="hs-identifier hs-type">InjectRuleFailure</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Deleg.html#ShelleyDelegPredFailure"><span class="hs-identifier hs-type">ShelleyDelegPredFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#InjectRuleFailure"><span class="hs-identifier hs-type">InjectRuleFailure</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Utxow.html#ShelleyUtxowPredFailure"><span class="hs-identifier hs-type">ShelleyUtxowPredFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-457"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#InjectRuleFailure"><span class="hs-identifier hs-type">InjectRuleFailure</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Utxo.html#ShelleyUtxoPredFailure"><span class="hs-identifier hs-type">ShelleyUtxoPredFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#InjectRuleFailure"><span class="hs-identifier hs-type">InjectRuleFailure</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Pool.html#ShelleyPoolPredFailure"><span class="hs-identifier hs-type">ShelleyPoolPredFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-459"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-460"></span><span>  </span><span id="ShelleyEraImp"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-var">ShelleyEraImp</span></a></span></span><span> </span><span id="local-6989586621679712234"><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-461"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-462"></span><span>  </span><span id="initGenesis"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initGenesis"><span class="hs-identifier hs-type">initGenesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-463"></span><span>    </span><span id="local-6989586621679712474"><span id="local-6989586621679712475"><span id="local-6989586621679712476"><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712474"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679712474"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712476"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679712475"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-464"></span><span>    </span><span class="annot"><a href="#local-6989586621679712475"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#Genesis"><span class="hs-identifier hs-type">Genesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="initGenesis"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initGenesis"><span class="hs-identifier hs-type">initGenesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-466"></span><span>    </span><span id="local-6989586621679712390"><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679712390"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#Genesis"><span class="hs-identifier hs-type">Genesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#NoGenesis"><span class="hs-identifier hs-type">NoGenesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-467"></span><span>    </span><span class="annot"><a href="#local-6989586621679712390"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#Genesis"><span class="hs-identifier hs-type">Genesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-468"></span><span>  </span><span id="local-6989586621679714016"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initGenesis"><span class="hs-identifier hs-var hs-var">initGenesis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Genesis era -&gt; m (Genesis era)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">NoGenesis era
Genesis era
forall era. NoGenesis era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#NoGenesis"><span class="hs-identifier hs-var">NoGenesis</span></a></span></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>  </span><span id="initNewEpochState"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initNewEpochState"><span class="hs-identifier hs-type">initNewEpochState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621679712420"><span id="local-6989586621679712421"><span id="local-6989586621679712422"><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712420"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679712420"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712421"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712422"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712421"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679712421"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><a href="#local-6989586621679712421"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-473"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="initNewEpochState"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initNewEpochState"><span class="hs-identifier hs-type">initNewEpochState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-474"></span><span>    </span><span id="local-6989586621679712396"><span id="local-6989586621679712397"><span id="local-6989586621679712398"><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712396"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-475"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679712396"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712397"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-476"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712398"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712397"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-477"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679712397"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-478"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#PreviousEra"><span class="hs-identifier hs-type">PreviousEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslateEra"><span class="hs-identifier hs-type">TranslateEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslationError"><span class="hs-identifier hs-type">TranslationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslationContext"><span class="hs-identifier hs-type">TranslationContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#Genesis"><span class="hs-identifier hs-type">Genesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-483"></span><span>    </span><span class="annot"><a href="#local-6989586621679712397"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-484"></span><span>  </span><span id="local-6989586621679714025"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initNewEpochState"><span class="hs-identifier hs-var hs-var">initNewEpochState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NewEpochState (PreviousEra era)
 -&gt; NewEpochState (PreviousEra era))
-&gt; m (NewEpochState era)
forall era g s (m :: * -&gt; *).
(MonadState s m, HasKeyPairs s, HasStatefulGen g m, MonadFail m,
 ShelleyEraImp era, ShelleyEraImp (PreviousEra era),
 TranslateEra era NewEpochState,
 TranslationError era NewEpochState ~ Void,
 TranslationContext era ~ Genesis era) =&gt;
(NewEpochState (PreviousEra era)
 -&gt; NewEpochState (PreviousEra era))
-&gt; m (NewEpochState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitNewEpochState"><span class="hs-identifier hs-var">defaultInitNewEpochState</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState (PreviousEra era) -&gt; NewEpochState (PreviousEra era)
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span></span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span>  </span><span id="initImpTestState"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initImpTestState"><span class="hs-identifier hs-type">initImpTestState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-487"></span><span>    </span><span id="local-6989586621679712235"><span id="local-6989586621679712236"><span id="local-6989586621679712237"><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712235"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-488"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679712235"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712236"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712237"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712236"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-490"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679712236"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-491"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-492"></span><span>    </span><span class="annot"><a href="#local-6989586621679712236"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-493"></span><span>  </span><span id="local-6989586621679714048"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initImpTestState"><span class="hs-identifier hs-var hs-var">initImpTestState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (NewEpochState era)
forall era s (m :: * -&gt; *) g.
(ShelleyEraImp era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
m (NewEpochState era)
forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadFail m) =&gt;
m (NewEpochState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initNewEpochState"><span class="hs-identifier hs-var">initNewEpochState</span></a></span><span> </span><span class="annot"><span class="annottext">m (NewEpochState era)
-&gt; (NewEpochState era -&gt; m (ImpTestState era))
-&gt; m (ImpTestState era)
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">NewEpochState era -&gt; m (ImpTestState era)
forall era s g (m :: * -&gt; *).
(EraGov era, EraTxOut era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
NewEpochState era -&gt; m (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitImpTestState"><span class="hs-identifier hs-var">defaultInitImpTestState</span></a></span></span><span>
</span><span id="line-494"></span><span>
</span><span id="line-495"></span><span>  </span><span class="hs-comment">-- | Try to find a sufficient number of KeyPairs that would satisfy a native script.</span><span>
</span><span id="line-496"></span><span>  </span><span class="hs-comment">-- Whenever script can't be satisfied, Nothing is returned</span><span>
</span><span id="line-497"></span><span>  </span><span id="impSatisfyNativeScript"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyNativeScript"><span class="hs-identifier hs-type">impSatisfyNativeScript</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-498"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Set of Witnesses that have already been satisfied</span></span><span>
</span><span id="line-499"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><span class="hs-comment">-- | The transaction body that the script will be applied to</span></span><span>
</span><span id="line-501"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxBody"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-502"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>  </span><span class="hs-comment">-- | This modifer should change not only the current PParams, but also the future</span><span>
</span><span id="line-506"></span><span>  </span><span class="hs-comment">-- PParams. If the future PParams are not updated, then they will overwrite the</span><span>
</span><span id="line-507"></span><span>  </span><span class="hs-comment">-- mofication of the current PParams at the next epoch.</span><span>
</span><span id="line-508"></span><span>  </span><span id="modifyPParams"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyPParams"><span class="hs-identifier hs-type">modifyPParams</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-509"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-510"></span><span>    </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>  </span><span id="local-6989586621679714076"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyPParams"><span class="hs-identifier hs-var hs-var">modifyPParams</span></a></span><span> </span><span id="local-6989586621679714084"><span class="annot"><span class="annottext">PParams era -&gt; PParams era
</span><a href="#local-6989586621679714084"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ()
forall era.
(NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyNES"><span class="hs-identifier hs-var">modifyNES</span></a></span><span> </span><span class="annot"><span class="annottext">((NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ())
-&gt; (NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Identity (EpochState era))
-&gt; NewEpochState era -&gt; Identity (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Identity (EpochState era))
 -&gt; NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; ((PParams era -&gt; Identity (PParams era))
    -&gt; EpochState era -&gt; Identity (EpochState era))
-&gt; (PParams era -&gt; Identity (PParams era))
-&gt; NewEpochState era
-&gt; Identity (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Identity (PParams era))
-&gt; EpochState era -&gt; Identity (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; Identity (PParams era))
 -&gt; NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; (PParams era -&gt; PParams era)
-&gt; NewEpochState era
-&gt; NewEpochState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; PParams era
</span><a href="#local-6989586621679714084"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span>  </span><span id="modifyImpInitProtVer"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitProtVer"><span class="hs-identifier hs-type">modifyImpInitProtVer</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-514"></span><span>    </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-515"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-516"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-517"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>
</span><span id="line-519"></span><span>  </span><span id="fixupTx"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupTx"><span class="hs-identifier hs-type">fixupTx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span>  </span><span id="expectTxSuccess"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectTxSuccess"><span class="hs-identifier hs-type">expectTxSuccess</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-522"></span><span>
</span><span id="line-523"></span><span>  </span><span id="genRegTxCert"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#genRegTxCert"><span class="hs-identifier hs-type">genRegTxCert</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#TxCert"><span class="hs-identifier hs-type">TxCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>
</span><span id="line-525"></span><span>  </span><span id="genUnRegTxCert"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#genUnRegTxCert"><span class="hs-identifier hs-type">genUnRegTxCert</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#TxCert"><span class="hs-identifier hs-type">TxCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712234"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span id="local-6989586621679712445"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfySignature"><span class="hs-identifier hs-type">impSatisfySignature</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-528"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-529"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-530"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712445"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-531"></span><span id="impSatisfySignature"><span class="annot"><span class="annottext">impSatisfySignature :: forall era.
KeyHash 'Witness
-&gt; Set (KeyHash 'Witness)
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfySignature"><span class="hs-identifier hs-var hs-var">impSatisfySignature</span></a></span></span><span> </span><span id="local-6989586621679714103"><span class="annot"><span class="annottext">KeyHash 'Witness
</span><a href="#local-6989586621679714103"><span class="hs-identifier hs-var">keyHash</span></a></span></span><span> </span><span id="local-6989586621679714104"><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679714104"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-532"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
</span><a href="#local-6989586621679714103"><span class="hs-identifier hs-var">keyHash</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness -&gt; Set (KeyHash 'Witness) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679714104"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span><span>
</span><span id="line-533"></span><span>    </span><span class="hs-keyword">then</span><span>
</span><span id="line-534"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
 -&gt; ImpTestM
      era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))))
-&gt; Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-535"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-536"></span><span>      </span><span id="local-6989586621679714106"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714106"><span class="hs-identifier hs-var">keyPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpM
     (LedgerSpec era) (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall era.
ImpTestState era -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairs"><span class="hs-identifier hs-var">impKeyPairs</span></a></span><span>
</span><span id="line-537"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
 -&gt; ImpTestM
      era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))))
-&gt; Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
-&gt; KeyPair 'Witness -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
</span><a href="#local-6989586621679714103"><span class="hs-identifier hs-var">keyHash</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyPair 'Witness -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; Maybe (KeyPair 'Witness)
-&gt; Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Maybe (KeyPair 'Witness)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
</span><a href="#local-6989586621679714103"><span class="hs-identifier hs-var">keyHash</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714106"><span class="hs-identifier hs-var">keyPairs</span></a></span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span id="local-6989586621679712461"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyMNativeScripts"><span class="hs-identifier hs-type">impSatisfyMNativeScripts</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-540"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712461"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-541"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-542"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Set of Witnesses that have already been satisfied</span></span><span>
</span><span id="line-543"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxBody"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712461"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-544"></span><span>  </span><span class="annot"><span class="hs-comment">-- | The transaction body that the scripts will be applied to</span></span><span>
</span><span id="line-545"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-546"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Number of scripts to satisfy</span></span><span>
</span><span id="line-547"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#StrictSeq"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712461"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-548"></span><span>  </span><span class="annot"><span class="hs-comment">-- | List of scripts that can be satisfied</span></span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712461"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-550"></span><span id="impSatisfyMNativeScripts"><span class="annot"><span class="annottext">impSatisfyMNativeScripts :: forall era.
ShelleyEraImp era =&gt;
Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyMNativeScripts"><span class="hs-identifier hs-var hs-var">impSatisfyMNativeScripts</span></a></span></span><span> </span><span id="local-6989586621679714124"><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679714124"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span></span><span> </span><span id="local-6989586621679714125"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679714125"><span class="hs-identifier hs-var">txBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-551"></span><span>  </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="#local-6989586621679714126"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-553"></span><span>    </span><span id="local-6989586621679714126"><span class="annot"><span class="annottext">go :: Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="#local-6989586621679714126"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679714127"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714127"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679714128"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679714128"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript era)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#Empty"><span class="hs-identifier hs-var">Empty</span></a></span><span>
</span><span id="line-554"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679714128"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
 -&gt; ImpM
      (LedgerSpec era)
      (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))))
-&gt; Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714127"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-555"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><a href="#local-6989586621679714126"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679714131"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714131"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679714132"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679714132"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679714133"><span class="annot"><span class="annottext">NativeScript era
</span><a href="#local-6989586621679714133"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#%3A%3C%7C"><span class="hs-operator hs-type">:&lt;|</span></a></span><span> </span><span id="local-6989586621679714135"><span class="annot"><span class="annottext">StrictSeq (NativeScript era)
</span><a href="#local-6989586621679714135"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-557"></span><span>      </span><span id="local-6989586621679714136"><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="#local-6989586621679714136"><span class="hs-identifier hs-var">satisifed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; NativeScript era
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall era.
ShelleyEraImp era =&gt;
Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; NativeScript era
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyNativeScript"><span class="hs-identifier hs-var">impSatisfyNativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679714124"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679714125"><span class="hs-identifier hs-var">txBody</span></a></span><span> </span><span class="annot"><span class="annottext">NativeScript era
</span><a href="#local-6989586621679714133"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-558"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="#local-6989586621679714136"><span class="hs-identifier hs-var">satisifed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-559"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="#local-6989586621679714126"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714131"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679714132"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript era)
</span><a href="#local-6989586621679714135"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-560"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679714137"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714137"><span class="hs-identifier hs-var">kps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="#local-6989586621679714126"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714137"><span class="hs-identifier hs-var">kps</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679714131"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679714132"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript era)
</span><a href="#local-6989586621679714135"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitNewEpochState"><span class="hs-identifier hs-type">defaultInitNewEpochState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-563"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712409"><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621679712408"><span class="annot"><a href="#local-6989586621679712408"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679712406"><span class="annot"><a href="#local-6989586621679712406"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679712407"><span class="annot"><a href="#local-6989586621679712407"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-564"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679712406"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712407"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-565"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712406"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-566"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712408"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712407"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679712407"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-568"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-569"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#PreviousEra"><span class="hs-identifier hs-type">PreviousEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslateEra"><span class="hs-identifier hs-type">TranslateEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span>
</span><span id="line-571"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslationError"><span class="hs-identifier hs-type">TranslationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslationContext"><span class="hs-identifier hs-type">TranslationContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Genesis.html#Genesis"><span class="hs-identifier hs-type">Genesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-573"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-574"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#PreviousEra"><span class="hs-identifier hs-type">PreviousEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#PreviousEra"><span class="hs-identifier hs-type">PreviousEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-575"></span><span>  </span><span class="annot"><a href="#local-6989586621679712407"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span id="defaultInitNewEpochState"><span class="annot"><span class="annottext">defaultInitNewEpochState :: forall era g s (m :: * -&gt; *).
(MonadState s m, HasKeyPairs s, HasStatefulGen g m, MonadFail m,
 ShelleyEraImp era, ShelleyEraImp (PreviousEra era),
 TranslateEra era NewEpochState,
 TranslationError era NewEpochState ~ Void,
 TranslationContext era ~ Genesis era) =&gt;
(NewEpochState (PreviousEra era)
 -&gt; NewEpochState (PreviousEra era))
-&gt; m (NewEpochState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitNewEpochState"><span class="hs-identifier hs-var hs-var">defaultInitNewEpochState</span></a></span></span><span> </span><span id="local-6989586621679714185"><span class="annot"><span class="annottext">NewEpochState (PreviousEra era) -&gt; NewEpochState (PreviousEra era)
</span><a href="#local-6989586621679714185"><span class="hs-identifier hs-var">modifyPrevEraNewEpochState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-577"></span><span>  </span><span id="local-6989586621679714186"><span class="annot"><span class="annottext">Genesis era
</span><a href="#local-6989586621679714186"><span class="hs-identifier hs-var">genesis</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall era s (m :: * -&gt; *) g.
(ShelleyEraImp era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
m (Genesis era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initGenesis"><span class="hs-identifier hs-var">initGenesis</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-578"></span><span>  </span><span id="local-6989586621679714187"><span class="annot"><span class="annottext">NewEpochState (PreviousEra era)
</span><a href="#local-6989586621679714187"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall era s (m :: * -&gt; *) g.
(ShelleyEraImp era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
m (NewEpochState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initNewEpochState"><span class="hs-identifier hs-var">initNewEpochState</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#PreviousEra"><span class="hs-identifier hs-type">PreviousEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679714188"><span class="annot"><span class="annottext">majProtVer :: Version
</span><a href="#local-6989586621679714188"><span class="hs-identifier hs-var hs-var">majProtVer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall era. Era era =&gt; Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#eraProtVerLow"><span class="hs-identifier hs-var">eraProtVerLow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-580"></span><span>      </span><span class="hs-comment">-- We need to set the protocol version for the current era and for debugging</span><span>
</span><span id="line-581"></span><span>      </span><span class="hs-comment">-- purposes we start the era at the epoch number that matches the protocol version</span><span>
</span><span id="line-582"></span><span>      </span><span class="hs-comment">-- times a 100. However, because this is the NewEpochState from the previous era, we</span><span>
</span><span id="line-583"></span><span>      </span><span class="hs-comment">-- initialize it with futurePParams preset and epoch number that is one behind the</span><span>
</span><span id="line-584"></span><span>      </span><span class="hs-comment">-- beginning of this era. Note that all imp tests will start with a TICK, in order</span><span>
</span><span id="line-585"></span><span>      </span><span class="hs-comment">-- for theses changes to be applied.</span><span>
</span><span id="line-586"></span><span>      </span><span id="local-6989586621679714190"><span class="annot"><span class="annottext">prevEraNewEpochState :: NewEpochState (PreviousEra era)
</span><a href="#local-6989586621679714190"><span class="hs-identifier hs-var hs-var">prevEraNewEpochState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-587"></span><span>        </span><span class="annot"><span class="annottext">NewEpochState (PreviousEra era)
</span><a href="#local-6989586621679714187"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-588"></span><span>          </span><span class="annot"><span class="annottext">NewEpochState (PreviousEra era)
-&gt; (NewEpochState (PreviousEra era)
    -&gt; NewEpochState (PreviousEra era))
-&gt; NewEpochState (PreviousEra era)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EpochState (PreviousEra era)
 -&gt; Identity (EpochState (PreviousEra era)))
-&gt; NewEpochState (PreviousEra era)
-&gt; Identity (NewEpochState (PreviousEra era))
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState (PreviousEra era)
  -&gt; Identity (EpochState (PreviousEra era)))
 -&gt; NewEpochState (PreviousEra era)
 -&gt; Identity (NewEpochState (PreviousEra era)))
-&gt; ((ProtVer -&gt; Identity ProtVer)
    -&gt; EpochState (PreviousEra era)
    -&gt; Identity (EpochState (PreviousEra era)))
-&gt; (ProtVer -&gt; Identity ProtVer)
-&gt; NewEpochState (PreviousEra era)
-&gt; Identity (NewEpochState (PreviousEra era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams (PreviousEra era) -&gt; Identity (PParams (PreviousEra era)))
-&gt; EpochState (PreviousEra era)
-&gt; Identity (EpochState (PreviousEra era))
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState (PreviousEra era)) (PParams (PreviousEra era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams (PreviousEra era)
  -&gt; Identity (PParams (PreviousEra era)))
 -&gt; EpochState (PreviousEra era)
 -&gt; Identity (EpochState (PreviousEra era)))
-&gt; ((ProtVer -&gt; Identity ProtVer)
    -&gt; PParams (PreviousEra era)
    -&gt; Identity (PParams (PreviousEra era)))
-&gt; (ProtVer -&gt; Identity ProtVer)
-&gt; EpochState (PreviousEra era)
-&gt; Identity (EpochState (PreviousEra era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ProtVer -&gt; Identity ProtVer)
-&gt; PParams (PreviousEra era)
-&gt; Identity (PParams (PreviousEra era))
forall era. EraPParams era =&gt; Lens' (PParams era) ProtVer
Lens' (PParams (PreviousEra era)) ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppProtocolVersionL"><span class="hs-identifier hs-var">ppProtocolVersionL</span></a></span><span> </span><span class="annot"><span class="annottext">((ProtVer -&gt; Identity ProtVer)
 -&gt; NewEpochState (PreviousEra era)
 -&gt; Identity (NewEpochState (PreviousEra era)))
-&gt; ProtVer
-&gt; NewEpochState (PreviousEra era)
-&gt; NewEpochState (PreviousEra era)
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Natural -&gt; ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-var">ProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679714188"><span class="hs-identifier hs-var">majProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-589"></span><span>          </span><span class="annot"><span class="annottext">NewEpochState (PreviousEra era)
-&gt; (NewEpochState (PreviousEra era)
    -&gt; NewEpochState (PreviousEra era))
-&gt; NewEpochState (PreviousEra era)
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; Identity EpochNo)
-&gt; NewEpochState (PreviousEra era)
-&gt; Identity (NewEpochState (PreviousEra era))
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochNo -&gt; f EpochNo)
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesELL"><span class="hs-identifier hs-var">nesELL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochNo -&gt; Identity EpochNo)
 -&gt; NewEpochState (PreviousEra era)
 -&gt; Identity (NewEpochState (PreviousEra era)))
-&gt; EpochNo
-&gt; NewEpochState (PreviousEra era)
-&gt; NewEpochState (PreviousEra era)
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">pred</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era. Era era =&gt; EpochNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEraStartEpochNo"><span class="hs-identifier hs-var">impEraStartEpochNo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679712409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><span class="annottext">NewEpochState era -&gt; m (NewEpochState era)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(NewEpochState era -&gt; m (NewEpochState era))
-&gt; NewEpochState era -&gt; m (NewEpochState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TranslationContext era
-&gt; NewEpochState (PreviousEra era) -&gt; NewEpochState era
forall era (f :: * -&gt; *).
(TranslateEra era f, TranslationError era f ~ Void) =&gt;
TranslationContext era -&gt; f (PreviousEra era) -&gt; f era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#translateEra%27"><span class="hs-identifier hs-var">translateEra'</span></a></span><span> </span><span class="annot"><span class="annottext">Genesis era
TranslationContext era
</span><a href="#local-6989586621679714186"><span class="hs-identifier hs-var">genesis</span></a></span><span> </span><span class="annot"><span class="annottext">(NewEpochState (PreviousEra era) -&gt; NewEpochState era)
-&gt; NewEpochState (PreviousEra era) -&gt; NewEpochState era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NewEpochState (PreviousEra era) -&gt; NewEpochState (PreviousEra era)
</span><a href="#local-6989586621679714185"><span class="hs-identifier hs-var">modifyPrevEraNewEpochState</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState (PreviousEra era)
</span><a href="#local-6989586621679714190"><span class="hs-identifier hs-var">prevEraNewEpochState</span></a></span><span>
</span><span id="line-591"></span><span>
</span><span id="line-592"></span><span class="hs-comment">-- | For debugging purposes we start the era at the epoch number that matches the starting</span><span>
</span><span id="line-593"></span><span class="hs-comment">-- protocol version for the era times a 100</span><span>
</span><span id="line-594"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEraStartEpochNo"><span class="hs-identifier hs-type">impEraStartEpochNo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712489"><span class="annot"><a href="#local-6989586621679712489"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#Era"><span class="hs-identifier hs-type">Era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712489"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span>
</span><span id="line-595"></span><span id="impEraStartEpochNo"><span class="annot"><span class="annottext">impEraStartEpochNo :: forall era. Era era =&gt; EpochNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEraStartEpochNo"><span class="hs-identifier hs-var hs-var">impEraStartEpochNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; EpochNo
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-var">EpochNo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; Word64
forall i. Integral i =&gt; Version -&gt; i
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#getVersion"><span class="hs-identifier hs-var">getVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679714204"><span class="hs-identifier hs-var">majProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">100</span></span><span class="hs-special">)</span><span>
</span><span id="line-596"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-597"></span><span>    </span><span id="local-6989586621679714204"><span class="annot"><span class="annottext">majProtVer :: Version
</span><a href="#local-6989586621679714204"><span class="hs-identifier hs-var hs-var">majProtVer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall era. Era era =&gt; Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#eraProtVerLow"><span class="hs-identifier hs-var">eraProtVerLow</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679712489"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitImpTestState"><span class="hs-identifier hs-type">defaultInitImpTestState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-600"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712425"><span class="annot"><a href="#local-6989586621679712425"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621679712426"><span class="annot"><a href="#local-6989586621679712426"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679712428"><span class="annot"><a href="#local-6989586621679712428"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679712427"><span class="annot"><a href="#local-6989586621679712427"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712425"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#EraTxOut"><span class="hs-identifier hs-type">EraTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712425"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-603"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712426"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-604"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679712426"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712427"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-605"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712428"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712427"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-606"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679712427"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-607"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-608"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712425"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-609"></span><span>  </span><span class="annot"><a href="#local-6989586621679712427"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712425"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span id="defaultInitImpTestState"><span class="annot"><span class="annottext">defaultInitImpTestState :: forall era s g (m :: * -&gt; *).
(EraGov era, EraTxOut era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
NewEpochState era -&gt; m (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#defaultInitImpTestState"><span class="hs-identifier hs-var hs-var">defaultInitImpTestState</span></a></span></span><span> </span><span id="local-6989586621679714268"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679714268"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-611"></span><span>  </span><span id="local-6989586621679714269"><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679714269"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall era s (m :: * -&gt; *) g.
(ShelleyEraImp era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
m (Genesis era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initGenesis"><span class="hs-identifier hs-var">initGenesis</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span>
</span><span id="line-612"></span><span>  </span><span id="local-6989586621679714270"><span class="annot"><span class="annottext">KeyHash 'Payment
</span><a href="#local-6989586621679714270"><span class="hs-identifier hs-var">rootKeyHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-613"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-614"></span><span>    </span><span class="annot"><a href="#local-6989586621679714271"><span class="hs-identifier hs-type">rootAddr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier hs-type">Addr</span></a></span><span>
</span><span id="line-615"></span><span>    </span><span id="local-6989586621679714271"><span class="annot"><span class="annottext">rootAddr :: Addr
</span><a href="#local-6989586621679714271"><span class="hs-identifier hs-var hs-var">rootAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment -&gt; StakeReference -&gt; Addr
forall p s.
(MakeCredential p 'Payment, MakeStakeReference s) =&gt;
p -&gt; s -&gt; Addr
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkAddr"><span class="hs-identifier hs-var">mkAddr</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment
</span><a href="#local-6989586621679714270"><span class="hs-identifier hs-var">rootKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">StakeReference
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#StakeRefNull"><span class="hs-identifier hs-var">StakeRefNull</span></a></span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><a href="#local-6989586621679714274"><span class="hs-identifier hs-type">rootTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712425"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-617"></span><span>    </span><span id="local-6989586621679714274"><span class="annot"><span class="annottext">rootTxOut :: TxOut era
</span><a href="#local-6989586621679714274"><span class="hs-identifier hs-var hs-var">rootTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr -&gt; Value era -&gt; TxOut era
forall era.
(EraTxOut era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; TxOut era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxOut"><span class="hs-identifier hs-var">mkBasicTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679714271"><span class="hs-identifier hs-var">rootAddr</span></a></span><span> </span><span class="annot"><span class="annottext">(Value era -&gt; TxOut era) -&gt; Value era -&gt; TxOut era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t s. Inject t s =&gt; t -&gt; s
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679714277"><span class="hs-identifier hs-var">rootCoin</span></a></span><span>
</span><span id="line-618"></span><span>    </span><span id="local-6989586621679714277"><span class="annot"><span class="annottext">rootCoin :: Coin
</span><a href="#local-6989586621679714277"><span class="hs-identifier hs-var hs-var">rootCoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesis -&gt; Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#sgMaxLovelaceSupply"><span class="hs-identifier hs-var">sgMaxLovelaceSupply</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679714269"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-619"></span><span>    </span><span class="annot"><a href="#local-6989586621679714280"><span class="hs-identifier hs-type">rootTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span id="local-6989586621679714280"><span class="annot"><span class="annottext">rootTxIn :: TxIn
</span><a href="#local-6989586621679714280"><span class="hs-identifier hs-var hs-var">rootTxIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-var">TxIn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; TxId
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#mkTxId"><span class="hs-identifier hs-var">mkTxId</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxIx
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span>
</span><span id="line-621"></span><span>    </span><span id="local-6989586621679714284"><span class="annot"><span class="annottext">nesWithRoot :: NewEpochState era
</span><a href="#local-6989586621679714284"><span class="hs-identifier hs-var hs-var">nesWithRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679714268"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; (NewEpochState era -&gt; NewEpochState era) -&gt; NewEpochState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(UTxO era -&gt; Identity (UTxO era))
-&gt; NewEpochState era -&gt; Identity (NewEpochState era)
forall era. Lens' (NewEpochState era) (UTxO era)
forall (t :: * -&gt; *) era. CanSetUTxO t =&gt; Lens' (t era) (UTxO era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#utxoL"><span class="hs-identifier hs-var">utxoL</span></a></span><span> </span><span class="annot"><span class="annottext">((UTxO era -&gt; Identity (UTxO era))
 -&gt; NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; UTxO era -&gt; NewEpochState era -&gt; NewEpochState era
forall a s t. Monoid a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%3C%3E~"><span class="hs-operator hs-var">&lt;&gt;~</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era) -&gt; UTxO era
forall era. Map TxIn (TxOut era) -&gt; UTxO era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#UTxO"><span class="hs-identifier hs-var">UTxO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxOut era -&gt; Map TxIn (TxOut era)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679714280"><span class="hs-identifier hs-var">rootTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679714274"><span class="hs-identifier hs-var">rootTxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-622"></span><span>  </span><span id="local-6989586621679714287"><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679714287"><span class="hs-identifier hs-var">prepState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m s
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-623"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679714288"><span class="annot"><span class="annottext">epochInfoE :: EpochInfo (Either Text)
</span><a href="#local-6989586621679714288"><span class="hs-identifier hs-var hs-var">epochInfoE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-624"></span><span>        </span><span class="annot"><span class="annottext">EpochSize -&gt; SlotLength -&gt; EpochInfo (Either Text)
forall (m :: * -&gt; *).
Monad m =&gt;
EpochSize -&gt; SlotLength -&gt; EpochInfo m
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.EpochInfo.Impl.html#fixedEpochInfo"><span class="hs-identifier hs-var">fixedEpochInfo</span></a></span><span>
</span><span id="line-625"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesis -&gt; EpochSize
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#sgEpochLength"><span class="hs-identifier hs-var">sgEpochLength</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679714269"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NominalDiffTime -&gt; SlotLength
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Time.html#mkSlotLength"><span class="hs-identifier hs-var">mkSlotLength</span></a></span><span> </span><span class="annot"><span class="annottext">(NominalDiffTime -&gt; SlotLength)
-&gt; (NominalDiffTimeMicro -&gt; NominalDiffTime)
-&gt; NominalDiffTimeMicro
-&gt; SlotLength
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NominalDiffTimeMicro -&gt; NominalDiffTime
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#fromNominalDiffTimeMicro"><span class="hs-identifier hs-var">fromNominalDiffTimeMicro</span></a></span><span> </span><span class="annot"><span class="annottext">(NominalDiffTimeMicro -&gt; SlotLength)
-&gt; NominalDiffTimeMicro -&gt; SlotLength
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis -&gt; NominalDiffTimeMicro
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#sgSlotLength"><span class="hs-identifier hs-var">sgSlotLength</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679714269"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>      </span><span id="local-6989586621679714291"><span class="annot"><span class="annottext">globals :: Globals
</span><a href="#local-6989586621679714291"><span class="hs-identifier hs-var hs-var">globals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis -&gt; EpochInfo (Either Text) -&gt; Globals
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#mkShelleyGlobals"><span class="hs-identifier hs-var">mkShelleyGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679714269"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Either Text)
</span><a href="#local-6989586621679714288"><span class="hs-identifier hs-var">epochInfoE</span></a></span><span>
</span><span id="line-628"></span><span>      </span><span id="local-6989586621679714292"><span class="annot"><span class="annottext">epochNo :: EpochNo
</span><a href="#local-6989586621679714292"><span class="hs-identifier hs-var hs-var">epochNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679714284"><span class="hs-identifier hs-var">nesWithRoot</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting EpochNo (NewEpochState era) EpochNo -&gt; EpochNo
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting EpochNo (NewEpochState era) EpochNo
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochNo -&gt; f EpochNo)
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesELL"><span class="hs-identifier hs-var">nesELL</span></a></span><span>
</span><span id="line-629"></span><span>      </span><span id="local-6989586621679714293"><span class="annot"><span class="annottext">slotNo :: SlotNo
</span><a href="#local-6989586621679714293"><span class="hs-identifier hs-var hs-var">slotNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; EpochInfo Identity -&gt; EpochNo -&gt; SlotNo
EpochInfo Identity -&gt; EpochNo -&gt; SlotNo
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html#epochInfoFirst"><span class="hs-identifier hs-var">epochInfoFirst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Globals -&gt; EpochInfo Identity
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#epochInfoPure"><span class="hs-identifier hs-var">epochInfoPure</span></a></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679714291"><span class="hs-identifier hs-var">globals</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679714292"><span class="hs-identifier hs-var">epochNo</span></a></span><span>
</span><span id="line-630"></span><span>  </span><span class="annot"><span class="annottext">ImpTestState era -&gt; m (ImpTestState era)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; m (ImpTestState era))
-&gt; ImpTestState era -&gt; m (ImpTestState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-631"></span><span>    </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span>
</span><span id="line-632"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">impNES :: NewEpochState era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNES"><span class="hs-identifier hs-var">impNES</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679714284"><span class="hs-identifier hs-var">nesWithRoot</span></a></span><span>
</span><span id="line-633"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impRootTxIn :: TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxIn"><span class="hs-identifier hs-var">impRootTxIn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679714280"><span class="hs-identifier hs-var">rootTxIn</span></a></span><span>
</span><span id="line-634"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impKeyPairs :: Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impKeyPairs"><span class="hs-identifier hs-var">impKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679714287"><span class="hs-identifier hs-var">prepState</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; Getting
     (Map (KeyHash 'Witness) (KeyPair 'Witness))
     s
     (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map (KeyHash 'Witness) (KeyPair 'Witness))
  s
  (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall t.
HasKeyPairs t =&gt;
Lens' t (Map (KeyHash 'Witness) (KeyPair 'Witness))
Lens' s (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsL"><span class="hs-identifier hs-var">keyPairsL</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impByronKeyPairs :: Map BootstrapAddress ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impByronKeyPairs"><span class="hs-identifier hs-var">impByronKeyPairs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">s
</span><a href="#local-6989586621679714287"><span class="hs-identifier hs-var">prepState</span></a></span><span> </span><span class="annot"><span class="annottext">s
-&gt; Getting
     (Map BootstrapAddress ByronKeyPair)
     s
     (Map BootstrapAddress ByronKeyPair)
-&gt; Map BootstrapAddress ByronKeyPair
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map BootstrapAddress ByronKeyPair)
  s
  (Map BootstrapAddress ByronKeyPair)
forall t.
HasKeyPairs t =&gt;
Lens' t (Map BootstrapAddress ByronKeyPair)
Lens' s (Map BootstrapAddress ByronKeyPair)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsByronL"><span class="hs-identifier hs-var">keyPairsByronL</span></a></span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impNativeScripts :: Map ScriptHash (NativeScript era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScripts"><span class="hs-identifier hs-var">impNativeScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-637"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impLastTick :: SlotNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTick"><span class="hs-identifier hs-var">impLastTick</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679714293"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-638"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impGlobals :: Globals
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobals"><span class="hs-identifier hs-var">impGlobals</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679714291"><span class="hs-identifier hs-var">globals</span></a></span><span>
</span><span id="line-639"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">impEvents :: [SomeSTSEvent era]
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEvents"><span class="hs-identifier hs-var">impEvents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SomeSTSEvent era]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-640"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withEachEraVersion"><span class="hs-identifier hs-type">withEachEraVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712547"><span class="annot"><a href="#local-6989586621679712547"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-644"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712547"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-645"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712547"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-646"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#Spec"><span class="hs-identifier hs-type">Spec</span></a></span><span>
</span><span id="line-647"></span><span id="withEachEraVersion"><span class="annot"><span class="annottext">withEachEraVersion :: forall era.
ShelleyEraImp era =&gt;
SpecWith (ImpInit (LedgerSpec era)) -&gt; Spec
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withEachEraVersion"><span class="hs-identifier hs-var hs-var">withEachEraVersion</span></a></span></span><span> </span><span id="local-6989586621679714314"><span class="annot"><span class="annottext">SpecWith (ImpInit (LedgerSpec era))
</span><a href="#local-6989586621679714314"><span class="hs-identifier hs-var">specWith</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-648"></span><span>  </span><span class="annot"><span class="annottext">forall t. ImpSpec t =&gt; SpecWith (ImpInit t) -&gt; Spec
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#withImpInit"><span class="hs-identifier hs-var">withImpInit</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712547"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SpecWith (ImpInit (LedgerSpec era)) -&gt; Spec)
-&gt; SpecWith (ImpInit (LedgerSpec era)) -&gt; Spec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-649"></span><span>    </span><span class="annot"><span class="annottext">[Version]
-&gt; (Version -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era. Era era =&gt; [Version]
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#eraProtVersions"><span class="hs-identifier hs-var">eraProtVersions</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679712547"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Version -&gt; SpecWith (ImpInit (LedgerSpec era)))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (Version -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679714318"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679714318"><span class="hs-identifier hs-var">protVer</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-650"></span><span>      </span><span class="annot"><span class="annottext">[Char]
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a. HasCallStack =&gt; [Char] -&gt; SpecWith a -&gt; SpecWith a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.html#describe"><span class="hs-identifier hs-var">describe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679714318"><span class="hs-identifier hs-var">protVer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-651"></span><span>        </span><span class="annot"><span class="annottext">Version
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall era.
(ShelleyEraImp era, ShelleyEraImp era) =&gt;
Version
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitProtVer"><span class="hs-identifier hs-var">modifyImpInitProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679714318"><span class="hs-identifier hs-var">protVer</span></a></span><span> </span><span class="annot"><span class="annottext">SpecWith (ImpInit (LedgerSpec era))
</span><a href="#local-6989586621679714314"><span class="hs-identifier hs-var">specWith</span></a></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyModifyImpInitProtVer"><span class="hs-identifier hs-type">shelleyModifyImpInitProtVer</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-654"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712561"><span class="annot"><a href="#local-6989586621679712561"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-655"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712561"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-656"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-657"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712561"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-658"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712561"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span id="shelleyModifyImpInitProtVer"><span class="annot"><span class="annottext">shelleyModifyImpInitProtVer :: forall era.
ShelleyEraImp era =&gt;
Version
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyModifyImpInitProtVer"><span class="hs-identifier hs-var hs-var">shelleyModifyImpInitProtVer</span></a></span></span><span> </span><span id="local-6989586621679714333"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679714333"><span class="hs-identifier hs-var">ver</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-660"></span><span>  </span><span class="annot"><span class="annottext">(ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall t.
(ImpInit t -&gt; ImpInit t)
-&gt; SpecWith (ImpInit t) -&gt; SpecWith (ImpInit t)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#modifyImpInit"><span class="hs-identifier hs-var">modifyImpInit</span></a></span><span> </span><span class="annot"><span class="annottext">((ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679714335"><span class="annot"><span class="annottext">ImpInit (LedgerSpec era)
</span><a href="#local-6989586621679714335"><span class="hs-identifier hs-var">impInit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-661"></span><span>    </span><span class="annot"><span class="annottext">ImpInit (LedgerSpec era)
</span><a href="#local-6989586621679714335"><span class="hs-identifier hs-var">impInit</span></a></span><span>
</span><span id="line-662"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitState"><span class="hs-identifier hs-var">impInitState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-663"></span><span>          </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitState"><span class="hs-identifier hs-var">impInitState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714335"><span class="hs-identifier hs-type">impInit</span></a></span><span>
</span><span id="line-664"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier hs-type">impNESL</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-type">nesEsL</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-type">curPParamsEpochStateL</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">.</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppProtocolVersionL"><span class="hs-identifier hs-type">ppProtocolVersionL</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-type">.~</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714333"><span class="hs-identifier hs-type">ver</span></a></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span>
</span><span id="line-665"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostSubmitTxHook"><span class="hs-identifier hs-type">modifyImpInitPostSubmitTxHook</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712565"><span class="annot"><a href="#local-6989586621679712565"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-669"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712566"><span class="annot"><a href="#local-6989586621679712566"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-670"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-671"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712565"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-672"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-673"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712565"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>      </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712565"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712565"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712566"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-677"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712565"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712565"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-679"></span><span id="modifyImpInitPostSubmitTxHook"><span class="annot"><span class="annottext">modifyImpInitPostSubmitTxHook :: forall era.
(forall t.
 Globals
 -&gt; TRC (EraRule &quot;LEDGER&quot; era)
 -&gt; Either
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
      (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
 -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostSubmitTxHook"><span class="hs-identifier hs-var hs-var">modifyImpInitPostSubmitTxHook</span></a></span></span><span> </span><span id="local-6989586621679714337"><span class="annot"><span class="annottext">forall t.
Globals
-&gt; TRC (EraRule &quot;LEDGER&quot; era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
     (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
-&gt; ImpM t ()
</span><a href="#local-6989586621679714337"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-680"></span><span>  </span><span class="annot"><span class="annottext">(ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall t.
(ImpInit t -&gt; ImpInit t)
-&gt; SpecWith (ImpInit t) -&gt; SpecWith (ImpInit t)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#modifyImpInit"><span class="hs-identifier hs-var">modifyImpInit</span></a></span><span> </span><span class="annot"><span class="annottext">((ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679714338"><span class="annot"><span class="annottext">ImpInit (LedgerSpec era)
</span><a href="#local-6989586621679714338"><span class="hs-identifier hs-var">impInit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-681"></span><span>    </span><span class="annot"><span class="annottext">ImpInit (LedgerSpec era)
</span><a href="#local-6989586621679714338"><span class="hs-identifier hs-var">impInit</span></a></span><span>
</span><span id="line-682"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitEnv"><span class="hs-identifier hs-var">impInitEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-683"></span><span>          </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitEnv"><span class="hs-identifier hs-var">impInitEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714338"><span class="hs-identifier hs-type">impInit</span></a></span><span>
</span><span id="line-684"></span><span>            </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHookL"><span class="hs-identifier hs-type">itePostSubmitTxHookL</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-type">.~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714337"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-685"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-686"></span><span>
</span><span id="line-687"></span><span id="local-6989586621679712572"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostSubmitTxHook"><span class="hs-identifier hs-type">disableImpInitPostSubmitTxHook</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-688"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712572"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-689"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712572"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-690"></span><span id="disableImpInitPostSubmitTxHook"><span class="annot"><span class="annottext">disableImpInitPostSubmitTxHook :: forall era.
SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostSubmitTxHook"><span class="hs-identifier hs-var hs-var">disableImpInitPostSubmitTxHook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><span class="annottext">(forall t.
 Globals
 -&gt; TRC (EraRule &quot;LEDGER&quot; era)
 -&gt; Either
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
      (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
 -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall era.
(forall t.
 Globals
 -&gt; TRC (EraRule &quot;LEDGER&quot; era)
 -&gt; Either
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
      (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
 -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostSubmitTxHook"><span class="hs-identifier hs-var">modifyImpInitPostSubmitTxHook</span></a></span><span> </span><span class="annot"><span class="annottext">((forall t.
  Globals
  -&gt; TRC (EraRule &quot;LEDGER&quot; era)
  -&gt; Either
       (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
       (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
  -&gt; ImpM t ())
 -&gt; SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (forall t.
    Globals
    -&gt; TRC (EraRule &quot;LEDGER&quot; era)
    -&gt; Either
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
         (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
    -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Globals
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TRC (EraRule &quot;LEDGER&quot; era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
  (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ImpM t ()
forall a. a -&gt; ImpM t a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostEpochBoundaryHook"><span class="hs-identifier hs-type">modifyImpInitPostEpochBoundaryHook</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712575"><span class="annot"><a href="#local-6989586621679712575"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712576"><span class="annot"><a href="#local-6989586621679712576"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-696"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-697"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712575"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-698"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712575"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-699"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712576"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-701"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712575"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-702"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712575"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-703"></span><span id="modifyImpInitPostEpochBoundaryHook"><span class="annot"><span class="annottext">modifyImpInitPostEpochBoundaryHook :: forall era.
(forall t.
 Globals
 -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostEpochBoundaryHook"><span class="hs-identifier hs-var hs-var">modifyImpInitPostEpochBoundaryHook</span></a></span></span><span> </span><span id="local-6989586621679714342"><span class="annot"><span class="annottext">forall t.
Globals
-&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; ImpM t ()
</span><a href="#local-6989586621679714342"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall t.
(ImpInit t -&gt; ImpInit t)
-&gt; SpecWith (ImpInit t) -&gt; SpecWith (ImpInit t)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#modifyImpInit"><span class="hs-identifier hs-var">modifyImpInit</span></a></span><span> </span><span class="annot"><span class="annottext">((ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (ImpInit (LedgerSpec era) -&gt; ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679714343"><span class="annot"><span class="annottext">ImpInit (LedgerSpec era)
</span><a href="#local-6989586621679714343"><span class="hs-identifier hs-var">impInit</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-704"></span><span>  </span><span class="annot"><span class="annottext">ImpInit (LedgerSpec era)
</span><a href="#local-6989586621679714343"><span class="hs-identifier hs-var">impInit</span></a></span><span>
</span><span id="line-705"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitEnv"><span class="hs-identifier hs-var">impInitEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-706"></span><span>        </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impInitEnv"><span class="hs-identifier hs-var">impInitEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714343"><span class="hs-identifier hs-type">impInit</span></a></span><span>
</span><span id="line-707"></span><span>          </span><span class="annot"><span class="hs-operator hs-type">&amp;</span></span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHookL"><span class="hs-identifier hs-type">itePostEpochBoundaryHookL</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-type">.~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714342"><span class="hs-identifier hs-type">f</span></a></span><span>
</span><span id="line-708"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-709"></span><span>
</span><span id="line-710"></span><span id="local-6989586621679714345"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostEpochBoundaryHook"><span class="hs-identifier hs-type">disableImpInitPostEpochBoundaryHook</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714345"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-712"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679714345"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-713"></span><span id="disableImpInitPostEpochBoundaryHook"><span class="annot"><span class="annottext">disableImpInitPostEpochBoundaryHook :: forall era.
SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostEpochBoundaryHook"><span class="hs-identifier hs-var hs-var">disableImpInitPostEpochBoundaryHook</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-714"></span><span>  </span><span class="annot"><span class="annottext">(forall t.
 Globals
 -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall era.
(forall t.
 Globals
 -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitPostEpochBoundaryHook"><span class="hs-identifier hs-var">modifyImpInitPostEpochBoundaryHook</span></a></span><span> </span><span class="annot"><span class="annottext">((forall t.
  Globals
  -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
  -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
  -&gt; ImpM t ())
 -&gt; SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (forall t.
    Globals
    -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
    -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
    -&gt; ImpM t ())
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Globals
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TRC (EraRule &quot;NEWEPOCH&quot; era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;NEWEPOCH&quot; era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; ImpM t ()
forall a. a -&gt; ImpM t a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>
</span><span id="line-716"></span><span id="local-6989586621679712583"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableInConformanceIt"><span class="hs-identifier hs-type">disableInConformanceIt</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-717"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712583"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-718"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-719"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712583"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-720"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.Monad.html#SpecWith"><span class="hs-identifier hs-type">SpecWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpInit"><span class="hs-identifier hs-type">ImpInit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#LedgerSpec"><span class="hs-identifier hs-type">LedgerSpec</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712583"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-721"></span><span id="disableInConformanceIt"><span class="annot"><span class="annottext">disableInConformanceIt :: forall era.
ShelleyEraImp era =&gt;
[Char] -&gt; ImpTestM era () -&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableInConformanceIt"><span class="hs-identifier hs-var hs-var">disableInConformanceIt</span></a></span></span><span> </span><span id="local-6989586621679714356"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679714356"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-722"></span><span>  </span><span class="annot"><span class="annottext">SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall era.
SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostSubmitTxHook"><span class="hs-identifier hs-var">disableImpInitPostSubmitTxHook</span></a></span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><span class="annottext">(SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (ImpTestM era () -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; ImpTestM era ()
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall era.
SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableImpInitPostEpochBoundaryHook"><span class="hs-identifier hs-var">disableImpInitPostEpochBoundaryHook</span></a></span><span>
</span><span id="line-724"></span><span>    </span><span class="annot"><span class="annottext">(SpecWith (ImpInit (LedgerSpec era))
 -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; (ImpTestM era () -&gt; SpecWith (ImpInit (LedgerSpec era)))
-&gt; ImpTestM era ()
-&gt; SpecWith (ImpInit (LedgerSpec era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era () -&gt; SpecWith (Arg (ImpTestM era ()))
forall a.
(HasCallStack, Example a) =&gt;
[Char] -&gt; a -&gt; SpecWith (Arg a)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-core-2.11.13-707e7990f927091784a53f26b416ab321bc8328c835764c4a4c0a3c59ebc02a5/share/doc/html/src/Test.Hspec.Core.Spec.html#it"><span class="hs-identifier hs-var">it</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679714356"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; [disabled in conformance]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span id="local-6989586621679712592"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLedgerEnv"><span class="hs-identifier hs-type">impLedgerEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712592"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712592"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712592"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#LedgerEnv"><span class="hs-identifier hs-type">LedgerEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712592"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-727"></span><span id="impLedgerEnv"><span class="annot"><span class="annottext">impLedgerEnv :: forall era.
EraGov era =&gt;
NewEpochState era -&gt; ImpTestM era (LedgerEnv era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLedgerEnv"><span class="hs-identifier hs-var hs-var">impLedgerEnv</span></a></span></span><span> </span><span id="local-6989586621679714374"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679714374"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-728"></span><span>  </span><span id="local-6989586621679714375"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679714375"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; SlotNo) -&gt; ImpM (LedgerSpec era) SlotNo
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; SlotNo
forall era. ImpTestState era -&gt; SlotNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTick"><span class="hs-identifier hs-var">impLastTick</span></a></span><span>
</span><span id="line-729"></span><span>  </span><span id="local-6989586621679714376"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679714376"><span class="hs-identifier hs-var">epochNo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShelleyBase EpochNo -&gt; ImpTestM era EpochNo
forall a era. ShelleyBase a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runShelleyBase"><span class="hs-identifier hs-var">runShelleyBase</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyBase EpochNo -&gt; ImpTestM era EpochNo)
-&gt; ShelleyBase EpochNo -&gt; ImpTestM era EpochNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; ShelleyBase EpochNo
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html#epochFromSlot"><span class="hs-identifier hs-var">epochFromSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679714375"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-730"></span><span>  </span><span class="annot"><span class="annottext">LedgerEnv era -&gt; ImpTestM era (LedgerEnv era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-731"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#LedgerEnv"><span class="hs-identifier hs-type">LedgerEnv</span></a></span><span>
</span><span id="line-732"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ledgerSlotNo :: SlotNo
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#ledgerSlotNo"><span class="hs-identifier hs-var">ledgerSlotNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679714375"><span class="hs-identifier hs-var">slotNo</span></a></span><span>
</span><span id="line-733"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerEpochNo :: Maybe EpochNo
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#ledgerEpochNo"><span class="hs-identifier hs-var">ledgerEpochNo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Maybe EpochNo
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679714376"><span class="hs-identifier hs-var">epochNo</span></a></span><span>
</span><span id="line-734"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerPp :: PParams era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#ledgerPp"><span class="hs-identifier hs-var">ledgerPp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679714374"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting (PParams era) (NewEpochState era) (PParams era)
-&gt; PParams era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const (PParams era) (EpochState era))
-&gt; NewEpochState era -&gt; Const (PParams era) (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const (PParams era) (EpochState era))
 -&gt; NewEpochState era -&gt; Const (PParams era) (NewEpochState era))
-&gt; ((PParams era -&gt; Const (PParams era) (PParams era))
    -&gt; EpochState era -&gt; Const (PParams era) (EpochState era))
-&gt; Getting (PParams era) (NewEpochState era) (PParams era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const (PParams era) (PParams era))
-&gt; EpochState era -&gt; Const (PParams era) (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span>
</span><span id="line-735"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerIx :: TxIx
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#ledgerIx"><span class="hs-identifier hs-var">ledgerIx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; TxIx
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#TxIx"><span class="hs-identifier hs-var">TxIx</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">0</span></span><span>
</span><span id="line-736"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerAccount :: ChainAccountState
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Rules.Ledger.html#ledgerAccount"><span class="hs-identifier hs-var">ledgerAccount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679714374"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting ChainAccountState (NewEpochState era) ChainAccountState
-&gt; ChainAccountState
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ChainAccountState (NewEpochState era) ChainAccountState
forall era. Lens' (NewEpochState era) ChainAccountState
forall (t :: * -&gt; *) era.
CanSetChainAccountState t =&gt;
Lens' (t era) ChainAccountState
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.ChainAccount.html#chainAccountStateL"><span class="hs-identifier hs-var">chainAccountStateL</span></a></span><span>
</span><span id="line-737"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-738"></span><span>
</span><span id="line-739"></span><span class="hs-comment">-- | Modify the previous PParams in the current state with the given function. For current</span><span>
</span><span id="line-740"></span><span class="hs-comment">-- and future PParams, use `modifyPParams`</span><span>
</span><span id="line-741"></span><span id="local-6989586621679712600"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyPrevPParams"><span class="hs-identifier hs-type">modifyPrevPParams</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-742"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712600"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-743"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712600"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712600"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-744"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712600"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-745"></span><span id="modifyPrevPParams"><span class="annot"><span class="annottext">modifyPrevPParams :: forall era.
EraGov era =&gt;
(PParams era -&gt; PParams era) -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyPrevPParams"><span class="hs-identifier hs-var hs-var">modifyPrevPParams</span></a></span></span><span> </span><span id="local-6989586621679714390"><span class="annot"><span class="annottext">PParams era -&gt; PParams era
</span><a href="#local-6989586621679714390"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ()
forall era.
(NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyNES"><span class="hs-identifier hs-var">modifyNES</span></a></span><span> </span><span class="annot"><span class="annottext">((NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ())
-&gt; (NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Identity (EpochState era))
-&gt; NewEpochState era -&gt; Identity (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Identity (EpochState era))
 -&gt; NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; ((PParams era -&gt; Identity (PParams era))
    -&gt; EpochState era -&gt; Identity (EpochState era))
-&gt; (PParams era -&gt; Identity (PParams era))
-&gt; NewEpochState era
-&gt; Identity (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Identity (PParams era))
-&gt; EpochState era -&gt; Identity (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#prevPParamsEpochStateL"><span class="hs-identifier hs-var">prevPParamsEpochStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; Identity (PParams era))
 -&gt; NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; (PParams era -&gt; PParams era)
-&gt; NewEpochState era
-&gt; NewEpochState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; PParams era
</span><a href="#local-6989586621679714390"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span class="annot"><span class="hs-comment">-- | Logs the current stake distribution</span></span><span>
</span><span id="line-748"></span><span id="local-6989586621679712602"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logInstantStake"><span class="hs-identifier hs-type">logInstantStake</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Stake.html#InstantStake"><span class="hs-identifier hs-type">InstantStake</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712602"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712602"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-749"></span><span id="logInstantStake"><span class="annot"><span class="annottext">logInstantStake :: forall era.
(ToExpr (InstantStake era), HasCallStack) =&gt;
ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logInstantStake"><span class="hs-identifier hs-var hs-var">logInstantStake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-750"></span><span>  </span><span id="local-6989586621679714401"><span class="annot"><span class="annottext">InstantStake era
</span><a href="#local-6989586621679714401"><span class="hs-identifier hs-var">stakeDistr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (InstantStake era)
-&gt; ImpTestM era (InstantStake era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">Getting r (NewEpochState era) (InstantStake era)
SimpleGetter (NewEpochState era) (InstantStake era)
forall era. SimpleGetter (NewEpochState era) (InstantStake era)
forall (t :: * -&gt; *) era.
CanGetInstantStake t =&gt;
SimpleGetter (t era) (InstantStake era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Stake.html#instantStakeG"><span class="hs-identifier hs-var">instantStakeG</span></a></span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; ImpTestM era ()
forall t. HasCallStack =&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logDoc"><span class="hs-identifier hs-var">logDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpTestM era ())
-&gt; Doc AnsiStyle -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Instant Stake: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InstantStake era -&gt; Doc AnsiStyle
forall a. ToExpr a =&gt; a -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExpr"><span class="hs-identifier hs-var">ansiExpr</span></a></span><span> </span><span class="annot"><span class="annottext">InstantStake era
</span><a href="#local-6989586621679714401"><span class="hs-identifier hs-var">stakeDistr</span></a></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#mkTxId"><span class="hs-identifier hs-type">mkTxId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxId"><span class="hs-identifier hs-type">TxId</span></a></span><span>
</span><span id="line-754"></span><span id="mkTxId"><span class="annot"><span class="annottext">mkTxId :: Int -&gt; TxId
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#mkTxId"><span class="hs-identifier hs-var hs-var">mkTxId</span></a></span></span><span> </span><span id="local-6989586621679714406"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679714406"><span class="hs-identifier hs-var">idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody -&gt; TxId
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxId"><span class="hs-identifier hs-var">TxId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SafeHash EraIndependentTxBody
forall a. Int -&gt; SafeHash a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Utils.html#mkDummySafeHash"><span class="hs-identifier hs-var">mkDummySafeHash</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679714406"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-757"></span><span>  </span><span id="local-6989586621679714547"><span id="local-6989586621679714559"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#ShelleyEraScript"><span class="hs-identifier hs-type">ShelleyEraScript</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-758"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span></span></span><span>
</span><span id="line-759"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-760"></span><span>  </span><span id="local-6989586621679715407"><span class="annot"><span class="annottext">initGenesis :: forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadFail m) =&gt;
m (Genesis ShelleyEra)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initGenesis"><span class="hs-identifier hs-var hs-var hs-var hs-var">initGenesis</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-762"></span><span>      </span><span id="local-6989586621679715510"><span class="annot"><span class="annottext">gen :: ShelleyGenesis
</span><a href="#local-6989586621679715510"><span class="hs-identifier hs-var hs-var">gen</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-763"></span><span>        </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier hs-type">ShelleyGenesis</span></a></span><span>
</span><span id="line-764"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sgSystemStart :: UTCTime
</span><a href="#local-6989586621679715512"><span class="hs-identifier hs-var">sgSystemStart</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Fail UTCTime -&gt; UTCTime
forall a. HasCallStack =&gt; Fail a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/FailT-0.1.2.0-a6bfc8b1703d475e2ae00d40307128c8b38b30577dae60bdff0e62519ebdc06b/share/doc/html/src/Control.Monad.Trans.Fail.String.html#errorFail"><span class="hs-identifier hs-var">errorFail</span></a></span><span> </span><span class="annot"><span class="annottext">(Fail UTCTime -&gt; UTCTime) -&gt; Fail UTCTime -&gt; UTCTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Fail UTCTime
forall (m :: * -&gt; *) t. (MonadFail m, ISO8601 t) =&gt; [Char] -&gt; m t
</span><span class="hs-identifier hs-var">iso8601ParseM</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;2017-09-23T21:44:51Z&quot;</span></span><span>
</span><span id="line-765"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgNetworkMagic :: Word32
</span><a href="#local-6989586621679715513"><span class="hs-identifier hs-var">sgNetworkMagic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">123_456</span></span><span> </span><span class="hs-comment">-- Mainnet value: 764824073</span><span>
</span><span id="line-766"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgNetworkId :: Network
</span><a href="#local-6989586621679715514"><span class="hs-identifier hs-var">sgNetworkId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Testnet"><span class="hs-identifier hs-var">Testnet</span></a></span><span>
</span><span id="line-767"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgActiveSlotsCoeff :: PositiveUnitInterval
</span><a href="#local-6989586621679715516"><span class="hs-identifier hs-var">sgActiveSlotsCoeff</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">20</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; PositiveUnitInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100</span></span><span> </span><span class="hs-comment">-- Mainnet value: 5 %! 100</span><span>
</span><span id="line-768"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgSecurityParam :: NonZero Word64
</span><a href="#local-6989586621679715517"><span class="hs-identifier hs-var">sgSecurityParam</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (n :: Natural) a.
(KnownNat n, 1 &lt;= n, WithinBounds n a, Num a) =&gt;
NonZero a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#knownNonZeroBounded"><span class="hs-identifier hs-var">knownNonZeroBounded</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-number">108</span></span><span> </span><span class="hs-comment">-- Mainnet value: 2160</span><span>
</span><span id="line-769"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgEpochLength :: EpochSize
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#sgEpochLength"><span class="hs-identifier hs-var">sgEpochLength</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochSize
</span><span class="hs-number">4320</span></span><span> </span><span class="hs-comment">-- Mainnet value: 432000</span><span>
</span><span id="line-770"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgSlotsPerKESPeriod :: Word64
</span><a href="#local-6989586621679715519"><span class="hs-identifier hs-var">sgSlotsPerKESPeriod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">129_600</span></span><span>
</span><span id="line-771"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgMaxKESEvolutions :: Word64
</span><a href="#local-6989586621679715520"><span class="hs-identifier hs-var">sgMaxKESEvolutions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">62</span></span><span>
</span><span id="line-772"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgSlotLength :: NominalDiffTimeMicro
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#sgSlotLength"><span class="hs-identifier hs-var">sgSlotLength</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NominalDiffTimeMicro
</span><span class="hs-number">1</span></span><span>
</span><span id="line-773"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgUpdateQuorum :: Word64
</span><a href="#local-6989586621679715521"><span class="hs-identifier hs-var">sgUpdateQuorum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">5</span></span><span>
</span><span id="line-774"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgMaxLovelaceSupply :: Word64
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#sgMaxLovelaceSupply"><span class="hs-identifier hs-var">sgMaxLovelaceSupply</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">45_000_000_000_000_000</span></span><span>
</span><span id="line-775"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgProtocolParams :: PParams ShelleyEra
</span><a href="#local-6989586621679715522"><span class="hs-identifier hs-var">sgProtocolParams</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-776"></span><span>              </span><span class="annot"><span class="annottext">PParams ShelleyEra
forall era. EraPParams era =&gt; PParams era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#emptyPParams"><span class="hs-identifier hs-var">emptyPParams</span></a></span><span>
</span><span id="line-777"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) Coin
Lens' (PParams ShelleyEra) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppMinFeeAL"><span class="hs-identifier hs-var">ppMinFeeAL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Coin -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">44</span></span><span>
</span><span id="line-778"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) Coin
Lens' (PParams ShelleyEra) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppMinFeeBL"><span class="hs-identifier hs-var">ppMinFeeBL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Coin -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">155_381</span></span><span>
</span><span id="line-779"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Identity Word32)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) Word32
Lens' (PParams ShelleyEra) Word32
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppMaxBBSizeL"><span class="hs-identifier hs-var">ppMaxBBSizeL</span></a></span><span> </span><span class="annot"><span class="annottext">((Word32 -&gt; Identity Word32)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Word32 -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">65_536</span></span><span>
</span><span id="line-780"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Word32 -&gt; Identity Word32)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) Word32
Lens' (PParams ShelleyEra) Word32
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppMaxTxSizeL"><span class="hs-identifier hs-var">ppMaxTxSizeL</span></a></span><span> </span><span class="annot"><span class="annottext">((Word32 -&gt; Identity Word32)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Word32 -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">16_384</span></span><span>
</span><span id="line-781"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) Coin
Lens' (PParams ShelleyEra) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppKeyDepositL"><span class="hs-identifier hs-var">ppKeyDepositL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Coin -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2_000_000</span></span><span>
</span><span id="line-782"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era.
(EraPParams era, HasCallStack) =&gt;
Lens' (PParams era) Coin
Lens' (PParams ShelleyEra) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppPoolDepositL"><span class="hs-identifier hs-var">ppPoolDepositL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Coin -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">500_000_000</span></span><span>
</span><span id="line-783"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EpochInterval -&gt; Identity EpochInterval)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) EpochInterval
Lens' (PParams ShelleyEra) EpochInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppEMaxL"><span class="hs-identifier hs-var">ppEMaxL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochInterval -&gt; Identity EpochInterval)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; EpochInterval -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; EpochInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochInterval"><span class="hs-identifier hs-var">EpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">18</span></span><span>
</span><span id="line-784"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Word16 -&gt; Identity Word16)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) Word16
Lens' (PParams ShelleyEra) Word16
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppNOptL"><span class="hs-identifier hs-var">ppNOptL</span></a></span><span> </span><span class="annot"><span class="annottext">((Word16 -&gt; Identity Word16)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Word16 -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">150</span></span><span>
</span><span id="line-785"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(NonNegativeInterval -&gt; Identity NonNegativeInterval)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era.
EraPParams era =&gt;
Lens' (PParams era) NonNegativeInterval
Lens' (PParams ShelleyEra) NonNegativeInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppA0L"><span class="hs-identifier hs-var">ppA0L</span></a></span><span> </span><span class="annot"><span class="annottext">((NonNegativeInterval -&gt; Identity NonNegativeInterval)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; NonNegativeInterval -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; NonNegativeInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-786"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(UnitInterval -&gt; Identity UnitInterval)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) UnitInterval
Lens' (PParams ShelleyEra) UnitInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppRhoL"><span class="hs-identifier hs-var">ppRhoL</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitInterval -&gt; Identity UnitInterval)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; UnitInterval -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">3</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; UnitInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1000</span></span><span class="hs-special">)</span><span>
</span><span id="line-787"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(UnitInterval -&gt; Identity UnitInterval)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) UnitInterval
Lens' (PParams ShelleyEra) UnitInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppTauL"><span class="hs-identifier hs-var">ppTauL</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitInterval -&gt; Identity UnitInterval)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; UnitInterval -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; UnitInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(UnitInterval -&gt; Identity UnitInterval)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era.
(EraPParams era, AtMostEra &quot;Alonzo&quot; era) =&gt;
Lens' (PParams era) UnitInterval
Lens' (PParams ShelleyEra) UnitInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppDL"><span class="hs-identifier hs-var">ppDL</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitInterval -&gt; Identity UnitInterval)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; UnitInterval -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; UnitInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Nonce -&gt; Identity Nonce)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era.
(EraPParams era, AtMostEra &quot;Alonzo&quot; era) =&gt;
Lens' (PParams era) Nonce
Lens' (PParams ShelleyEra) Nonce
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppExtraEntropyL"><span class="hs-identifier hs-var">ppExtraEntropyL</span></a></span><span> </span><span class="annot"><span class="annottext">((Nonce -&gt; Identity Nonce)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Nonce -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Nonce
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#NeutralNonce"><span class="hs-identifier hs-var">NeutralNonce</span></a></span><span>
</span><span id="line-790"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era.
(EraPParams era, AtMostEra &quot;Mary&quot; era) =&gt;
Lens' (PParams era) Coin
Lens' (PParams ShelleyEra) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppMinUTxOValueL"><span class="hs-identifier hs-var">ppMinUTxOValueL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Coin -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">2_000_000</span></span><span>
</span><span id="line-791"></span><span>                </span><span class="annot"><span class="annottext">PParams ShelleyEra
-&gt; (PParams ShelleyEra -&gt; PParams ShelleyEra) -&gt; PParams ShelleyEra
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra)
forall era. EraPParams era =&gt; Lens' (PParams era) Coin
Lens' (PParams ShelleyEra) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppMinPoolCostL"><span class="hs-identifier hs-var">ppMinPoolCostL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; PParams ShelleyEra -&gt; Identity (PParams ShelleyEra))
-&gt; Coin -&gt; PParams ShelleyEra -&gt; PParams ShelleyEra
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">340_000_000</span></span><span>
</span><span id="line-792"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- TODO: Add a top level definition and add private keys to ImpState:</span><span>
</span><span id="line-793"></span><span>            </span><span class="annot"><span class="annottext">sgGenDelegs :: Map (KeyHash 'Genesis) GenDelegPair
</span><a href="#local-6989586621679715541"><span class="hs-identifier hs-var">sgGenDelegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Genesis) GenDelegPair
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-794"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgInitialFunds :: ListMap Addr Coin
</span><a href="#local-6989586621679715542"><span class="hs-identifier hs-var">sgInitialFunds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListMap Addr Coin
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-795"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sgStaking :: ShelleyGenesisStaking
</span><a href="#local-6989586621679715543"><span class="hs-identifier hs-var">sgStaking</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesisStaking
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-796"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-797"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis -&gt; Either [ValidationErr] ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#validateGenesis"><span class="hs-identifier hs-var">validateGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679715510"><span class="hs-identifier hs-var">gen</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-798"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis -&gt; m ShelleyGenesis
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679715510"><span class="hs-identifier hs-var">gen</span></a></span><span>
</span><span id="line-799"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679715544"><span class="annot"><span class="annottext">[ValidationErr]
</span><a href="#local-6989586621679715544"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; m (Genesis ShelleyEra)
forall a. [Char] -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; [Char] -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m (Genesis ShelleyEra))
-&gt; ([Text] -&gt; [Char]) -&gt; [Text] -&gt; m (Genesis ShelleyEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; [Char]) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; [Char]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; m (Genesis ShelleyEra))
-&gt; [Text] -&gt; m (Genesis ShelleyEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(ValidationErr -&gt; Text) -&gt; [ValidationErr] -&gt; [Text]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">ValidationErr -&gt; Text
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Genesis.html#describeValidationErr"><span class="hs-identifier hs-var">describeValidationErr</span></a></span><span> </span><span class="annot"><span class="annottext">[ValidationErr]
</span><a href="#local-6989586621679715544"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-800"></span><span>
</span><span id="line-801"></span><span>  </span><span id="local-6989586621679715560"><span class="annot"><span class="annottext">initNewEpochState :: forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadFail m) =&gt;
m (NewEpochState ShelleyEra)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initNewEpochState"><span class="hs-identifier hs-var hs-var hs-var hs-var">initNewEpochState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-802"></span><span>    </span><span id="local-6989586621679715561"><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679715561"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall era s (m :: * -&gt; *) g.
(ShelleyEraImp era, HasKeyPairs s, MonadState s m,
 HasStatefulGen g m, MonadFail m) =&gt;
m (Genesis era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#initGenesis"><span class="hs-identifier hs-var">initGenesis</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679715562"><span class="annot"><span class="annottext">transContext :: FromByronTranslationContext
</span><a href="#local-6989586621679715562"><span class="hs-identifier hs-var hs-var">transContext</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis -&gt; FromByronTranslationContext
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Translation.html#toFromByronTranslationContext"><span class="hs-identifier hs-var">toFromByronTranslationContext</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis
</span><a href="#local-6989586621679715561"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span><span>
</span><span id="line-804"></span><span>        </span><span id="local-6989586621679715565"><span class="annot"><span class="annottext">startEpochNo :: EpochNo
</span><a href="#local-6989586621679715565"><span class="hs-identifier hs-var hs-var">startEpochNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall era. Era era =&gt; EpochNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEraStartEpochNo"><span class="hs-identifier hs-var">impEraStartEpochNo</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span>
</span><span id="line-805"></span><span>    </span><span class="annot"><span class="annottext">NewEpochState ShelleyEra -&gt; m (NewEpochState ShelleyEra)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(NewEpochState ShelleyEra -&gt; m (NewEpochState ShelleyEra))
-&gt; NewEpochState ShelleyEra -&gt; m (NewEpochState ShelleyEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FromByronTranslationContext
-&gt; EpochNo -&gt; UTxO -&gt; NewEpochState ShelleyEra
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.API.ByronTranslation.html#translateToShelleyLedgerStateFromUtxo"><span class="hs-identifier hs-var">translateToShelleyLedgerStateFromUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">FromByronTranslationContext
</span><a href="#local-6989586621679715562"><span class="hs-identifier hs-var">transContext</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679715565"><span class="hs-identifier hs-var">startEpochNo</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.UTxO.UTxO.html#empty"><span class="hs-identifier hs-var">Byron.empty</span></a></span><span>
</span><span id="line-806"></span><span>
</span><span id="line-807"></span><span>  </span><span id="local-6989586621679715591"><span class="annot"><span class="annottext">impSatisfyNativeScript :: Set (KeyHash 'Witness)
-&gt; TxBody ShelleyEra
-&gt; NativeScript ShelleyEra
-&gt; ImpTestM
     ShelleyEra (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyNativeScript"><span class="hs-identifier hs-var hs-var hs-var hs-var">impSatisfyNativeScript</span></a></span></span><span> </span><span id="local-6989586621679715592"><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715592"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span></span><span> </span><span id="local-6989586621679715593"><span class="annot"><span class="annottext">TxBody ShelleyEra
</span><a href="#local-6989586621679715593"><span class="hs-identifier hs-var">txBody</span></a></span></span><span> </span><span id="local-6989586621679715594"><span class="annot"><span class="annottext">NativeScript ShelleyEra
</span><a href="#local-6989586621679715594"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-808"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NativeScript ShelleyEra
</span><a href="#local-6989586621679715594"><span class="hs-identifier hs-var">script</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-809"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireSignature"><span class="hs-identifier hs-type">RequireSignature</span></a></span><span> </span><span id="local-6989586621679715595"><span class="annot"><span class="annottext">KeyHash 'Witness
</span><a href="#local-6989586621679715595"><span class="hs-identifier hs-var">keyHash</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
-&gt; Set (KeyHash 'Witness)
-&gt; ImpTestM
     ShelleyEra (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall era.
KeyHash 'Witness
-&gt; Set (KeyHash 'Witness)
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfySignature"><span class="hs-identifier hs-var">impSatisfySignature</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
</span><a href="#local-6989586621679715595"><span class="hs-identifier hs-var">keyHash</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715592"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span><span>
</span><span id="line-810"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireAllOf"><span class="hs-identifier hs-type">RequireAllOf</span></a></span><span> </span><span id="local-6989586621679715596"><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715596"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; TxBody ShelleyEra
-&gt; Int
-&gt; StrictSeq (NativeScript ShelleyEra)
-&gt; ImpTestM
     ShelleyEra (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall era.
ShelleyEraImp era =&gt;
Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyMNativeScripts"><span class="hs-identifier hs-var">impSatisfyMNativeScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715592"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody ShelleyEra
</span><a href="#local-6989586621679715593"><span class="hs-identifier hs-var">txBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra) -&gt; Int
forall a. StrictSeq a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715596"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715596"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-811"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireAnyOf"><span class="hs-identifier hs-type">RequireAnyOf</span></a></span><span> </span><span id="local-6989586621679715598"><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715598"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-812"></span><span>        </span><span id="local-6989586621679715599"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679715599"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Int, ImpM (LedgerSpec ShelleyEra) Int)]
-&gt; ImpM (LedgerSpec ShelleyEra) Int
forall (m :: * -&gt; *) a. MonadGen m =&gt; [(Int, m a)] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/quickcheck-transformer-0.3.1.2-8c69fd32e35ce43d2fa08d505758002237123724318b720a1bb6c013ff6e3bc9/share/doc/html/src/Test.QuickCheck.GenT.html#frequency"><span class="hs-identifier hs-var">frequency</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">9</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ImpM (LedgerSpec ShelleyEra) Int
forall a. a -&gt; ImpM (LedgerSpec ShelleyEra) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; ImpM (LedgerSpec ShelleyEra) Int
forall a. Random a =&gt; (a, a) -&gt; ImpM (LedgerSpec ShelleyEra) a
forall (g :: * -&gt; *) a. (MonadGen g, Random a) =&gt; (a, a) -&gt; g a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/quickcheck-transformer-0.3.1.2-8c69fd32e35ce43d2fa08d505758002237123724318b720a1bb6c013ff6e3bc9/share/doc/html/src/Test.QuickCheck.GenT.html#choose"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra) -&gt; Int
forall a. StrictSeq a -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715598"><span class="hs-identifier hs-var">ss</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-813"></span><span>        </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; TxBody ShelleyEra
-&gt; Int
-&gt; StrictSeq (NativeScript ShelleyEra)
-&gt; ImpTestM
     ShelleyEra (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall era.
ShelleyEraImp era =&gt;
Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyMNativeScripts"><span class="hs-identifier hs-var">impSatisfyMNativeScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715592"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody ShelleyEra
</span><a href="#local-6989586621679715593"><span class="hs-identifier hs-var">txBody</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679715599"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715598"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-814"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.Scripts.html#RequireMOf"><span class="hs-identifier hs-type">RequireMOf</span></a></span><span> </span><span id="local-6989586621679715602"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679715602"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679715603"><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715603"><span class="hs-identifier hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; TxBody ShelleyEra
-&gt; Int
-&gt; StrictSeq (NativeScript ShelleyEra)
-&gt; ImpTestM
     ShelleyEra (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall era.
ShelleyEraImp era =&gt;
Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; Int
-&gt; StrictSeq (NativeScript era)
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyMNativeScripts"><span class="hs-identifier hs-var">impSatisfyMNativeScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715592"><span class="hs-identifier hs-var">providedVKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody ShelleyEra
</span><a href="#local-6989586621679715593"><span class="hs-identifier hs-var">txBody</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679715602"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (NativeScript ShelleyEra)
</span><a href="#local-6989586621679715603"><span class="hs-identifier hs-var">ss</span></a></span><span>
</span><span id="line-815"></span><span>      </span><span class="annot"><span class="annottext">NativeScript ShelleyEra
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpTestM
     ShelleyEra (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Impossible: All NativeScripts should have been accounted for&quot;</span></span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span>  </span><span id="local-6989586621679715609"><span class="annot"><span class="annottext">fixupTx :: HasCallStack =&gt;
Tx ShelleyEra -&gt; ImpTestM ShelleyEra (Tx ShelleyEra)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupTx"><span class="hs-identifier hs-var hs-var hs-var hs-var">fixupTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx ShelleyEra -&gt; ImpTestM ShelleyEra (Tx ShelleyEra)
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyFixupTx"><span class="hs-identifier hs-var">shelleyFixupTx</span></a></span><span>
</span><span id="line-818"></span><span>  </span><span id="local-6989586621679715614"><span class="annot"><span class="annottext">expectTxSuccess :: HasCallStack =&gt; Tx ShelleyEra -&gt; ImpTestM ShelleyEra ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectTxSuccess"><span class="hs-identifier hs-var hs-var hs-var hs-var">expectTxSuccess</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx ShelleyEra -&gt; ImpTestM ShelleyEra ()
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impShelleyExpectTxSuccess"><span class="hs-identifier hs-var">impShelleyExpectTxSuccess</span></a></span><span>
</span><span id="line-819"></span><span>  </span><span id="local-6989586621679715617"><span class="annot"><span class="annottext">modifyImpInitProtVer :: ShelleyEraImp ShelleyEra =&gt;
Version
-&gt; SpecWith (ImpInit (LedgerSpec ShelleyEra))
-&gt; SpecWith (ImpInit (LedgerSpec ShelleyEra))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyImpInitProtVer"><span class="hs-identifier hs-var hs-var hs-var hs-var">modifyImpInitProtVer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version
-&gt; SpecWith (ImpInit (LedgerSpec ShelleyEra))
-&gt; SpecWith (ImpInit (LedgerSpec ShelleyEra))
forall era.
ShelleyEraImp era =&gt;
Version
-&gt; SpecWith (ImpInit (LedgerSpec era))
-&gt; SpecWith (ImpInit (LedgerSpec era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyModifyImpInitProtVer"><span class="hs-identifier hs-var">shelleyModifyImpInitProtVer</span></a></span><span>
</span><span id="line-820"></span><span>  </span><span id="local-6989586621679715619"><span class="annot"><span class="annottext">genRegTxCert :: Credential 'Staking -&gt; ImpTestM ShelleyEra (TxCert ShelleyEra)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#genRegTxCert"><span class="hs-identifier hs-var hs-var hs-var hs-var">genRegTxCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpTestM ShelleyEra (TxCert ShelleyEra)
forall era.
ShelleyEraTxCert era =&gt;
Credential 'Staking -&gt; ImpTestM era (TxCert era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenRegTxCert"><span class="hs-identifier hs-var">shelleyGenRegTxCert</span></a></span><span>
</span><span id="line-821"></span><span>  </span><span id="local-6989586621679715621"><span class="annot"><span class="annottext">genUnRegTxCert :: Credential 'Staking -&gt; ImpTestM ShelleyEra (TxCert ShelleyEra)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#genUnRegTxCert"><span class="hs-identifier hs-var hs-var hs-var hs-var">genUnRegTxCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpTestM ShelleyEra (TxCert ShelleyEra)
forall era.
ShelleyEraTxCert era =&gt;
Credential 'Staking -&gt; ImpTestM era (TxCert era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenUnRegTxCert"><span class="hs-identifier hs-var">shelleyGenUnRegTxCert</span></a></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="hs-comment">-- | Figure out all the Byron Addresses that need witnesses as well as all of the</span><span>
</span><span id="line-824"></span><span class="hs-comment">-- KeyHashes for Shelley Key witnesses that are required.</span><span>
</span><span id="line-825"></span><span id="local-6989586621679712929"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impWitsVKeyNeeded"><span class="hs-identifier hs-type">impWitsVKeyNeeded</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-826"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#EraUTxO"><span class="hs-identifier hs-type">EraUTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712929"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-827"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxBody"><span class="hs-identifier hs-type">TxBody</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712929"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-828"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span>
</span><span id="line-829"></span><span>    </span><span class="annot"><a href="#local-6989586621679712929"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-830"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-type">BootstrapAddress</span></a></span><span> </span><span class="hs-comment">-- Byron Based Addresses</span><span>
</span><span id="line-831"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Shelley Based KeyHashes</span><span>
</span><span id="line-832"></span><span>    </span><span class="hs-special">)</span></span><span>
</span><span id="line-833"></span><span id="impWitsVKeyNeeded"><span class="annot"><span class="annottext">impWitsVKeyNeeded :: forall era.
EraUTxO era =&gt;
TxBody era
-&gt; ImpTestM era (Set BootstrapAddress, Set (KeyHash 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impWitsVKeyNeeded"><span class="hs-identifier hs-var hs-var">impWitsVKeyNeeded</span></a></span></span><span> </span><span id="local-6989586621679715646"><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679715646"><span class="hs-identifier hs-var">txBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-834"></span><span>  </span><span id="local-6989586621679715647"><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679715647"><span class="hs-identifier hs-var">ls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (LedgerState era)
-&gt; ImpTestM era (LedgerState era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((LedgerState era -&gt; Const r (LedgerState era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (LedgerState era -&gt; Const r (LedgerState era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const r (LedgerState era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>  </span><span id="local-6989586621679715650"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715650"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (UTxO era)
forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var">getUTxO</span></a></span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679715651"><span class="annot"><span class="annottext">toBootAddr :: TxIn -&gt; Maybe BootstrapAddress
</span><a href="#local-6989586621679715651"><span class="hs-identifier hs-var hs-var">toBootAddr</span></a></span></span><span> </span><span id="local-6989586621679715652"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679715652"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-837"></span><span>        </span><span id="local-6989586621679715653"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679715653"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; UTxO era -&gt; Maybe (TxOut era)
forall era. TxIn -&gt; UTxO era -&gt; Maybe (TxOut era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#txinLookup"><span class="hs-identifier hs-var">txinLookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679715652"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715650"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-838"></span><span>        </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679715653"><span class="hs-identifier hs-var">txOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
-&gt; Getting
     (Maybe BootstrapAddress) (TxOut era) (Maybe BootstrapAddress)
-&gt; Maybe BootstrapAddress
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe BootstrapAddress) (TxOut era) (Maybe BootstrapAddress)
forall era.
EraTxOut era =&gt;
SimpleGetter (TxOut era) (Maybe BootstrapAddress)
SimpleGetter (TxOut era) (Maybe BootstrapAddress)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bootAddrTxOutF"><span class="hs-identifier hs-var">bootAddrTxOutF</span></a></span><span>
</span><span id="line-839"></span><span>      </span><span id="local-6989586621679715656"><span class="annot"><span class="annottext">bootAddrs :: Set BootstrapAddress
</span><a href="#local-6989586621679715656"><span class="hs-identifier hs-var hs-var">bootAddrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BootstrapAddress] -&gt; Set BootstrapAddress
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([BootstrapAddress] -&gt; Set BootstrapAddress)
-&gt; [BootstrapAddress] -&gt; Set BootstrapAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; Maybe BootstrapAddress) -&gt; [TxIn] -&gt; [BootstrapAddress]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Maybe BootstrapAddress
</span><a href="#local-6989586621679715651"><span class="hs-identifier hs-var">toBootAddr</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; [BootstrapAddress]) -&gt; [TxIn] -&gt; [BootstrapAddress]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; [TxIn]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679715646"><span class="hs-identifier hs-var">txBody</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
-&gt; Getting (Set TxIn) (TxBody era) (Set TxIn) -&gt; Set TxIn
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Set TxIn) (TxBody era) (Set TxIn)
forall era. EraTxBody era =&gt; SimpleGetter (TxBody era) (Set TxIn)
SimpleGetter (TxBody era) (Set TxIn)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#spendableInputsTxBodyF"><span class="hs-identifier hs-var">spendableInputsTxBodyF</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-840"></span><span>      </span><span id="local-6989586621679715660"><span class="annot"><span class="annottext">bootKeyHashes :: Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715660"><span class="hs-identifier hs-var hs-var">bootKeyHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BootstrapAddress -&gt; KeyHash 'Witness)
-&gt; Set BootstrapAddress -&gt; Set (KeyHash 'Witness)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash 'Payment -&gt; KeyHash 'Witness
forall (r :: KeyRole) (r' :: KeyRole). KeyHash r -&gt; KeyHash r'
forall (a :: KeyRole -&gt; *) (r :: KeyRole) (r' :: KeyRole).
HasKeyRole a =&gt;
a r -&gt; a r'
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#coerceKeyRole"><span class="hs-identifier hs-var">coerceKeyRole</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyHash 'Payment -&gt; KeyHash 'Witness)
-&gt; (BootstrapAddress -&gt; KeyHash 'Payment)
-&gt; BootstrapAddress
-&gt; KeyHash 'Witness
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress -&gt; KeyHash 'Payment
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#bootstrapKeyHash"><span class="hs-identifier hs-var">bootstrapKeyHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set BootstrapAddress
</span><a href="#local-6989586621679715656"><span class="hs-identifier hs-var">bootAddrs</span></a></span><span>
</span><span id="line-841"></span><span>      </span><span id="local-6989586621679715663"><span class="annot"><span class="annottext">allKeyHashes :: Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715663"><span class="hs-identifier hs-var hs-var">allKeyHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-842"></span><span>        </span><span class="annot"><span class="annottext">CertState era -&gt; UTxO era -&gt; TxBody era -&gt; Set (KeyHash 'Witness)
forall era.
EraUTxO era =&gt;
CertState era -&gt; UTxO era -&gt; TxBody era -&gt; Set (KeyHash 'Witness)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#getWitsVKeyNeeded"><span class="hs-identifier hs-var">getWitsVKeyNeeded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679715647"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState era
-&gt; Getting (CertState era) (LedgerState era) (CertState era)
-&gt; CertState era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (CertState era) (LedgerState era) (CertState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(CertState era -&gt; f (CertState era))
-&gt; LedgerState era -&gt; f (LedgerState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertStateL"><span class="hs-identifier hs-var">lsCertStateL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679715647"><span class="hs-identifier hs-var">ls</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState era
-&gt; Getting (UTxO era) (LedgerState era) (UTxO era) -&gt; UTxO era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (UTxO era) (LedgerState era) (UTxO era)
forall era. Lens' (LedgerState era) (UTxO era)
forall (t :: * -&gt; *) era. CanSetUTxO t =&gt; Lens' (t era) (UTxO era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#utxoL"><span class="hs-identifier hs-var">utxoL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679715646"><span class="hs-identifier hs-var">txBody</span></a></span><span>
</span><span id="line-843"></span><span>  </span><span class="annot"><span class="annottext">(Set BootstrapAddress, Set (KeyHash 'Witness))
-&gt; ImpTestM era (Set BootstrapAddress, Set (KeyHash 'Witness))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set BootstrapAddress
</span><a href="#local-6989586621679715656"><span class="hs-identifier hs-var">bootAddrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715663"><span class="hs-identifier hs-var">allKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; Set (KeyHash 'Witness) -&gt; Set (KeyHash 'Witness)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679715660"><span class="hs-identifier hs-var">bootKeyHashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span class="hs-keyword">data</span><span> </span><span id="ImpTestEnv"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier hs-var">ImpTestEnv</span></a></span></span><span> </span><span id="local-6989586621679712954"><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ImpTestEnv"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier hs-var">ImpTestEnv</span></a></span></span><span>
</span><span id="line-846"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="iteFixup"><span class="annot"><span class="annottext">forall era. ImpTestEnv era -&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixup"><span class="hs-identifier hs-var hs-var">iteFixup</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="itePostSubmitTxHook"><span class="annot"><span class="annottext">forall era.
ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;LEDGER&quot; era)
   -&gt; Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
        (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
   -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHook"><span class="hs-identifier hs-var hs-var">itePostSubmitTxHook</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-848"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712254"><span class="annot"><a href="#local-6989586621679712254"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-849"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-850"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-852"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-854"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712254"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="itePostEpochBoundaryHook"><span class="annot"><span class="annottext">forall era.
ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHook"><span class="hs-identifier hs-var hs-var">itePostEpochBoundaryHook</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-856"></span><span>      </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712255"><span class="annot"><a href="#local-6989586621679712255"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-857"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-858"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-859"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712954"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-860"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712255"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-862"></span><span>
</span><span id="line-863"></span><span id="local-6989586621679712960"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixupL"><span class="hs-identifier hs-type">iteFixupL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier hs-type">ImpTestEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712960"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712960"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712960"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712960"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-864"></span><span id="iteFixupL"><span class="annot"><span class="annottext">iteFixupL :: forall era (f :: * -&gt; *).
Functor f =&gt;
((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; f (Tx era -&gt; ImpTestM era (Tx era)))
-&gt; ImpTestEnv era -&gt; f (ImpTestEnv era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixupL"><span class="hs-identifier hs-var hs-var">iteFixupL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestEnv era -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; (ImpTestEnv era
    -&gt; (Tx era -&gt; ImpTestM era (Tx era)) -&gt; ImpTestEnv era)
-&gt; Lens
     (ImpTestEnv era)
     (ImpTestEnv era)
     (Tx era -&gt; ImpTestM era (Tx era))
     (Tx era -&gt; ImpTestM era (Tx era))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era -&gt; Tx era -&gt; ImpTestM era (Tx era)
forall era. ImpTestEnv era -&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixup"><span class="hs-identifier hs-var">iteFixup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679715669"><span class="annot"><span class="annottext">ImpTestEnv era
</span><a href="#local-6989586621679715669"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679715670"><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679715670"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era
</span><a href="#local-6989586621679715669"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixup"><span class="hs-identifier hs-var">iteFixup</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679715670"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-865"></span><span>
</span><span id="line-866"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHookL"><span class="hs-identifier hs-type">itePostSubmitTxHookL</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-867"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712569"><span class="annot"><a href="#local-6989586621679712569"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-868"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier hs-type">ImpTestEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712569"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-870"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712570"><span class="annot"><a href="#local-6989586621679712570"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-871"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-872"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712569"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-873"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-874"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712569"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-875"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712569"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712569"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-876"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712570"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-877"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span id="itePostSubmitTxHookL"><span class="annot"><span class="annottext">itePostSubmitTxHookL :: forall era (f :: * -&gt; *).
Functor f =&gt;
((forall t.
  Globals
  -&gt; TRC (EraRule &quot;LEDGER&quot; era)
  -&gt; Either
       (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
       (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
  -&gt; ImpM t ())
 -&gt; f (forall t.
       Globals
       -&gt; TRC (EraRule &quot;LEDGER&quot; era)
       -&gt; Either
            (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
            (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
       -&gt; ImpM t ()))
-&gt; ImpTestEnv era -&gt; f (ImpTestEnv era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHookL"><span class="hs-identifier hs-var hs-var">itePostSubmitTxHookL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestEnv era
 -&gt; forall t.
    Globals
    -&gt; TRC (EraRule &quot;LEDGER&quot; era)
    -&gt; Either
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
         (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
    -&gt; ImpM t ())
-&gt; (ImpTestEnv era
    -&gt; (forall t.
        Globals
        -&gt; TRC (EraRule &quot;LEDGER&quot; era)
        -&gt; Either
             (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
             (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
        -&gt; ImpM t ())
    -&gt; ImpTestEnv era)
-&gt; Lens
     (ImpTestEnv era)
     (ImpTestEnv era)
     (forall t.
      Globals
      -&gt; TRC (EraRule &quot;LEDGER&quot; era)
      -&gt; Either
           (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
           (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
      -&gt; ImpM t ())
     (forall t.
      Globals
      -&gt; TRC (EraRule &quot;LEDGER&quot; era)
      -&gt; Either
           (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
           (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
      -&gt; ImpM t ())
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;LEDGER&quot; era)
   -&gt; Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
        (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
   -&gt; ImpM t ()
forall era.
ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;LEDGER&quot; era)
   -&gt; Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
        (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
   -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHook"><span class="hs-identifier hs-var">itePostSubmitTxHook</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679715673"><span class="annot"><span class="annottext">ImpTestEnv era
</span><a href="#local-6989586621679715673"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679715674"><span class="annot"><span class="annottext">forall t.
Globals
-&gt; TRC (EraRule &quot;LEDGER&quot; era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
     (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
-&gt; ImpM t ()
</span><a href="#local-6989586621679715674"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era
</span><a href="#local-6989586621679715673"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHook"><span class="hs-identifier hs-var">itePostSubmitTxHook</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679715674"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-879"></span><span>
</span><span id="line-880"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHookL"><span class="hs-identifier hs-type">itePostEpochBoundaryHookL</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712578"><span class="annot"><a href="#local-6989586621679712578"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-882"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span>
</span><span id="line-883"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestEnv"><span class="hs-identifier hs-type">ImpTestEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712578"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712579"><span class="annot"><a href="#local-6989586621679712579"><span class="hs-identifier hs-type">t</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-885"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#Globals"><span class="hs-identifier hs-type">Globals</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-886"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712578"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-887"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;NEWEPOCH&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679712578"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-888"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712579"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-890"></span><span id="itePostEpochBoundaryHookL"><span class="annot"><span class="annottext">itePostEpochBoundaryHookL :: forall era (f :: * -&gt; *).
Functor f =&gt;
((forall t.
  Globals
  -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
  -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
  -&gt; ImpM t ())
 -&gt; f (forall t.
       Globals
       -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
       -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
       -&gt; ImpM t ()))
-&gt; ImpTestEnv era -&gt; f (ImpTestEnv era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHookL"><span class="hs-identifier hs-var hs-var">itePostEpochBoundaryHookL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestEnv era
 -&gt; forall t.
    Globals
    -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
    -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
    -&gt; ImpM t ())
-&gt; (ImpTestEnv era
    -&gt; (forall t.
        Globals
        -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
        -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
        -&gt; ImpM t ())
    -&gt; ImpTestEnv era)
-&gt; Lens
     (ImpTestEnv era)
     (ImpTestEnv era)
     (forall t.
      Globals
      -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
      -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
      -&gt; ImpM t ())
     (forall t.
      Globals
      -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
      -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
      -&gt; ImpM t ())
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; ImpM t ()
forall era.
ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHook"><span class="hs-identifier hs-var">itePostEpochBoundaryHook</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679715677"><span class="annot"><span class="annottext">ImpTestEnv era
</span><a href="#local-6989586621679715677"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679715678"><span class="annot"><span class="annottext">forall t.
Globals
-&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; ImpM t ()
</span><a href="#local-6989586621679715678"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era
</span><a href="#local-6989586621679715677"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHook"><span class="hs-identifier hs-var">itePostEpochBoundaryHook</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679715678"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679712976"><span id="local-6989586621679715685"><span class="annot"><span class="hs-identifier hs-type">MonadWriter</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-type">SomeSTSEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712976"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712976"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-893"></span><span>  </span><span id="local-6989586621679715699"><span class="annot"><span class="annottext">writer :: forall a. (a, [SomeSTSEvent era]) -&gt; ImpTestM era a
</span><a href="#local-6989586621679715699"><span class="hs-identifier hs-var hs-var hs-var hs-var">writer</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679715701"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679715701"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679715702"><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715702"><span class="hs-identifier hs-var">evs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([SomeSTSEvent era] -&gt; Identity [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
([SomeSTSEvent era] -&gt; f [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEventsL"><span class="hs-identifier hs-var">impEventsL</span></a></span><span> </span><span class="annot"><span class="annottext">(([SomeSTSEvent era] -&gt; Identity [SomeSTSEvent era])
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; ([SomeSTSEvent era] -&gt; [SomeSTSEvent era]) -&gt; ImpTestM era ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#%25%3D"><span class="hs-operator hs-var">%=</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SomeSTSEvent era] -&gt; [SomeSTSEvent era] -&gt; [SomeSTSEvent era]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715702"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ImpTestM era () -&gt; a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679715701"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-894"></span><span>  </span><span id="local-6989586621679715724"><span class="annot"><span class="annottext">listen :: forall a. ImpTestM era a -&gt; ImpTestM era (a, [SomeSTSEvent era])
</span><a href="#local-6989586621679715724"><span class="hs-identifier hs-var hs-var hs-var hs-var">listen</span></a></span></span><span> </span><span id="local-6989586621679715726"><span class="annot"><span class="annottext">ImpTestM era a
</span><a href="#local-6989586621679715726"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-895"></span><span>    </span><span id="local-6989586621679715727"><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715727"><span class="hs-identifier hs-var">oldEvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [SomeSTSEvent era] (ImpTestState era) [SomeSTSEvent era]
-&gt; ImpM (LedgerSpec era) [SomeSTSEvent era]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Getting [SomeSTSEvent era] (ImpTestState era) [SomeSTSEvent era]
forall era (f :: * -&gt; *).
Functor f =&gt;
([SomeSTSEvent era] -&gt; f [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEventsL"><span class="hs-identifier hs-var">impEventsL</span></a></span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><span class="annottext">([SomeSTSEvent era] -&gt; Identity [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
([SomeSTSEvent era] -&gt; f [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEventsL"><span class="hs-identifier hs-var">impEventsL</span></a></span><span> </span><span class="annot"><span class="annottext">(([SomeSTSEvent era] -&gt; Identity [SomeSTSEvent era])
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; [SomeSTSEvent era] -&gt; ImpTestM era ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">[SomeSTSEvent era]
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-897"></span><span>    </span><span id="local-6989586621679715728"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679715728"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era a
</span><a href="#local-6989586621679715726"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-898"></span><span>    </span><span id="local-6989586621679715729"><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715729"><span class="hs-identifier hs-var">newEvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting [SomeSTSEvent era] (ImpTestState era) [SomeSTSEvent era]
-&gt; ImpM (LedgerSpec era) [SomeSTSEvent era]
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Getting [SomeSTSEvent era] (ImpTestState era) [SomeSTSEvent era]
forall era (f :: * -&gt; *).
Functor f =&gt;
([SomeSTSEvent era] -&gt; f [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEventsL"><span class="hs-identifier hs-var">impEventsL</span></a></span><span>
</span><span id="line-899"></span><span>    </span><span class="annot"><span class="annottext">([SomeSTSEvent era] -&gt; Identity [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
([SomeSTSEvent era] -&gt; f [SomeSTSEvent era])
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impEventsL"><span class="hs-identifier hs-var">impEventsL</span></a></span><span> </span><span class="annot"><span class="annottext">(([SomeSTSEvent era] -&gt; Identity [SomeSTSEvent era])
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; [SomeSTSEvent era] -&gt; ImpTestM era ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715727"><span class="hs-identifier hs-var">oldEvs</span></a></span><span>
</span><span id="line-900"></span><span>    </span><span class="annot"><span class="annottext">(a, [SomeSTSEvent era]) -&gt; ImpTestM era (a, [SomeSTSEvent era])
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679715728"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715729"><span class="hs-identifier hs-var">newEvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>  </span><span id="local-6989586621679715733"><span class="annot"><span class="annottext">pass :: forall a.
ImpTestM era (a, [SomeSTSEvent era] -&gt; [SomeSTSEvent era])
-&gt; ImpTestM era a
</span><a href="#local-6989586621679715733"><span class="hs-identifier hs-var hs-var hs-var hs-var">pass</span></a></span></span><span> </span><span id="local-6989586621679715735"><span class="annot"><span class="annottext">ImpTestM era (a, [SomeSTSEvent era] -&gt; [SomeSTSEvent era])
</span><a href="#local-6989586621679715735"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-902"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679715736"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679715736"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679715737"><span class="annot"><span class="annottext">[SomeSTSEvent era] -&gt; [SomeSTSEvent era]
</span><a href="#local-6989586621679715737"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679715738"><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715738"><span class="hs-identifier hs-var">evs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (a, [SomeSTSEvent era] -&gt; [SomeSTSEvent era])
-&gt; ImpM
     (LedgerSpec era)
     ((a, [SomeSTSEvent era] -&gt; [SomeSTSEvent era]), [SomeSTSEvent era])
forall a. ImpTestM era a -&gt; ImpTestM era (a, [SomeSTSEvent era])
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var">listen</span></span><span> </span><span class="annot"><span class="annottext">ImpTestM era (a, [SomeSTSEvent era] -&gt; [SomeSTSEvent era])
</span><a href="#local-6989586621679715735"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-903"></span><span>    </span><span class="annot"><span class="annottext">(a, [SomeSTSEvent era]) -&gt; ImpTestM era a
forall a. (a, [SomeSTSEvent era]) -&gt; ImpTestM era a
forall w (m :: * -&gt; *) a. MonadWriter w m =&gt; (a, w) -&gt; m a
</span><span class="hs-identifier hs-var">writer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679715736"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SomeSTSEvent era] -&gt; [SomeSTSEvent era]
</span><a href="#local-6989586621679715737"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[SomeSTSEvent era]
</span><a href="#local-6989586621679715738"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span id="local-6989586621679712596"><span id="local-6989586621679712597"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runShelleyBase"><span class="hs-identifier hs-type">runShelleyBase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712596"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712597"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712596"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-906"></span><span id="runShelleyBase"><span class="annot"><span class="annottext">runShelleyBase :: forall a era. ShelleyBase a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runShelleyBase"><span class="hs-identifier hs-var hs-var">runShelleyBase</span></a></span></span><span> </span><span id="local-6989586621679715745"><span class="annot"><span class="annottext">ShelleyBase a
</span><a href="#local-6989586621679715745"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-907"></span><span>  </span><span id="local-6989586621679715746"><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679715746"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Globals (ImpTestState era) Globals
-&gt; ImpM (LedgerSpec era) Globals
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Globals (ImpTestState era) Globals
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span>
</span><span id="line-908"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; ImpTestM era a
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ImpTestM era a) -&gt; a -&gt; ImpTestM era a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Identity a -&gt; a
forall a. Identity a -&gt; a
</span><span class="hs-identifier hs-var">runIdentity</span></span><span> </span><span class="annot"><span class="annottext">(Identity a -&gt; a) -&gt; Identity a -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBase a -&gt; Globals -&gt; Identity a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBase a
</span><a href="#local-6989586621679715745"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679715746"><span class="hs-identifier hs-var">globals</span></a></span><span>
</span><span id="line-909"></span><span>
</span><span id="line-910"></span><span id="local-6989586621679713005"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getRewardAccountAmount"><span class="hs-identifier hs-type">getRewardAccountAmount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713005"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713005"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-911"></span><span id="getRewardAccountAmount"><span class="annot"><span class="annottext">getRewardAccountAmount :: forall era.
(HasCallStack, EraCertState era) =&gt;
RewardAccount -&gt; ImpTestM era Coin
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getRewardAccountAmount"><span class="hs-identifier hs-var hs-var">getRewardAccountAmount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; ImpTestM era Coin
forall era.
(HasCallStack, EraCertState era) =&gt;
RewardAccount -&gt; ImpTestM era Coin
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getAccountBalance"><span class="hs-identifier hs-var">getAccountBalance</span></a></span><span>
</span><span id="line-912"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">getRewardAccountAmount</span><span> </span><span class="hs-pragma">&quot;In favor of `getAccountBalance`&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span id="local-6989586621679713008"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupBalance"><span class="hs-identifier hs-type">lookupBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713008"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713008"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-915"></span><span id="lookupBalance"><span class="annot"><span class="annottext">lookupBalance :: forall era.
EraCertState era =&gt;
Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupBalance"><span class="hs-identifier hs-var hs-var">lookupBalance</span></a></span></span><span> </span><span id="local-6989586621679715765"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679715765"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-916"></span><span>  </span><span id="local-6989586621679715766"><span class="annot"><span class="annottext">Map (Credential 'Staking) (AccountState era)
</span><a href="#local-6989586621679715766"><span class="hs-identifier hs-var">accountsMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter
  (NewEpochState era) (Map (Credential 'Staking) (AccountState era))
-&gt; ImpTestM era (Map (Credential 'Staking) (AccountState era))
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter
   (NewEpochState era) (Map (Credential 'Staking) (AccountState era))
 -&gt; ImpTestM era (Map (Credential 'Staking) (AccountState era)))
-&gt; SimpleGetter
     (NewEpochState era) (Map (Credential 'Staking) (AccountState era))
-&gt; ImpTestM era (Map (Credential 'Staking) (AccountState era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((Map (Credential 'Staking) (AccountState era)
     -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (Map (Credential 'Staking) (AccountState era)
    -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const r (LedgerState era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((LedgerState era -&gt; Const r (LedgerState era))
 -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; ((Map (Credential 'Staking) (AccountState era)
     -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
    -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; (Map (Credential 'Staking) (AccountState era)
    -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
-&gt; EpochState era
-&gt; Const r (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CertState era -&gt; Const r (CertState era))
-&gt; LedgerState era -&gt; Const r (LedgerState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(CertState era -&gt; f (CertState era))
-&gt; LedgerState era -&gt; f (LedgerState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertStateL"><span class="hs-identifier hs-var">lsCertStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((CertState era -&gt; Const r (CertState era))
 -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; ((Map (Credential 'Staking) (AccountState era)
     -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
    -&gt; CertState era -&gt; Const r (CertState era))
-&gt; (Map (Credential 'Staking) (AccountState era)
    -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
-&gt; LedgerState era
-&gt; Const r (LedgerState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DState era -&gt; Const r (DState era))
-&gt; CertState era -&gt; Const r (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (DState era)
Lens' (CertState era) (DState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certDStateL"><span class="hs-identifier hs-var">certDStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((DState era -&gt; Const r (DState era))
 -&gt; CertState era -&gt; Const r (CertState era))
-&gt; ((Map (Credential 'Staking) (AccountState era)
     -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
    -&gt; DState era -&gt; Const r (DState era))
-&gt; (Map (Credential 'Staking) (AccountState era)
    -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
-&gt; CertState era
-&gt; Const r (CertState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Accounts era -&gt; Const r (Accounts era))
-&gt; DState era -&gt; Const r (DState era)
forall era. Lens' (DState era) (Accounts era)
forall (t :: * -&gt; *) era.
CanSetAccounts t =&gt;
Lens' (t era) (Accounts era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsL"><span class="hs-identifier hs-var">accountsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Accounts era -&gt; Const r (Accounts era))
 -&gt; DState era -&gt; Const r (DState era))
-&gt; ((Map (Credential 'Staking) (AccountState era)
     -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
    -&gt; Accounts era -&gt; Const r (Accounts era))
-&gt; (Map (Credential 'Staking) (AccountState era)
    -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
-&gt; DState era
-&gt; Const r (DState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (Credential 'Staking) (AccountState era)
 -&gt; Const r (Map (Credential 'Staking) (AccountState era)))
-&gt; Accounts era -&gt; Const r (Accounts era)
forall era.
EraAccounts era =&gt;
Lens' (Accounts era) (Map (Credential 'Staking) (AccountState era))
Lens' (Accounts era) (Map (Credential 'Staking) (AccountState era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsMapL"><span class="hs-identifier hs-var">accountsMapL</span></a></span><span>
</span><span id="line-917"></span><span>  </span><span class="annot"><span class="annottext">Maybe Coin -&gt; ImpTestM era (Maybe Coin)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Coin -&gt; ImpTestM era (Maybe Coin))
-&gt; Maybe Coin -&gt; ImpTestM era (Maybe Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-918"></span><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679715780"><span class="annot"><span class="annottext">AccountState era
</span><a href="#local-6989586621679715780"><span class="hs-identifier hs-var">accountState</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Coin
forall a. Compactible a =&gt; CompactForm a -&gt; a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#fromCompact"><span class="hs-identifier hs-var">fromCompact</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AccountState era
</span><a href="#local-6989586621679715780"><span class="hs-identifier hs-var">accountState</span></a></span><span> </span><span class="annot"><span class="annottext">AccountState era
-&gt; Getting (CompactForm Coin) (AccountState era) (CompactForm Coin)
-&gt; CompactForm Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (CompactForm Coin) (AccountState era) (CompactForm Coin)
forall era.
EraAccounts era =&gt;
Lens' (AccountState era) (CompactForm Coin)
Lens' (AccountState era) (CompactForm Coin)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#balanceAccountStateL"><span class="hs-identifier hs-var">balanceAccountStateL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-919"></span><span>      </span><span class="annot"><span class="annottext">(AccountState era -&gt; Coin)
-&gt; Maybe (AccountState era) -&gt; Maybe Coin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
-&gt; Map (Credential 'Staking) (AccountState era)
-&gt; Maybe (AccountState era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679715765"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (AccountState era)
</span><a href="#local-6989586621679715766"><span class="hs-identifier hs-var">accountsMap</span></a></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span id="local-6989586621679713021"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupAccountBalance"><span class="hs-identifier hs-type">lookupAccountBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-922"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713021"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713021"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-923"></span><span id="lookupAccountBalance"><span class="annot"><span class="annottext">lookupAccountBalance :: forall era.
(HasCallStack, EraCertState era) =&gt;
RewardAccount -&gt; ImpTestM era (Maybe Coin)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupAccountBalance"><span class="hs-identifier hs-var hs-var">lookupAccountBalance</span></a></span></span><span> </span><span id="local-6989586621679715799"><span class="annot"><span class="annottext">ra :: RewardAccount
</span><a href="#local-6989586621679715799"><span class="hs-identifier hs-var">ra</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679715801"><span class="annot"><span class="annottext">Network
raNetwork :: Network
raNetwork :: RewardAccount -&gt; Network
</span><a href="#local-6989586621679715801"><span class="hs-identifier hs-var hs-var">raNetwork</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679715803"><span class="annot"><span class="annottext">Credential 'Staking
raCredential :: Credential 'Staking
raCredential :: RewardAccount -&gt; Credential 'Staking
</span><a href="#local-6989586621679715803"><span class="hs-identifier hs-var hs-var">raCredential</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-924"></span><span>  </span><span id="local-6989586621679715805"><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679715805"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Network (ImpTestState era) Network
-&gt; ImpM (LedgerSpec era) Network
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Globals -&gt; Const Network Globals)
-&gt; ImpTestState era -&gt; Const Network (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Globals -&gt; Const Network Globals)
 -&gt; ImpTestState era -&gt; Const Network (ImpTestState era))
-&gt; ((Network -&gt; Const Network Network)
    -&gt; Globals -&gt; Const Network Globals)
-&gt; Getting Network (ImpTestState era) Network
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Network) -&gt; SimpleGetter Globals Network
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#networkId"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679715801"><span class="hs-identifier hs-var">raNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">Network -&gt; Network -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679715805"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-926"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) ()
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpM (LedgerSpec era) ())
-&gt; [Char] -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-927"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Reward Account with an unexpected NetworkId: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679715799"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-928"></span><span>  </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
forall era.
EraCertState era =&gt;
Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupBalance"><span class="hs-identifier hs-var">lookupBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679715803"><span class="hs-identifier hs-var">raCredential</span></a></span><span>
</span><span id="line-929"></span><span>
</span><span id="line-930"></span><span id="local-6989586621679713024"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getBalance"><span class="hs-identifier hs-type">getBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713024"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713024"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-931"></span><span id="getBalance"><span class="annot"><span class="annottext">getBalance :: forall era.
(HasCallStack, EraCertState era) =&gt;
Credential 'Staking -&gt; ImpTestM era Coin
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getBalance"><span class="hs-identifier hs-var hs-var">getBalance</span></a></span></span><span> </span><span id="local-6989586621679715822"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679715822"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-932"></span><span>  </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
forall era.
EraCertState era =&gt;
Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupBalance"><span class="hs-identifier hs-var">lookupBalance</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679715822"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestM era (Maybe Coin)
-&gt; (Maybe Coin -&gt; ImpM (LedgerSpec era) Coin)
-&gt; ImpM (LedgerSpec era) Coin
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-933"></span><span>    </span><span class="annot"><span class="annottext">Maybe Coin
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-934"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) Coin
forall (m :: * -&gt; *) a. (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Expectations.Lifted.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpM (LedgerSpec era) Coin)
-&gt; [Char] -&gt; ImpM (LedgerSpec era) Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-935"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected a registered account: &quot;</span></span><span>
</span><span id="line-936"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679715822"><span class="hs-identifier hs-var">cred</span></a></span><span>
</span><span id="line-937"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;. Use `registerRewardAccount` to register a new account in ImpSpec&quot;</span></span><span>
</span><span id="line-938"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679715824"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679715824"><span class="hs-identifier hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; ImpM (LedgerSpec era) Coin
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679715824"><span class="hs-identifier hs-var">balance</span></a></span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span id="local-6989586621679715825"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getAccountBalance"><span class="hs-identifier hs-type">getAccountBalance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679715825"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679715825"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-941"></span><span id="getAccountBalance"><span class="annot"><span class="annottext">getAccountBalance :: forall era.
(HasCallStack, EraCertState era) =&gt;
RewardAccount -&gt; ImpTestM era Coin
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getAccountBalance"><span class="hs-identifier hs-var hs-var">getAccountBalance</span></a></span></span><span> </span><span id="local-6989586621679715839"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679715839"><span class="hs-identifier hs-var">ra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-942"></span><span>  </span><span class="annot"><span class="annottext">RewardAccount -&gt; ImpTestM era (Maybe Coin)
forall era.
(HasCallStack, EraCertState era) =&gt;
RewardAccount -&gt; ImpTestM era (Maybe Coin)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupAccountBalance"><span class="hs-identifier hs-var">lookupAccountBalance</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679715839"><span class="hs-identifier hs-var">ra</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestM era (Maybe Coin)
-&gt; (Maybe Coin -&gt; ImpM (LedgerSpec era) Coin)
-&gt; ImpM (LedgerSpec era) Coin
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-943"></span><span>    </span><span class="annot"><span class="annottext">Maybe Coin
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-944"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) Coin
forall (m :: * -&gt; *) a. (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Expectations.Lifted.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpM (LedgerSpec era) Coin)
-&gt; [Char] -&gt; ImpM (LedgerSpec era) Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-945"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected a registered account: &quot;</span></span><span>
</span><span id="line-946"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679715839"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-947"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;. Use `registerRewardAccount` to register a new account in ImpSpec&quot;</span></span><span>
</span><span id="line-948"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679715840"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679715840"><span class="hs-identifier hs-var">balance</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; ImpM (LedgerSpec era) Coin
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679715840"><span class="hs-identifier hs-var">balance</span></a></span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span id="local-6989586621679713031"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getImpRootTxOut"><span class="hs-identifier hs-type">getImpRootTxOut</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713031"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713031"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-951"></span><span id="getImpRootTxOut"><span class="annot"><span class="annottext">getImpRootTxOut :: forall era. ImpTestM era (TxIn, TxOut era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getImpRootTxOut"><span class="hs-identifier hs-var hs-var">getImpRootTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-952"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679715850"><span class="annot"><span class="annottext">TxIn
impRootTxIn :: forall era. ImpTestState era -&gt; TxIn
impRootTxIn :: TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxIn"><span class="hs-identifier hs-var hs-var">impRootTxIn</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (ImpTestState era)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-953"></span><span>  </span><span id="local-6989586621679715851"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715851"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (UTxO era)
forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var">getUTxO</span></a></span><span>
</span><span id="line-954"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; UTxO era -&gt; Maybe (TxOut era)
forall era. TxIn -&gt; UTxO era -&gt; Maybe (TxOut era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#txinLookup"><span class="hs-identifier hs-var">txinLookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679715850"><span class="hs-identifier hs-var">impRootTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715851"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-955"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TxOut era)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era (TxIn, TxOut era)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Root txId no longer points to an existing unspent output&quot;</span></span><span>
</span><span id="line-956"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679715852"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679715852"><span class="hs-identifier hs-var">rootTxOut</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut era) -&gt; ImpTestM era (TxIn, TxOut era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679715850"><span class="hs-identifier hs-var">impRootTxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679715852"><span class="hs-identifier hs-var">rootTxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impAddNativeScript"><span class="hs-identifier hs-type">impAddNativeScript</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713033"><span class="annot"><a href="#local-6989586621679713033"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-960"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#EraScript"><span class="hs-identifier hs-type">EraScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713033"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-961"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713033"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-962"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713033"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span>
</span><span id="line-963"></span><span id="impAddNativeScript"><span class="annot"><span class="annottext">impAddNativeScript :: forall era.
EraScript era =&gt;
NativeScript era -&gt; ImpTestM era ScriptHash
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impAddNativeScript"><span class="hs-identifier hs-var hs-var">impAddNativeScript</span></a></span></span><span> </span><span id="local-6989586621679715863"><span class="annot"><span class="annottext">NativeScript era
</span><a href="#local-6989586621679715863"><span class="hs-identifier hs-var">nativeScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-964"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679715864"><span class="annot"><span class="annottext">script :: Script era
</span><a href="#local-6989586621679715864"><span class="hs-identifier hs-var hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NativeScript era -&gt; Script era
forall era. EraScript era =&gt; NativeScript era -&gt; Script era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#fromNativeScript"><span class="hs-identifier hs-var">fromNativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">NativeScript era
</span><a href="#local-6989586621679715863"><span class="hs-identifier hs-var">nativeScript</span></a></span><span>
</span><span id="line-965"></span><span>      </span><span id="local-6989586621679715866"><span class="annot"><span class="annottext">scriptHash :: ScriptHash
</span><a href="#local-6989586621679715866"><span class="hs-identifier hs-var hs-var">scriptHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall era. EraScript era =&gt; Script era -&gt; ScriptHash
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#hashScript"><span class="hs-identifier hs-var">hashScript</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713033"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="annottext">Script era
</span><a href="#local-6989586621679715864"><span class="hs-identifier hs-var">script</span></a></span><span>
</span><span id="line-966"></span><span>  </span><span class="annot"><span class="annottext">(Map ScriptHash (NativeScript era)
 -&gt; Identity (Map ScriptHash (NativeScript era)))
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map ScriptHash (NativeScript era)
 -&gt; f (Map ScriptHash (NativeScript era)))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsL"><span class="hs-identifier hs-var">impNativeScriptsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ScriptHash (NativeScript era)
  -&gt; Identity (Map ScriptHash (NativeScript era)))
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; (Map ScriptHash (NativeScript era)
    -&gt; Map ScriptHash (NativeScript era))
-&gt; ImpM (LedgerSpec era) ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#%25%3D"><span class="hs-operator hs-var">%=</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
-&gt; NativeScript era
-&gt; Map ScriptHash (NativeScript era)
-&gt; Map ScriptHash (NativeScript era)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679715866"><span class="hs-identifier hs-var">scriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">NativeScript era
</span><a href="#local-6989586621679715863"><span class="hs-identifier hs-var">nativeScript</span></a></span><span>
</span><span id="line-967"></span><span>  </span><span class="annot"><span class="annottext">ScriptHash -&gt; ImpTestM era ScriptHash
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679715866"><span class="hs-identifier hs-var">scriptHash</span></a></span><span>
</span><span id="line-968"></span><span>
</span><span id="line-969"></span><span id="local-6989586621679713038"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsRequired"><span class="hs-identifier hs-type">impNativeScriptsRequired</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-970"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#EraUTxO"><span class="hs-identifier hs-type">EraUTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713038"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-971"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713038"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-972"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713038"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713038"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-973"></span><span id="impNativeScriptsRequired"><span class="annot"><span class="annottext">impNativeScriptsRequired :: forall era.
EraUTxO era =&gt;
Tx era -&gt; ImpTestM era (Map ScriptHash (NativeScript era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsRequired"><span class="hs-identifier hs-var hs-var">impNativeScriptsRequired</span></a></span></span><span> </span><span id="local-6989586621679715883"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679715883"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-974"></span><span>  </span><span id="local-6989586621679715884"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715884"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (UTxO era)
forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var">getUTxO</span></a></span><span>
</span><span id="line-975"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679715885"><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
impNativeScripts :: forall era. ImpTestState era -&gt; Map ScriptHash (NativeScript era)
impNativeScripts :: Map ScriptHash (NativeScript era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScripts"><span class="hs-identifier hs-var hs-var">impNativeScripts</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (ImpTestState era)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-976"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679715886"><span class="annot"><span class="annottext">needed :: ScriptsNeeded era
</span><a href="#local-6989586621679715886"><span class="hs-identifier hs-var hs-var">needed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; TxBody era -&gt; ScriptsNeeded era
forall era.
EraUTxO era =&gt;
UTxO era -&gt; TxBody era -&gt; ScriptsNeeded era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#getScriptsNeeded"><span class="hs-identifier hs-var">getScriptsNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715884"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679715883"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-977"></span><span>      </span><span id="local-6989586621679715889"><span class="annot"><span class="annottext">hashesNeeded :: Set ScriptHash
</span><a href="#local-6989586621679715889"><span class="hs-identifier hs-var hs-var">hashesNeeded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptsNeeded era -&gt; Set ScriptHash
forall era. EraUTxO era =&gt; ScriptsNeeded era -&gt; Set ScriptHash
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#getScriptsHashesNeeded"><span class="hs-identifier hs-var">getScriptsHashesNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptsNeeded era
</span><a href="#local-6989586621679715886"><span class="hs-identifier hs-var">needed</span></a></span><span>
</span><span id="line-978"></span><span>  </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
-&gt; ImpTestM era (Map ScriptHash (NativeScript era))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Map ScriptHash (NativeScript era)
 -&gt; ImpTestM era (Map ScriptHash (NativeScript era)))
-&gt; Map ScriptHash (NativeScript era)
-&gt; ImpTestM era (Map ScriptHash (NativeScript era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679715885"><span class="hs-identifier hs-var">impNativeScripts</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
-&gt; Set ScriptHash -&gt; Map ScriptHash (NativeScript era)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.restrictKeys`</span></span><span> </span><span class="annot"><span class="annottext">Set ScriptHash
</span><a href="#local-6989586621679715889"><span class="hs-identifier hs-var">hashesNeeded</span></a></span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span class="annot"><span class="hs-comment">-- | Modifies transaction by adding necessary scripts</span></span><span>
</span><span id="line-981"></span><span id="local-6989586621679713042"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addNativeScriptTxWits"><span class="hs-identifier hs-type">addNativeScriptTxWits</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-982"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713042"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-983"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713042"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-984"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713042"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713042"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-985"></span><span id="addNativeScriptTxWits"><span class="annot"><span class="annottext">addNativeScriptTxWits :: forall era. ShelleyEraImp era =&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addNativeScriptTxWits"><span class="hs-identifier hs-var hs-var">addNativeScriptTxWits</span></a></span></span><span> </span><span id="local-6989586621679715921"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679715921"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addNativeScriptTxWits&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-986"></span><span>  </span><span id="local-6989586621679715922"><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679715922"><span class="hs-identifier hs-var">scriptsRequired</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Map ScriptHash (NativeScript era))
forall era.
EraUTxO era =&gt;
Tx era -&gt; ImpTestM era (Map ScriptHash (NativeScript era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsRequired"><span class="hs-identifier hs-var">impNativeScriptsRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679715921"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-987"></span><span>  </span><span id="local-6989586621679715923"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715923"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (UTxO era)
forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var">getUTxO</span></a></span><span>
</span><span id="line-988"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#ScriptsProvided"><span class="hs-identifier hs-type">ScriptsProvided</span></a></span><span> </span><span id="local-6989586621679715925"><span class="annot"><span class="annottext">Map ScriptHash (Script era)
</span><a href="#local-6989586621679715925"><span class="hs-identifier hs-var">provided</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; Tx era -&gt; ScriptsProvided era
forall era.
EraUTxO era =&gt;
UTxO era -&gt; Tx era -&gt; ScriptsProvided era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#getScriptsProvided"><span class="hs-identifier hs-var">getScriptsProvided</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679715923"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679715921"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-989"></span><span>      </span><span id="local-6989586621679715927"><span class="annot"><span class="annottext">scriptsToAdd :: Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679715927"><span class="hs-identifier hs-var hs-var">scriptsToAdd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679715922"><span class="hs-identifier hs-var">scriptsRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
-&gt; Map ScriptHash (Script era) -&gt; Map ScriptHash (NativeScript era)
forall k a b. Ord k =&gt; Map k a -&gt; Map k b -&gt; Map k a
</span><span class="hs-operator hs-var">Map.\\</span></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (Script era)
</span><a href="#local-6989586621679715925"><span class="hs-identifier hs-var">provided</span></a></span><span>
</span><span id="line-990"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-991"></span><span>    </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679715921"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-992"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxWits era -&gt; Identity (TxWits era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx era) (TxWits era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#witsTxL"><span class="hs-identifier hs-var">witsTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxWits era -&gt; Identity (TxWits era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((Map ScriptHash (Script era)
     -&gt; Identity (Map ScriptHash (Script era)))
    -&gt; TxWits era -&gt; Identity (TxWits era))
-&gt; (Map ScriptHash (Script era)
    -&gt; Identity (Map ScriptHash (Script era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map ScriptHash (Script era)
 -&gt; Identity (Map ScriptHash (Script era)))
-&gt; TxWits era -&gt; Identity (TxWits era)
forall era.
EraTxWits era =&gt;
Lens' (TxWits era) (Map ScriptHash (Script era))
Lens' (TxWits era) (Map ScriptHash (Script era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#scriptTxWitsL"><span class="hs-identifier hs-var">scriptTxWitsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ScriptHash (Script era)
  -&gt; Identity (Map ScriptHash (Script era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; Map ScriptHash (Script era) -&gt; Tx era -&gt; Tx era
forall a s t. Monoid a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%3C%3E~"><span class="hs-operator hs-var">&lt;&gt;~</span></a></span><span> </span><span class="annot"><span class="annottext">(NativeScript era -&gt; Script era)
-&gt; Map ScriptHash (NativeScript era) -&gt; Map ScriptHash (Script era)
forall a b. (a -&gt; b) -&gt; Map ScriptHash a -&gt; Map ScriptHash b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">NativeScript era -&gt; Script era
forall era. EraScript era =&gt; NativeScript era -&gt; Script era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#fromNativeScript"><span class="hs-identifier hs-var">fromNativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679715927"><span class="hs-identifier hs-var">scriptsToAdd</span></a></span><span>
</span><span id="line-993"></span><span>
</span><span id="line-994"></span><span class="annot"><span class="hs-comment">-- | Adds @TxWits@ that will satisfy all of the required key witnesses</span></span><span>
</span><span id="line-995"></span><span id="local-6989586621679713056"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#updateAddrTxWits"><span class="hs-identifier hs-type">updateAddrTxWits</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-996"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-997"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713056"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-998"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-999"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713056"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1000"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713056"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713056"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1001"></span><span id="updateAddrTxWits"><span class="annot"><span class="annottext">updateAddrTxWits :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#updateAddrTxWits"><span class="hs-identifier hs-var hs-var">updateAddrTxWits</span></a></span></span><span> </span><span id="local-6989586621679716015"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716015"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;updateAddrTxWits&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1002"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716016"><span class="annot"><span class="annottext">txBody :: TxBody era
</span><a href="#local-6989586621679716016"><span class="hs-identifier hs-var hs-var">txBody</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716015"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span>
</span><span id="line-1003"></span><span>      </span><span id="local-6989586621679716017"><span class="annot"><span class="annottext">txBodyHash :: SafeHash EraIndependentTxBody
</span><a href="#local-6989586621679716017"><span class="hs-identifier hs-var hs-var">txBodyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; SafeHash EraIndependentTxBody
forall x i. HashAnnotated x i =&gt; x -&gt; SafeHash i
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#hashAnnotated"><span class="hs-identifier hs-var">hashAnnotated</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679716016"><span class="hs-identifier hs-var">txBody</span></a></span><span>
</span><span id="line-1004"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679716019"><span class="annot"><span class="annottext">Set BootstrapAddress
</span><a href="#local-6989586621679716019"><span class="hs-identifier hs-var">bootAddrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716020"><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716020"><span class="hs-identifier hs-var">witsVKeyNeeded</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxBody era
-&gt; ImpTestM era (Set BootstrapAddress, Set (KeyHash 'Witness))
forall era.
EraUTxO era =&gt;
TxBody era
-&gt; ImpTestM era (Set BootstrapAddress, Set (KeyHash 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impWitsVKeyNeeded"><span class="hs-identifier hs-var">impWitsVKeyNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679716016"><span class="hs-identifier hs-var">txBody</span></a></span><span>
</span><span id="line-1005"></span><span>  </span><span class="hs-comment">-- Shelley Based Addr Witnesses</span><span>
</span><span id="line-1006"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716021"><span class="annot"><span class="annottext">curAddrWitHashes :: Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716021"><span class="hs-identifier hs-var hs-var">curAddrWitHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WitVKey 'Witness -&gt; KeyHash 'Witness)
-&gt; Set (WitVKey 'Witness) -&gt; Set (KeyHash 'Witness)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">WitVKey 'Witness -&gt; KeyHash 'Witness
forall (kr :: KeyRole). WitVKey kr -&gt; KeyHash 'Witness
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.WitVKey.html#witVKeyHash"><span class="hs-identifier hs-var">witVKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (WitVKey 'Witness) -&gt; Set (KeyHash 'Witness))
-&gt; Set (WitVKey 'Witness) -&gt; Set (KeyHash 'Witness)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716015"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting
     (Set (WitVKey 'Witness)) (Tx era) (Set (WitVKey 'Witness))
-&gt; Set (WitVKey 'Witness)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era))
-&gt; Tx era -&gt; Const (Set (WitVKey 'Witness)) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx era) (TxWits era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#witsTxL"><span class="hs-identifier hs-var">witsTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era))
 -&gt; Tx era -&gt; Const (Set (WitVKey 'Witness)) (Tx era))
-&gt; ((Set (WitVKey 'Witness)
     -&gt; Const (Set (WitVKey 'Witness)) (Set (WitVKey 'Witness)))
    -&gt; TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era))
-&gt; Getting
     (Set (WitVKey 'Witness)) (Tx era) (Set (WitVKey 'Witness))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set (WitVKey 'Witness)
 -&gt; Const (Set (WitVKey 'Witness)) (Set (WitVKey 'Witness)))
-&gt; TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era)
forall era.
EraTxWits era =&gt;
Lens' (TxWits era) (Set (WitVKey 'Witness))
Lens' (TxWits era) (Set (WitVKey 'Witness))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#addrTxWitsL"><span class="hs-identifier hs-var">addrTxWitsL</span></a></span><span>
</span><span id="line-1007"></span><span>  </span><span id="local-6989586621679716023"><span class="annot"><span class="annottext">[KeyPair 'Witness]
</span><a href="#local-6989586621679716023"><span class="hs-identifier hs-var">extraKeyPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'Witness -&gt; ImpM (LedgerSpec era) (KeyPair 'Witness))
-&gt; [KeyHash 'Witness] -&gt; ImpM (LedgerSpec era) [KeyPair 'Witness]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness -&gt; ImpM (LedgerSpec era) (KeyPair 'Witness)
forall s (m :: * -&gt; *) (r :: KeyRole).
(HasCallStack, HasKeyPairs s, MonadState s m) =&gt;
KeyHash r -&gt; m (KeyPair r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getKeyPair"><span class="hs-identifier hs-var">getKeyPair</span></a></span><span> </span><span class="annot"><span class="annottext">([KeyHash 'Witness] -&gt; ImpM (LedgerSpec era) [KeyPair 'Witness])
-&gt; [KeyHash 'Witness] -&gt; ImpM (LedgerSpec era) [KeyPair 'Witness]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness) -&gt; [KeyHash 'Witness]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716020"><span class="hs-identifier hs-var">witsVKeyNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; Set (KeyHash 'Witness) -&gt; Set (KeyHash 'Witness)
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716021"><span class="hs-identifier hs-var">curAddrWitHashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716025"><span class="annot"><span class="annottext">extraAddrVKeyWits :: Set (WitVKey 'Witness)
</span><a href="#local-6989586621679716025"><span class="hs-identifier hs-var hs-var">extraAddrVKeyWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody
-&gt; [KeyPair 'Witness] -&gt; Set (WitVKey 'Witness)
forall (kr :: KeyRole).
SafeHash EraIndependentTxBody
-&gt; [KeyPair kr] -&gt; Set (WitVKey 'Witness)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkWitnessesVKey"><span class="hs-identifier hs-var">mkWitnessesVKey</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody
</span><a href="#local-6989586621679716017"><span class="hs-identifier hs-var">txBodyHash</span></a></span><span> </span><span class="annot"><span class="annottext">[KeyPair 'Witness]
</span><a href="#local-6989586621679716023"><span class="hs-identifier hs-var">extraKeyPairs</span></a></span><span>
</span><span id="line-1009"></span><span>      </span><span id="local-6989586621679716026"><span class="annot"><span class="annottext">addrWitHashes :: Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716026"><span class="hs-identifier hs-var hs-var">addrWitHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716021"><span class="hs-identifier hs-var">curAddrWitHashes</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; Set (KeyHash 'Witness) -&gt; Set (KeyHash 'Witness)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(WitVKey 'Witness -&gt; KeyHash 'Witness)
-&gt; Set (WitVKey 'Witness) -&gt; Set (KeyHash 'Witness)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">WitVKey 'Witness -&gt; KeyHash 'Witness
forall (kr :: KeyRole). WitVKey kr -&gt; KeyHash 'Witness
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.WitVKey.html#witVKeyHash"><span class="hs-identifier hs-var">witVKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">Set (WitVKey 'Witness)
</span><a href="#local-6989586621679716025"><span class="hs-identifier hs-var">extraAddrVKeyWits</span></a></span><span>
</span><span id="line-1010"></span><span>  </span><span class="hs-comment">-- Shelley Based Native Script Witnesses</span><span>
</span><span id="line-1011"></span><span>  </span><span id="local-6989586621679716027"><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679716027"><span class="hs-identifier hs-var">scriptsRequired</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Map ScriptHash (NativeScript era))
forall era.
EraUTxO era =&gt;
Tx era -&gt; ImpTestM era (Map ScriptHash (NativeScript era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsRequired"><span class="hs-identifier hs-var">impNativeScriptsRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716015"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1012"></span><span>  </span><span id="local-6989586621679716028"><span class="annot"><span class="annottext">[Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
</span><a href="#local-6989586621679716028"><span class="hs-identifier hs-var">nativeScriptsKeyPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1013"></span><span>    </span><span class="annot"><span class="annottext">(NativeScript era
 -&gt; ImpM
      (LedgerSpec era)
      (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))))
-&gt; [NativeScript era]
-&gt; ImpM
     (LedgerSpec era)
     [Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; NativeScript era
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall era.
ShelleyEraImp era =&gt;
Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; NativeScript era
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyNativeScript"><span class="hs-identifier hs-var">impSatisfyNativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716026"><span class="hs-identifier hs-var">addrWitHashes</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
</span><a href="#local-6989586621679716016"><span class="hs-identifier hs-var">txBody</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era) -&gt; [NativeScript era]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679716027"><span class="hs-identifier hs-var">scriptsRequired</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1014"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716030"><span class="annot"><span class="annottext">extraNativeScriptVKeyWits :: Set (WitVKey 'Witness)
</span><a href="#local-6989586621679716030"><span class="hs-identifier hs-var hs-var">extraNativeScriptVKeyWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1015"></span><span>        </span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody
-&gt; [KeyPair 'Witness] -&gt; Set (WitVKey 'Witness)
forall (kr :: KeyRole).
SafeHash EraIndependentTxBody
-&gt; [KeyPair kr] -&gt; Set (WitVKey 'Witness)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkWitnessesVKey"><span class="hs-identifier hs-var">mkWitnessesVKey</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody
</span><a href="#local-6989586621679716017"><span class="hs-identifier hs-var">txBodyHash</span></a></span><span> </span><span class="annot"><span class="annottext">([KeyPair 'Witness] -&gt; Set (WitVKey 'Witness))
-&gt; [KeyPair 'Witness] -&gt; Set (WitVKey 'Witness)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness) -&gt; [KeyPair 'Witness]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Map (KeyHash 'Witness) (KeyPair 'Witness)]
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
-&gt; [Map (KeyHash 'Witness) (KeyPair 'Witness)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
</span><a href="#local-6989586621679716028"><span class="hs-identifier hs-var">nativeScriptsKeyPairs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1016"></span><span>  </span><span class="hs-comment">-- Byron Based Witessed</span><span>
</span><span id="line-1017"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716031"><span class="annot"><span class="annottext">curBootAddrWitHashes :: Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716031"><span class="hs-identifier hs-var hs-var">curBootAddrWitHashes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(BootstrapWitness -&gt; KeyHash 'Witness)
-&gt; Set BootstrapWitness -&gt; Set (KeyHash 'Witness)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">BootstrapWitness -&gt; KeyHash 'Witness
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Bootstrap.html#bootstrapWitKeyHash"><span class="hs-identifier hs-var">bootstrapWitKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Set BootstrapWitness -&gt; Set (KeyHash 'Witness))
-&gt; Set BootstrapWitness -&gt; Set (KeyHash 'Witness)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716015"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting (Set BootstrapWitness) (Tx era) (Set BootstrapWitness)
-&gt; Set BootstrapWitness
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxWits era -&gt; Const (Set BootstrapWitness) (TxWits era))
-&gt; Tx era -&gt; Const (Set BootstrapWitness) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx era) (TxWits era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#witsTxL"><span class="hs-identifier hs-var">witsTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxWits era -&gt; Const (Set BootstrapWitness) (TxWits era))
 -&gt; Tx era -&gt; Const (Set BootstrapWitness) (Tx era))
-&gt; ((Set BootstrapWitness
     -&gt; Const (Set BootstrapWitness) (Set BootstrapWitness))
    -&gt; TxWits era -&gt; Const (Set BootstrapWitness) (TxWits era))
-&gt; Getting (Set BootstrapWitness) (Tx era) (Set BootstrapWitness)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set BootstrapWitness
 -&gt; Const (Set BootstrapWitness) (Set BootstrapWitness))
-&gt; TxWits era -&gt; Const (Set BootstrapWitness) (TxWits era)
forall era.
EraTxWits era =&gt;
Lens' (TxWits era) (Set BootstrapWitness)
Lens' (TxWits era) (Set BootstrapWitness)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bootAddrTxWitsL"><span class="hs-identifier hs-var">bootAddrTxWitsL</span></a></span><span>
</span><span id="line-1018"></span><span>      </span><span id="local-6989586621679716033"><span class="annot"><span class="annottext">bootAddrWitsNeeded :: [BootstrapAddress]
</span><a href="#local-6989586621679716033"><span class="hs-identifier hs-var hs-var">bootAddrWitsNeeded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1019"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679716034"><span class="hs-identifier hs-var">bootAddr</span></a></span><span>
</span><span id="line-1020"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679716034"><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679716034"><span class="hs-identifier hs-var">bootAddr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set BootstrapAddress -&gt; [BootstrapAddress]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set BootstrapAddress
</span><a href="#local-6989586621679716019"><span class="hs-identifier hs-var">bootAddrs</span></a></span><span>
</span><span id="line-1021"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash 'Payment -&gt; KeyHash 'Witness
forall (r :: KeyRole) (r' :: KeyRole). KeyHash r -&gt; KeyHash r'
forall (a :: KeyRole -&gt; *) (r :: KeyRole) (r' :: KeyRole).
HasKeyRole a =&gt;
a r -&gt; a r'
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#coerceKeyRole"><span class="hs-identifier hs-var">coerceKeyRole</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BootstrapAddress -&gt; KeyHash 'Payment
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#bootstrapKeyHash"><span class="hs-identifier hs-var">bootstrapKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679716034"><span class="hs-identifier hs-var">bootAddr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness -&gt; Set (KeyHash 'Witness) -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-operator hs-var">`Set.member`</span></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716031"><span class="hs-identifier hs-var">curBootAddrWitHashes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1022"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-1023"></span><span>  </span><span id="local-6989586621679716036"><span class="annot"><span class="annottext">[BootstrapWitness]
</span><a href="#local-6989586621679716036"><span class="hs-identifier hs-var">extraBootAddrWits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[BootstrapAddress]
-&gt; (BootstrapAddress -&gt; ImpM (LedgerSpec era) BootstrapWitness)
-&gt; ImpM (LedgerSpec era) [BootstrapWitness]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[BootstrapAddress]
</span><a href="#local-6989586621679716033"><span class="hs-identifier hs-var">bootAddrWitsNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">((BootstrapAddress -&gt; ImpM (LedgerSpec era) BootstrapWitness)
 -&gt; ImpM (LedgerSpec era) [BootstrapWitness])
-&gt; (BootstrapAddress -&gt; ImpM (LedgerSpec era) BootstrapWitness)
-&gt; ImpM (LedgerSpec era) [BootstrapWitness]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679716037"><span class="annot"><span class="annottext">bootAddr :: BootstrapAddress
</span><a href="#local-6989586621679716037"><span class="hs-identifier hs-var">bootAddr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-type">BootstrapAddress</span></a></span><span> </span><span id="local-6989586621679716039"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679716039"><span class="hs-identifier hs-var">byronAddr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1024"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#ByronKeyPair"><span class="hs-identifier hs-type">ByronKeyPair</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679716041"><span class="annot"><span class="annottext">SigningKey
</span><a href="#local-6989586621679716041"><span class="hs-identifier hs-var">signingKey</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BootstrapAddress -&gt; ImpM (LedgerSpec era) ByronKeyPair
forall s (m :: * -&gt; *).
(HasCallStack, HasKeyPairs s, MonadState s m) =&gt;
BootstrapAddress -&gt; m ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getByronKeyPair"><span class="hs-identifier hs-var">getByronKeyPair</span></a></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679716037"><span class="hs-identifier hs-var">bootAddr</span></a></span><span>
</span><span id="line-1025"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716042"><span class="annot"><span class="annottext">attrs :: Attributes AddrAttributes
</span><a href="#local-6989586621679716042"><span class="hs-identifier hs-var hs-var">attrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address -&gt; Attributes AddrAttributes
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.Common.Address.html#addrAttributes"><span class="hs-identifier hs-var">Byron.addrAttributes</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679716039"><span class="hs-identifier hs-var">byronAddr</span></a></span><span>
</span><span id="line-1026"></span><span>    </span><span class="annot"><span class="annottext">BootstrapWitness -&gt; ImpM (LedgerSpec era) BootstrapWitness
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(BootstrapWitness -&gt; ImpM (LedgerSpec era) BootstrapWitness)
-&gt; BootstrapWitness -&gt; ImpM (LedgerSpec era) BootstrapWitness
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Hash HASH EraIndependentTxBody
-&gt; SigningKey -&gt; Attributes AddrAttributes -&gt; BootstrapWitness
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Bootstrap.html#makeBootstrapWitness"><span class="hs-identifier hs-var">makeBootstrapWitness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody -&gt; Hash HASH EraIndependentTxBody
forall i. SafeHash i -&gt; Hash HASH i
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#extractHash"><span class="hs-identifier hs-var">extractHash</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody
</span><a href="#local-6989586621679716017"><span class="hs-identifier hs-var">txBodyHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SigningKey
</span><a href="#local-6989586621679716041"><span class="hs-identifier hs-var">signingKey</span></a></span><span> </span><span class="annot"><span class="annottext">Attributes AddrAttributes
</span><a href="#local-6989586621679716042"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-1027"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1028"></span><span>    </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716015"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1029"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxWits era -&gt; Identity (TxWits era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx era) (TxWits era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#witsTxL"><span class="hs-identifier hs-var">witsTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxWits era -&gt; Identity (TxWits era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((Set (WitVKey 'Witness) -&gt; Identity (Set (WitVKey 'Witness)))
    -&gt; TxWits era -&gt; Identity (TxWits era))
-&gt; (Set (WitVKey 'Witness) -&gt; Identity (Set (WitVKey 'Witness)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set (WitVKey 'Witness) -&gt; Identity (Set (WitVKey 'Witness)))
-&gt; TxWits era -&gt; Identity (TxWits era)
forall era.
EraTxWits era =&gt;
Lens' (TxWits era) (Set (WitVKey 'Witness))
Lens' (TxWits era) (Set (WitVKey 'Witness))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#addrTxWitsL"><span class="hs-identifier hs-var">addrTxWitsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (WitVKey 'Witness) -&gt; Identity (Set (WitVKey 'Witness)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; Set (WitVKey 'Witness) -&gt; Tx era -&gt; Tx era
forall a s t. Monoid a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%3C%3E~"><span class="hs-operator hs-var">&lt;&gt;~</span></a></span><span> </span><span class="annot"><span class="annottext">Set (WitVKey 'Witness)
</span><a href="#local-6989586621679716025"><span class="hs-identifier hs-var">extraAddrVKeyWits</span></a></span><span> </span><span class="annot"><span class="annottext">Set (WitVKey 'Witness)
-&gt; Set (WitVKey 'Witness) -&gt; Set (WitVKey 'Witness)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set (WitVKey 'Witness)
</span><a href="#local-6989586621679716030"><span class="hs-identifier hs-var">extraNativeScriptVKeyWits</span></a></span><span>
</span><span id="line-1030"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxWits era -&gt; Identity (TxWits era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx era) (TxWits era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#witsTxL"><span class="hs-identifier hs-var">witsTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxWits era -&gt; Identity (TxWits era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((Set BootstrapWitness -&gt; Identity (Set BootstrapWitness))
    -&gt; TxWits era -&gt; Identity (TxWits era))
-&gt; (Set BootstrapWitness -&gt; Identity (Set BootstrapWitness))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set BootstrapWitness -&gt; Identity (Set BootstrapWitness))
-&gt; TxWits era -&gt; Identity (TxWits era)
forall era.
EraTxWits era =&gt;
Lens' (TxWits era) (Set BootstrapWitness)
Lens' (TxWits era) (Set BootstrapWitness)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bootAddrTxWitsL"><span class="hs-identifier hs-var">bootAddrTxWitsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set BootstrapWitness -&gt; Identity (Set BootstrapWitness))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; Set BootstrapWitness -&gt; Tx era -&gt; Tx era
forall a s t. Monoid a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%3C%3E~"><span class="hs-operator hs-var">&lt;&gt;~</span></a></span><span> </span><span class="annot"><span class="annottext">[BootstrapWitness] -&gt; Set BootstrapWitness
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[BootstrapWitness]
</span><a href="#local-6989586621679716036"><span class="hs-identifier hs-var">extraBootAddrWits</span></a></span><span>
</span><span id="line-1031"></span><span>
</span><span id="line-1032"></span><span class="annot"><span class="hs-comment">-- | This fixup step ensures that there are enough funds in the transaction.</span></span><span>
</span><span id="line-1033"></span><span id="local-6989586621679716045"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addRootTxIn"><span class="hs-identifier hs-type">addRootTxIn</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1034"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716045"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1035"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716045"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1036"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716045"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716045"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1037"></span><span id="addRootTxIn"><span class="annot"><span class="annottext">addRootTxIn :: forall era. ShelleyEraImp era =&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addRootTxIn"><span class="hs-identifier hs-var hs-var">addRootTxIn</span></a></span></span><span> </span><span id="local-6989586621679716063"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716063"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;addRootTxIn&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1038"></span><span>  </span><span id="local-6989586621679716064"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716064"><span class="hs-identifier hs-var">rootTxIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TxIn, TxOut era) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut era) -&gt; TxIn)
-&gt; ImpM (LedgerSpec era) (TxIn, TxOut era)
-&gt; ImpM (LedgerSpec era) TxIn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (TxIn, TxOut era)
forall era. ImpTestM era (TxIn, TxOut era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getImpRootTxOut"><span class="hs-identifier hs-var">getImpRootTxOut</span></a></span><span>
</span><span id="line-1039"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1040"></span><span>    </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716063"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1041"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((Set TxIn -&gt; Identity (Set TxIn))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (Set TxIn -&gt; Identity (Set TxIn))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set TxIn -&gt; Identity (Set TxIn))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era. EraTxBody era =&gt; Lens' (TxBody era) (Set TxIn)
Lens' (TxBody era) (Set TxIn)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#inputsTxBodyL"><span class="hs-identifier hs-var">inputsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set TxIn -&gt; Identity (Set TxIn)) -&gt; Tx era -&gt; Identity (Tx era))
-&gt; (Set TxIn -&gt; Set TxIn) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Set TxIn -&gt; Set TxIn
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716064"><span class="hs-identifier hs-var">rootTxIn</span></a></span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span id="local-6989586621679713096"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptKeyPairs"><span class="hs-identifier hs-type">impNativeScriptKeyPairs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1044"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713096"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1045"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713096"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1046"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span>
</span><span id="line-1047"></span><span>    </span><span class="annot"><a href="#local-6989586621679713096"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1048"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Witness"><span class="hs-identifier hs-type">Witness</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1049"></span><span id="impNativeScriptKeyPairs"><span class="annot"><span class="annottext">impNativeScriptKeyPairs :: forall era.
ShelleyEraImp era =&gt;
Tx era -&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptKeyPairs"><span class="hs-identifier hs-var hs-var">impNativeScriptKeyPairs</span></a></span></span><span> </span><span id="local-6989586621679716090"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716090"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1050"></span><span>  </span><span id="local-6989586621679716091"><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679716091"><span class="hs-identifier hs-var">scriptsRequired</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Map ScriptHash (NativeScript era))
forall era.
EraUTxO era =&gt;
Tx era -&gt; ImpTestM era (Map ScriptHash (NativeScript era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptsRequired"><span class="hs-identifier hs-var">impNativeScriptsRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716090"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1051"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716092"><span class="annot"><span class="annottext">nativeScripts :: [NativeScript era]
</span><a href="#local-6989586621679716092"><span class="hs-identifier hs-var hs-var">nativeScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era) -&gt; [NativeScript era]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (NativeScript era)
</span><a href="#local-6989586621679716091"><span class="hs-identifier hs-var">scriptsRequired</span></a></span><span>
</span><span id="line-1052"></span><span>      </span><span id="local-6989586621679716093"><span class="annot"><span class="annottext">curAddrWits :: Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716093"><span class="hs-identifier hs-var hs-var">curAddrWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WitVKey 'Witness -&gt; KeyHash 'Witness)
-&gt; Set (WitVKey 'Witness) -&gt; Set (KeyHash 'Witness)
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">WitVKey 'Witness -&gt; KeyHash 'Witness
forall (kr :: KeyRole). WitVKey kr -&gt; KeyHash 'Witness
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.WitVKey.html#witVKeyHash"><span class="hs-identifier hs-var">witVKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (WitVKey 'Witness) -&gt; Set (KeyHash 'Witness))
-&gt; Set (WitVKey 'Witness) -&gt; Set (KeyHash 'Witness)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716090"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting
     (Set (WitVKey 'Witness)) (Tx era) (Set (WitVKey 'Witness))
-&gt; Set (WitVKey 'Witness)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era))
-&gt; Tx era -&gt; Const (Set (WitVKey 'Witness)) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxWits era)
Lens' (Tx era) (TxWits era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#witsTxL"><span class="hs-identifier hs-var">witsTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era))
 -&gt; Tx era -&gt; Const (Set (WitVKey 'Witness)) (Tx era))
-&gt; ((Set (WitVKey 'Witness)
     -&gt; Const (Set (WitVKey 'Witness)) (Set (WitVKey 'Witness)))
    -&gt; TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era))
-&gt; Getting
     (Set (WitVKey 'Witness)) (Tx era) (Set (WitVKey 'Witness))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set (WitVKey 'Witness)
 -&gt; Const (Set (WitVKey 'Witness)) (Set (WitVKey 'Witness)))
-&gt; TxWits era -&gt; Const (Set (WitVKey 'Witness)) (TxWits era)
forall era.
EraTxWits era =&gt;
Lens' (TxWits era) (Set (WitVKey 'Witness))
Lens' (TxWits era) (Set (WitVKey 'Witness))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#addrTxWitsL"><span class="hs-identifier hs-var">addrTxWitsL</span></a></span><span>
</span><span id="line-1053"></span><span>  </span><span id="local-6989586621679716094"><span class="annot"><span class="annottext">[Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
</span><a href="#local-6989586621679716094"><span class="hs-identifier hs-var">keyPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(NativeScript era
 -&gt; ImpM
      (LedgerSpec era)
      (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))))
-&gt; [NativeScript era]
-&gt; ImpM
     (LedgerSpec era)
     [Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; [a] -&gt; m [b]
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; NativeScript era
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall era.
ShelleyEraImp era =&gt;
Set (KeyHash 'Witness)
-&gt; TxBody era
-&gt; NativeScript era
-&gt; ImpTestM era (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impSatisfyNativeScript"><span class="hs-identifier hs-var">impSatisfyNativeScript</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716093"><span class="hs-identifier hs-var">curAddrWits</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era
 -&gt; NativeScript era
 -&gt; ImpM
      (LedgerSpec era)
      (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))))
-&gt; TxBody era
-&gt; NativeScript era
-&gt; ImpM
     (LedgerSpec era)
     (Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716090"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NativeScript era]
</span><a href="#local-6989586621679716092"><span class="hs-identifier hs-var">nativeScripts</span></a></span><span>
</span><span id="line-1054"></span><span>  </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'Witness) (KeyPair 'Witness)
 -&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness)))
-&gt; ([Map (KeyHash 'Witness) (KeyPair 'Witness)]
    -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; [Map (KeyHash 'Witness) (KeyPair 'Witness)]
-&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Map (KeyHash 'Witness) (KeyPair 'Witness)]
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span> </span><span class="annot"><span class="annottext">([Map (KeyHash 'Witness) (KeyPair 'Witness)]
 -&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness)))
-&gt; [Map (KeyHash 'Witness) (KeyPair 'Witness)]
-&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
-&gt; [Map (KeyHash 'Witness) (KeyPair 'Witness)]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">[Maybe (Map (KeyHash 'Witness) (KeyPair 'Witness))]
</span><a href="#local-6989586621679716094"><span class="hs-identifier hs-var">keyPairs</span></a></span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span id="local-6989586621679716095"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupTxOuts"><span class="hs-identifier hs-type">fixupTxOuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716095"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716095"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716095"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716095"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1057"></span><span id="fixupTxOuts"><span class="annot"><span class="annottext">fixupTxOuts :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupTxOuts"><span class="hs-identifier hs-var hs-var">fixupTxOuts</span></a></span></span><span> </span><span id="local-6989586621679716145"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716145"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1058"></span><span>  </span><span id="local-6989586621679716146"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716146"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (PParams era)
 -&gt; ImpTestM era (PParams era))
-&gt; SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((PParams era -&gt; Const r (PParams era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (PParams era -&gt; Const r (PParams era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const r (PParams era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span>
</span><span id="line-1059"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1060"></span><span>    </span><span id="local-6989586621679716150"><span class="annot"><span class="annottext">txOuts :: StrictSeq (TxOut era)
</span><a href="#local-6989586621679716150"><span class="hs-identifier hs-var hs-var">txOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716145"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting (StrictSeq (TxOut era)) (Tx era) (StrictSeq (TxOut era))
-&gt; StrictSeq (TxOut era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
-&gt; Tx era -&gt; Const (StrictSeq (TxOut era)) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
 -&gt; Tx era -&gt; Const (StrictSeq (TxOut era)) (Tx era))
-&gt; ((StrictSeq (TxOut era)
     -&gt; Const (StrictSeq (TxOut era)) (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
-&gt; Getting (StrictSeq (TxOut era)) (Tx era) (StrictSeq (TxOut era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era)
 -&gt; Const (StrictSeq (TxOut era)) (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span>
</span><span id="line-1061"></span><span>  </span><span id="local-6989586621679716152"><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679716152"><span class="hs-identifier hs-var">fixedUpTxOuts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
-&gt; (TxOut era -&gt; ImpM (LedgerSpec era) (TxOut era))
-&gt; ImpM (LedgerSpec era) (StrictSeq (TxOut era))
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679716150"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut era -&gt; ImpM (LedgerSpec era) (TxOut era))
 -&gt; ImpM (LedgerSpec era) (StrictSeq (TxOut era)))
-&gt; (TxOut era -&gt; ImpM (LedgerSpec era) (TxOut era))
-&gt; ImpM (LedgerSpec era) (StrictSeq (TxOut era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679716153"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716153"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1062"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716153"><span class="hs-identifier hs-var">txOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; Getting Coin (TxOut era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Coin (TxOut era) Coin
forall era. (HasCallStack, EraTxOut era) =&gt; Lens' (TxOut era) Coin
Lens' (TxOut era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#coinTxOutL"><span class="hs-identifier hs-var">coinTxOutL</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-1063"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1064"></span><span>        </span><span id="local-6989586621679716156"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716156"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) Coin
forall a (m :: * -&gt; *). (Arbitrary a, MonadGen m) =&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#arbitrary"><span class="hs-identifier hs-var">arbitrary</span></a></span><span>
</span><span id="line-1065"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716158"><span class="annot"><span class="annottext">txOut' :: TxOut era
</span><a href="#local-6989586621679716158"><span class="hs-identifier hs-var hs-var">txOut'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; TxOut era -&gt; TxOut era
forall era. EraTxOut era =&gt; PParams era -&gt; TxOut era -&gt; TxOut era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Tools.html#ensureMinCoinTxOut"><span class="hs-identifier hs-var">ensureMinCoinTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716146"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716153"><span class="hs-identifier hs-var">txOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; (TxOut era -&gt; TxOut era) -&gt; TxOut era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin) -&gt; TxOut era -&gt; Identity (TxOut era)
forall era. (HasCallStack, EraTxOut era) =&gt; Lens' (TxOut era) Coin
Lens' (TxOut era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#coinTxOutL"><span class="hs-identifier hs-var">coinTxOutL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin) -&gt; TxOut era -&gt; Identity (TxOut era))
-&gt; Coin -&gt; TxOut era -&gt; TxOut era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716156"><span class="hs-identifier hs-var">amount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>        </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; ImpM (LedgerSpec era) ()
forall t. HasCallStack =&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logDoc"><span class="hs-identifier hs-var">logDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpM (LedgerSpec era) ())
-&gt; Doc AnsiStyle -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1067"></span><span>          </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Fixed up the amount in the TxOut to &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Doc AnsiStyle
forall a. ToExpr a =&gt; a -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExpr"><span class="hs-identifier hs-var">ansiExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716158"><span class="hs-identifier hs-var">txOut'</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; Getting Coin (TxOut era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Coin (TxOut era) Coin
forall era. (HasCallStack, EraTxOut era) =&gt; Lens' (TxOut era) Coin
Lens' (TxOut era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#coinTxOutL"><span class="hs-identifier hs-var">coinTxOutL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1068"></span><span>        </span><span class="annot"><span class="annottext">TxOut era -&gt; ImpM (LedgerSpec era) (TxOut era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716158"><span class="hs-identifier hs-var">txOut'</span></a></span><span>
</span><span id="line-1069"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1070"></span><span>        </span><span class="annot"><span class="annottext">TxOut era -&gt; ImpM (LedgerSpec era) (TxOut era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716153"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-1071"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era -&gt; ImpTestM era (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716145"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxOut era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679716152"><span class="hs-identifier hs-var">fixedUpTxOuts</span></a></span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span id="local-6989586621679716159"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupFees"><span class="hs-identifier hs-type">fixupFees</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1074"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716159"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1075"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716159"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1076"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716159"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716159"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1077"></span><span id="fixupFees"><span class="annot"><span class="annottext">fixupFees :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupFees"><span class="hs-identifier hs-var hs-var">fixupFees</span></a></span></span><span> </span><span id="local-6989586621679716286"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716286"><span class="hs-identifier hs-var">txOriginal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;fixupFees&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1078"></span><span>  </span><span class="hs-comment">-- Fee will be overwritten later on, unless it wasn't set to zero to begin with:</span><span>
</span><span id="line-1079"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716287"><span class="annot"><span class="annottext">tx :: Tx era
</span><a href="#local-6989586621679716287"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716286"><span class="hs-identifier hs-var">txOriginal</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((Coin -&gt; Identity Coin) -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (Coin -&gt; Identity Coin)
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin) -&gt; TxBody era -&gt; Identity (TxBody era)
forall era. EraTxBody era =&gt; Lens' (TxBody era) Coin
Lens' (TxBody era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#feeTxBodyL"><span class="hs-identifier hs-var">feeTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin) -&gt; Tx era -&gt; Identity (Tx era))
-&gt; Coin -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-1080"></span><span>  </span><span id="local-6989586621679716289"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716289"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (PParams era)
 -&gt; ImpTestM era (PParams era))
-&gt; SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((PParams era -&gt; Const r (PParams era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (PParams era -&gt; Const r (PParams era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const r (PParams era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span>
</span><span id="line-1081"></span><span>  </span><span id="local-6989586621679716293"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716293"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (UTxO era)
forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var">getUTxO</span></a></span><span>
</span><span id="line-1082"></span><span>  </span><span id="local-6989586621679716294"><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679716294"><span class="hs-identifier hs-var">certState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (CertState era)
-&gt; ImpTestM era (CertState era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (CertState era)
 -&gt; ImpTestM era (CertState era))
-&gt; SimpleGetter (NewEpochState era) (CertState era)
-&gt; ImpTestM era (CertState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((CertState era -&gt; Const r (CertState era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (CertState era -&gt; Const r (CertState era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const r (LedgerState era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((LedgerState era -&gt; Const r (LedgerState era))
 -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; ((CertState era -&gt; Const r (CertState era))
    -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; (CertState era -&gt; Const r (CertState era))
-&gt; EpochState era
-&gt; Const r (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CertState era -&gt; Const r (CertState era))
-&gt; LedgerState era -&gt; Const r (LedgerState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(CertState era -&gt; f (CertState era))
-&gt; LedgerState era -&gt; f (LedgerState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertStateL"><span class="hs-identifier hs-var">lsCertStateL</span></a></span><span>
</span><span id="line-1083"></span><span>  </span><span id="local-6989586621679716298"><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679716298"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) Addr
forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadGen m) =&gt;
m Addr
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr_"><span class="hs-identifier hs-var">freshKeyAddr_</span></a></span><span>
</span><span id="line-1084"></span><span>  </span><span id="local-6989586621679716299"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679716299"><span class="hs-identifier hs-var">nativeScriptKeyPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall era.
ShelleyEraImp era =&gt;
Tx era -&gt; ImpTestM era (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScriptKeyPairs"><span class="hs-identifier hs-var">impNativeScriptKeyPairs</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716287"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1085"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1086"></span><span>    </span><span id="local-6989586621679716300"><span class="annot"><span class="annottext">nativeScriptKeyWits :: Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716300"><span class="hs-identifier hs-var hs-var">nativeScriptKeyWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness) -&gt; Set (KeyHash 'Witness)
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679716299"><span class="hs-identifier hs-var">nativeScriptKeyPairs</span></a></span><span>
</span><span id="line-1087"></span><span>    </span><span id="local-6989586621679716302"><span class="annot"><span class="annottext">consumedValue :: Value era
</span><a href="#local-6989586621679716302"><span class="hs-identifier hs-var hs-var">consumedValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; CertState era -&gt; UTxO era -&gt; TxBody era -&gt; Value era
forall era.
EraUTxO era =&gt;
PParams era -&gt; CertState era -&gt; UTxO era -&gt; TxBody era -&gt; Value era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#consumed"><span class="hs-identifier hs-var">consumed</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716289"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679716294"><span class="hs-identifier hs-var">certState</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716293"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716287"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1088"></span><span>    </span><span id="local-6989586621679716304"><span class="annot"><span class="annottext">producedValue :: Value era
</span><a href="#local-6989586621679716304"><span class="hs-identifier hs-var hs-var">producedValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; CertState era -&gt; TxBody era -&gt; Value era
forall era.
(EraUTxO era, EraCertState era) =&gt;
PParams era -&gt; CertState era -&gt; TxBody era -&gt; Value era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.UTxO.html#produced"><span class="hs-identifier hs-var">produced</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716289"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679716294"><span class="hs-identifier hs-var">certState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716287"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>    </span><span id="local-6989586621679716383"><span class="annot"><span class="annottext">ensureNonNegativeCoin :: p -&gt; ImpM t p
</span><a href="#local-6989586621679716383"><span class="hs-identifier hs-var hs-var">ensureNonNegativeCoin</span></a></span></span><span> </span><span id="local-6989586621679716384"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679716384"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-1090"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Integer -&gt; Bool) -&gt; p -&gt; p -&gt; Bool
forall t. Val t =&gt; (Integer -&gt; Integer -&gt; Bool) -&gt; t -&gt; t -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#pointwise"><span class="hs-identifier hs-var">pointwise</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(&lt;=)</span></span><span> </span><span class="annot"><span class="annottext">p
forall t. Val t =&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679716384"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p -&gt; ImpM t p
forall a. a -&gt; ImpM t a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679716384"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1091"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1092"></span><span>          </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; ImpM t ()
forall t. HasCallStack =&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logDoc"><span class="hs-identifier hs-var">logDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpM t ()) -&gt; Doc AnsiStyle -&gt; ImpM t ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Failed to validate coin: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">p -&gt; Doc AnsiStyle
forall a. ToExpr a =&gt; a -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExpr"><span class="hs-identifier hs-var">ansiExpr</span></a></span><span> </span><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621679716384"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1093"></span><span>          </span><span class="annot"><span class="annottext">p -&gt; ImpM t p
forall a. a -&gt; ImpM t a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">p
forall t. Val t =&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span>
</span><span id="line-1094"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) ()
forall t. HasCallStack =&gt; [Char] -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logString"><span class="hs-identifier hs-var">logString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Validating changeBeforeFee&quot;</span></span><span>
</span><span id="line-1095"></span><span>  </span><span id="local-6989586621679716386"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716386"><span class="hs-identifier hs-var">changeBeforeFee</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; ImpM (LedgerSpec era) Coin
forall {p} {t}. (Val p, ToExpr p) =&gt; p -&gt; ImpM t p
</span><a href="#local-6989586621679716383"><span class="hs-identifier hs-var">ensureNonNegativeCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; ImpM (LedgerSpec era) Coin)
-&gt; Coin -&gt; ImpM (LedgerSpec era) Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value era -&gt; Coin
forall t. Val t =&gt; t -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#coin"><span class="hs-identifier hs-var">coin</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679716302"><span class="hs-identifier hs-var">consumedValue</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Value era -&gt; Coin
forall t. Val t =&gt; t -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#coin"><span class="hs-identifier hs-var">coin</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679716304"><span class="hs-identifier hs-var">producedValue</span></a></span><span>
</span><span id="line-1096"></span><span>  </span><span class="annot"><span class="annottext">Coin -&gt; ImpM (LedgerSpec era) ()
forall a t. (HasCallStack, ToExpr a) =&gt; a -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logToExpr"><span class="hs-identifier hs-var">logToExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716386"><span class="hs-identifier hs-var">changeBeforeFee</span></a></span><span>
</span><span id="line-1097"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1098"></span><span>    </span><span id="local-6989586621679716389"><span class="annot"><span class="annottext">changeBeforeFeeTxOut :: TxOut era
</span><a href="#local-6989586621679716389"><span class="hs-identifier hs-var hs-var">changeBeforeFeeTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr -&gt; Value era -&gt; TxOut era
forall era.
(EraTxOut era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; TxOut era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxOut"><span class="hs-identifier hs-var">mkBasicTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679716298"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t s. Inject t s =&gt; t -&gt; s
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716386"><span class="hs-identifier hs-var">changeBeforeFee</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1099"></span><span>    </span><span id="local-6989586621679716390"><span class="annot"><span class="annottext">txNoWits :: Tx era
</span><a href="#local-6989586621679716390"><span class="hs-identifier hs-var hs-var">txNoWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716287"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; (StrictSeq (TxOut era) -&gt; StrictSeq (TxOut era))
-&gt; Tx era
-&gt; Tx era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictSeq (TxOut era) -&gt; TxOut era -&gt; StrictSeq (TxOut era)
forall a. StrictSeq a -&gt; a -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#%3A%7C%3E"><span class="hs-operator hs-var">:|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716389"><span class="hs-identifier hs-var">changeBeforeFeeTxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1100"></span><span>    </span><span id="local-6989586621679716392"><span class="annot"><span class="annottext">outsBeforeFee :: StrictSeq (TxOut era)
</span><a href="#local-6989586621679716392"><span class="hs-identifier hs-var hs-var">outsBeforeFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716287"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting (StrictSeq (TxOut era)) (Tx era) (StrictSeq (TxOut era))
-&gt; StrictSeq (TxOut era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
-&gt; Tx era -&gt; Const (StrictSeq (TxOut era)) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
 -&gt; Tx era -&gt; Const (StrictSeq (TxOut era)) (Tx era))
-&gt; ((StrictSeq (TxOut era)
     -&gt; Const (StrictSeq (TxOut era)) (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
-&gt; Getting (StrictSeq (TxOut era)) (Tx era) (StrictSeq (TxOut era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era)
 -&gt; Const (StrictSeq (TxOut era)) (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span>
</span><span id="line-1101"></span><span>    </span><span id="local-6989586621679716393"><span class="annot"><span class="annottext">suppliedFee :: Coin
</span><a href="#local-6989586621679716393"><span class="hs-identifier hs-var hs-var">suppliedFee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716286"><span class="hs-identifier hs-var">txOriginal</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting Coin (Tx era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Const Coin (TxBody era))
-&gt; Tx era -&gt; Const Coin (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Const Coin (TxBody era))
 -&gt; Tx era -&gt; Const Coin (Tx era))
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; TxBody era -&gt; Const Coin (TxBody era))
-&gt; Getting Coin (Tx era) Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Const Coin Coin) -&gt; TxBody era -&gt; Const Coin (TxBody era)
forall era. EraTxBody era =&gt; Lens' (TxBody era) Coin
Lens' (TxBody era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#feeTxBodyL"><span class="hs-identifier hs-var">feeTxBodyL</span></a></span><span>
</span><span id="line-1102"></span><span>    </span><span id="local-6989586621679716394"><span class="annot"><span class="annottext">fee0 :: Coin
</span><a href="#local-6989586621679716394"><span class="hs-identifier hs-var hs-var">fee0</span></a></span></span><span>
</span><span id="line-1103"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716393"><span class="hs-identifier hs-var">suppliedFee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; PParams era -&gt; Tx era -&gt; Set (KeyHash 'Witness) -&gt; Coin
forall era.
(EraUTxO era, EraCertState era) =&gt;
UTxO era -&gt; PParams era -&gt; Tx era -&gt; Set (KeyHash 'Witness) -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Tools.html#calcMinFeeTxNativeScriptWits"><span class="hs-identifier hs-var">calcMinFeeTxNativeScriptWits</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716293"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716289"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716390"><span class="hs-identifier hs-var">txNoWits</span></a></span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Witness)
</span><a href="#local-6989586621679716300"><span class="hs-identifier hs-var">nativeScriptKeyWits</span></a></span><span>
</span><span id="line-1104"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716393"><span class="hs-identifier hs-var">suppliedFee</span></a></span><span>
</span><span id="line-1105"></span><span>    </span><span id="local-6989586621679716395"><span class="annot"><span class="annottext">fee :: Coin
</span><a href="#local-6989586621679716395"><span class="hs-identifier hs-var hs-var">fee</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#rationalToCoinViaCeiling"><span class="hs-identifier hs-var">rationalToCoinViaCeiling</span></a></span><span> </span><span class="annot"><span class="annottext">(Rational -&gt; Coin) -&gt; Rational -&gt; Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Rational
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#coinToRational"><span class="hs-identifier hs-var">coinToRational</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716394"><span class="hs-identifier hs-var">fee0</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Rational
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">11</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><span class="hs-operator hs-var">%</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">10</span></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) ()
forall t. HasCallStack =&gt; [Char] -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logString"><span class="hs-identifier hs-var">logString</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Validating change&quot;</span></span><span>
</span><span id="line-1107"></span><span>  </span><span id="local-6989586621679716398"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716398"><span class="hs-identifier hs-var">change</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; ImpM (LedgerSpec era) Coin
forall {p} {t}. (Val p, ToExpr p) =&gt; p -&gt; ImpM t p
</span><a href="#local-6989586621679716383"><span class="hs-identifier hs-var">ensureNonNegativeCoin</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; ImpM (LedgerSpec era) Coin)
-&gt; Coin -&gt; ImpM (LedgerSpec era) Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716389"><span class="hs-identifier hs-var">changeBeforeFeeTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; Getting Coin (TxOut era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Coin (TxOut era) Coin
forall era. (HasCallStack, EraTxOut era) =&gt; Lens' (TxOut era) Coin
Lens' (TxOut era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#coinTxOutL"><span class="hs-identifier hs-var">coinTxOutL</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716395"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-1108"></span><span>  </span><span class="annot"><span class="annottext">Coin -&gt; ImpM (LedgerSpec era) ()
forall a t. (HasCallStack, ToExpr a) =&gt; a -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logToExpr"><span class="hs-identifier hs-var">logToExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716398"><span class="hs-identifier hs-var">change</span></a></span><span>
</span><span id="line-1109"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1110"></span><span>    </span><span id="local-6989586621679716399"><span class="annot"><span class="annottext">changeTxOut :: TxOut era
</span><a href="#local-6989586621679716399"><span class="hs-identifier hs-var hs-var">changeTxOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716389"><span class="hs-identifier hs-var">changeBeforeFeeTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; (TxOut era -&gt; TxOut era) -&gt; TxOut era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin) -&gt; TxOut era -&gt; Identity (TxOut era)
forall era. (HasCallStack, EraTxOut era) =&gt; Lens' (TxOut era) Coin
Lens' (TxOut era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#coinTxOutL"><span class="hs-identifier hs-var">coinTxOutL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin) -&gt; TxOut era -&gt; Identity (TxOut era))
-&gt; Coin -&gt; TxOut era -&gt; TxOut era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716398"><span class="hs-identifier hs-var">change</span></a></span><span>
</span><span id="line-1111"></span><span>    </span><span class="hs-comment">-- If the remainder is sufficently big we add it to outputs, otherwise we add the</span><span>
</span><span id="line-1112"></span><span>    </span><span class="hs-comment">-- extraneous coin to the fee and discard the remainder TxOut</span><span>
</span><span id="line-1113"></span><span>    </span><span id="local-6989586621679716400"><span class="annot"><span class="annottext">txWithFee :: Tx era
</span><a href="#local-6989586621679716400"><span class="hs-identifier hs-var hs-var">txWithFee</span></a></span></span><span>
</span><span id="line-1114"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716398"><span class="hs-identifier hs-var">change</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; TxOut era -&gt; Coin
forall era. EraTxOut era =&gt; PParams era -&gt; TxOut era -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#getMinCoinTxOut"><span class="hs-identifier hs-var">getMinCoinTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716289"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716399"><span class="hs-identifier hs-var">changeTxOut</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1115"></span><span>          </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716390"><span class="hs-identifier hs-var">txNoWits</span></a></span><span>
</span><span id="line-1116"></span><span>            </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxOut era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679716392"><span class="hs-identifier hs-var">outsBeforeFee</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era) -&gt; TxOut era -&gt; StrictSeq (TxOut era)
forall a. StrictSeq a -&gt; a -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#%3A%7C%3E"><span class="hs-operator hs-var">:|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716399"><span class="hs-identifier hs-var">changeTxOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>            </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((Coin -&gt; Identity Coin) -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (Coin -&gt; Identity Coin)
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin) -&gt; TxBody era -&gt; Identity (TxBody era)
forall era. EraTxBody era =&gt; Lens' (TxBody era) Coin
Lens' (TxBody era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#feeTxBodyL"><span class="hs-identifier hs-var">feeTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin) -&gt; Tx era -&gt; Identity (Tx era))
-&gt; Coin -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716395"><span class="hs-identifier hs-var">fee</span></a></span><span>
</span><span id="line-1118"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1119"></span><span>          </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716390"><span class="hs-identifier hs-var">txNoWits</span></a></span><span>
</span><span id="line-1120"></span><span>            </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxOut era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era)
</span><a href="#local-6989586621679716392"><span class="hs-identifier hs-var">outsBeforeFee</span></a></span><span>
</span><span id="line-1121"></span><span>            </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((Coin -&gt; Identity Coin) -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (Coin -&gt; Identity Coin)
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin) -&gt; TxBody era -&gt; Identity (TxBody era)
forall era. EraTxBody era =&gt; Lens' (TxBody era) Coin
Lens' (TxBody era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#feeTxBodyL"><span class="hs-identifier hs-var">feeTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin) -&gt; Tx era -&gt; Identity (Tx era))
-&gt; Coin -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716395"><span class="hs-identifier hs-var">fee</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679716398"><span class="hs-identifier hs-var">change</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716400"><span class="hs-identifier hs-var">txWithFee</span></a></span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span class="annot"><span class="hs-comment">-- | Adds an auxiliary data hash if auxiliary data present, while the hash of it is not.</span></span><span>
</span><span id="line-1125"></span><span id="local-6989586621679713131"><span id="local-6989586621679713132"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupAuxDataHash"><span class="hs-identifier hs-type">fixupAuxDataHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#EraTx"><span class="hs-identifier hs-type">EraTx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713131"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="annot"><a href="#local-6989586621679713132"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713131"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679713132"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713131"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1126"></span><span id="fixupAuxDataHash"><span class="annot"><span class="annottext">fixupAuxDataHash :: forall era (m :: * -&gt; *).
(EraTx era, Applicative m) =&gt;
Tx era -&gt; m (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupAuxDataHash"><span class="hs-identifier hs-var hs-var">fixupAuxDataHash</span></a></span></span><span> </span><span id="local-6989586621679716422"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716422"><span class="hs-identifier hs-var">tx</span></a></span></span><span>
</span><span id="line-1127"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StrictMaybe TxAuxDataHash
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716422"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting
     (StrictMaybe TxAuxDataHash) (Tx era) (StrictMaybe TxAuxDataHash)
-&gt; StrictMaybe TxAuxDataHash
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Const (StrictMaybe TxAuxDataHash) (TxBody era))
-&gt; Tx era -&gt; Const (StrictMaybe TxAuxDataHash) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Const (StrictMaybe TxAuxDataHash) (TxBody era))
 -&gt; Tx era -&gt; Const (StrictMaybe TxAuxDataHash) (Tx era))
-&gt; ((StrictMaybe TxAuxDataHash
     -&gt; Const (StrictMaybe TxAuxDataHash) (StrictMaybe TxAuxDataHash))
    -&gt; TxBody era -&gt; Const (StrictMaybe TxAuxDataHash) (TxBody era))
-&gt; Getting
     (StrictMaybe TxAuxDataHash) (Tx era) (StrictMaybe TxAuxDataHash)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe TxAuxDataHash
 -&gt; Const (StrictMaybe TxAuxDataHash) (StrictMaybe TxAuxDataHash))
-&gt; TxBody era -&gt; Const (StrictMaybe TxAuxDataHash) (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictMaybe TxAuxDataHash)
Lens' (TxBody era) (StrictMaybe TxAuxDataHash)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#auxDataHashTxBodyL"><span class="hs-identifier hs-var">auxDataHashTxBodyL</span></a></span><span>
</span><span id="line-1128"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span id="local-6989586621679716426"><span class="annot"><span class="annottext">TxAuxData era
</span><a href="#local-6989586621679716426"><span class="hs-identifier hs-var">auxData</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716422"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting
     (StrictMaybe (TxAuxData era))
     (Tx era)
     (StrictMaybe (TxAuxData era))
-&gt; StrictMaybe (TxAuxData era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (StrictMaybe (TxAuxData era))
  (Tx era)
  (StrictMaybe (TxAuxData era))
forall era.
EraTx era =&gt;
Lens' (Tx era) (StrictMaybe (TxAuxData era))
Lens' (Tx era) (StrictMaybe (TxAuxData era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#auxDataTxL"><span class="hs-identifier hs-var">auxDataTxL</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1129"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; m (Tx era)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716422"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictMaybe TxAuxDataHash
     -&gt; Identity (StrictMaybe TxAuxDataHash))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictMaybe TxAuxDataHash
    -&gt; Identity (StrictMaybe TxAuxDataHash))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe TxAuxDataHash -&gt; Identity (StrictMaybe TxAuxDataHash))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictMaybe TxAuxDataHash)
Lens' (TxBody era) (StrictMaybe TxAuxDataHash)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#auxDataHashTxBodyL"><span class="hs-identifier hs-var">auxDataHashTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictMaybe TxAuxDataHash
  -&gt; Identity (StrictMaybe TxAuxDataHash))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictMaybe TxAuxDataHash -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">TxAuxDataHash -&gt; StrictMaybe TxAuxDataHash
forall a. a -&gt; StrictMaybe a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-var">SJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SafeHash EraIndependentTxAuxData -&gt; TxAuxDataHash
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#TxAuxDataHash"><span class="hs-identifier hs-var">TxAuxDataHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxAuxData era -&gt; SafeHash EraIndependentTxAuxData
forall x i. HashAnnotated x i =&gt; x -&gt; SafeHash i
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#hashAnnotated"><span class="hs-identifier hs-var">hashAnnotated</span></a></span><span> </span><span class="annot"><span class="annottext">TxAuxData era
</span><a href="#local-6989586621679716426"><span class="hs-identifier hs-var">auxData</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1130"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; m (Tx era)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716422"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyFixupTx"><span class="hs-identifier hs-type">shelleyFixupTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1133"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679716429"><span class="annot"><a href="#local-6989586621679716429"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1134"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716429"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1135"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716429"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1136"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716429"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716429"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span id="shelleyFixupTx"><span class="annot"><span class="annottext">shelleyFixupTx :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyFixupTx"><span class="hs-identifier hs-var hs-var">shelleyFixupTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1138"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall era. ShelleyEraImp era =&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addNativeScriptTxWits"><span class="hs-identifier hs-var">addNativeScriptTxWits</span></a></span><span>
</span><span id="line-1139"></span><span>    </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall era (m :: * -&gt; *).
(EraTx era, Applicative m) =&gt;
Tx era -&gt; m (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupAuxDataHash"><span class="hs-identifier hs-var">fixupAuxDataHash</span></a></span><span>
</span><span id="line-1140"></span><span>    </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall era. ShelleyEraImp era =&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addRootTxIn"><span class="hs-identifier hs-var">addRootTxIn</span></a></span><span>
</span><span id="line-1141"></span><span>    </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupTxOuts"><span class="hs-identifier hs-var">fixupTxOuts</span></a></span><span>
</span><span id="line-1142"></span><span>    </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#fixupFees"><span class="hs-identifier hs-var">fixupFees</span></a></span><span>
</span><span id="line-1143"></span><span>    </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#updateAddrTxWits"><span class="hs-identifier hs-var">updateAddrTxWits</span></a></span><span>
</span><span id="line-1144"></span><span>    </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679716462"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716462"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era ()
forall era.
(EraGov era, EraUTxO era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logFeeMismatch"><span class="hs-identifier hs-var">logFeeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716462"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestM era () -&gt; Tx era -&gt; ImpTestM era (Tx era)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; b -&gt; f b
</span><span class="hs-operator hs-var">$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716462"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impShelleyExpectTxSuccess"><span class="hs-identifier hs-type">impShelleyExpectTxSuccess</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1147"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712927"><span class="annot"><a href="#local-6989586621679712927"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1148"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712927"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1149"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712927"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1150"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712927"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span id="impShelleyExpectTxSuccess"><span class="annot"><span class="annottext">impShelleyExpectTxSuccess :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impShelleyExpectTxSuccess"><span class="hs-identifier hs-var hs-var">impShelleyExpectTxSuccess</span></a></span></span><span> </span><span id="local-6989586621679716496"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1152"></span><span>  </span><span id="local-6989586621679716497"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716497"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (UTxO era)
-&gt; ImpTestM era (UTxO era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO era -&gt; Const r (UTxO era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
SimpleGetter (NewEpochState era) (UTxO era)
forall era. Lens' (NewEpochState era) (UTxO era)
forall (t :: * -&gt; *) era. CanSetUTxO t =&gt; Lens' (t era) (UTxO era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#utxoL"><span class="hs-identifier hs-var">utxoL</span></a></span><span>
</span><span id="line-1153"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716500"><span class="annot"><span class="annottext">inputs :: Set TxIn
</span><a href="#local-6989586621679716500"><span class="hs-identifier hs-var hs-var">inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (Set TxIn) (Tx era) (Set TxIn) -&gt; Set TxIn
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Const (Set TxIn) (TxBody era))
-&gt; Tx era -&gt; Const (Set TxIn) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Const (Set TxIn) (TxBody era))
 -&gt; Tx era -&gt; Const (Set TxIn) (Tx era))
-&gt; ((Set TxIn -&gt; Const (Set TxIn) (Set TxIn))
    -&gt; TxBody era -&gt; Const (Set TxIn) (TxBody era))
-&gt; Getting (Set TxIn) (Tx era) (Set TxIn)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set TxIn -&gt; Const (Set TxIn) (Set TxIn))
-&gt; TxBody era -&gt; Const (Set TxIn) (TxBody era)
forall era. EraTxBody era =&gt; Lens' (TxBody era) (Set TxIn)
Lens' (TxBody era) (Set TxIn)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#inputsTxBodyL"><span class="hs-identifier hs-var">inputsTxBodyL</span></a></span><span>
</span><span id="line-1154"></span><span>      </span><span id="local-6989586621679716501"><span class="annot"><span class="annottext">outputs :: [(TxIn, TxOut era)]
</span><a href="#local-6989586621679716501"><span class="hs-identifier hs-var hs-var">outputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era) -&gt; [(TxIn, TxOut era)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map TxIn (TxOut era) -&gt; [(TxIn, TxOut era)])
-&gt; (TxBody era -&gt; Map TxIn (TxOut era))
-&gt; TxBody era
-&gt; [(TxIn, TxOut era)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; Map TxIn (TxOut era)
forall era. UTxO era -&gt; Map TxIn (TxOut era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO era -&gt; Map TxIn (TxOut era))
-&gt; (TxBody era -&gt; UTxO era) -&gt; TxBody era -&gt; Map TxIn (TxOut era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; UTxO era
forall era. EraTxBody era =&gt; TxBody era -&gt; UTxO era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#txouts"><span class="hs-identifier hs-var">txouts</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; [(TxIn, TxOut era)])
-&gt; TxBody era -&gt; [(TxIn, TxOut era)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716496"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span>
</span><span id="line-1155"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Inputs should be gone from UTxO&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1156"></span><span>    </span><span class="annot"><span class="annottext">UTxO era -&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)] -&gt; ImpTestM era ()
forall era.
(HasCallStack, ToExpr (TxOut era)) =&gt;
UTxO era -&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)] -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectUTxOContent"><span class="hs-identifier hs-var">expectUTxOContent</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716497"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716505"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut era) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679716505"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716505"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set TxIn -&gt; [TxIn]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set TxIn
</span><a href="#local-6989586621679716500"><span class="hs-identifier hs-var">inputs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1157"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Outputs should be in UTxO&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1158"></span><span>    </span><span class="annot"><span class="annottext">UTxO era -&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)] -&gt; ImpTestM era ()
forall era.
(HasCallStack, ToExpr (TxOut era)) =&gt;
UTxO era -&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)] -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectUTxOContent"><span class="hs-identifier hs-var">expectUTxOContent</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716497"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716506"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TxOut era) -&gt; Maybe (TxOut era) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; Maybe (TxOut era)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716507"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679716506"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716506"><span class="hs-identifier hs-var">txIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716507"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679716507"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TxIn, TxOut era)]
</span><a href="#local-6989586621679716501"><span class="hs-identifier hs-var">outputs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1159"></span><span>
</span><span id="line-1160"></span><span id="local-6989586621679713143"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logFeeMismatch"><span class="hs-identifier hs-type">logFeeMismatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#EraUTxO"><span class="hs-identifier hs-type">EraUTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1161"></span><span id="logFeeMismatch"><span class="annot"><span class="annottext">logFeeMismatch :: forall era.
(EraGov era, EraUTxO era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logFeeMismatch"><span class="hs-identifier hs-var hs-var">logFeeMismatch</span></a></span></span><span> </span><span id="local-6989586621679716533"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716533"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1162"></span><span>  </span><span id="local-6989586621679716534"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716534"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (PParams era)
 -&gt; ImpTestM era (PParams era))
-&gt; SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((PParams era -&gt; Const r (PParams era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (PParams era -&gt; Const r (PParams era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const r (PParams era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span>
</span><span id="line-1163"></span><span>  </span><span id="local-6989586621679716538"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716538"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (UTxO era)
-&gt; ImpTestM era (UTxO era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO era -&gt; Const r (UTxO era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
SimpleGetter (NewEpochState era) (UTxO era)
forall era. Lens' (NewEpochState era) (UTxO era)
forall (t :: * -&gt; *) era. CanSetUTxO t =&gt; Lens' (t era) (UTxO era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#utxoL"><span class="hs-identifier hs-var">utxoL</span></a></span><span>
</span><span id="line-1164"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621679716541"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679716541"><span class="hs-identifier hs-var">feeUsed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716533"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting Coin (Tx era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Const Coin (TxBody era))
-&gt; Tx era -&gt; Const Coin (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Const Coin (TxBody era))
 -&gt; Tx era -&gt; Const Coin (Tx era))
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; TxBody era -&gt; Const Coin (TxBody era))
-&gt; Getting Coin (Tx era) Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Const Coin Coin) -&gt; TxBody era -&gt; Const Coin (TxBody era)
forall era. EraTxBody era =&gt; Lens' (TxBody era) Coin
Lens' (TxBody era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#feeTxBodyL"><span class="hs-identifier hs-var">feeTxBodyL</span></a></span><span>
</span><span id="line-1165"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span id="local-6989586621679716542"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679716542"><span class="hs-identifier hs-var">feeMin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; Tx era -&gt; UTxO era -&gt; Coin
forall era.
EraUTxO era =&gt;
PParams era -&gt; Tx era -&gt; UTxO era -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#getMinFeeTxUtxo"><span class="hs-identifier hs-var">getMinFeeTxUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679716534"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716533"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679716538"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-1166"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679716541"><span class="hs-identifier hs-var">feeUsed</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679716542"><span class="hs-identifier hs-var">feeMin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1167"></span><span>    </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; ImpTestM era ()
forall t. HasCallStack =&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logDoc"><span class="hs-identifier hs-var">logDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpTestM era ())
-&gt; Doc AnsiStyle -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1168"></span><span>      </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Estimated fee &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Doc AnsiStyle
forall a. ToExpr a =&gt; a -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExpr"><span class="hs-identifier hs-var">ansiExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679716541"><span class="hs-identifier hs-var">feeUsed</span></a></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot; while required fee is &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Doc AnsiStyle
forall a. ToExpr a =&gt; a -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExpr"><span class="hs-identifier hs-var">ansiExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679716542"><span class="hs-identifier hs-var">feeMin</span></a></span><span>
</span><span id="line-1169"></span><span>
</span><span id="line-1170"></span><span id="local-6989586621679713156"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx_"><span class="hs-identifier hs-type">submitTx_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713156"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713156"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713156"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1171"></span><span id="submitTx_"><span class="annot"><span class="annottext">submitTx_ :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx_"><span class="hs-identifier hs-var hs-var">submitTx_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) ())
-&gt; (Tx era -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; Tx era
-&gt; ImpM (LedgerSpec era) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx"><span class="hs-identifier hs-var">submitTx</span></a></span><span>
</span><span id="line-1172"></span><span>
</span><span id="line-1173"></span><span id="local-6989586621679716551"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx"><span class="hs-identifier hs-type">submitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716551"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716551"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716551"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716551"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1174"></span><span id="submitTx"><span class="annot"><span class="annottext">submitTx :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx"><span class="hs-identifier hs-var hs-var">submitTx</span></a></span></span><span> </span><span id="local-6989586621679716571"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; ImpM
     (LedgerSpec era)
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#trySubmitTx"><span class="hs-identifier hs-var">trySubmitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716571"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era))
-&gt; (Either
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
      (Tx era)
    -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; ImpM (LedgerSpec era) (Tx era)
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))) (Tx era)
-&gt; ImpM (LedgerSpec era) (Tx era)
forall a b (m :: * -&gt; *).
(HasCallStack, ToExpr a, NFData b, MonadIO m) =&gt;
Either a b -&gt; m b
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Imp.Common.html#expectRightDeepExpr"><span class="hs-identifier hs-var">expectRightDeepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Either
   (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))) (Tx era)
 -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; (Either
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
      (Tx era)
    -&gt; Either
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))) (Tx era))
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era)
-&gt; ImpM (LedgerSpec era) (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
 -&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))) (Tx era)
forall a b c. (a -&gt; b) -&gt; Either a c -&gt; Either b c
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
-&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span>
</span><span id="line-1175"></span><span>
</span><span id="line-1176"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#trySubmitTx"><span class="hs-identifier hs-type">trySubmitTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1177"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713163"><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1178"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1179"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-1180"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1181"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1182"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1183"></span><span id="trySubmitTx"><span class="annot"><span class="annottext">trySubmitTx :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#trySubmitTx"><span class="hs-identifier hs-var hs-var">trySubmitTx</span></a></span></span><span> </span><span id="local-6989586621679716709"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716709"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1184"></span><span>  </span><span id="local-6989586621679716710"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImpTestEnv era -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpM (LedgerSpec era) (Tx era -&gt; ImpTestM era (Tx era))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era -&gt; Tx era -&gt; ImpTestM era (Tx era)
forall era. ImpTestEnv era -&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixup"><span class="hs-identifier hs-var">iteFixup</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (Tx era -&gt; ImpTestM era (Tx era))
-&gt; ((Tx era -&gt; ImpTestM era (Tx era)) -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era (Tx era)
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era -&gt; ImpTestM era (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716709"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1185"></span><span>  </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) ()
forall a t. (HasCallStack, ToExpr a) =&gt; a -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logToExpr"><span class="hs-identifier hs-var">logToExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span>
</span><span id="line-1186"></span><span>  </span><span id="local-6989586621679716711"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716711"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; NewEpochState era)
-&gt; ImpM (LedgerSpec era) (NewEpochState era)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; NewEpochState era
forall era. ImpTestState era -&gt; NewEpochState era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNES"><span class="hs-identifier hs-var">impNES</span></a></span><span>
</span><span id="line-1187"></span><span>  </span><span id="local-6989586621679716712"><span class="annot"><span class="annottext">LedgerEnv era
</span><a href="#local-6989586621679716712"><span class="hs-identifier hs-var">lEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NewEpochState era -&gt; ImpTestM era (LedgerEnv era)
forall era.
EraGov era =&gt;
NewEpochState era -&gt; ImpTestM era (LedgerEnv era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLedgerEnv"><span class="hs-identifier hs-var">impLedgerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716711"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-1188"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestState"><span class="hs-identifier hs-type">ImpTestState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679716713"><span class="annot"><span class="annottext">TxIn
impRootTxIn :: forall era. ImpTestState era -&gt; TxIn
impRootTxIn :: TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxIn"><span class="hs-identifier hs-var hs-var">impRootTxIn</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (ImpTestState era)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-1189"></span><span>  </span><span id="local-6989586621679716714"><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
  (LedgerState era, [Event (EraRule &quot;LEDGER&quot; era)])
</span><a href="#local-6989586621679716714"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (rule :: Symbol) era.
(STS (EraRule rule era), BaseM (EraRule rule era) ~ ShelleyBase) =&gt;
Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (State (EraRule rule era), [Event (EraRule rule era)]))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule"><span class="hs-identifier hs-var">tryRunImpRule</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><span class="annottext">LedgerEnv era
Environment (EraRule &quot;LEDGER&quot; era)
</span><a href="#local-6989586621679716712"><span class="hs-identifier hs-var">lEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716711"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting (LedgerState era) (NewEpochState era) (LedgerState era)
-&gt; LedgerState era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const (LedgerState era) (EpochState era))
-&gt; NewEpochState era -&gt; Const (LedgerState era) (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const (LedgerState era) (EpochState era))
 -&gt; NewEpochState era
 -&gt; Const (LedgerState era) (NewEpochState era))
-&gt; ((LedgerState era -&gt; Const (LedgerState era) (LedgerState era))
    -&gt; EpochState era -&gt; Const (LedgerState era) (EpochState era))
-&gt; Getting (LedgerState era) (NewEpochState era) (LedgerState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const (LedgerState era) (LedgerState era))
-&gt; EpochState era -&gt; Const (LedgerState era) (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tx era
Signal (EraRule &quot;LEDGER&quot; era)
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span>
</span><span id="line-1190"></span><span>  </span><span id="local-6989586621679716715"><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679716715"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Globals (ImpTestState era) Globals
-&gt; ImpM (LedgerSpec era) Globals
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Globals (ImpTestState era) Globals
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span>
</span><span id="line-1191"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716716"><span class="annot"><span class="annottext">trc :: TRC (EraRule &quot;LEDGER&quot; era)
</span><a href="#local-6989586621679716716"><span class="hs-identifier hs-var hs-var">trc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Environment (EraRule &quot;LEDGER&quot; era), State (EraRule &quot;LEDGER&quot; era),
 Signal (EraRule &quot;LEDGER&quot; era))
-&gt; TRC (EraRule &quot;LEDGER&quot; era)
forall sts. (Environment sts, State sts, Signal sts) -&gt; TRC sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-var">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerEnv era
Environment (EraRule &quot;LEDGER&quot; era)
</span><a href="#local-6989586621679716712"><span class="hs-identifier hs-var">lEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716711"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting (LedgerState era) (NewEpochState era) (LedgerState era)
-&gt; LedgerState era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const (LedgerState era) (EpochState era))
-&gt; NewEpochState era -&gt; Const (LedgerState era) (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const (LedgerState era) (EpochState era))
 -&gt; NewEpochState era
 -&gt; Const (LedgerState era) (NewEpochState era))
-&gt; ((LedgerState era -&gt; Const (LedgerState era) (LedgerState era))
    -&gt; EpochState era -&gt; Const (LedgerState era) (EpochState era))
-&gt; Getting (LedgerState era) (NewEpochState era) (LedgerState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const (LedgerState era) (LedgerState era))
-&gt; EpochState era -&gt; Const (LedgerState era) (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tx era
Signal (EraRule &quot;LEDGER&quot; era)
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1192"></span><span>
</span><span id="line-1193"></span><span>  </span><span class="hs-comment">-- Check for conformance</span><span>
</span><span id="line-1194"></span><span>  </span><span class="annot"><span class="annottext">(ImpTestEnv era
 -&gt; forall t.
    Globals
    -&gt; TRC (EraRule &quot;LEDGER&quot; era)
    -&gt; Either
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
         (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
    -&gt; ImpM t ())
-&gt; ImpM
     (LedgerSpec era)
     (forall t.
      Globals
      -&gt; TRC (EraRule &quot;LEDGER&quot; era)
      -&gt; Either
           (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
           (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
      -&gt; ImpM t ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;LEDGER&quot; era)
   -&gt; Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
        (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
   -&gt; ImpM t ()
forall era.
ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;LEDGER&quot; era)
   -&gt; Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
        (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
   -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostSubmitTxHook"><span class="hs-identifier hs-var">itePostSubmitTxHook</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (forall t.
   Globals
   -&gt; TRC (EraRule &quot;LEDGER&quot; era)
   -&gt; Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
        (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
   -&gt; ImpM t ())
-&gt; ((forall t.
     Globals
     -&gt; TRC (EraRule &quot;LEDGER&quot; era)
     -&gt; Either
          (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
          (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
     -&gt; ImpM t ())
    -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) ()
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679716718"><span class="annot"><span class="annottext">forall t.
Globals
-&gt; TRC (EraRule &quot;LEDGER&quot; era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
     (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
-&gt; ImpM t ()
</span><a href="#local-6989586621679716718"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Globals
-&gt; TRC (EraRule &quot;LEDGER&quot; era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
     (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
-&gt; ImpM (LedgerSpec era) ()
forall t.
Globals
-&gt; TRC (EraRule &quot;LEDGER&quot; era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
     (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
-&gt; ImpM t ()
</span><a href="#local-6989586621679716718"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679716715"><span class="hs-identifier hs-var">globals</span></a></span><span> </span><span class="annot"><span class="annottext">TRC (EraRule &quot;LEDGER&quot; era)
</span><a href="#local-6989586621679716716"><span class="hs-identifier hs-var">trc</span></a></span><span> </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
  (State (EraRule &quot;LEDGER&quot; era), [Event (EraRule &quot;LEDGER&quot; era)])
Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
  (LedgerState era, [Event (EraRule &quot;LEDGER&quot; era)])
</span><a href="#local-6989586621679716714"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>
</span><span id="line-1196"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
  (LedgerState era, [Event (EraRule &quot;LEDGER&quot; era)])
</span><a href="#local-6989586621679716714"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1197"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679716719"><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
</span><a href="#local-6989586621679716719"><span class="hs-identifier hs-var">predFailures</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1198"></span><span>      </span><span class="hs-comment">-- Verify that produced predicate failures are ready for the node-to-client protocol</span><span>
</span><span id="line-1199"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; ImpM (LedgerSpec era) ()
forall a. IO a -&gt; ImpM (LedgerSpec era) a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; ImpM (LedgerSpec era) ())
-&gt; IO () -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; (PredicateFailure (EraRule &quot;LEDGER&quot; era) -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
</span><a href="#local-6989586621679716719"><span class="hs-identifier hs-var">predFailures</span></a></span><span> </span><span class="annot"><span class="annottext">((PredicateFailure (EraRule &quot;LEDGER&quot; era) -&gt; IO ()) -&gt; IO ())
-&gt; (PredicateFailure (EraRule &quot;LEDGER&quot; era) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall era t.
(Era era, Show t, Eq t, EncCBOR t, DecCBOR t, HasCallStack) =&gt;
t -&gt; IO ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Binary.RoundTrip.html#roundTripEraExpectation"><span class="hs-identifier hs-var">roundTripEraExpectation</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1200"></span><span>      </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
  (Tx era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
   (Tx era)
 -&gt; ImpTestM
      era
      (Either
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
         (Tx era)))
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
</span><a href="#local-6989586621679716719"><span class="hs-identifier hs-var">predFailures</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679716721"><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679716721"><span class="hs-identifier hs-var">st'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716722"><span class="annot"><span class="annottext">[Event (EraRule &quot;LEDGER&quot; era)]
</span><a href="#local-6989586621679716722"><span class="hs-identifier hs-var">events</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1202"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716723"><span class="annot"><span class="annottext">txId :: TxId
</span><a href="#local-6989586621679716723"><span class="hs-identifier hs-var hs-var">txId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeHash EraIndependentTxBody -&gt; TxId
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxId"><span class="hs-identifier hs-var">TxId</span></a></span><span> </span><span class="annot"><span class="annottext">(SafeHash EraIndependentTxBody -&gt; TxId)
-&gt; (TxBody era -&gt; SafeHash EraIndependentTxBody)
-&gt; TxBody era
-&gt; TxId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; SafeHash EraIndependentTxBody
forall x i. HashAnnotated x i =&gt; x -&gt; SafeHash i
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#hashAnnotated"><span class="hs-identifier hs-var">hashAnnotated</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; TxId) -&gt; TxBody era -&gt; TxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; Getting (TxBody era) (Tx era) (TxBody era) -&gt; TxBody era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (TxBody era) (Tx era) (TxBody era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span>
</span><span id="line-1203"></span><span>          </span><span id="local-6989586621679716724"><span class="annot"><span class="annottext">outsSize :: Int
</span><a href="#local-6989586621679716724"><span class="hs-identifier hs-var hs-var">outsSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictSeq (TxOut era) -&gt; Int
forall a. StrictSeq a -&gt; Int
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#length"><span class="hs-identifier hs-var">SSeq.length</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era) -&gt; Int) -&gt; StrictSeq (TxOut era) -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Getting (StrictSeq (TxOut era)) (Tx era) (StrictSeq (TxOut era))
-&gt; StrictSeq (TxOut era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
-&gt; Tx era -&gt; Const (StrictSeq (TxOut era)) (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
 -&gt; Tx era -&gt; Const (StrictSeq (TxOut era)) (Tx era))
-&gt; ((StrictSeq (TxOut era)
     -&gt; Const (StrictSeq (TxOut era)) (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era))
-&gt; Getting (StrictSeq (TxOut era)) (Tx era) (StrictSeq (TxOut era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era)
 -&gt; Const (StrictSeq (TxOut era)) (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Const (StrictSeq (TxOut era)) (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span>
</span><span id="line-1204"></span><span>          </span><span id="local-6989586621679716726"><span class="annot"><span class="annottext">rootIndex :: Int
</span><a href="#local-6989586621679716726"><span class="hs-identifier hs-var hs-var">rootIndex</span></a></span></span><span>
</span><span id="line-1205"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679716724"><span class="hs-identifier hs-var">outsSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679716724"><span class="hs-identifier hs-var">outsSize</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1206"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Int
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected at least 1 output after submitting tx: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxId -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679716723"><span class="hs-identifier hs-var">txId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>      </span><span class="annot"><span class="annottext">[SomeSTSEvent era] -&gt; ImpM (LedgerSpec era) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">([SomeSTSEvent era] -&gt; ImpM (LedgerSpec era) ())
-&gt; [SomeSTSEvent era] -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Event (EraRule &quot;LEDGER&quot; era) -&gt; SomeSTSEvent era)
-&gt; [Event (EraRule &quot;LEDGER&quot; era)] -&gt; [SomeSTSEvent era]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era (rule :: Symbol).
(Typeable (Event (EraRule rule era)),
 Eq (Event (EraRule rule era)),
 ToExpr (Event (EraRule rule era))) =&gt;
Event (EraRule rule era) -&gt; SomeSTSEvent era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-var">SomeSTSEvent</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713163"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Event (EraRule &quot;LEDGER&quot; era)]
</span><a href="#local-6989586621679716722"><span class="hs-identifier hs-var">events</span></a></span><span>
</span><span id="line-1208"></span><span>      </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; ImpTestState era) -&gt; ImpM (LedgerSpec era) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((ImpTestState era -&gt; ImpTestState era)
 -&gt; ImpM (LedgerSpec era) ())
-&gt; (ImpTestState era -&gt; ImpTestState era)
-&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(NewEpochState era -&gt; f (NewEpochState era))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier hs-var">impNESL</span></a></span><span> </span><span class="annot"><span class="annottext">((NewEpochState era -&gt; Identity (NewEpochState era))
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; ((LedgerState era -&gt; Identity (LedgerState era))
    -&gt; NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; (LedgerState era -&gt; Identity (LedgerState era))
-&gt; ImpTestState era
-&gt; Identity (ImpTestState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Identity (EpochState era))
-&gt; NewEpochState era -&gt; Identity (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Identity (EpochState era))
 -&gt; NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; ((LedgerState era -&gt; Identity (LedgerState era))
    -&gt; EpochState era -&gt; Identity (EpochState era))
-&gt; (LedgerState era -&gt; Identity (LedgerState era))
-&gt; NewEpochState era
-&gt; Identity (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Identity (LedgerState era))
-&gt; EpochState era -&gt; Identity (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((LedgerState era -&gt; Identity (LedgerState era))
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; LedgerState era -&gt; ImpTestState era -&gt; ImpTestState era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679716721"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-1209"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span id="local-6989586621679716729"><span class="annot"><span class="annottext">Map TxIn (TxOut era)
</span><a href="#local-6989586621679716729"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (UTxO era)
forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var">getUTxO</span></a></span><span>
</span><span id="line-1210"></span><span>      </span><span class="hs-comment">-- This TxIn is in the utxo, and thus can be the new root, only if the transaction</span><span>
</span><span id="line-1211"></span><span>      </span><span class="hs-comment">-- was phase2-valid.  Otherwise, no utxo with this id would have been created, and</span><span>
</span><span id="line-1212"></span><span>      </span><span class="hs-comment">-- so we need to set the new root to what it was before the submission.</span><span>
</span><span id="line-1213"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716730"><span class="annot"><span class="annottext">assumedNewRoot :: TxIn
</span><a href="#local-6989586621679716730"><span class="hs-identifier hs-var hs-var">assumedNewRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; TxIx -&gt; TxIn
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-var">TxIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621679716723"><span class="hs-identifier hs-var">txId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; Integer -&gt; TxIx
Integer -&gt; TxIx
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#mkTxIxPartial"><span class="hs-identifier hs-var">mkTxIxPartial</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679716726"><span class="hs-identifier hs-var">rootIndex</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716732"><span class="annot"><span class="annottext">newRoot :: TxIn
</span><a href="#local-6989586621679716732"><span class="hs-identifier hs-var hs-var">newRoot</span></a></span></span><span>
</span><span id="line-1215"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Map TxIn (TxOut era) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.member</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716730"><span class="hs-identifier hs-var">assumedNewRoot</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era)
</span><a href="#local-6989586621679716729"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716730"><span class="hs-identifier hs-var">assumedNewRoot</span></a></span><span>
</span><span id="line-1216"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Map TxIn (TxOut era) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.member</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716713"><span class="hs-identifier hs-var">impRootTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut era)
</span><a href="#local-6989586621679716729"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716713"><span class="hs-identifier hs-var">impRootTxIn</span></a></span><span>
</span><span id="line-1217"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TxIn
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Root not found in UTxO&quot;</span></span><span>
</span><span id="line-1218"></span><span>      </span><span class="annot"><span class="annottext">(TxIn -&gt; Identity TxIn)
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(TxIn -&gt; f TxIn) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impRootTxInL"><span class="hs-identifier hs-var">impRootTxInL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxIn -&gt; Identity TxIn)
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; TxIn -&gt; ImpM (LedgerSpec era) ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679716732"><span class="hs-identifier hs-var">newRoot</span></a></span><span>
</span><span id="line-1219"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) ()
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectTxSuccess"><span class="hs-identifier hs-var">expectTxSuccess</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span>
</span><span id="line-1220"></span><span>      </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
  (Tx era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
   (Tx era)
 -&gt; ImpTestM
      era
      (Either
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
         (Tx era)))
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716710"><span class="hs-identifier hs-var">txFixed</span></a></span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span class="hs-comment">-- | Submit a transaction that is expected to be rejected with the given predicate failures.</span><span>
</span><span id="line-1223"></span><span class="hs-comment">-- The inputs and outputs are automatically balanced.</span><span>
</span><span id="line-1224"></span><span id="local-6989586621679713195"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTx"><span class="hs-identifier hs-type">submitFailingTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1225"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-1226"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713195"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1227"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1228"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713195"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1229"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679713195"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1230"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713195"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1231"></span><span id="submitFailingTx"><span class="annot"><span class="annottext">submitFailingTx :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era
-&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTx"><span class="hs-identifier hs-var hs-var">submitFailingTx</span></a></span></span><span> </span><span id="local-6989586621679716740"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716740"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; (Tx era
    -&gt; ImpM
         (LedgerSpec era)
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))))
-&gt; ImpM (LedgerSpec era) ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era
-&gt; (Tx era
    -&gt; ImpTestM
         era (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))))
-&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTxM"><span class="hs-identifier hs-var">submitFailingTxM</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716740"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((Tx era
  -&gt; ImpM
       (LedgerSpec era)
       (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))))
 -&gt; ImpM (LedgerSpec era) ())
-&gt; (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
    -&gt; Tx era
    -&gt; ImpM
         (LedgerSpec era)
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))))
-&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; ImpM (LedgerSpec era) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
-&gt; Tx era
-&gt; ImpM
     (LedgerSpec era)
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">(ImpM
   (LedgerSpec era)
   (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
 -&gt; Tx era
 -&gt; ImpM
      (LedgerSpec era)
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))))
-&gt; (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
    -&gt; ImpM
         (LedgerSpec era)
         (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))))
-&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; Tx era
-&gt; ImpM
     (LedgerSpec era)
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; ImpM
     (LedgerSpec era)
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span class="hs-comment">-- | Submit a transaction that is expected to be rejected, and compute</span><span>
</span><span id="line-1234"></span><span class="hs-comment">-- the expected predicate failures from the fixed-up tx using the supplied action.</span><span>
</span><span id="line-1235"></span><span class="hs-comment">-- The inputs and outputs are automatically balanced.</span><span>
</span><span id="line-1236"></span><span id="local-6989586621679713197"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTxM"><span class="hs-identifier hs-type">submitFailingTxM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-1238"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713197"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1239"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1240"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713197"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1241"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713197"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713197"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;LEDGER&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679713197"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1242"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713197"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1243"></span><span id="submitFailingTxM"><span class="annot"><span class="annottext">submitFailingTxM :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era
-&gt; (Tx era
    -&gt; ImpTestM
         era (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))))
-&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitFailingTxM"><span class="hs-identifier hs-var hs-var">submitFailingTxM</span></a></span></span><span> </span><span id="local-6989586621679716772"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716772"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span id="local-6989586621679716773"><span class="annot"><span class="annottext">Tx era
-&gt; ImpTestM
     era (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
</span><a href="#local-6989586621679716773"><span class="hs-identifier hs-var">mkExpectedFailures</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1244"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679716774"><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
</span><a href="#local-6989586621679716774"><span class="hs-identifier hs-var">predFailures</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716775"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716775"><span class="hs-identifier hs-var">fixedUpTx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
  (Tx era)
-&gt; ImpM
     (LedgerSpec era)
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
forall b a (m :: * -&gt; *).
(HasCallStack, ToExpr b, NFData a, MonadIO m) =&gt;
Either a b -&gt; m a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Imp.Common.html#expectLeftDeepExpr"><span class="hs-identifier hs-var">expectLeftDeepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Either
   (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
   (Tx era)
 -&gt; ImpM
      (LedgerSpec era)
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era))
-&gt; ImpM
     (LedgerSpec era)
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
-&gt; ImpM
     (LedgerSpec era)
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; ImpM
     (LedgerSpec era)
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#trySubmitTx"><span class="hs-identifier hs-var">trySubmitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716772"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1245"></span><span>  </span><span id="local-6989586621679716778"><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
</span><a href="#local-6989586621679716778"><span class="hs-identifier hs-var">expectedFailures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Tx era
-&gt; ImpTestM
     era (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)))
</span><a href="#local-6989586621679716773"><span class="hs-identifier hs-var">mkExpectedFailures</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679716775"><span class="hs-identifier hs-var">fixedUpTx</span></a></span><span>
</span><span id="line-1246"></span><span>  </span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
</span><a href="#local-6989586621679716774"><span class="hs-identifier hs-var">predFailures</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
-&gt; ImpTestM era ()
forall a (m :: * -&gt; *).
(HasCallStack, ToExpr a, Eq a, MonadIO m) =&gt;
a -&gt; a -&gt; m ()
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Imp.Common.html#shouldBeExpr"><span class="hs-operator hs-var">`shouldBeExpr`</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era))
</span><a href="#local-6989586621679716778"><span class="hs-identifier hs-var">expectedFailures</span></a></span><span>
</span><span id="line-1247"></span><span>
</span><span id="line-1248"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule"><span class="hs-identifier hs-type">tryRunImpRule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1249"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713178"><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span></span><span> </span><span id="local-6989586621679713179"><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-type">BaseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1251"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1252"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1253"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1254"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span>
</span><span id="line-1255"></span><span>    </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1256"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-1257"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713179"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span id="tryRunImpRule"><span class="annot"><span class="annottext">tryRunImpRule :: forall (rule :: Symbol) era.
(STS (EraRule rule era), BaseM (EraRule rule era) ~ ShelleyBase) =&gt;
Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (State (EraRule rule era), [Event (EraRule rule era)]))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule"><span class="hs-identifier hs-var hs-var">tryRunImpRule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (rule :: Symbol) era.
(STS (EraRule rule era), BaseM (EraRule rule era) ~ ShelleyBase) =&gt;
AssertionPolicy
-&gt; Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (State (EraRule rule era), [Event (EraRule rule era)]))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule%27"><span class="hs-identifier hs-var">tryRunImpRule'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713178"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><span class="annottext">AssertionPolicy
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#AssertionsAll"><span class="hs-identifier hs-var">AssertionsAll</span></a></span><span>
</span><span id="line-1261"></span><span>
</span><span id="line-1262"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRuleNoAssertions"><span class="hs-identifier hs-type">tryRunImpRuleNoAssertions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1263"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679716788"><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span></span><span> </span><span id="local-6989586621679716789"><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1264"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1265"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-type">BaseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span>
</span><span id="line-1266"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1267"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1268"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1269"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1270"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span>
</span><span id="line-1271"></span><span>    </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1272"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-1273"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1274"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679716789"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1276"></span><span id="tryRunImpRuleNoAssertions"><span class="annot"><span class="annottext">tryRunImpRuleNoAssertions :: forall (rule :: Symbol) era.
(STS (EraRule rule era), BaseM (EraRule rule era) ~ ShelleyBase) =&gt;
Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (State (EraRule rule era), [Event (EraRule rule era)]))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRuleNoAssertions"><span class="hs-identifier hs-var hs-var">tryRunImpRuleNoAssertions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (rule :: Symbol) era.
(STS (EraRule rule era), BaseM (EraRule rule era) ~ ShelleyBase) =&gt;
AssertionPolicy
-&gt; Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (State (EraRule rule era), [Event (EraRule rule era)]))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule%27"><span class="hs-identifier hs-var">tryRunImpRule'</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679716788"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><span class="annottext">AssertionPolicy
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#AssertionsOff"><span class="hs-identifier hs-var">AssertionsOff</span></a></span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule%27"><span class="hs-identifier hs-type">tryRunImpRule'</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1279"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713216"><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span></span><span> </span><span id="local-6989586621679713217"><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1280"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-type">BaseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1281"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#AssertionPolicy"><span class="hs-identifier hs-type">AssertionPolicy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1282"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1283"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1284"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1285"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span>
</span><span id="line-1286"></span><span>    </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1287"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span>
</span><span id="line-1288"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">NonEmpty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-type">PredicateFailure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1289"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-1291"></span><span id="tryRunImpRule%27"><span class="annot"><span class="annottext">tryRunImpRule' :: forall (rule :: Symbol) era.
(STS (EraRule rule era), BaseM (EraRule rule era) ~ ShelleyBase) =&gt;
AssertionPolicy
-&gt; Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (State (EraRule rule era), [Event (EraRule rule era)]))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule%27"><span class="hs-identifier hs-var hs-var">tryRunImpRule'</span></a></span></span><span> </span><span id="local-6989586621679716805"><span class="annot"><span class="annottext">AssertionPolicy
</span><a href="#local-6989586621679716805"><span class="hs-identifier hs-var">assertionPolicy</span></a></span></span><span> </span><span id="local-6989586621679716806"><span class="annot"><span class="annottext">Environment (EraRule rule era)
</span><a href="#local-6989586621679716806"><span class="hs-identifier hs-var">stsEnv</span></a></span></span><span> </span><span id="local-6989586621679716807"><span class="annot"><span class="annottext">State (EraRule rule era)
</span><a href="#local-6989586621679716807"><span class="hs-identifier hs-var">stsState</span></a></span></span><span> </span><span id="local-6989586621679716808"><span class="annot"><span class="annottext">Signal (EraRule rule era)
</span><a href="#local-6989586621679716808"><span class="hs-identifier hs-var">stsSignal</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716809"><span class="annot"><span class="annottext">trc :: TRC (EraRule rule era)
</span><a href="#local-6989586621679716809"><span class="hs-identifier hs-var hs-var">trc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Environment (EraRule rule era), State (EraRule rule era),
 Signal (EraRule rule era))
-&gt; TRC (EraRule rule era)
forall sts. (Environment sts, State sts, Signal sts) -&gt; TRC sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-var">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment (EraRule rule era)
</span><a href="#local-6989586621679716806"><span class="hs-identifier hs-var">stsEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State (EraRule rule era)
</span><a href="#local-6989586621679716807"><span class="hs-identifier hs-var">stsState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Signal (EraRule rule era)
</span><a href="#local-6989586621679716808"><span class="hs-identifier hs-var">stsSignal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1294"></span><span>    </span><span id="local-6989586621679716810"><span class="annot"><span class="annottext">stsOpts :: ApplySTSOpts 'EventPolicyReturn
</span><a href="#local-6989586621679716810"><span class="hs-identifier hs-var hs-var">stsOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1295"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#ApplySTSOpts"><span class="hs-identifier hs-type">ApplySTSOpts</span></a></span><span>
</span><span id="line-1296"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">asoValidation :: ValidationPolicy
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#asoValidation"><span class="hs-identifier hs-var">asoValidation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationPolicy
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#ValidateAll"><span class="hs-identifier hs-var">ValidateAll</span></a></span><span>
</span><span id="line-1297"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">asoEvents :: SingEP 'EventPolicyReturn
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#asoEvents"><span class="hs-identifier hs-var">asoEvents</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SingEP 'EventPolicyReturn
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#EPReturn"><span class="hs-identifier hs-var">EPReturn</span></a></span><span>
</span><span id="line-1298"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">asoAssertions :: AssertionPolicy
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#asoAssertions"><span class="hs-identifier hs-var">asoAssertions</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AssertionPolicy
</span><a href="#local-6989586621679716805"><span class="hs-identifier hs-var">assertionPolicy</span></a></span><span>
</span><span id="line-1299"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1300"></span><span>  </span><span class="annot"><span class="annottext">ShelleyBase
  (Either
     (NonEmpty (PredicateFailure (EraRule rule era)))
     (EventReturnType
        'EventPolicyReturn (EraRule rule era) (State (EraRule rule era))))
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (EventReturnType
           'EventPolicyReturn (EraRule rule era) (State (EraRule rule era))))
forall a era. ShelleyBase a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runShelleyBase"><span class="hs-identifier hs-var">runShelleyBase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall s (m :: * -&gt; *) (rtype :: RuleType) (ep :: EventPolicy).
(STS s, RuleTypeRep rtype, m ~ BaseM s) =&gt;
ApplySTSOpts ep
-&gt; RuleContext rtype s
-&gt; m (Either
        (NonEmpty (PredicateFailure s)) (EventReturnType ep s (State s)))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#applySTSOptsEither"><span class="hs-identifier hs-var">applySTSOptsEither</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713216"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713217"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ApplySTSOpts 'EventPolicyReturn
</span><a href="#local-6989586621679716810"><span class="hs-identifier hs-var">stsOpts</span></a></span><span> </span><span class="annot"><span class="annottext">RuleContext 'Transition (EraRule rule era)
TRC (EraRule rule era)
</span><a href="#local-6989586621679716809"><span class="hs-identifier hs-var">trc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>
</span><span id="line-1302"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runImpRule"><span class="hs-identifier hs-type">runImpRule</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1303"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713236"><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span></span><span> </span><span id="local-6989586621679713237"><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1304"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownSymbol</span></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span>
</span><span id="line-1306"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1307"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-type">BaseM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span>
</span><span id="line-1308"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NFData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1310"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1311"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1312"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typeable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Event"><span class="hs-identifier hs-type">Event</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1313"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1314"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1315"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1316"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1317"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1318"></span><span id="runImpRule"><span class="annot"><span class="annottext">runImpRule :: forall (rule :: Symbol) era.
(HasCallStack, KnownSymbol rule, STS (EraRule rule era),
 BaseM (EraRule rule era) ~ ShelleyBase,
 NFData (State (EraRule rule era)),
 NFData (Event (EraRule rule era)),
 ToExpr (Event (EraRule rule era)), Eq (Event (EraRule rule era)),
 Typeable (Event (EraRule rule era))) =&gt;
Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM era (State (EraRule rule era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runImpRule"><span class="hs-identifier hs-var hs-var">runImpRule</span></a></span></span><span> </span><span id="local-6989586621679716855"><span class="annot"><span class="annottext">Environment (EraRule rule era)
</span><a href="#local-6989586621679716855"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679716856"><span class="annot"><span class="annottext">State (EraRule rule era)
</span><a href="#local-6989586621679716856"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679716857"><span class="annot"><span class="annottext">Signal (EraRule rule era)
</span><a href="#local-6989586621679716857"><span class="hs-identifier hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1319"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716858"><span class="annot"><span class="annottext">ruleName :: [Char]
</span><a href="#local-6989586621679716858"><span class="hs-identifier hs-var hs-var">ruleName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proxy rule -&gt; [Char]
forall (n :: Symbol) (proxy :: Symbol -&gt; *).
KnownSymbol n =&gt;
proxy n -&gt; [Char]
</span><span class="hs-identifier hs-var">symbolVal</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall {k} (t :: k). Proxy t
forall (t :: Symbol). Proxy t
</span><span class="hs-identifier hs-var">Proxy</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1320"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679716860"><span class="annot"><span class="annottext">State (EraRule rule era)
</span><a href="#local-6989586621679716860"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679716861"><span class="annot"><span class="annottext">[Event (EraRule rule era)]
</span><a href="#local-6989586621679716861"><span class="hs-identifier hs-var">ev</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1321"></span><span>    </span><span class="annot"><span class="annottext">forall (rule :: Symbol) era.
(STS (EraRule rule era), BaseM (EraRule rule era) ~ ShelleyBase) =&gt;
Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule rule era)))
        (State (EraRule rule era), [Event (EraRule rule era)]))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#tryRunImpRule"><span class="hs-identifier hs-var">tryRunImpRule</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span> </span><span class="annot"><span class="annottext">Environment (EraRule rule era)
</span><a href="#local-6989586621679716855"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">State (EraRule rule era)
</span><a href="#local-6989586621679716856"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Signal (EraRule rule era)
</span><a href="#local-6989586621679716857"><span class="hs-identifier hs-var">sig</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (Either
     (NonEmpty (PredicateFailure (EraRule rule era)))
     (State (EraRule rule era), [Event (EraRule rule era)]))
-&gt; (Either
      (NonEmpty (PredicateFailure (EraRule rule era)))
      (State (EraRule rule era), [Event (EraRule rule era)])
    -&gt; ImpM
         (LedgerSpec era)
         (State (EraRule rule era), [Event (EraRule rule era)]))
-&gt; ImpM
     (LedgerSpec era)
     (State (EraRule rule era), [Event (EraRule rule era)])
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-1322"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679716862"><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule rule era))
</span><a href="#local-6989586621679716862"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1323"></span><span>        </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpM
     (LedgerSpec era)
     (State (EraRule rule era), [Event (EraRule rule era)])
forall (m :: * -&gt; *) a. (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Expectations.Lifted.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char]
 -&gt; ImpM
      (LedgerSpec era)
      (State (EraRule rule era), [Event (EraRule rule era)]))
-&gt; [Char]
-&gt; ImpM
     (LedgerSpec era)
     (State (EraRule rule era), [Event (EraRule rule era)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1324"></span><span>          </span><span class="annot"><span class="annottext">[[Char]] -&gt; [Char]
</span><span class="hs-identifier hs-var">unlines</span></span><span> </span><span class="annot"><span class="annottext">([[Char]] -&gt; [Char]) -&gt; [[Char]] -&gt; [Char]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1325"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Failed to run &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679716858"><span class="hs-identifier hs-var">ruleName</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [[Char]] -&gt; [[Char]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(PredicateFailure (EraRule rule era) -&gt; [Char])
-&gt; [PredicateFailure (EraRule rule era)] -&gt; [[Char]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">PredicateFailure (EraRule rule era) -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule rule era))
-&gt; [PredicateFailure (EraRule rule era)]
forall a. NonEmpty a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty (PredicateFailure (EraRule rule era))
</span><a href="#local-6989586621679716862"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1326"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679716864"><span class="annot"><span class="annottext">(State (EraRule rule era), [Event (EraRule rule era)])
</span><a href="#local-6989586621679716864"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(State (EraRule rule era), [Event (EraRule rule era)])
-&gt; ImpM
     (LedgerSpec era)
     (State (EraRule rule era), [Event (EraRule rule era)])
forall (m :: * -&gt; *) a. (MonadIO m, NFData a) =&gt; a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/unliftio-0.2.25.1-e4f789ba556ee5560c772d9621453215296e4bfb0cb6d914d78127017dc8538a/share/doc/html/src/UnliftIO.Exception.html#evaluateDeep"><span class="hs-identifier hs-var">evaluateDeep</span></a></span><span> </span><span class="annot"><span class="annottext">(State (EraRule rule era), [Event (EraRule rule era)])
</span><a href="#local-6989586621679716864"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1327"></span><span>  </span><span class="annot"><span class="annottext">[SomeSTSEvent era] -&gt; ImpM (LedgerSpec era) ()
forall w (m :: * -&gt; *). MonadWriter w m =&gt; w -&gt; m ()
</span><span class="hs-identifier hs-var">tell</span></span><span> </span><span class="annot"><span class="annottext">([SomeSTSEvent era] -&gt; ImpM (LedgerSpec era) ())
-&gt; [SomeSTSEvent era] -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Event (EraRule rule era) -&gt; SomeSTSEvent era)
-&gt; [Event (EraRule rule era)] -&gt; [SomeSTSEvent era]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall era (rule :: Symbol).
(Typeable (Event (EraRule rule era)),
 Eq (Event (EraRule rule era)),
 ToExpr (Event (EraRule rule era))) =&gt;
Event (EraRule rule era) -&gt; SomeSTSEvent era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#SomeSTSEvent"><span class="hs-identifier hs-var">SomeSTSEvent</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713237"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713236"><span class="hs-identifier hs-type">rule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Event (EraRule rule era)]
</span><a href="#local-6989586621679716861"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-1328"></span><span>  </span><span class="annot"><span class="annottext">State (EraRule rule era) -&gt; ImpTestM era (State (EraRule rule era))
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">State (EraRule rule era)
</span><a href="#local-6989586621679716860"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1329"></span><span>
</span><span id="line-1330"></span><span class="annot"><span class="hs-comment">-- | Runs the TICK rule once</span></span><span>
</span><span id="line-1331"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passTick"><span class="hs-identifier hs-type">passTick</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1332"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712260"><span class="annot"><a href="#local-6989586621679712260"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1333"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-1334"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712260"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1335"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1336"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712260"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1337"></span><span id="passTick"><span class="annot"><span class="annottext">passTick :: forall era. (HasCallStack, ShelleyEraImp era) =&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passTick"><span class="hs-identifier hs-var hs-var">passTick</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1338"></span><span>  </span><span id="local-6989586621679716934"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679716934"><span class="hs-identifier hs-var">impLastTick</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; SlotNo) -&gt; ImpM (LedgerSpec era) SlotNo
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; SlotNo
forall era. ImpTestState era -&gt; SlotNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTick"><span class="hs-identifier hs-var">impLastTick</span></a></span><span>
</span><span id="line-1339"></span><span>  </span><span id="local-6989586621679716935"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716935"><span class="hs-identifier hs-var">curNES</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (NewEpochState era)
-&gt; ImpTestM era (NewEpochState era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall a. a -&gt; a
SimpleGetter (NewEpochState era) (NewEpochState era)
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1340"></span><span>  </span><span id="local-6989586621679716936"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716936"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (rule :: Symbol) era.
(HasCallStack, KnownSymbol rule, STS (EraRule rule era),
 BaseM (EraRule rule era) ~ ShelleyBase,
 NFData (State (EraRule rule era)),
 NFData (Event (EraRule rule era)),
 ToExpr (Event (EraRule rule era)), Eq (Event (EraRule rule era)),
 Typeable (Event (EraRule rule era))) =&gt;
Environment (EraRule rule era)
-&gt; State (EraRule rule era)
-&gt; Signal (EraRule rule era)
-&gt; ImpTestM era (State (EraRule rule era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runImpRule"><span class="hs-identifier hs-var">runImpRule</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;TICK&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;TICK&quot; era)
NewEpochState era
</span><a href="#local-6989586621679716935"><span class="hs-identifier hs-var">curNES</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
Signal (EraRule &quot;TICK&quot; era)
</span><a href="#local-6989586621679716934"><span class="hs-identifier hs-var">impLastTick</span></a></span><span>
</span><span id="line-1341"></span><span>  </span><span class="annot"><span class="annottext">(SlotNo -&gt; Identity SlotNo)
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(SlotNo -&gt; f SlotNo) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickL"><span class="hs-identifier hs-var">impLastTickL</span></a></span><span> </span><span class="annot"><span class="annottext">((SlotNo -&gt; Identity SlotNo)
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; SlotNo -&gt; ImpTestM era ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Num a) =&gt;
ASetter s s a a -&gt; a -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#%2B%3D"><span class="hs-operator hs-var">+=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1342"></span><span>  </span><span class="annot"><span class="annottext">(NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(NewEpochState era -&gt; f (NewEpochState era))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier hs-var">impNESL</span></a></span><span> </span><span class="annot"><span class="annottext">((NewEpochState era -&gt; Identity (NewEpochState era))
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; NewEpochState era -&gt; ImpTestM era ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716936"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-1343"></span><span>
</span><span id="line-1344"></span><span class="annot"><span class="hs-comment">-- | Runs the TICK rule until the next epoch is reached</span></span><span>
</span><span id="line-1345"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier hs-type">passEpoch</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1346"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713257"><span class="annot"><a href="#local-6989586621679713257"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1347"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713257"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1348"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713257"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1349"></span><span id="passEpoch"><span class="annot"><span class="annottext">passEpoch :: forall era. (ShelleyEraImp era, HasCallStack) =&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier hs-var hs-var">passEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1350"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-1351"></span><span>    </span><span id="local-6989586621679716989"><span class="annot"><span class="annottext">tickUntilNewEpoch :: EpochNo -&gt; ImpTestM era ()
</span><a href="#local-6989586621679716989"><span class="hs-identifier hs-var hs-var">tickUntilNewEpoch</span></a></span></span><span> </span><span id="local-6989586621679716990"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679716990"><span class="hs-identifier hs-var">curEpochNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1352"></span><span>      </span><span id="local-6989586621679716991"><span class="annot"><span class="annottext">State (EraRule &quot;NEWEPOCH&quot; era)
</span><a href="#local-6989586621679716991"><span class="hs-identifier hs-var">oldNES</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (State (EraRule &quot;NEWEPOCH&quot; era))
-&gt; ImpTestM era (State (EraRule &quot;NEWEPOCH&quot; era))
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(State (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; Const r (State (EraRule &quot;NEWEPOCH&quot; era)))
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; Const r (State (EraRule &quot;NEWEPOCH&quot; era))
(State (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; Const r (State (EraRule &quot;NEWEPOCH&quot; era)))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall a. a -&gt; a
SimpleGetter (NewEpochState era) (State (EraRule &quot;NEWEPOCH&quot; era))
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1353"></span><span>      </span><span class="annot"><span class="annottext">forall era. (HasCallStack, ShelleyEraImp era) =&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passTick"><span class="hs-identifier hs-var">passTick</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713257"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1354"></span><span>      </span><span id="local-6989586621679716992"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679716992"><span class="hs-identifier hs-var">newEpochNo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) EpochNo -&gt; ImpTestM era EpochNo
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; Const r EpochNo)
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
SimpleGetter (NewEpochState era) EpochNo
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochNo -&gt; f EpochNo)
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesELL"><span class="hs-identifier hs-var">nesELL</span></a></span><span>
</span><span id="line-1355"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679716992"><span class="hs-identifier hs-var">newEpochNo</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679716990"><span class="hs-identifier hs-var">curEpochNo</span></a></span><span>
</span><span id="line-1356"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1357"></span><span>          </span><span id="local-6989586621679716994"><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679716994"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Globals (ImpTestState era) Globals
-&gt; ImpM (LedgerSpec era) Globals
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Globals (ImpTestState era) Globals
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span>
</span><span id="line-1358"></span><span>          </span><span id="local-6989586621679716995"><span class="annot"><span class="annottext">State (EraRule &quot;NEWEPOCH&quot; era)
</span><a href="#local-6989586621679716995"><span class="hs-identifier hs-var">newNES</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (State (EraRule &quot;NEWEPOCH&quot; era))
-&gt; ImpTestM era (State (EraRule &quot;NEWEPOCH&quot; era))
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(State (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; Const r (State (EraRule &quot;NEWEPOCH&quot; era)))
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; Const r (State (EraRule &quot;NEWEPOCH&quot; era))
(State (EraRule &quot;NEWEPOCH&quot; era)
 -&gt; Const r (State (EraRule &quot;NEWEPOCH&quot; era)))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall a. a -&gt; a
SimpleGetter (NewEpochState era) (State (EraRule &quot;NEWEPOCH&quot; era))
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-1359"></span><span>          </span><span class="annot"><span class="annottext">(ImpTestEnv era
 -&gt; forall t.
    Globals
    -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
    -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
    -&gt; ImpM t ())
-&gt; ImpM
     (LedgerSpec era)
     (forall t.
      Globals
      -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
      -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
      -&gt; ImpM t ())
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; ImpM t ()
forall era.
ImpTestEnv era
-&gt; forall t.
   Globals
   -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#itePostEpochBoundaryHook"><span class="hs-identifier hs-var">itePostEpochBoundaryHook</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (forall t.
   Globals
   -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
   -&gt; ImpM t ())
-&gt; ((forall t.
     Globals
     -&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
     -&gt; State (EraRule &quot;NEWEPOCH&quot; era)
     -&gt; ImpM t ())
    -&gt; ImpTestM era ())
-&gt; ImpTestM era ()
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679716996"><span class="annot"><span class="annottext">forall t.
Globals
-&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; ImpM t ()
</span><a href="#local-6989586621679716996"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Globals
-&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; ImpTestM era ()
forall t.
Globals
-&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
-&gt; State (EraRule &quot;NEWEPOCH&quot; era)
-&gt; ImpM t ()
</span><a href="#local-6989586621679716996"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679716994"><span class="hs-identifier hs-var">globals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Environment (EraRule &quot;NEWEPOCH&quot; era),
 State (EraRule &quot;NEWEPOCH&quot; era), Signal (EraRule &quot;NEWEPOCH&quot; era))
-&gt; TRC (EraRule &quot;NEWEPOCH&quot; era)
forall sts. (Environment sts, State sts, Signal sts) -&gt; TRC sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-var">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;NEWEPOCH&quot; era)
</span><a href="#local-6989586621679716991"><span class="hs-identifier hs-var">oldNES</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EpochNo
Signal (EraRule &quot;NEWEPOCH&quot; era)
</span><a href="#local-6989586621679716992"><span class="hs-identifier hs-var">newEpochNo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;NEWEPOCH&quot; era)
</span><a href="#local-6989586621679716995"><span class="hs-identifier hs-var">newNES</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1360"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; ImpTestM era ()
</span><a href="#local-6989586621679716989"><span class="hs-identifier hs-var">tickUntilNewEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679716990"><span class="hs-identifier hs-var">curEpochNo</span></a></span><span>
</span><span id="line-1361"></span><span>  </span><span id="local-6989586621679716997"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716997"><span class="hs-identifier hs-var">preNES</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; NewEpochState era)
-&gt; ImpM (LedgerSpec era) (NewEpochState era)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; NewEpochState era
forall era. ImpTestState era -&gt; NewEpochState era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNES"><span class="hs-identifier hs-var">impNES</span></a></span><span>
</span><span id="line-1362"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679716998"><span class="annot"><span class="annottext">startEpoch :: EpochNo
</span><a href="#local-6989586621679716998"><span class="hs-identifier hs-var hs-var">startEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716997"><span class="hs-identifier hs-var">preNES</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting EpochNo (NewEpochState era) EpochNo -&gt; EpochNo
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting EpochNo (NewEpochState era) EpochNo
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochNo -&gt; f EpochNo)
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesELL"><span class="hs-identifier hs-var">nesELL</span></a></span><span>
</span><span id="line-1363"></span><span>  </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; ImpTestM era ()
forall t. HasCallStack =&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logDoc"><span class="hs-identifier hs-var">logDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpTestM era ())
-&gt; Doc AnsiStyle -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle
</span><span class="hs-string">&quot;Entering &quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; Doc AnsiStyle -&gt; Doc AnsiStyle
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; Doc AnsiStyle
forall a. ToExpr a =&gt; a -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExpr"><span class="hs-identifier hs-var">ansiExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo
forall a. Enum a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">succ</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679716998"><span class="hs-identifier hs-var">startEpoch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1364"></span><span>  </span><span class="annot"><span class="annottext">EpochNo -&gt; ImpTestM era ()
</span><a href="#local-6989586621679716989"><span class="hs-identifier hs-var">tickUntilNewEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679716998"><span class="hs-identifier hs-var">startEpoch</span></a></span><span>
</span><span id="line-1365"></span><span>  </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; NewEpochState era)
-&gt; ImpM (LedgerSpec era) (NewEpochState era)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; NewEpochState era
forall era. ImpTestState era -&gt; NewEpochState era
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNES"><span class="hs-identifier hs-var">impNES</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (NewEpochState era)
-&gt; (NewEpochState era -&gt; ImpTestM era ()) -&gt; ImpTestM era ()
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">NewEpochState era -&gt; NewEpochState era -&gt; ImpTestM era ()
forall era.
(EraTxOut era, EraGov era, HasCallStack, EraCertState era) =&gt;
NewEpochState era -&gt; NewEpochState era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#epochBoundaryCheck"><span class="hs-identifier hs-var">epochBoundaryCheck</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679716997"><span class="hs-identifier hs-var">preNES</span></a></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span id="local-6989586621679713262"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#epochBoundaryCheck"><span class="hs-identifier hs-type">epochBoundaryCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1368"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#EraTxOut"><span class="hs-identifier hs-type">EraTxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713262"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713262"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713262"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1369"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713262"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1370"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713262"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1371"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713262"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1372"></span><span id="epochBoundaryCheck"><span class="annot"><span class="annottext">epochBoundaryCheck :: forall era.
(EraTxOut era, EraGov era, HasCallStack, EraCertState era) =&gt;
NewEpochState era -&gt; NewEpochState era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#epochBoundaryCheck"><span class="hs-identifier hs-var hs-var">epochBoundaryCheck</span></a></span></span><span> </span><span id="local-6989586621679717043"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679717043"><span class="hs-identifier hs-var">preNES</span></a></span></span><span> </span><span id="local-6989586621679717044"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679717044"><span class="hs-identifier hs-var">postNES</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1373"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking ADA preservation at the epoch boundary&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1374"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679717045"><span class="annot"><span class="annottext">preSum :: Coin
</span><a href="#local-6989586621679717045"><span class="hs-identifier hs-var hs-var">preSum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era -&gt; Coin
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 EraTxOut era, EraGov era, EraCertState era) =&gt;
NewEpochState era -&gt; Coin
</span><a href="#local-6989586621679717046"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679717043"><span class="hs-identifier hs-var">preNES</span></a></span><span>
</span><span id="line-1375"></span><span>        </span><span id="local-6989586621679717047"><span class="annot"><span class="annottext">postSum :: Coin
</span><a href="#local-6989586621679717047"><span class="hs-identifier hs-var hs-var">postSum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era -&gt; Coin
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 EraTxOut era, EraGov era, EraCertState era) =&gt;
NewEpochState era -&gt; Coin
</span><a href="#local-6989586621679717046"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679717044"><span class="hs-identifier hs-var">postNES</span></a></span><span>
</span><span id="line-1376"></span><span>    </span><span class="annot"><span class="annottext">Doc AnsiStyle -&gt; ImpTestM era ()
forall t. HasCallStack =&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logDoc"><span class="hs-identifier hs-var">logDoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpTestM era ())
-&gt; Doc AnsiStyle -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Doc AnsiStyle
forall a. ToExpr a =&gt; a -&gt; a -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#diffExpr"><span class="hs-identifier hs-var">diffExpr</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717045"><span class="hs-identifier hs-var">preSum</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717047"><span class="hs-identifier hs-var">postSum</span></a></span><span>
</span><span id="line-1377"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717045"><span class="hs-identifier hs-var">preSum</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717047"><span class="hs-identifier hs-var">postSum</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ([Char] -&gt; ImpTestM era ()) -&gt; [Char] -&gt; ImpTestM era ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era ()
forall (m :: * -&gt; *). (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-expectations-lifted-0.10.0-3b9af14f4044ae8391bddf2d12815688264dd87b731d8f5b89bdb0b08f389286/share/doc/html/src/Test.Hspec.Expectations.Lifted.html#expectationFailure"><span class="hs-identifier hs-var">expectationFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpTestM era ()) -&gt; [Char] -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1378"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Total ADA in the epoch state is not preserved\n\tpost - pre = &quot;</span></span><span>
</span><span id="line-1379"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717047"><span class="hs-identifier hs-var">postSum</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C-%3E"><span class="hs-operator hs-var">&lt;-&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717045"><span class="hs-identifier hs-var">preSum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1381"></span><span>    </span><span id="local-6989586621679717046"><span class="annot"><span class="annottext">tot :: NewEpochState era -&gt; Coin
</span><a href="#local-6989586621679717046"><span class="hs-identifier hs-var hs-var">tot</span></a></span></span><span> </span><span id="local-6989586621679717402"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679717402"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1382"></span><span>      </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator hs-var">(&lt;+&gt;)</span></a></span><span>
</span><span id="line-1383"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AdaPots -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.AdaPots.html#sumAdaPots"><span class="hs-identifier hs-var">sumAdaPots</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochState era -&gt; AdaPots
forall era.
(EraTxOut era, EraGov era, EraCertState era) =&gt;
EpochState era -&gt; AdaPots
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.AdaPots.html#totalAdaPotsES"><span class="hs-identifier hs-var">totalAdaPotsES</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679717402"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting (EpochState era) (NewEpochState era) (EpochState era)
-&gt; EpochState era
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (EpochState era) (NewEpochState era) (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1384"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679717402"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era -&gt; Getting Coin (NewEpochState era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const Coin (EpochState era))
-&gt; NewEpochState era -&gt; Const Coin (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const Coin (EpochState era))
 -&gt; NewEpochState era -&gt; Const Coin (NewEpochState era))
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; EpochState era -&gt; Const Coin (EpochState era))
-&gt; Getting Coin (NewEpochState era) Coin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const Coin (LedgerState era))
-&gt; EpochState era -&gt; Const Coin (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((LedgerState era -&gt; Const Coin (LedgerState era))
 -&gt; EpochState era -&gt; Const Coin (EpochState era))
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; LedgerState era -&gt; Const Coin (LedgerState era))
-&gt; (Coin -&gt; Const Coin Coin)
-&gt; EpochState era
-&gt; Const Coin (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(UTxOState era -&gt; Const Coin (UTxOState era))
-&gt; LedgerState era -&gt; Const Coin (LedgerState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(UTxOState era -&gt; f (UTxOState era))
-&gt; LedgerState era -&gt; f (LedgerState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsUTxOStateL"><span class="hs-identifier hs-var">lsUTxOStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((UTxOState era -&gt; Const Coin (UTxOState era))
 -&gt; LedgerState era -&gt; Const Coin (LedgerState era))
-&gt; ((Coin -&gt; Const Coin Coin)
    -&gt; UTxOState era -&gt; Const Coin (UTxOState era))
-&gt; (Coin -&gt; Const Coin Coin)
-&gt; LedgerState era
-&gt; Const Coin (LedgerState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Const Coin Coin)
-&gt; UTxOState era -&gt; Const Coin (UTxOState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Coin -&gt; f Coin) -&gt; UTxOState era -&gt; f (UTxOState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#utxosDonationL"><span class="hs-identifier hs-var">utxosDonationL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span>
</span><span id="line-1386"></span><span class="annot"><span class="hs-comment">-- | Runs the TICK rule until the `n` epochs are passed</span></span><span>
</span><span id="line-1387"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochs"><span class="hs-identifier hs-type">passNEpochs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1388"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713302"><span class="annot"><a href="#local-6989586621679713302"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1389"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713302"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1390"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1391"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713302"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1392"></span><span id="passNEpochs"><span class="annot"><span class="annottext">passNEpochs :: forall era. ShelleyEraImp era =&gt; Natural -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochs"><span class="hs-identifier hs-var hs-var">passNEpochs</span></a></span></span><span> </span><span id="local-6989586621679717428"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679717428"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1393"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Passing &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679717428"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; epochs&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1394"></span><span>    </span><span class="annot"><span class="annottext">[Natural]
-&gt; (Natural -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">Natural
Item [Natural]
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">..</span><span> </span><span class="annot"><span class="annottext">Natural
Item [Natural]
</span><a href="#local-6989586621679717428"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Natural -&gt; ImpM (LedgerSpec era) ()) -&gt; ImpM (LedgerSpec era) ())
-&gt; (Natural -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679717429"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679717429"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1395"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Passing epoch (&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679717429"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) ()
forall era. (ShelleyEraImp era, HasCallStack) =&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier hs-var">passEpoch</span></a></span><span>
</span><span id="line-1396"></span><span>
</span><span id="line-1397"></span><span class="hs-comment">-- | Runs the TICK rule until the `n` epochs are passed, running the `checks`</span><span>
</span><span id="line-1398"></span><span class="hs-comment">-- each time.</span><span>
</span><span id="line-1399"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochsChecking"><span class="hs-identifier hs-type">passNEpochsChecking</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1400"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713304"><span class="annot"><a href="#local-6989586621679713304"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1401"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713304"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1402"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1403"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713304"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1404"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713304"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1405"></span><span id="passNEpochsChecking"><span class="annot"><span class="annottext">passNEpochsChecking :: forall era.
ShelleyEraImp era =&gt;
Natural -&gt; ImpTestM era () -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochsChecking"><span class="hs-identifier hs-var hs-var">passNEpochsChecking</span></a></span></span><span> </span><span id="local-6989586621679717439"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679717439"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621679717440"><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679717440"><span class="hs-identifier hs-var">checks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1406"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m ()
</span><span class="hs-identifier hs-var">replicateM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural -&gt; Int
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679717439"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ImpTestM era ()
forall era. (ShelleyEraImp era, HasCallStack) =&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier hs-var">passEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestM era () -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b.
ImpM (LedgerSpec era) a
-&gt; ImpM (LedgerSpec era) b -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679717440"><span class="hs-identifier hs-var">checks</span></a></span><span>
</span><span id="line-1407"></span><span>
</span><span id="line-1408"></span><span class="annot"><span class="hs-comment">-- | Adds a ToExpr to the log, which is only shown if the test fails</span></span><span>
</span><span id="line-1409"></span><span id="local-6989586621679713126"><span id="local-6989586621679713127"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logToExpr"><span class="hs-identifier hs-type">logToExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713126"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679713126"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#ImpM"><span class="hs-identifier hs-type">ImpM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713127"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1410"></span><span id="logToExpr"><span class="annot"><span class="annottext">logToExpr :: forall a t. (HasCallStack, ToExpr a) =&gt; a -&gt; ImpM t ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#logToExpr"><span class="hs-identifier hs-var hs-var">logToExpr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CallStack -&gt; Doc AnsiStyle -&gt; ImpM t ()
forall t. CallStack -&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logWithCallStack"><span class="hs-identifier hs-var">logWithCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack
CallStack
</span><a href="#local-6989586621679717445"><span class="hs-var">?callStack</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpM t ())
-&gt; (a -&gt; Doc AnsiStyle) -&gt; a -&gt; ImpM t ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Pretty.html#ansiWlExpr"><span class="hs-identifier hs-var">ansiWlExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Doc AnsiStyle) -&gt; (a -&gt; Expr) -&gt; a -&gt; Doc AnsiStyle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Expr
forall a. ToExpr a =&gt; a -&gt; Expr
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#toExpr"><span class="hs-identifier hs-var">toExpr</span></a></span><span>
</span><span id="line-1411"></span><span>
</span><span id="line-1412"></span><span class="annot"><span class="hs-comment">-- | Adds the result of an action to the log, which is only shown if the test fails</span></span><span>
</span><span id="line-1413"></span><span id="local-6989586621679713313"><span id="local-6989586621679713314"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLogToExpr"><span class="hs-identifier hs-type">impLogToExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713313"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713314"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713313"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713314"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713313"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1414"></span><span id="impLogToExpr"><span class="annot"><span class="annottext">impLogToExpr :: forall a era.
(HasCallStack, ToExpr a) =&gt;
ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLogToExpr"><span class="hs-identifier hs-var hs-var">impLogToExpr</span></a></span></span><span> </span><span id="local-6989586621679717454"><span class="annot"><span class="annottext">ImpTestM era a
</span><a href="#local-6989586621679717454"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1415"></span><span>  </span><span id="local-6989586621679717455"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679717455"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era a
</span><a href="#local-6989586621679717454"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-1416"></span><span>  </span><span class="annot"><span class="annottext">CallStack -&gt; Doc AnsiStyle -&gt; ImpM (LedgerSpec era) ()
forall t. CallStack -&gt; Doc AnsiStyle -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logWithCallStack"><span class="hs-identifier hs-var">logWithCallStack</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack
CallStack
</span><a href="#local-6989586621679717452"><span class="hs-var">?callStack</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc AnsiStyle -&gt; ImpM (LedgerSpec era) ())
-&gt; (a -&gt; Doc AnsiStyle) -&gt; a -&gt; ImpM (LedgerSpec era) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Expr -&gt; Doc AnsiStyle
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Pretty.html#ansiWlExpr"><span class="hs-identifier hs-var">ansiWlExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(Expr -&gt; Doc AnsiStyle) -&gt; (a -&gt; Expr) -&gt; a -&gt; Doc AnsiStyle
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Expr
forall a. ToExpr a =&gt; a -&gt; Expr
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#toExpr"><span class="hs-identifier hs-var">toExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; ImpM (LedgerSpec era) ()) -&gt; a -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679717455"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1417"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; ImpTestM era a
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679717455"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-1418"></span><span>
</span><span id="line-1419"></span><span class="annot"><span class="hs-comment">-- | Creates a fresh @SafeHash@</span></span><span>
</span><span id="line-1420"></span><span id="local-6989586621679713317"><span id="local-6989586621679713318"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshSafeHash"><span class="hs-identifier hs-type">freshSafeHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713317"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#SafeHash"><span class="hs-identifier hs-type">SafeHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713318"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1421"></span><span id="freshSafeHash"><span class="annot"><span class="annottext">freshSafeHash :: forall era a. ImpTestM era (SafeHash a)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshSafeHash"><span class="hs-identifier hs-var hs-var">freshSafeHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (SafeHash a)
forall a (m :: * -&gt; *). (Arbitrary a, MonadGen m) =&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#arbitrary"><span class="hs-identifier hs-var">arbitrary</span></a></span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span id="local-6989586621679713323"><span id="local-6989586621679713324"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-type">freshKeyHashVRF</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1424"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713323"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#VRFVerKeyHash"><span class="hs-identifier hs-type">VRFVerKeyHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679713324"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyRoleVRF"><span class="hs-identifier hs-type">KeyRoleVRF</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-1425"></span><span id="freshKeyHashVRF"><span class="annot"><span class="annottext">freshKeyHashVRF :: forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var hs-var">freshKeyHashVRF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (VRFVerKeyHash r)
forall a (m :: * -&gt; *). (Arbitrary a, MonadGen m) =&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#arbitrary"><span class="hs-identifier hs-var">arbitrary</span></a></span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span class="annot"><span class="hs-comment">-- | Adds a key pair to the keyhash lookup map</span></span><span>
</span><span id="line-1428"></span><span id="local-6989586621679713329"><span id="local-6989586621679713330"><span id="local-6989586621679713331"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addKeyPair"><span class="hs-identifier hs-type">addKeyPair</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1429"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713329"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713329"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713330"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1430"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713331"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1431"></span><span>  </span><span class="annot"><a href="#local-6989586621679713330"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713331"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1432"></span><span id="addKeyPair"><span class="annot"><span class="annottext">addKeyPair :: forall s (m :: * -&gt; *) (r :: KeyRole).
(HasKeyPairs s, MonadState s m) =&gt;
KeyPair r -&gt; m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addKeyPair"><span class="hs-identifier hs-var hs-var">addKeyPair</span></a></span></span><span> </span><span id="local-6989586621679717475"><span class="annot"><span class="annottext">keyPair :: KeyPair r
</span><a href="#local-6989586621679717475"><span class="hs-identifier hs-var">keyPair</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span id="local-6989586621679717477"><span class="annot"><span class="annottext">VKey r
</span><a href="#local-6989586621679717477"><span class="hs-identifier hs-var">vk</span></a></span></span><span> </span><span class="annot"><span class="annottext">SignKeyDSIGN DSIGN
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1433"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679717478"><span class="annot"><span class="annottext">keyHash :: KeyHash r
</span><a href="#local-6989586621679717478"><span class="hs-identifier hs-var hs-var">keyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VKey r -&gt; KeyHash r
forall (kd :: KeyRole). VKey kd -&gt; KeyHash kd
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#hashKey"><span class="hs-identifier hs-var">hashKey</span></a></span><span> </span><span class="annot"><span class="annottext">VKey r
</span><a href="#local-6989586621679717477"><span class="hs-identifier hs-var">vk</span></a></span><span>
</span><span id="line-1434"></span><span>  </span><span class="annot"><span class="annottext">(s -&gt; s) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((s -&gt; s) -&gt; m ()) -&gt; (s -&gt; s) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'Witness) (KeyPair 'Witness)
 -&gt; Identity (Map (KeyHash 'Witness) (KeyPair 'Witness)))
-&gt; s -&gt; Identity s
forall t.
HasKeyPairs t =&gt;
Lens' t (Map (KeyHash 'Witness) (KeyPair 'Witness))
Lens' s (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsL"><span class="hs-identifier hs-var">keyPairsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (KeyHash 'Witness) (KeyPair 'Witness)
  -&gt; Identity (Map (KeyHash 'Witness) (KeyPair 'Witness)))
 -&gt; s -&gt; Identity s)
-&gt; (Map (KeyHash 'Witness) (KeyPair 'Witness)
    -&gt; Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; s
-&gt; s
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
-&gt; KeyPair 'Witness
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash r -&gt; KeyHash 'Witness
forall (r :: KeyRole) (r' :: KeyRole). KeyHash r -&gt; KeyHash r'
forall (a :: KeyRole -&gt; *) (r :: KeyRole) (r' :: KeyRole).
HasKeyRole a =&gt;
a r -&gt; a r'
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#coerceKeyRole"><span class="hs-identifier hs-var">coerceKeyRole</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash r
</span><a href="#local-6989586621679717478"><span class="hs-identifier hs-var">keyHash</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyPair r -&gt; KeyPair 'Witness
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">KeyPair r
</span><a href="#local-6989586621679717475"><span class="hs-identifier hs-var">keyPair</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1435"></span><span>  </span><span class="annot"><span class="annottext">KeyHash r -&gt; m (KeyHash r)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">KeyHash r
</span><a href="#local-6989586621679717478"><span class="hs-identifier hs-var">keyHash</span></a></span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span class="hs-comment">-- | Looks up the `KeyPair` corresponding to the `KeyHash`. The `KeyHash` must be</span><span>
</span><span id="line-1438"></span><span class="hs-comment">-- created with `freshKeyHash` for this to work.</span><span>
</span><span id="line-1439"></span><span id="local-6989586621679713071"><span id="local-6989586621679713072"><span id="local-6989586621679713073"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getKeyPair"><span class="hs-identifier hs-type">getKeyPair</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1440"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713071"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713071"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713072"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1441"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713073"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1442"></span><span>  </span><span class="annot"><a href="#local-6989586621679713072"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713073"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1443"></span><span id="getKeyPair"><span class="annot"><span class="annottext">getKeyPair :: forall s (m :: * -&gt; *) (r :: KeyRole).
(HasCallStack, HasKeyPairs s, MonadState s m) =&gt;
KeyHash r -&gt; m (KeyPair r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getKeyPair"><span class="hs-identifier hs-var hs-var">getKeyPair</span></a></span></span><span> </span><span id="local-6989586621679717500"><span class="annot"><span class="annottext">KeyHash r
</span><a href="#local-6989586621679717500"><span class="hs-identifier hs-var">keyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1444"></span><span>  </span><span id="local-6989586621679717501"><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679717501"><span class="hs-identifier hs-var">keyPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (Map (KeyHash 'Witness) (KeyPair 'Witness))
  s
  (Map (KeyHash 'Witness) (KeyPair 'Witness))
-&gt; m (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map (KeyHash 'Witness) (KeyPair 'Witness))
  s
  (Map (KeyHash 'Witness) (KeyPair 'Witness))
forall t.
HasKeyPairs t =&gt;
Lens' t (Map (KeyHash 'Witness) (KeyPair 'Witness))
Lens' s (Map (KeyHash 'Witness) (KeyPair 'Witness))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsL"><span class="hs-identifier hs-var">keyPairsL</span></a></span><span>
</span><span id="line-1445"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Witness
-&gt; Map (KeyHash 'Witness) (KeyPair 'Witness)
-&gt; Maybe (KeyPair 'Witness)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash r -&gt; KeyHash 'Witness
forall (a :: KeyRole -&gt; *) (r :: KeyRole).
HasKeyRole a =&gt;
a r -&gt; a 'Witness
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#asWitness"><span class="hs-identifier hs-var">asWitness</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash r
</span><a href="#local-6989586621679717500"><span class="hs-identifier hs-var">keyHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Witness) (KeyPair 'Witness)
</span><a href="#local-6989586621679717501"><span class="hs-identifier hs-var">keyPairs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1446"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679717502"><span class="annot"><span class="annottext">KeyPair 'Witness
</span><a href="#local-6989586621679717502"><span class="hs-identifier hs-var">keyPair</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">KeyPair r -&gt; m (KeyPair r)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(KeyPair r -&gt; m (KeyPair r)) -&gt; KeyPair r -&gt; m (KeyPair r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">KeyPair 'Witness -&gt; KeyPair r
forall a b. Coercible a b =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">coerce</span></span><span> </span><span class="annot"><span class="annottext">KeyPair 'Witness
</span><a href="#local-6989586621679717502"><span class="hs-identifier hs-var">keyPair</span></a></span><span>
</span><span id="line-1447"></span><span>    </span><span class="annot"><span class="annottext">Maybe (KeyPair 'Witness)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1448"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; m (KeyPair r)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m (KeyPair r)) -&gt; [Char] -&gt; m (KeyPair r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1449"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Could not find a keypair corresponding to: &quot;</span></span><span>
</span><span id="line-1450"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">KeyHash r -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">KeyHash r
</span><a href="#local-6989586621679717500"><span class="hs-identifier hs-var">keyHash</span></a></span><span>
</span><span id="line-1451"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\nAlways use `freshKeyHash` to create key hashes.&quot;</span></span><span>
</span><span id="line-1452"></span><span>
</span><span id="line-1453"></span><span class="hs-comment">-- | Generates a fresh `KeyHash` and stores the corresponding `KeyPair` in the</span><span>
</span><span id="line-1454"></span><span class="hs-comment">-- ImpTestState. If you also need the `KeyPair` consider using `freshKeyPair` for</span><span>
</span><span id="line-1455"></span><span class="hs-comment">-- generation or `getKeyPair` to look up the `KeyPair` corresponding to the `KeyHash`</span><span>
</span><span id="line-1456"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-type">freshKeyHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1457"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712523"><span class="annot"><a href="#local-6989586621679712523"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679712520"><span class="annot"><a href="#local-6989586621679712520"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679712522"><span class="annot"><a href="#local-6989586621679712522"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679712521"><span class="annot"><a href="#local-6989586621679712521"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1458"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712520"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679712520"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712521"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712522"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712521"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1459"></span><span>  </span><span class="annot"><a href="#local-6989586621679712521"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712523"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1460"></span><span id="freshKeyHash"><span class="annot"><span class="annottext">freshKeyHash :: forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var hs-var">freshKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KeyHash r, KeyPair r) -&gt; KeyHash r
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((KeyHash r, KeyPair r) -&gt; KeyHash r)
-&gt; m (KeyHash r, KeyPair r) -&gt; m (KeyHash r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (KeyHash r, KeyPair r)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r, KeyPair r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyPair"><span class="hs-identifier hs-var">freshKeyPair</span></a></span><span>
</span><span id="line-1461"></span><span>
</span><span id="line-1462"></span><span class="annot"><span class="hs-comment">-- | Generate a random `KeyPair` and add it to the known keys in the Imp state</span></span><span>
</span><span id="line-1463"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyPair"><span class="hs-identifier hs-type">freshKeyPair</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1464"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713352"><span class="annot"><a href="#local-6989586621679713352"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679713349"><span class="annot"><a href="#local-6989586621679713349"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679713351"><span class="annot"><a href="#local-6989586621679713351"><span class="hs-identifier hs-type">g</span></a></span></span><span> </span><span id="local-6989586621679713350"><span class="annot"><a href="#local-6989586621679713350"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1465"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713349"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713349"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713350"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713351"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713350"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1466"></span><span>  </span><span class="annot"><a href="#local-6989586621679713350"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713352"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713352"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1467"></span><span id="freshKeyPair"><span class="annot"><span class="annottext">freshKeyPair :: forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r, KeyPair r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyPair"><span class="hs-identifier hs-var hs-var">freshKeyPair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1468"></span><span>  </span><span id="local-6989586621679717527"><span class="annot"><span class="annottext">KeyPair r
</span><a href="#local-6989586621679717527"><span class="hs-identifier hs-var">keyPair</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (KeyPair r)
forall g (m :: * -&gt; *) a. (HasStatefulGen g m, Uniform a) =&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#uniformM"><span class="hs-identifier hs-var">uniformM</span></a></span><span>
</span><span id="line-1469"></span><span>  </span><span id="local-6989586621679717529"><span class="annot"><span class="annottext">KeyHash r
</span><a href="#local-6989586621679717529"><span class="hs-identifier hs-var">keyHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KeyPair r -&gt; m (KeyHash r)
forall s (m :: * -&gt; *) (r :: KeyRole).
(HasKeyPairs s, MonadState s m) =&gt;
KeyPair r -&gt; m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#addKeyPair"><span class="hs-identifier hs-var">addKeyPair</span></a></span><span> </span><span class="annot"><span class="annottext">KeyPair r
</span><a href="#local-6989586621679717527"><span class="hs-identifier hs-var">keyPair</span></a></span><span>
</span><span id="line-1470"></span><span>  </span><span class="annot"><span class="annottext">(KeyHash r, KeyPair r) -&gt; m (KeyHash r, KeyPair r)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash r
</span><a href="#local-6989586621679717529"><span class="hs-identifier hs-var">keyHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KeyPair r
</span><a href="#local-6989586621679717527"><span class="hs-identifier hs-var">keyPair</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1471"></span><span>
</span><span id="line-1472"></span><span class="hs-comment">-- | Generate a random `Addr` that uses a `KeyHash`, and add the corresponding `KeyPair`</span><span>
</span><span id="line-1473"></span><span class="hs-comment">-- to the known keys in the Imp state.</span><span>
</span><span id="line-1474"></span><span id="local-6989586621679713110"><span id="local-6989586621679713111"><span id="local-6989586621679713112"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr_"><span class="hs-identifier hs-type">freshKeyAddr_</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1475"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713110"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713110"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713111"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713112"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713111"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/quickcheck-transformer-0.3.1.2-8c69fd32e35ce43d2fa08d505758002237123724318b720a1bb6c013ff6e3bc9/share/doc/html/src/Test.QuickCheck.GenT.html#MonadGen"><span class="hs-identifier hs-type">MonadGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713111"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679713111"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier hs-type">Addr</span></a></span></span></span></span><span>
</span><span id="line-1476"></span><span id="freshKeyAddr_"><span class="annot"><span class="annottext">freshKeyAddr_ :: forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadGen m) =&gt;
m Addr
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr_"><span class="hs-identifier hs-var hs-var">freshKeyAddr_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(KeyHash 'Payment, Addr) -&gt; Addr
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((KeyHash 'Payment, Addr) -&gt; Addr)
-&gt; m (KeyHash 'Payment, Addr) -&gt; m Addr
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m (KeyHash 'Payment, Addr)
forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadGen m) =&gt;
m (KeyHash 'Payment, Addr)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr"><span class="hs-identifier hs-var">freshKeyAddr</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span class="hs-comment">-- | Generate a random `Addr` that uses a `KeyHash`, add the corresponding `KeyPair`</span><span>
</span><span id="line-1479"></span><span class="hs-comment">-- to the known keys in the Imp state, and return the `KeyHash` as well as the `Addr`.</span><span>
</span><span id="line-1480"></span><span id="local-6989586621679713367"><span id="local-6989586621679713368"><span id="local-6989586621679713369"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr"><span class="hs-identifier hs-type">freshKeyAddr</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1481"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713367"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713367"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713368"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713369"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713368"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/quickcheck-transformer-0.3.1.2-8c69fd32e35ce43d2fa08d505758002237123724318b720a1bb6c013ff6e3bc9/share/doc/html/src/Test.QuickCheck.GenT.html#MonadGen"><span class="hs-identifier hs-type">MonadGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713368"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1482"></span><span>  </span><span class="annot"><a href="#local-6989586621679713368"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier hs-type">Addr</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-1483"></span><span id="freshKeyAddr"><span class="annot"><span class="annottext">freshKeyAddr :: forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m, MonadGen m) =&gt;
m (KeyHash 'Payment, Addr)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyAddr"><span class="hs-identifier hs-var hs-var">freshKeyAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1484"></span><span>  </span><span id="local-6989586621679717575"><span class="annot"><span class="annottext">KeyHash 'Payment
</span><a href="#local-6989586621679717575"><span class="hs-identifier hs-var">paymentKeyHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Payment"><span class="hs-identifier hs-type">Payment</span></a></span><span>
</span><span id="line-1485"></span><span>  </span><span id="local-6989586621679717576"><span class="annot"><span class="annottext">Maybe StakeReference
</span><a href="#local-6989586621679717576"><span class="hs-identifier hs-var">stakingKeyHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1486"></span><span>    </span><span class="annot"><span class="annottext">[m (Maybe StakeReference)] -&gt; m (Maybe StakeReference)
forall (m :: * -&gt; *) a. MonadGen m =&gt; [m a] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/quickcheck-transformer-0.3.1.2-8c69fd32e35ce43d2fa08d505758002237123724318b720a1bb6c013ff6e3bc9/share/doc/html/src/Test.QuickCheck.GenT.html#oneof"><span class="hs-identifier hs-var">oneof</span></a></span><span>
</span><span id="line-1487"></span><span>      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StakeReference -&gt; Maybe StakeReference
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(StakeReference -&gt; Maybe StakeReference)
-&gt; (KeyHash 'Staking -&gt; StakeReference)
-&gt; KeyHash 'Staking
-&gt; Maybe StakeReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Staking -&gt; StakeReference
forall c. MakeStakeReference c =&gt; c -&gt; StakeReference
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkStakeRef"><span class="hs-identifier hs-var">mkStakeRef</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyHash 'Staking -&gt; Maybe StakeReference)
-&gt; m (KeyHash 'Staking) -&gt; m (Maybe StakeReference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StakeReference -&gt; Maybe StakeReference
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(StakeReference -&gt; Maybe StakeReference)
-&gt; (Ptr -&gt; StakeReference) -&gt; Ptr -&gt; Maybe StakeReference
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall c. MakeStakeReference c =&gt; c -&gt; StakeReference
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkStakeRef"><span class="hs-identifier hs-var">mkStakeRef</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Ptr"><span class="hs-identifier hs-type">Ptr</span></a></span><span> </span><span class="annot"><span class="annottext">(Ptr -&gt; Maybe StakeReference) -&gt; m Ptr -&gt; m (Maybe StakeReference)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m Ptr
forall a (m :: * -&gt; *). (Arbitrary a, MonadGen m) =&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#arbitrary"><span class="hs-identifier hs-var">arbitrary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe StakeReference -&gt; m (Maybe StakeReference)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe StakeReference
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">]</span><span>
</span><span id="line-1488"></span><span>  </span><span class="annot"><span class="annottext">(KeyHash 'Payment, Addr) -&gt; m (KeyHash 'Payment, Addr)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash 'Payment
</span><a href="#local-6989586621679717575"><span class="hs-identifier hs-var">paymentKeyHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment -&gt; Maybe StakeReference -&gt; Addr
forall p s.
(MakeCredential p 'Payment, MakeStakeReference s) =&gt;
p -&gt; s -&gt; Addr
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkAddr"><span class="hs-identifier hs-var">mkAddr</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment
</span><a href="#local-6989586621679717575"><span class="hs-identifier hs-var">paymentKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StakeReference
</span><a href="#local-6989586621679717576"><span class="hs-identifier hs-var">stakingKeyHash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1489"></span><span>
</span><span id="line-1490"></span><span class="hs-comment">-- | Looks up the keypair corresponding to the `BootstrapAddress`. The `BootstrapAddress`</span><span>
</span><span id="line-1491"></span><span class="hs-comment">-- must be created with `freshBootstrapAddess` for this to work.</span><span>
</span><span id="line-1492"></span><span id="local-6989586621679713085"><span id="local-6989586621679713086"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getByronKeyPair"><span class="hs-identifier hs-type">getByronKeyPair</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1493"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713085"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713085"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713086"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1494"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-type">BootstrapAddress</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1495"></span><span>  </span><span class="annot"><a href="#local-6989586621679713086"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#ByronKeyPair"><span class="hs-identifier hs-type">ByronKeyPair</span></a></span></span></span><span>
</span><span id="line-1496"></span><span id="getByronKeyPair"><span class="annot"><span class="annottext">getByronKeyPair :: forall s (m :: * -&gt; *).
(HasCallStack, HasKeyPairs s, MonadState s m) =&gt;
BootstrapAddress -&gt; m ByronKeyPair
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getByronKeyPair"><span class="hs-identifier hs-var hs-var">getByronKeyPair</span></a></span></span><span> </span><span id="local-6989586621679717595"><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679717595"><span class="hs-identifier hs-var">bootAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1497"></span><span>  </span><span id="local-6989586621679717596"><span class="annot"><span class="annottext">Map BootstrapAddress ByronKeyPair
</span><a href="#local-6989586621679717596"><span class="hs-identifier hs-var">keyPairs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  (Map BootstrapAddress ByronKeyPair)
  s
  (Map BootstrapAddress ByronKeyPair)
-&gt; m (Map BootstrapAddress ByronKeyPair)
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Map BootstrapAddress ByronKeyPair)
  s
  (Map BootstrapAddress ByronKeyPair)
forall t.
HasKeyPairs t =&gt;
Lens' t (Map BootstrapAddress ByronKeyPair)
Lens' s (Map BootstrapAddress ByronKeyPair)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsByronL"><span class="hs-identifier hs-var">keyPairsByronL</span></a></span><span>
</span><span id="line-1498"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
-&gt; Map BootstrapAddress ByronKeyPair -&gt; Maybe ByronKeyPair
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679717595"><span class="hs-identifier hs-var">bootAddr</span></a></span><span> </span><span class="annot"><span class="annottext">Map BootstrapAddress ByronKeyPair
</span><a href="#local-6989586621679717596"><span class="hs-identifier hs-var">keyPairs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1499"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679717597"><span class="annot"><span class="annottext">ByronKeyPair
</span><a href="#local-6989586621679717597"><span class="hs-identifier hs-var">keyPair</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByronKeyPair -&gt; m ByronKeyPair
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">ByronKeyPair
</span><a href="#local-6989586621679717597"><span class="hs-identifier hs-var">keyPair</span></a></span><span>
</span><span id="line-1500"></span><span>    </span><span class="annot"><span class="annottext">Maybe ByronKeyPair
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1501"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; m ByronKeyPair
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; m ByronKeyPair) -&gt; [Char] -&gt; m ByronKeyPair
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1502"></span><span>        </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Could not find a keypair corresponding to: &quot;</span></span><span>
</span><span id="line-1503"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679717595"><span class="hs-identifier hs-var">bootAddr</span></a></span><span>
</span><span id="line-1504"></span><span>          </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;\nAlways use `freshByronKeyHash` to create key hashes.&quot;</span></span><span>
</span><span id="line-1505"></span><span>
</span><span id="line-1506"></span><span class="hs-comment">-- | Generates a fresh `KeyHash` and stores the corresponding `ByronKeyPair` in the</span><span>
</span><span id="line-1507"></span><span class="hs-comment">-- ImpTestState. If you also need the `ByronKeyPair` consider using `freshByronKeyPair` for</span><span>
</span><span id="line-1508"></span><span class="hs-comment">-- generation or `getByronKeyPair` to look up the `ByronKeyPair` corresponding to the `KeyHash`</span><span>
</span><span id="line-1509"></span><span id="local-6989586621679713379"><span id="local-6989586621679713380"><span id="local-6989586621679713381"><span id="local-6989586621679713382"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshByronKeyHash"><span class="hs-identifier hs-type">freshByronKeyHash</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1510"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713379"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713379"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713380"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713381"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713380"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1511"></span><span>  </span><span class="annot"><a href="#local-6989586621679713380"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713382"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-1512"></span><span id="freshByronKeyHash"><span class="annot"><span class="annottext">freshByronKeyHash :: forall s (m :: * -&gt; *) g (r :: KeyRole).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshByronKeyHash"><span class="hs-identifier hs-var hs-var">freshByronKeyHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash 'Payment -&gt; KeyHash r
forall (r :: KeyRole) (r' :: KeyRole). KeyHash r -&gt; KeyHash r'
forall (a :: KeyRole -&gt; *) (r :: KeyRole) (r' :: KeyRole).
HasKeyRole a =&gt;
a r -&gt; a r'
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#coerceKeyRole"><span class="hs-identifier hs-var">coerceKeyRole</span></a></span><span> </span><span class="annot"><span class="annottext">(KeyHash 'Payment -&gt; KeyHash r)
-&gt; (BootstrapAddress -&gt; KeyHash 'Payment)
-&gt; BootstrapAddress
-&gt; KeyHash r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress -&gt; KeyHash 'Payment
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#bootstrapKeyHash"><span class="hs-identifier hs-var">bootstrapKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">(BootstrapAddress -&gt; KeyHash r)
-&gt; m BootstrapAddress -&gt; m (KeyHash r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">m BootstrapAddress
forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m BootstrapAddress
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshBootstapAddress"><span class="hs-identifier hs-var">freshBootstapAddress</span></a></span><span>
</span><span id="line-1513"></span><span>
</span><span id="line-1514"></span><span id="local-6989586621679713387"><span id="local-6989586621679713388"><span id="local-6989586621679713389"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshBootstapAddress"><span class="hs-identifier hs-type">freshBootstapAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1515"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#HasKeyPairs"><span class="hs-identifier hs-type">HasKeyPairs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713387"><span class="hs-identifier hs-type">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679713387"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713388"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#HasStatefulGen"><span class="hs-identifier hs-type">HasStatefulGen</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713389"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713388"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1516"></span><span>  </span><span class="annot"><a href="#local-6989586621679713388"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-type">BootstrapAddress</span></a></span></span></span></span><span>
</span><span id="line-1517"></span><span id="freshBootstapAddress"><span class="annot"><span class="annottext">freshBootstapAddress :: forall s (m :: * -&gt; *) g.
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m BootstrapAddress
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshBootstapAddress"><span class="hs-identifier hs-var hs-var">freshBootstapAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1518"></span><span>  </span><span id="local-6989586621679717638"><span class="annot"><span class="annottext">keyPair :: ByronKeyPair
</span><a href="#local-6989586621679717638"><span class="hs-identifier hs-var">keyPair</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#ByronKeyPair"><span class="hs-identifier hs-type">ByronKeyPair</span></a></span><span> </span><span id="local-6989586621679717639"><span class="annot"><span class="annottext">VerificationKey
</span><a href="#local-6989586621679717639"><span class="hs-identifier hs-var">verificationKey</span></a></span></span><span> </span><span class="annot"><span class="annottext">SigningKey
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m ByronKeyPair
forall g (m :: * -&gt; *) a. (HasStatefulGen g m, Uniform a) =&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#uniformM"><span class="hs-identifier hs-var">uniformM</span></a></span><span>
</span><span id="line-1519"></span><span>  </span><span id="local-6989586621679717640"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679717640"><span class="hs-identifier hs-var">hasPayload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Bool
forall g (m :: * -&gt; *) a. (HasStatefulGen g m, Uniform a) =&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#uniformM"><span class="hs-identifier hs-var">uniformM</span></a></span><span>
</span><span id="line-1520"></span><span>  </span><span id="local-6989586621679717641"><span class="annot"><span class="annottext">Maybe HDAddressPayload
</span><a href="#local-6989586621679717641"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1521"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679717640"><span class="hs-identifier hs-var">hasPayload</span></a></span><span>
</span><span id="line-1522"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HDAddressPayload -&gt; Maybe HDAddressPayload
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(HDAddressPayload -&gt; Maybe HDAddressPayload)
-&gt; (ByteString -&gt; HDAddressPayload)
-&gt; ByteString
-&gt; Maybe HDAddressPayload
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HDAddressPayload
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.Common.AddrAttributes.html#HDAddressPayload"><span class="hs-identifier hs-var">Byron.HDAddressPayload</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe HDAddressPayload)
-&gt; m ByteString -&gt; m (Maybe HDAddressPayload)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; m ByteString
forall a (m :: * -&gt; *). HasStatefulGen a m =&gt; Int -&gt; m ByteString
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#uniformByteStringM"><span class="hs-identifier hs-var">uniformByteStringM</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; m ByteString) -&gt; m Int -&gt; m ByteString
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; m Int
forall g (m :: * -&gt; *) a.
(HasStatefulGen g m, UniformRange a) =&gt;
(a, a) -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#uniformRM"><span class="hs-identifier hs-var">uniformRM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">63</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1523"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe HDAddressPayload -&gt; m (Maybe HDAddressPayload)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Maybe HDAddressPayload
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-1524"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679717645"><span class="annot"><span class="annottext">asd :: AddrSpendingData
</span><a href="#local-6989586621679717645"><span class="hs-identifier hs-var hs-var">asd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VerificationKey -&gt; AddrSpendingData
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.Common.AddrSpendingData.html#VerKeyASD"><span class="hs-identifier hs-var">Byron.VerKeyASD</span></a></span><span> </span><span class="annot"><span class="annottext">VerificationKey
</span><a href="#local-6989586621679717639"><span class="hs-identifier hs-var">verificationKey</span></a></span><span>
</span><span id="line-1525"></span><span>      </span><span id="local-6989586621679717647"><span class="annot"><span class="annottext">attrs :: AddrAttributes
</span><a href="#local-6989586621679717647"><span class="hs-identifier hs-var hs-var">attrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HDAddressPayload -&gt; NetworkMagic -&gt; AddrAttributes
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.Common.AddrAttributes.html#AddrAttributes"><span class="hs-identifier hs-var">Byron.AddrAttributes</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HDAddressPayload
</span><a href="#local-6989586621679717641"><span class="hs-identifier hs-var">payload</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word32 -&gt; NetworkMagic
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.Common.NetworkMagic.html#NetworkTestnet"><span class="hs-identifier hs-var">Byron.NetworkTestnet</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-1526"></span><span>      </span><span id="local-6989586621679717650"><span class="annot"><span class="annottext">bootAddr :: BootstrapAddress
</span><a href="#local-6989586621679717650"><span class="hs-identifier hs-var hs-var">bootAddr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Address -&gt; BootstrapAddress
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#BootstrapAddress"><span class="hs-identifier hs-var">BootstrapAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(Address -&gt; BootstrapAddress) -&gt; Address -&gt; BootstrapAddress
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AddrSpendingData -&gt; AddrAttributes -&gt; Address
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-byron-1.2.0.0/doc/html/cardano-ledger-byron/src/Cardano.Chain.Common.Address.html#makeAddress"><span class="hs-identifier hs-var">Byron.makeAddress</span></a></span><span> </span><span class="annot"><span class="annottext">AddrSpendingData
</span><a href="#local-6989586621679717645"><span class="hs-identifier hs-var">asd</span></a></span><span> </span><span class="annot"><span class="annottext">AddrAttributes
</span><a href="#local-6989586621679717647"><span class="hs-identifier hs-var">attrs</span></a></span><span>
</span><span id="line-1527"></span><span>  </span><span class="annot"><span class="annottext">(s -&gt; s) -&gt; m ()
forall s (m :: * -&gt; *). MonadState s m =&gt; (s -&gt; s) -&gt; m ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="annot"><span class="annottext">((s -&gt; s) -&gt; m ()) -&gt; (s -&gt; s) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Map BootstrapAddress ByronKeyPair
 -&gt; Identity (Map BootstrapAddress ByronKeyPair))
-&gt; s -&gt; Identity s
forall t.
HasKeyPairs t =&gt;
Lens' t (Map BootstrapAddress ByronKeyPair)
Lens' s (Map BootstrapAddress ByronKeyPair)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#keyPairsByronL"><span class="hs-identifier hs-var">keyPairsByronL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map BootstrapAddress ByronKeyPair
  -&gt; Identity (Map BootstrapAddress ByronKeyPair))
 -&gt; s -&gt; Identity s)
-&gt; (Map BootstrapAddress ByronKeyPair
    -&gt; Map BootstrapAddress ByronKeyPair)
-&gt; s
-&gt; s
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
-&gt; ByronKeyPair
-&gt; Map BootstrapAddress ByronKeyPair
-&gt; Map BootstrapAddress ByronKeyPair
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679717650"><span class="hs-identifier hs-var">bootAddr</span></a></span><span> </span><span class="annot"><span class="annottext">ByronKeyPair
</span><a href="#local-6989586621679717638"><span class="hs-identifier hs-var">keyPair</span></a></span><span>
</span><span id="line-1528"></span><span>  </span><span class="annot"><span class="annottext">BootstrapAddress -&gt; m BootstrapAddress
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">BootstrapAddress
</span><a href="#local-6989586621679717650"><span class="hs-identifier hs-var">bootAddr</span></a></span><span>
</span><span id="line-1529"></span><span>
</span><span id="line-1530"></span><span id="local-6989586621679713403"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendCoinTo"><span class="hs-identifier hs-type">sendCoinTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713403"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713403"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span></span><span>
</span><span id="line-1531"></span><span id="sendCoinTo"><span class="annot"><span class="annottext">sendCoinTo :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Addr -&gt; Coin -&gt; ImpTestM era TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendCoinTo"><span class="hs-identifier hs-var hs-var">sendCoinTo</span></a></span></span><span> </span><span id="local-6989586621679717663"><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717663"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr -&gt; Value era -&gt; ImpM (LedgerSpec era) TxIn
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; ImpTestM era TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo"><span class="hs-identifier hs-var">sendValueTo</span></a></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717663"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">(Value era -&gt; ImpM (LedgerSpec era) TxIn)
-&gt; (Coin -&gt; Value era) -&gt; Coin -&gt; ImpM (LedgerSpec era) TxIn
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t s. Inject t s =&gt; t -&gt; s
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#inject"><span class="hs-identifier hs-var">inject</span></a></span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span id="local-6989586621679713406"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendCoinTo_"><span class="hs-identifier hs-type">sendCoinTo_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713406"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713406"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1534"></span><span id="sendCoinTo_"><span class="annot"><span class="annottext">sendCoinTo_ :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Addr -&gt; Coin -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendCoinTo_"><span class="hs-identifier hs-var hs-var">sendCoinTo_</span></a></span></span><span> </span><span id="local-6989586621679717670"><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717670"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) TxIn -&gt; ImpM (LedgerSpec era) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) TxIn -&gt; ImpM (LedgerSpec era) ())
-&gt; (Coin -&gt; ImpM (LedgerSpec era) TxIn)
-&gt; Coin
-&gt; ImpM (LedgerSpec era) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Addr -&gt; Coin -&gt; ImpM (LedgerSpec era) TxIn
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Addr -&gt; Coin -&gt; ImpTestM era TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendCoinTo"><span class="hs-identifier hs-var">sendCoinTo</span></a></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717670"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-1535"></span><span>
</span><span id="line-1536"></span><span id="local-6989586621679713405"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo"><span class="hs-identifier hs-type">sendValueTo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713405"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713405"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713405"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span></span><span>
</span><span id="line-1537"></span><span id="sendValueTo"><span class="annot"><span class="annottext">sendValueTo :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; ImpTestM era TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo"><span class="hs-identifier hs-var hs-var">sendValueTo</span></a></span></span><span> </span><span id="local-6989586621679717706"><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717706"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679717707"><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679717707"><span class="hs-identifier hs-var">amount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1538"></span><span>  </span><span id="local-6989586621679717708"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679717708"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1539"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; Tx era -&gt; ImpTestM era (Tx era)
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn"><span class="hs-identifier hs-var">submitTxAnn</span></a></span><span>
</span><span id="line-1540"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Giving &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value era -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679717707"><span class="hs-identifier hs-var">amount</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; to &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Addr -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717706"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1541"></span><span>      </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era -&gt; ImpTestM era (Tx era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-1542"></span><span>        </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxOut era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; StrictSeq (TxOut era)
forall a. a -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#singleton"><span class="hs-identifier hs-var">SSeq.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr -&gt; Value era -&gt; TxOut era
forall era.
(EraTxOut era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; TxOut era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxOut"><span class="hs-identifier hs-var">mkBasicTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717706"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
</span><a href="#local-6989586621679717707"><span class="hs-identifier hs-var">amount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1543"></span><span>  </span><span class="annot"><span class="annottext">TxIn -&gt; ImpTestM era TxIn
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; ImpTestM era TxIn) -&gt; TxIn -&gt; ImpTestM era TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Tx era -&gt; TxIn
forall era. (HasCallStack, EraTx era) =&gt; Int -&gt; Tx era -&gt; TxIn
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Utils.html#txInAt"><span class="hs-identifier hs-var">txInAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679717708"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1544"></span><span>
</span><span id="line-1545"></span><span id="local-6989586621679713412"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo_"><span class="hs-identifier hs-type">sendValueTo_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713412"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#Addr"><span class="hs-identifier hs-type">Addr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Value"><span class="hs-identifier hs-type">Value</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713412"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713412"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1546"></span><span id="sendValueTo_"><span class="annot"><span class="annottext">sendValueTo_ :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo_"><span class="hs-identifier hs-var hs-var">sendValueTo_</span></a></span></span><span> </span><span id="local-6989586621679717718"><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717718"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) TxIn -&gt; ImpM (LedgerSpec era) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) TxIn -&gt; ImpM (LedgerSpec era) ())
-&gt; (Value era -&gt; ImpM (LedgerSpec era) TxIn)
-&gt; Value era
-&gt; ImpM (LedgerSpec era) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Addr -&gt; Value era -&gt; ImpM (LedgerSpec era) TxIn
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; ImpTestM era TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#sendValueTo"><span class="hs-identifier hs-var">sendValueTo</span></a></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679717718"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-1547"></span><span>
</span><span id="line-1548"></span><span class="annot"><span class="hs-comment">-- | Modify the current new epoch state with a function</span></span><span>
</span><span id="line-1549"></span><span id="local-6989586621679712431"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyNES"><span class="hs-identifier hs-type">modifyNES</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712431"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712431"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712431"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1550"></span><span id="modifyNES"><span class="annot"><span class="annottext">modifyNES :: forall era.
(NewEpochState era -&gt; NewEpochState era) -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyNES"><span class="hs-identifier hs-var hs-var">modifyNES</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NewEpochState era -&gt; Identity (NewEpochState era))
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(NewEpochState era -&gt; f (NewEpochState era))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier hs-var">impNESL</span></a></span><span> </span><span class="annot"><span class="annottext">((NewEpochState era -&gt; Identity (NewEpochState era))
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; (NewEpochState era -&gt; NewEpochState era)
-&gt; ImpM (LedgerSpec era) ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; (a -&gt; b) -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#%25%3D"><span class="hs-operator hs-var">%=</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1551"></span><span>
</span><span id="line-1552"></span><span class="annot"><span class="hs-comment">-- | Get a value from the current new epoch state using the lens</span></span><span>
</span><span id="line-1553"></span><span id="local-6989586621679712609"><span id="local-6989586621679712610"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-type">getsNES</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#SimpleGetter"><span class="hs-identifier hs-type">SimpleGetter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712609"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679712610"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712609"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712610"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1554"></span><span id="getsNES"><span class="annot"><span class="annottext">getsNES :: forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var hs-var">getsNES</span></a></span></span><span> </span><span id="local-6989586621679717729"><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) a
</span><a href="#local-6989586621679717729"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; a) -&gt; ImpM (LedgerSpec era) a
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((ImpTestState era -&gt; a) -&gt; ImpM (LedgerSpec era) a)
-&gt; (Getting a (ImpTestState era) a -&gt; ImpTestState era -&gt; a)
-&gt; Getting a (ImpTestState era) a
-&gt; ImpM (LedgerSpec era) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Getting a (ImpTestState era) a -&gt; ImpTestState era -&gt; a
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#view"><span class="hs-identifier hs-var">view</span></a></span><span> </span><span class="annot"><span class="annottext">(Getting a (ImpTestState era) a -&gt; ImpM (LedgerSpec era) a)
-&gt; Getting a (ImpTestState era) a -&gt; ImpM (LedgerSpec era) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(NewEpochState era -&gt; Const a (NewEpochState era))
-&gt; ImpTestState era -&gt; Const a (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(NewEpochState era -&gt; f (NewEpochState era))
-&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNESL"><span class="hs-identifier hs-var">impNESL</span></a></span><span> </span><span class="annot"><span class="annottext">((NewEpochState era -&gt; Const a (NewEpochState era))
 -&gt; ImpTestState era -&gt; Const a (ImpTestState era))
-&gt; ((a -&gt; Const a a)
    -&gt; NewEpochState era -&gt; Const a (NewEpochState era))
-&gt; Getting a (ImpTestState era) a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Const a a)
-&gt; NewEpochState era -&gt; Const a (NewEpochState era)
SimpleGetter (NewEpochState era) a
</span><a href="#local-6989586621679717729"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1555"></span><span>
</span><span id="line-1556"></span><span id="local-6989586621679712939"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-type">getUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712939"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712939"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1557"></span><span id="getUTxO"><span class="annot"><span class="annottext">getUTxO :: forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var hs-var">getUTxO</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (UTxO era)
-&gt; ImpTestM era (UTxO era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(UTxO era -&gt; Const r (UTxO era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
SimpleGetter (NewEpochState era) (UTxO era)
forall era. Lens' (NewEpochState era) (UTxO era)
forall (t :: * -&gt; *) era. CanSetUTxO t =&gt; Lens' (t era) (UTxO era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#utxoL"><span class="hs-identifier hs-var">utxoL</span></a></span><span>
</span><span id="line-1558"></span><span>
</span><span id="line-1559"></span><span id="local-6989586621679713423"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier hs-type">getProtVer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713423"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713423"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span></span><span>
</span><span id="line-1560"></span><span id="getProtVer"><span class="annot"><span class="annottext">getProtVer :: forall era. EraGov era =&gt; ImpTestM era ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier hs-var hs-var">getProtVer</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) ProtVer -&gt; ImpTestM era ProtVer
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) ProtVer -&gt; ImpTestM era ProtVer)
-&gt; SimpleGetter (NewEpochState era) ProtVer -&gt; ImpTestM era ProtVer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((ProtVer -&gt; Const r ProtVer)
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (ProtVer -&gt; Const r ProtVer)
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const r (PParams era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; Const r (PParams era))
 -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; ((ProtVer -&gt; Const r ProtVer)
    -&gt; PParams era -&gt; Const r (PParams era))
-&gt; (ProtVer -&gt; Const r ProtVer)
-&gt; EpochState era
-&gt; Const r (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ProtVer -&gt; Const r ProtVer)
-&gt; PParams era -&gt; Const r (PParams era)
forall era. EraPParams era =&gt; Lens' (PParams era) ProtVer
Lens' (PParams era) ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppProtocolVersionL"><span class="hs-identifier hs-var">ppProtocolVersionL</span></a></span><span>
</span><span id="line-1561"></span><span>
</span><span id="line-1562"></span><span id="local-6989586621679713409"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn"><span class="hs-identifier hs-type">submitTxAnn</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1563"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1564"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1565"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713409"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1566"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713409"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713409"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1567"></span><span id="submitTxAnn"><span class="annot"><span class="annottext">submitTxAnn :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn"><span class="hs-identifier hs-var hs-var">submitTxAnn</span></a></span></span><span> </span><span id="local-6989586621679717759"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679717759"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621679717760"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679717760"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) (Tx era)
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679717759"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era
-&gt; ImpM
     (LedgerSpec era)
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
Tx era
-&gt; ImpTestM
     era
     (Either
        (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
        (Tx era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#trySubmitTx"><span class="hs-identifier hs-var">trySubmitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679717760"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM
  (LedgerSpec era)
  (Either
     (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
     (Tx era))
-&gt; (Either
      (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
      (Tx era)
    -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; ImpM (LedgerSpec era) (Tx era)
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Either
  (NonEmpty (PredicateFailure (EraRule &quot;LEDGER&quot; era)), Tx era)
  (Tx era)
-&gt; ImpM (LedgerSpec era) (Tx era)
forall a b (m :: * -&gt; *).
(HasCallStack, ToExpr a, NFData b, MonadIO m) =&gt;
Either a b -&gt; m b
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Imp.Common.html#expectRightDeepExpr"><span class="hs-identifier hs-var">expectRightDeepExpr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>
</span><span id="line-1569"></span><span id="local-6989586621679713429"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn_"><span class="hs-identifier hs-type">submitTxAnn_</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1570"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713429"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713429"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713429"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1571"></span><span id="submitTxAnn_"><span class="annot"><span class="annottext">submitTxAnn_ :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn_"><span class="hs-identifier hs-var hs-var">submitTxAnn_</span></a></span></span><span> </span><span id="local-6989586621679717767"><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679717767"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><span class="hs-identifier hs-var">void</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) (Tx era) -&gt; ImpM (LedgerSpec era) ())
-&gt; (Tx era -&gt; ImpM (LedgerSpec era) (Tx era))
-&gt; Tx era
-&gt; ImpM (LedgerSpec era) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn"><span class="hs-identifier hs-var">submitTxAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><a href="#local-6989586621679717767"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1572"></span><span>
</span><span id="line-1573"></span><span id="local-6989586621679713431"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getRewardAccountFor"><span class="hs-identifier hs-type">getRewardAccountFor</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1574"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1575"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713431"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span></span><span>
</span><span id="line-1576"></span><span id="getRewardAccountFor"><span class="annot"><span class="annottext">getRewardAccountFor :: forall era. Credential 'Staking -&gt; ImpTestM era RewardAccount
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getRewardAccountFor"><span class="hs-identifier hs-var hs-var">getRewardAccountFor</span></a></span></span><span> </span><span id="local-6989586621679717774"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717774"><span class="hs-identifier hs-var">stakingC</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1577"></span><span>  </span><span id="local-6989586621679717775"><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679717775"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Network (ImpTestState era) Network
-&gt; ImpM (LedgerSpec era) Network
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Globals -&gt; Const Network Globals)
-&gt; ImpTestState era -&gt; Const Network (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Globals -&gt; Const Network Globals)
 -&gt; ImpTestState era -&gt; Const Network (ImpTestState era))
-&gt; ((Network -&gt; Const Network Network)
    -&gt; Globals -&gt; Const Network Globals)
-&gt; Getting Network (ImpTestState era) Network
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Network) -&gt; SimpleGetter Globals Network
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#networkId"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1578"></span><span>  </span><span class="annot"><span class="annottext">RewardAccount -&gt; ImpTestM era RewardAccount
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; ImpTestM era RewardAccount)
-&gt; RewardAccount -&gt; ImpTestM era RewardAccount
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Network -&gt; Credential 'Staking -&gt; RewardAccount
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-var">RewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679717775"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717774"><span class="hs-identifier hs-var">stakingC</span></a></span><span>
</span><span id="line-1579"></span><span>
</span><span id="line-1580"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerStakeCredential"><span class="hs-identifier hs-type">registerStakeCredential</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1581"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713433"><span class="annot"><a href="#local-6989586621679713433"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1582"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-1583"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713433"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1584"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1585"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1586"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713433"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-1587"></span><span id="registerStakeCredential"><span class="annot"><span class="annottext">registerStakeCredential :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Credential 'Staking -&gt; ImpTestM era RewardAccount
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerStakeCredential"><span class="hs-identifier hs-var hs-var">registerStakeCredential</span></a></span></span><span> </span><span id="local-6989586621679717803"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717803"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1588"></span><span>  </span><span id="local-6989586621679717804"><span class="annot"><span class="annottext">TxCert era
</span><a href="#local-6989586621679717804"><span class="hs-identifier hs-var">regTxCert</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpM (LedgerSpec era) (TxCert era)
forall era.
ShelleyEraImp era =&gt;
Credential 'Staking -&gt; ImpTestM era (TxCert era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#genRegTxCert"><span class="hs-identifier hs-var">genRegTxCert</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717803"><span class="hs-identifier hs-var">cred</span></a></span><span>
</span><span id="line-1589"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Tx era -&gt; ImpTestM era ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn_"><span class="hs-identifier hs-var">submitTxAnn_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Register Reward Account: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential 'Staking -&gt; Text
forall (kr :: KeyRole). Credential kr -&gt; Text
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#credToText"><span class="hs-identifier hs-var">credToText</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717803"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era ()) -&gt; Tx era -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1590"></span><span>    </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-1591"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxCert era))
Lens' (TxBody era) (StrictSeq (TxCert era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#certsTxBodyL"><span class="hs-identifier hs-var">certsTxBodyL</span></a></span><span>
</span><span id="line-1592"></span><span>        </span><span class="annot"><span class="annottext">((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxCert era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">[TxCert era] -&gt; StrictSeq (TxCert era)
forall a. [a] -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#fromList"><span class="hs-identifier hs-var">SSeq.fromList</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Item [TxCert era]
TxCert era
</span><a href="#local-6989586621679717804"><span class="hs-identifier hs-var">regTxCert</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1593"></span><span>  </span><span id="local-6989586621679717807"><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679717807"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Network (ImpTestState era) Network
-&gt; ImpM (LedgerSpec era) Network
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Globals -&gt; Const Network Globals)
-&gt; ImpTestState era -&gt; Const Network (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Globals -&gt; Const Network Globals)
 -&gt; ImpTestState era -&gt; Const Network (ImpTestState era))
-&gt; ((Network -&gt; Const Network Network)
    -&gt; Globals -&gt; Const Network Globals)
-&gt; Getting Network (ImpTestState era) Network
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Network) -&gt; SimpleGetter Globals Network
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#networkId"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1594"></span><span>  </span><span class="annot"><span class="annottext">RewardAccount -&gt; ImpTestM era RewardAccount
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; ImpTestM era RewardAccount)
-&gt; RewardAccount -&gt; ImpTestM era RewardAccount
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Network -&gt; Credential 'Staking -&gt; RewardAccount
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-var">RewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679717807"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717803"><span class="hs-identifier hs-var">cred</span></a></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span id="local-6989586621679713437"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#delegateStake"><span class="hs-identifier hs-type">delegateStake</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1597"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713437"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.TxCert.html#ShelleyEraTxCert"><span class="hs-identifier hs-type">ShelleyEraTxCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713437"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1598"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1599"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1600"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713437"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1601"></span><span id="delegateStake"><span class="annot"><span class="annottext">delegateStake :: forall era.
(ShelleyEraImp era, ShelleyEraTxCert era) =&gt;
Credential 'Staking -&gt; KeyHash 'StakePool -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#delegateStake"><span class="hs-identifier hs-var hs-var">delegateStake</span></a></span></span><span> </span><span id="local-6989586621679717827"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717827"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span id="local-6989586621679717828"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717828"><span class="hs-identifier hs-var">poolKH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1602"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Tx era -&gt; ImpTestM era ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn_"><span class="hs-identifier hs-var">submitTxAnn_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Delegate Staking Credential: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; [Char]
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential 'Staking -&gt; Text
forall (kr :: KeyRole). Credential kr -&gt; Text
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#credToText"><span class="hs-identifier hs-var">credToText</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717827"><span class="hs-identifier hs-var">cred</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era ()) -&gt; Tx era -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1603"></span><span>    </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-1604"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxCert era))
Lens' (TxBody era) (StrictSeq (TxCert era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#certsTxBodyL"><span class="hs-identifier hs-var">certsTxBodyL</span></a></span><span>
</span><span id="line-1605"></span><span>        </span><span class="annot"><span class="annottext">((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxCert era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">[TxCert era] -&gt; StrictSeq (TxCert era)
forall a. [a] -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#fromList"><span class="hs-identifier hs-var">SSeq.fromList</span></a></span><span>
</span><span id="line-1606"></span><span>          </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Credential 'Staking -&gt; KeyHash 'StakePool -&gt; TxCert era
forall era.
ShelleyEraTxCert era =&gt;
Credential 'Staking -&gt; KeyHash 'StakePool -&gt; TxCert era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.TxCert.html#DelegStakeTxCert"><span class="hs-identifier hs-var">DelegStakeTxCert</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717827"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717828"><span class="hs-identifier hs-var">poolKH</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1607"></span><span>
</span><span id="line-1608"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerRewardAccount"><span class="hs-identifier hs-type">registerRewardAccount</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1609"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679713440"><span class="annot"><a href="#local-6989586621679713440"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1610"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span>
</span><span id="line-1611"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713440"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1612"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1613"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713440"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span>
</span><span id="line-1614"></span><span id="registerRewardAccount"><span class="annot"><span class="annottext">registerRewardAccount :: forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
ImpTestM era RewardAccount
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerRewardAccount"><span class="hs-identifier hs-var hs-var">registerRewardAccount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'Staking)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'Staking)
-&gt; (KeyHash 'Staking -&gt; ImpM (LedgerSpec era) RewardAccount)
-&gt; ImpM (LedgerSpec era) RewardAccount
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpM (LedgerSpec era) RewardAccount
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Credential 'Staking -&gt; ImpTestM era RewardAccount
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerStakeCredential"><span class="hs-identifier hs-var">registerStakeCredential</span></a></span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking -&gt; ImpM (LedgerSpec era) RewardAccount)
-&gt; (KeyHash 'Staking -&gt; Credential 'Staking)
-&gt; KeyHash 'Staking
-&gt; ImpM (LedgerSpec era) RewardAccount
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'Staking -&gt; Credential 'Staking
forall (kr :: KeyRole). KeyHash kr -&gt; Credential kr
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#KeyHashObj"><span class="hs-identifier hs-var">KeyHashObj</span></a></span><span>
</span><span id="line-1615"></span><span>
</span><span id="line-1616"></span><span id="local-6989586621679717846"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupReward"><span class="hs-identifier hs-type">lookupReward</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717846"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717846"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1617"></span><span id="lookupReward"><span class="annot"><span class="annottext">lookupReward :: forall era.
EraCertState era =&gt;
Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupReward"><span class="hs-identifier hs-var hs-var">lookupReward</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
forall era.
EraCertState era =&gt;
Credential 'Staking -&gt; ImpTestM era (Maybe Coin)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#lookupBalance"><span class="hs-identifier hs-var">lookupBalance</span></a></span><span>
</span><span id="line-1618"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">lookupReward</span><span> </span><span class="hs-pragma">&quot;In favor of `lookupBalance`&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1619"></span><span>
</span><span id="line-1620"></span><span id="local-6989586621679717849"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getReward"><span class="hs-identifier hs-type">getReward</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717849"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717849"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span></span><span>
</span><span id="line-1621"></span><span id="getReward"><span class="annot"><span class="annottext">getReward :: forall era.
(HasCallStack, EraCertState era) =&gt;
Credential 'Staking -&gt; ImpTestM era Coin
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getReward"><span class="hs-identifier hs-var hs-var">getReward</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpTestM era Coin
forall era.
(HasCallStack, EraCertState era) =&gt;
Credential 'Staking -&gt; ImpTestM era Coin
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getBalance"><span class="hs-identifier hs-var">getBalance</span></a></span><span>
</span><span id="line-1622"></span><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">getReward</span><span> </span><span class="hs-pragma">&quot;In favor of `getBalance`&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1623"></span><span>
</span><span id="line-1624"></span><span id="local-6989586621679713445"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshPoolParams"><span class="hs-identifier hs-type">freshPoolParams</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1625"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713445"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1626"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1627"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1628"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713445"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#PoolParams"><span class="hs-identifier hs-type">PoolParams</span></a></span></span><span>
</span><span id="line-1629"></span><span id="freshPoolParams"><span class="annot"><span class="annottext">freshPoolParams :: forall era.
ShelleyEraImp era =&gt;
KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era PoolParams
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshPoolParams"><span class="hs-identifier hs-var hs-var">freshPoolParams</span></a></span></span><span> </span><span id="local-6989586621679717879"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717879"><span class="hs-identifier hs-var">khPool</span></a></span></span><span> </span><span id="local-6989586621679717880"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679717880"><span class="hs-identifier hs-var">rewardAccount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1630"></span><span>  </span><span id="local-6989586621679717881"><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621679717881"><span class="hs-identifier hs-var">vrfHash</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (VRFVerKeyHash 'StakePoolVRF)
forall era (r :: KeyRoleVRF). ImpTestM era (VRFVerKeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHashVRF"><span class="hs-identifier hs-var">freshKeyHashVRF</span></a></span><span>
</span><span id="line-1631"></span><span>  </span><span id="local-6989586621679717882"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679717882"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (PParams era)
 -&gt; ImpTestM era (PParams era))
-&gt; SimpleGetter (NewEpochState era) (PParams era)
-&gt; ImpTestM era (PParams era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((PParams era -&gt; Const r (PParams era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (PParams era -&gt; Const r (PParams era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const r (PParams era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span>
</span><span id="line-1632"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679717886"><span class="annot"><span class="annottext">minCost :: Coin
</span><a href="#local-6989586621679717886"><span class="hs-identifier hs-var hs-var">minCost</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679717882"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era -&gt; Getting Coin (PParams era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Coin (PParams era) Coin
forall era. EraPParams era =&gt; Lens' (PParams era) Coin
Lens' (PParams era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppMinPoolCostL"><span class="hs-identifier hs-var">ppMinPoolCostL</span></a></span><span>
</span><span id="line-1633"></span><span>  </span><span id="local-6989586621679717887"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717887"><span class="hs-identifier hs-var">poolCostExtra</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Coin, Coin) -&gt; ImpM (LedgerSpec era) Coin
forall g (m :: * -&gt; *) a.
(HasStatefulGen g m, UniformRange a) =&gt;
(a, a) -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#uniformRM"><span class="hs-identifier hs-var">uniformRM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100_000_000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span>  </span><span id="local-6989586621679717888"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717888"><span class="hs-identifier hs-var">pledge</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Coin, Coin) -&gt; ImpM (LedgerSpec era) Coin
forall g (m :: * -&gt; *) a.
(HasStatefulGen g m, UniformRange a) =&gt;
(a, a) -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Random.html#uniformRM"><span class="hs-identifier hs-var">uniformRM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">100_000_000</span></span><span class="hs-special">)</span><span>
</span><span id="line-1635"></span><span>  </span><span class="annot"><span class="annottext">PoolParams -&gt; ImpTestM era PoolParams
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1636"></span><span>    </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#PoolParams"><span class="hs-identifier hs-type">PoolParams</span></a></span><span>
</span><span id="line-1637"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ppVrf :: VRFVerKeyHash 'StakePoolVRF
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppVrf"><span class="hs-identifier hs-var">ppVrf</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VRFVerKeyHash 'StakePoolVRF
</span><a href="#local-6989586621679717881"><span class="hs-identifier hs-var">vrfHash</span></a></span><span>
</span><span id="line-1638"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppRewardAccount :: RewardAccount
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppRewardAccount"><span class="hs-identifier hs-var">ppRewardAccount</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679717880"><span class="hs-identifier hs-var">rewardAccount</span></a></span><span>
</span><span id="line-1639"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppRelays :: StrictSeq StakePoolRelay
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppRelays"><span class="hs-identifier hs-var">ppRelays</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictSeq StakePoolRelay
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1640"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppPledge :: Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppPledge"><span class="hs-identifier hs-var">ppPledge</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717888"><span class="hs-identifier hs-var">pledge</span></a></span><span>
</span><span id="line-1641"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppOwners :: Set (KeyHash 'Staking)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppOwners"><span class="hs-identifier hs-var">ppOwners</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (KeyHash 'Staking)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-1642"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppMetadata :: StrictMaybe PoolMetadata
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppMetadata"><span class="hs-identifier hs-var">ppMetadata</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictMaybe PoolMetadata
forall a. StrictMaybe a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span>
</span><span id="line-1643"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppMargin :: UnitInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppMargin"><span class="hs-identifier hs-var">ppMargin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInterval
forall a. Default a =&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1644"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppId :: KeyHash 'StakePool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppId"><span class="hs-identifier hs-var">ppId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717879"><span class="hs-identifier hs-var">khPool</span></a></span><span>
</span><span id="line-1645"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ppCost :: Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.StakePool.html#ppCost"><span class="hs-identifier hs-var">ppCost</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717886"><span class="hs-identifier hs-var">minCost</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679717887"><span class="hs-identifier hs-var">poolCostExtra</span></a></span><span>
</span><span id="line-1646"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-1647"></span><span>
</span><span id="line-1648"></span><span id="local-6989586621679713454"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPool"><span class="hs-identifier hs-type">registerPool</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1649"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713454"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1650"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1651"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713454"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1652"></span><span id="registerPool"><span class="annot"><span class="annottext">registerPool :: forall era.
ShelleyEraImp era =&gt;
KeyHash 'StakePool -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPool"><span class="hs-identifier hs-var hs-var">registerPool</span></a></span></span><span> </span><span id="local-6989586621679717906"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717906"><span class="hs-identifier hs-var">khPool</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImpTestM era RewardAccount
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
ImpTestM era RewardAccount
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerRewardAccount"><span class="hs-identifier hs-var">registerRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">ImpTestM era RewardAccount
-&gt; (RewardAccount -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) ()
forall a b.
ImpM (LedgerSpec era) a
-&gt; (a -&gt; ImpM (LedgerSpec era) b) -&gt; ImpM (LedgerSpec era) b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpM (LedgerSpec era) ()
forall era.
ShelleyEraImp era =&gt;
KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPoolWithRewardAccount"><span class="hs-identifier hs-var">registerPoolWithRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717906"><span class="hs-identifier hs-var">khPool</span></a></span><span>
</span><span id="line-1653"></span><span>
</span><span id="line-1654"></span><span id="local-6989586621679713456"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPoolWithRewardAccount"><span class="hs-identifier hs-type">registerPoolWithRewardAccount</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1655"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713456"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1656"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1657"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1658"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713456"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1659"></span><span id="registerPoolWithRewardAccount"><span class="annot"><span class="annottext">registerPoolWithRewardAccount :: forall era.
ShelleyEraImp era =&gt;
KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPoolWithRewardAccount"><span class="hs-identifier hs-var hs-var">registerPoolWithRewardAccount</span></a></span></span><span> </span><span id="local-6989586621679717927"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717927"><span class="hs-identifier hs-var">khPool</span></a></span></span><span> </span><span id="local-6989586621679717928"><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679717928"><span class="hs-identifier hs-var">rewardAccount</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1660"></span><span>  </span><span id="local-6989586621679717929"><span class="annot"><span class="annottext">PoolParams
</span><a href="#local-6989586621679717929"><span class="hs-identifier hs-var">pps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era PoolParams
forall era.
ShelleyEraImp era =&gt;
KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era PoolParams
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshPoolParams"><span class="hs-identifier hs-var">freshPoolParams</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717927"><span class="hs-identifier hs-var">khPool</span></a></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679717928"><span class="hs-identifier hs-var">rewardAccount</span></a></span><span>
</span><span id="line-1661"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Tx era -&gt; ImpTestM era ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn_"><span class="hs-identifier hs-var">submitTxAnn_</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Registering a new stake pool&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era ()) -&gt; Tx era -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1662"></span><span>    </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-1663"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxCert era))
Lens' (TxBody era) (StrictSeq (TxCert era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#certsTxBodyL"><span class="hs-identifier hs-var">certsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxCert era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">TxCert era -&gt; StrictSeq (TxCert era)
forall a. a -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#singleton"><span class="hs-identifier hs-var">SSeq.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PoolParams -&gt; TxCert era
forall era. EraTxCert era =&gt; PoolParams -&gt; TxCert era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#RegPoolTxCert"><span class="hs-identifier hs-var">RegPoolTxCert</span></a></span><span> </span><span class="annot"><span class="annottext">PoolParams
</span><a href="#local-6989586621679717929"><span class="hs-identifier hs-var">pps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span id="local-6989586621679713460"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerAndRetirePoolToMakeReward"><span class="hs-identifier hs-type">registerAndRetirePoolToMakeReward</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1666"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713460"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1667"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1668"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713460"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1669"></span><span id="registerAndRetirePoolToMakeReward"><span class="annot"><span class="annottext">registerAndRetirePoolToMakeReward :: forall era.
ShelleyEraImp era =&gt;
Credential 'Staking -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerAndRetirePoolToMakeReward"><span class="hs-identifier hs-var hs-var">registerAndRetirePoolToMakeReward</span></a></span></span><span> </span><span id="local-6989586621679717969"><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717969"><span class="hs-identifier hs-var">stakingCred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1670"></span><span>  </span><span id="local-6989586621679717970"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717970"><span class="hs-identifier hs-var">poolId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (KeyHash 'StakePool)
forall (r :: KeyRole) s g (m :: * -&gt; *).
(HasKeyPairs s, MonadState s m, HasStatefulGen g m) =&gt;
m (KeyHash r)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#freshKeyHash"><span class="hs-identifier hs-var">freshKeyHash</span></a></span><span>
</span><span id="line-1671"></span><span>  </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era ()
forall era.
ShelleyEraImp era =&gt;
KeyHash 'StakePool -&gt; RewardAccount -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#registerPoolWithRewardAccount"><span class="hs-identifier hs-var">registerPoolWithRewardAccount</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717970"><span class="hs-identifier hs-var">poolId</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; ImpTestM era ())
-&gt; ImpM (LedgerSpec era) RewardAccount -&gt; ImpTestM era ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><span class="hs-operator hs-var">=&lt;&lt;</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; ImpM (LedgerSpec era) RewardAccount
forall era. Credential 'Staking -&gt; ImpTestM era RewardAccount
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getRewardAccountFor"><span class="hs-identifier hs-var">getRewardAccountFor</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679717969"><span class="hs-identifier hs-var">stakingCred</span></a></span><span>
</span><span id="line-1672"></span><span>  </span><span class="annot"><span class="annottext">ImpTestM era ()
forall era. (ShelleyEraImp era, HasCallStack) =&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passEpoch"><span class="hs-identifier hs-var">passEpoch</span></a></span><span>
</span><span id="line-1673"></span><span>  </span><span id="local-6989586621679717971"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679717971"><span class="hs-identifier hs-var">curEpochNo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) EpochNo -&gt; ImpTestM era EpochNo
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; Const r EpochNo)
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
SimpleGetter (NewEpochState era) EpochNo
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochNo -&gt; f EpochNo)
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesELL"><span class="hs-identifier hs-var">nesELL</span></a></span><span>
</span><span id="line-1674"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679717974"><span class="annot"><span class="annottext">poolLifetime :: Word32
</span><a href="#local-6989586621679717974"><span class="hs-identifier hs-var hs-var">poolLifetime</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word32
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1675"></span><span>      </span><span id="local-6989586621679717975"><span class="annot"><span class="annottext">poolExpiry :: EpochNo
</span><a href="#local-6989586621679717975"><span class="hs-identifier hs-var hs-var">poolExpiry</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochInterval -&gt; EpochNo
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#addEpochInterval"><span class="hs-identifier hs-var">addEpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679717971"><span class="hs-identifier hs-var">curEpochNo</span></a></span><span> </span><span class="annot"><span class="annottext">(EpochInterval -&gt; EpochNo) -&gt; EpochInterval -&gt; EpochNo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; EpochInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochInterval"><span class="hs-identifier hs-var">EpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679717974"><span class="hs-identifier hs-var">poolLifetime</span></a></span><span>
</span><span id="line-1676"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; Tx era -&gt; ImpTestM era ()
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
[Char] -&gt; Tx era -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTxAnn_"><span class="hs-identifier hs-var">submitTxAnn_</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Retiring the temporary stake pool&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era ()) -&gt; Tx era -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1677"></span><span>    </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-1678"></span><span>      </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxCert era))
Lens' (TxBody era) (StrictSeq (TxCert era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#certsTxBodyL"><span class="hs-identifier hs-var">certsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxCert era) -&gt; Identity (StrictSeq (TxCert era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxCert era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">TxCert era -&gt; StrictSeq (TxCert era)
forall a. a -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#singleton"><span class="hs-identifier hs-var">SSeq.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; EpochNo -&gt; TxCert era
forall era.
EraTxCert era =&gt;
KeyHash 'StakePool -&gt; EpochNo -&gt; TxCert era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#RetirePoolTxCert"><span class="hs-identifier hs-var">RetirePoolTxCert</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679717970"><span class="hs-identifier hs-var">poolId</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679717975"><span class="hs-identifier hs-var">poolExpiry</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1679"></span><span>  </span><span class="annot"><span class="annottext">Natural -&gt; ImpTestM era ()
forall era. ShelleyEraImp era =&gt; Natural -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#passNEpochs"><span class="hs-identifier hs-var">passNEpochs</span></a></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; ImpTestM era ()) -&gt; Natural -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Word32 -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Word32
</span><a href="#local-6989586621679717974"><span class="hs-identifier hs-var">poolLifetime</span></a></span><span>
</span><span id="line-1680"></span><span>
</span><span id="line-1681"></span><span class="annot"><span class="hs-comment">-- | Compose given function with the configured fixup</span></span><span>
</span><span id="line-1682"></span><span id="local-6989586621679713464"><span id="local-6989586621679713465"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withCustomFixup"><span class="hs-identifier hs-type">withCustomFixup</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1683"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1684"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713465"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1685"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713464"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713465"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1686"></span><span id="withCustomFixup"><span class="annot"><span class="annottext">withCustomFixup :: forall era a.
((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withCustomFixup"><span class="hs-identifier hs-var hs-var">withCustomFixup</span></a></span></span><span> </span><span id="local-6989586621679717982"><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717982"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ImpTestEnv era -&gt; ImpTestEnv era)
-&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) a
forall a.
(ImpTestEnv era -&gt; ImpTestEnv era)
-&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((ImpTestEnv era -&gt; ImpTestEnv era)
 -&gt; ImpM (LedgerSpec era) a -&gt; ImpM (LedgerSpec era) a)
-&gt; (ImpTestEnv era -&gt; ImpTestEnv era)
-&gt; ImpM (LedgerSpec era) a
-&gt; ImpM (LedgerSpec era) a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Identity (Tx era -&gt; ImpTestM era (Tx era)))
-&gt; ImpTestEnv era -&gt; Identity (ImpTestEnv era)
forall era (f :: * -&gt; *).
Functor f =&gt;
((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; f (Tx era -&gt; ImpTestM era (Tx era)))
-&gt; ImpTestEnv era -&gt; f (ImpTestEnv era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#iteFixupL"><span class="hs-identifier hs-var">iteFixupL</span></a></span><span> </span><span class="annot"><span class="annottext">(((Tx era -&gt; ImpTestM era (Tx era))
  -&gt; Identity (Tx era -&gt; ImpTestM era (Tx era)))
 -&gt; ImpTestEnv era -&gt; Identity (ImpTestEnv era))
-&gt; ((Tx era -&gt; ImpTestM era (Tx era))
    -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestEnv era
-&gt; ImpTestEnv era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717982"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1687"></span><span>
</span><span id="line-1688"></span><span class="annot"><span class="hs-comment">-- | Replace all fixup with the given function</span></span><span>
</span><span id="line-1689"></span><span id="local-6989586621679713471"><span id="local-6989586621679713472"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withFixup"><span class="hs-identifier hs-type">withFixup</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1690"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713471"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713471"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713471"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1691"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713471"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713472"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1692"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713471"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713472"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1693"></span><span id="withFixup"><span class="annot"><span class="annottext">withFixup :: forall era a.
(Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withFixup"><span class="hs-identifier hs-var hs-var">withFixup</span></a></span></span><span> </span><span id="local-6989586621679717984"><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717984"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
forall era a.
((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withCustomFixup"><span class="hs-identifier hs-var">withCustomFixup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717984"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1694"></span><span>
</span><span id="line-1695"></span><span class="annot"><span class="hs-comment">-- | Performs the action without running the fix-up function on any transactions</span></span><span>
</span><span id="line-1696"></span><span id="local-6989586621679713475"><span id="local-6989586621679713476"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withNoFixup"><span class="hs-identifier hs-type">withNoFixup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713475"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713476"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713475"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713476"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1697"></span><span id="withNoFixup"><span class="annot"><span class="annottext">withNoFixup :: forall era a. ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withNoFixup"><span class="hs-identifier hs-var hs-var">withNoFixup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
forall era a.
(Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withFixup"><span class="hs-identifier hs-var">withFixup</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-1698"></span><span>
</span><span id="line-1699"></span><span class="annot"><span class="hs-comment">-- | Apply given fixup function before the configured fixup</span></span><span>
</span><span id="line-1700"></span><span id="local-6989586621679717986"><span id="local-6989586621679717987"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withPreFixup"><span class="hs-identifier hs-type">withPreFixup</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1701"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717986"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717986"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717986"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1702"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717986"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717987"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1703"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717986"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717987"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1704"></span><span id="withPreFixup"><span class="annot"><span class="annottext">withPreFixup :: forall era a.
(Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withPreFixup"><span class="hs-identifier hs-var hs-var">withPreFixup</span></a></span></span><span> </span><span id="local-6989586621679717989"><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717989"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
forall era a.
((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withCustomFixup"><span class="hs-identifier hs-var">withCustomFixup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717989"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1705"></span><span>
</span><span id="line-1706"></span><span class="annot"><span class="hs-comment">-- | Apply given fixup function after the configured fixup</span></span><span>
</span><span id="line-1707"></span><span id="local-6989586621679717990"><span id="local-6989586621679717991"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withPostFixup"><span class="hs-identifier hs-type">withPostFixup</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1708"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717990"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717990"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#Tx"><span class="hs-identifier hs-type">Tx</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717990"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1709"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717990"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717991"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1710"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717990"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679717991"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1711"></span><span id="withPostFixup"><span class="annot"><span class="annottext">withPostFixup :: forall era a.
(Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withPostFixup"><span class="hs-identifier hs-var hs-var">withPostFixup</span></a></span></span><span> </span><span id="local-6989586621679717993"><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717993"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
forall era a.
((Tx era -&gt; ImpTestM era (Tx era))
 -&gt; Tx era -&gt; ImpTestM era (Tx era))
-&gt; ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#withCustomFixup"><span class="hs-identifier hs-var">withCustomFixup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Tx era -&gt; ImpTestM era (Tx era))
-&gt; (Tx era -&gt; ImpTestM era (Tx era))
-&gt; Tx era
-&gt; ImpTestM era (Tx era)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&gt;=&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpTestM era (Tx era)
</span><a href="#local-6989586621679717993"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1712"></span><span>
</span><span id="line-1713"></span><span id="local-6989586621679713151"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectUTxOContent"><span class="hs-identifier hs-type">expectUTxOContent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1714"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/tree-diff-0.3.4-ef016b9048a98243efba583942a384684f7a662dffbb0844de08f7ab79f0b6af/share/doc/html/src/Data.TreeDiff.Class.html#ToExpr"><span class="hs-identifier hs-type">ToExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713151"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1715"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#UTxO"><span class="hs-identifier hs-type">UTxO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713151"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1716"></span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713151"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1717"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713151"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1718"></span><span id="expectUTxOContent"><span class="annot"><span class="annottext">expectUTxOContent :: forall era.
(HasCallStack, ToExpr (TxOut era)) =&gt;
UTxO era -&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)] -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectUTxOContent"><span class="hs-identifier hs-var hs-var">expectUTxOContent</span></a></span></span><span> </span><span id="local-6989586621679718012"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679718012"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((TxIn, Maybe (TxOut era) -&gt; Bool) -&gt; ImpM (LedgerSpec era) ())
-&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)] -&gt; ImpM (LedgerSpec era) ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><span class="hs-identifier hs-var">traverse_</span></span><span> </span><span class="annot"><span class="annottext">(((TxIn, Maybe (TxOut era) -&gt; Bool) -&gt; ImpM (LedgerSpec era) ())
 -&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)] -&gt; ImpM (LedgerSpec era) ())
-&gt; ((TxIn, Maybe (TxOut era) -&gt; Bool) -&gt; ImpM (LedgerSpec era) ())
-&gt; [(TxIn, Maybe (TxOut era) -&gt; Bool)]
-&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679718013"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679718013"><span class="hs-identifier hs-var">txIn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679718014"><span class="annot"><span class="annottext">Maybe (TxOut era) -&gt; Bool
</span><a href="#local-6989586621679718014"><span class="hs-identifier hs-var">test</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1719"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679718015"><span class="annot"><span class="annottext">result :: Maybe (TxOut era)
</span><a href="#local-6989586621679718015"><span class="hs-identifier hs-var hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679718013"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Map TxIn (TxOut era) -&gt; Maybe (TxOut era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-operator hs-var">`Map.lookup`</span></span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; Map TxIn (TxOut era)
forall era. UTxO era -&gt; Map TxIn (TxOut era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#unUTxO"><span class="hs-identifier hs-var">unUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679718012"><span class="hs-identifier hs-var">utxo</span></a></span><span>
</span><span id="line-1720"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TxOut era) -&gt; Bool
</span><a href="#local-6989586621679718014"><span class="hs-identifier hs-var">test</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut era)
</span><a href="#local-6989586621679718015"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1721"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) ()
forall (m :: * -&gt; *). (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-expectations-lifted-0.10.0-3b9af14f4044ae8391bddf2d12815688264dd87b731d8f5b89bdb0b08f389286/share/doc/html/src/Test.Hspec.Expectations.Lifted.html#expectationFailure"><span class="hs-identifier hs-var">expectationFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpM (LedgerSpec era) ())
-&gt; [Char] -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1722"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;UTxO content failed predicate:\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; [Char]
forall a. ToExpr a =&gt; a -&gt; [Char]
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExprString"><span class="hs-identifier hs-var">ansiExprString</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679718013"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; -&gt; &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut era) -&gt; [Char]
forall a. ToExpr a =&gt; a -&gt; [Char]
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/l/testlib/doc/html/cardano-ledger-binary/src/Test.Cardano.Ledger.Binary.TreeDiff.html#ansiExprString"><span class="hs-identifier hs-var">ansiExprString</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TxOut era)
</span><a href="#local-6989586621679718015"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-1723"></span><span>
</span><span id="line-1724"></span><span id="local-6989586621679713490"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectRegisteredRewardAddress"><span class="hs-identifier hs-type">expectRegisteredRewardAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1725"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713490"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713490"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1726"></span><span id="expectRegisteredRewardAddress"><span class="annot"><span class="annottext">expectRegisteredRewardAddress :: forall era.
(HasCallStack, EraCertState era) =&gt;
RewardAccount -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectRegisteredRewardAddress"><span class="hs-identifier hs-var hs-var">expectRegisteredRewardAddress</span></a></span></span><span> </span><span id="local-6989586621679718042"><span class="annot"><span class="annottext">ra :: RewardAccount
</span><a href="#local-6989586621679718042"><span class="hs-identifier hs-var">ra</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679718043"><span class="annot"><span class="annottext">Network
raNetwork :: RewardAccount -&gt; Network
raNetwork :: Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#raNetwork"><span class="hs-identifier hs-var hs-var">raNetwork</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679718044"><span class="annot"><span class="annottext">Credential 'Staking
raCredential :: RewardAccount -&gt; Credential 'Staking
raCredential :: Credential 'Staking
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#raCredential"><span class="hs-identifier hs-var hs-var">raCredential</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1727"></span><span>  </span><span id="local-6989586621679718045"><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679718045"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Network (ImpTestState era) Network
-&gt; ImpM (LedgerSpec era) Network
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Globals -&gt; Const Network Globals)
-&gt; ImpTestState era -&gt; Const Network (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Globals -&gt; Const Network Globals)
 -&gt; ImpTestState era -&gt; Const Network (ImpTestState era))
-&gt; ((Network -&gt; Const Network Network)
    -&gt; Globals -&gt; Const Network Globals)
-&gt; Getting Network (ImpTestState era) Network
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Network) -&gt; SimpleGetter Globals Network
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#networkId"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1728"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679718043"><span class="hs-identifier hs-var">raNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">Network -&gt; Network -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679718045"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1729"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era ()
forall (m :: * -&gt; *) a. (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Expectations.Lifted.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpTestM era ()) -&gt; [Char] -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1730"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Reward Account with an unexpected NetworkId: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679718042"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-1731"></span><span>  </span><span id="local-6989586621679718046"><span class="annot"><span class="annottext">Accounts era
</span><a href="#local-6989586621679718046"><span class="hs-identifier hs-var">accounts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (Accounts era)
-&gt; ImpTestM era (Accounts era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (Accounts era)
 -&gt; ImpTestM era (Accounts era))
-&gt; SimpleGetter (NewEpochState era) (Accounts era)
-&gt; ImpTestM era (Accounts era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const r (LedgerState era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((LedgerState era -&gt; Const r (LedgerState era))
 -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; EpochState era
-&gt; Const r (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CertState era -&gt; Const r (CertState era))
-&gt; LedgerState era -&gt; Const r (LedgerState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(CertState era -&gt; f (CertState era))
-&gt; LedgerState era -&gt; f (LedgerState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertStateL"><span class="hs-identifier hs-var">lsCertStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((CertState era -&gt; Const r (CertState era))
 -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; CertState era -&gt; Const r (CertState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; LedgerState era
-&gt; Const r (LedgerState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DState era -&gt; Const r (DState era))
-&gt; CertState era -&gt; Const r (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (DState era)
Lens' (CertState era) (DState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certDStateL"><span class="hs-identifier hs-var">certDStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((DState era -&gt; Const r (DState era))
 -&gt; CertState era -&gt; Const r (CertState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; DState era -&gt; Const r (DState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; CertState era
-&gt; Const r (CertState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Accounts era -&gt; Const r (Accounts era))
-&gt; DState era -&gt; Const r (DState era)
forall era. Lens' (DState era) (Accounts era)
forall (t :: * -&gt; *) era.
CanSetAccounts t =&gt;
Lens' (t era) (Accounts era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsL"><span class="hs-identifier hs-var">accountsL</span></a></span><span>
</span><span id="line-1732"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Credential 'Staking -&gt; Accounts era -&gt; Bool
forall era.
EraAccounts era =&gt;
Credential 'Staking -&gt; Accounts era -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#isAccountRegistered"><span class="hs-identifier hs-var">isAccountRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679718044"><span class="hs-identifier hs-var">raCredential</span></a></span><span> </span><span class="annot"><span class="annottext">Accounts era
</span><a href="#local-6989586621679718046"><span class="hs-identifier hs-var">accounts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1733"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era ()
forall (m :: * -&gt; *) a. (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Expectations.Lifted.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpTestM era ()) -&gt; [Char] -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1734"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected account &quot;</span></span><span>
</span><span id="line-1735"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679718042"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-1736"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; to be registered, but it is not.&quot;</span></span><span>
</span><span id="line-1737"></span><span>
</span><span id="line-1738"></span><span id="local-6989586621679718055"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectNotRegisteredRewardAddress"><span class="hs-identifier hs-type">expectNotRegisteredRewardAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1739"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#EraCertState"><span class="hs-identifier hs-type">EraCertState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718055"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718055"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1740"></span><span id="expectNotRegisteredRewardAddress"><span class="annot"><span class="annottext">expectNotRegisteredRewardAddress :: forall era.
(HasCallStack, EraCertState era) =&gt;
RewardAccount -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectNotRegisteredRewardAddress"><span class="hs-identifier hs-var hs-var">expectNotRegisteredRewardAddress</span></a></span></span><span> </span><span id="local-6989586621679718074"><span class="annot"><span class="annottext">ra :: RewardAccount
</span><a href="#local-6989586621679718074"><span class="hs-identifier hs-var">ra</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#RewardAccount"><span class="hs-identifier hs-type">RewardAccount</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679718075"><span class="annot"><span class="annottext">Network
raNetwork :: RewardAccount -&gt; Network
raNetwork :: Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#raNetwork"><span class="hs-identifier hs-var hs-var">raNetwork</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679718076"><span class="annot"><span class="annottext">Credential 'Staking
raCredential :: RewardAccount -&gt; Credential 'Staking
raCredential :: Credential 'Staking
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#raCredential"><span class="hs-identifier hs-var hs-var">raCredential</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1741"></span><span>  </span><span id="local-6989586621679718077"><span class="annot"><span class="annottext">Accounts era
</span><a href="#local-6989586621679718077"><span class="hs-identifier hs-var">accounts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) (Accounts era)
-&gt; ImpTestM era (Accounts era)
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) (Accounts era)
 -&gt; ImpTestM era (Accounts era))
-&gt; SimpleGetter (NewEpochState era) (Accounts era)
-&gt; ImpTestM era (Accounts era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(LedgerState era -&gt; Const r (LedgerState era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(LedgerState era -&gt; f (LedgerState era))
-&gt; EpochState era -&gt; f (EpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#esLStateL"><span class="hs-identifier hs-var">esLStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((LedgerState era -&gt; Const r (LedgerState era))
 -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; EpochState era
-&gt; Const r (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(CertState era -&gt; Const r (CertState era))
-&gt; LedgerState era -&gt; Const r (LedgerState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(CertState era -&gt; f (CertState era))
-&gt; LedgerState era -&gt; f (LedgerState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertStateL"><span class="hs-identifier hs-var">lsCertStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((CertState era -&gt; Const r (CertState era))
 -&gt; LedgerState era -&gt; Const r (LedgerState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; CertState era -&gt; Const r (CertState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; LedgerState era
-&gt; Const r (LedgerState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(DState era -&gt; Const r (DState era))
-&gt; CertState era -&gt; Const r (CertState era)
forall era. EraCertState era =&gt; Lens' (CertState era) (DState era)
Lens' (CertState era) (DState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#certDStateL"><span class="hs-identifier hs-var">certDStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((DState era -&gt; Const r (DState era))
 -&gt; CertState era -&gt; Const r (CertState era))
-&gt; ((Accounts era -&gt; Const r (Accounts era))
    -&gt; DState era -&gt; Const r (DState era))
-&gt; (Accounts era -&gt; Const r (Accounts era))
-&gt; CertState era
-&gt; Const r (CertState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Accounts era -&gt; Const r (Accounts era))
-&gt; DState era -&gt; Const r (DState era)
forall era. Lens' (DState era) (Accounts era)
forall (t :: * -&gt; *) era.
CanSetAccounts t =&gt;
Lens' (t era) (Accounts era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#accountsL"><span class="hs-identifier hs-var">accountsL</span></a></span><span>
</span><span id="line-1742"></span><span>  </span><span id="local-6989586621679718085"><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679718085"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting Network (ImpTestState era) Network
-&gt; ImpM (LedgerSpec era) Network
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#use"><span class="hs-identifier hs-var">use</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Globals -&gt; Const Network Globals)
-&gt; ImpTestState era -&gt; Const Network (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Globals -&gt; f Globals) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGlobalsL"><span class="hs-identifier hs-var">impGlobalsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Globals -&gt; Const Network Globals)
 -&gt; ImpTestState era -&gt; Const Network (ImpTestState era))
-&gt; ((Network -&gt; Const Network Network)
    -&gt; Globals -&gt; Const Network Globals)
-&gt; Getting Network (ImpTestState era) Network
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Network) -&gt; SimpleGetter Globals Network
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#to"><span class="hs-identifier hs-var">to</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Network
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#networkId"><span class="hs-identifier hs-var">networkId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1743"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679718075"><span class="hs-identifier hs-var">raNetwork</span></a></span><span> </span><span class="annot"><span class="annottext">Network -&gt; Network -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Network
</span><a href="#local-6989586621679718085"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; Accounts era -&gt; Bool
forall era.
EraAccounts era =&gt;
Credential 'Staking -&gt; Accounts era -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Account.html#isAccountRegistered"><span class="hs-identifier hs-var">isAccountRegistered</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking
</span><a href="#local-6989586621679718076"><span class="hs-identifier hs-var">raCredential</span></a></span><span> </span><span class="annot"><span class="annottext">Accounts era
</span><a href="#local-6989586621679718077"><span class="hs-identifier hs-var">accounts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ImpTestM era () -&gt; ImpTestM era ())
-&gt; ImpTestM era () -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1744"></span><span>    </span><span class="annot"><span class="annottext">[Char] -&gt; ImpTestM era ()
forall (m :: * -&gt; *) a. (HasCallStack, MonadIO m) =&gt; [Char] -&gt; m a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Expectations.Lifted.html#assertFailure"><span class="hs-identifier hs-var">assertFailure</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpTestM era ()) -&gt; [Char] -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-1745"></span><span>      </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Expected account &quot;</span></span><span>
</span><span id="line-1746"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">RewardAccount
</span><a href="#local-6989586621679718074"><span class="hs-identifier hs-var">ra</span></a></span><span>
</span><span id="line-1747"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot; to not be registered, but it is.&quot;</span></span><span>
</span><span id="line-1748"></span><span>
</span><span id="line-1749"></span><span id="local-6989586621679713496"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectTreasury"><span class="hs-identifier hs-type">expectTreasury</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713496"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1750"></span><span id="expectTreasury"><span class="annot"><span class="annottext">expectTreasury :: forall era. HasCallStack =&gt; Coin -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#expectTreasury"><span class="hs-identifier hs-var hs-var">expectTreasury</span></a></span></span><span> </span><span id="local-6989586621679718096"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679718096"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1751"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Checking treasury amount&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ())
-&gt; ImpM (LedgerSpec era) () -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1752"></span><span>    </span><span id="local-6989586621679718097"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679718097"><span class="hs-identifier hs-var">treasuryAmount</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) Coin -&gt; ImpTestM era Coin
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Const r Coin)
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
SimpleGetter (NewEpochState era) Coin
Lens' (NewEpochState era) Coin
forall (t :: * -&gt; *) era.
CanSetChainAccountState t =&gt;
Lens' (t era) Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.ChainAccount.html#treasuryL"><span class="hs-identifier hs-var">treasuryL</span></a></span><span>
</span><span id="line-1753"></span><span>    </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679718096"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; ImpM (LedgerSpec era) ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadIO m, Show a, Eq a) =&gt;
a -&gt; a -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/hspec-expectations-lifted-0.10.0-3b9af14f4044ae8391bddf2d12815688264dd87b731d8f5b89bdb0b08f389286/share/doc/html/src/Test.Hspec.Expectations.Lifted.html#shouldBe"><span class="hs-operator hs-var">`shouldBe`</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679718097"><span class="hs-identifier hs-var">treasuryAmount</span></a></span><span>
</span><span id="line-1754"></span><span>
</span><span id="line-1755"></span><span class="hs-comment">-- Ensure no fees reach the treasury since that complicates withdrawal checks</span><span>
</span><span id="line-1756"></span><span id="local-6989586621679718102"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableTreasuryExpansion"><span class="hs-identifier hs-type">disableTreasuryExpansion</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718102"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718102"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1757"></span><span id="disableTreasuryExpansion"><span class="annot"><span class="annottext">disableTreasuryExpansion :: forall era. ShelleyEraImp era =&gt; ImpM (LedgerSpec era) ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#disableTreasuryExpansion"><span class="hs-identifier hs-var hs-var">disableTreasuryExpansion</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; PParams era) -&gt; ImpTestM era ()
forall era.
ShelleyEraImp era =&gt;
(PParams era -&gt; PParams era) -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#modifyPParams"><span class="hs-identifier hs-var">modifyPParams</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; PParams era) -&gt; ImpTestM era ())
-&gt; (PParams era -&gt; PParams era) -&gt; ImpTestM era ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(UnitInterval -&gt; Identity UnitInterval)
-&gt; PParams era -&gt; Identity (PParams era)
forall era. EraPParams era =&gt; Lens' (PParams era) UnitInterval
Lens' (PParams era) UnitInterval
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#ppTauL"><span class="hs-identifier hs-var">ppTauL</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitInterval -&gt; Identity UnitInterval)
 -&gt; PParams era -&gt; Identity (PParams era))
-&gt; UnitInterval -&gt; PParams era -&gt; PParams era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; UnitInterval
forall r. (IsRatio r, HasCallStack) =&gt; Integer -&gt; Integer -&gt; r
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Rational.html#%25%21"><span class="hs-operator hs-var">%!</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1758"></span><span>
</span><span id="line-1759"></span><span id="local-6989586621679713504"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLookupNativeScript"><span class="hs-identifier hs-type">impLookupNativeScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713504"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#NativeScript"><span class="hs-identifier hs-type">NativeScript</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713504"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-1760"></span><span id="impLookupNativeScript"><span class="annot"><span class="annottext">impLookupNativeScript :: forall era. ScriptHash -&gt; ImpTestM era (Maybe (NativeScript era))
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLookupNativeScript"><span class="hs-identifier hs-var hs-var">impLookupNativeScript</span></a></span></span><span> </span><span id="local-6989586621679718120"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679718120"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptHash
-&gt; Map ScriptHash (NativeScript era) -&gt; Maybe (NativeScript era)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679718120"><span class="hs-identifier hs-var">sh</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ScriptHash (NativeScript era) -&gt; Maybe (NativeScript era))
-&gt; ImpM (LedgerSpec era) (Map ScriptHash (NativeScript era))
-&gt; ImpM (LedgerSpec era) (Maybe (NativeScript era))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; Map ScriptHash (NativeScript era))
-&gt; ImpM (LedgerSpec era) (Map ScriptHash (NativeScript era))
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; Map ScriptHash (NativeScript era)
forall era. ImpTestState era -&gt; Map ScriptHash (NativeScript era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impNativeScripts"><span class="hs-identifier hs-var">impNativeScripts</span></a></span><span>
</span><span id="line-1761"></span><span>
</span><span id="line-1762"></span><span id="local-6989586621679713506"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGetUTxO"><span class="hs-identifier hs-type">impGetUTxO</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713506"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713506"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713506"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1763"></span><span id="impGetUTxO"><span class="annot"><span class="annottext">impGetUTxO :: forall era. ShelleyEraImp era =&gt; TxIn -&gt; ImpTestM era (TxOut era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impGetUTxO"><span class="hs-identifier hs-var hs-var">impGetUTxO</span></a></span></span><span> </span><span id="local-6989586621679718136"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679718136"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; ImpM (LedgerSpec era) (TxOut era)
-&gt; ImpM (LedgerSpec era) (TxOut era)
forall a t. NFData a =&gt; [Char] -&gt; ImpM t a -&gt; ImpM t a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#impAnn"><span class="hs-identifier hs-var">impAnn</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Looking up TxOut&quot;</span></span><span> </span><span class="annot"><span class="annottext">(ImpM (LedgerSpec era) (TxOut era)
 -&gt; ImpM (LedgerSpec era) (TxOut era))
-&gt; ImpM (LedgerSpec era) (TxOut era)
-&gt; ImpM (LedgerSpec era) (TxOut era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1764"></span><span>  </span><span id="local-6989586621679718137"><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679718137"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era (UTxO era)
forall era. ImpTestM era (UTxO era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getUTxO"><span class="hs-identifier hs-var">getUTxO</span></a></span><span>
</span><span id="line-1765"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; UTxO era -&gt; Maybe (TxOut era)
forall era. TxIn -&gt; UTxO era -&gt; Maybe (TxOut era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.UTxO.html#txinLookup"><span class="hs-identifier hs-var">txinLookup</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679718136"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679718137"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1766"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679718138"><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679718138"><span class="hs-identifier hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; ImpM (LedgerSpec era) (TxOut era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679718138"><span class="hs-identifier hs-var">txOut</span></a></span><span>
</span><span id="line-1767"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TxOut era)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) (TxOut era)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpM (LedgerSpec era) (TxOut era))
-&gt; [Char] -&gt; ImpM (LedgerSpec era) (TxOut era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Failed to get TxOut for &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679718136"><span class="hs-identifier hs-var">txIn</span></a></span><span>
</span><span id="line-1768"></span><span>
</span><span id="line-1769"></span><span id="local-6989586621679713508"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#produceScript"><span class="hs-identifier hs-type">produceScript</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1770"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ShelleyEraImp"><span class="hs-identifier hs-type">ShelleyEraImp</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713508"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1771"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#ScriptHash"><span class="hs-identifier hs-type">ScriptHash</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1772"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713508"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.TxIn.html#TxIn"><span class="hs-identifier hs-type">TxIn</span></a></span></span><span>
</span><span id="line-1773"></span><span id="produceScript"><span class="annot"><span class="annottext">produceScript :: forall era.
(ShelleyEraImp era, HasCallStack) =&gt;
ScriptHash -&gt; ImpTestM era TxIn
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#produceScript"><span class="hs-identifier hs-var hs-var">produceScript</span></a></span></span><span> </span><span id="local-6989586621679718178"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679718178"><span class="hs-identifier hs-var">scriptHash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1774"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679718179"><span class="annot"><span class="annottext">addr :: Addr
</span><a href="#local-6989586621679718179"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; StakeReference -&gt; Addr
forall p s.
(MakeCredential p 'Payment, MakeStakeReference s) =&gt;
p -&gt; s -&gt; Addr
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.KeyPair.html#mkAddr"><span class="hs-identifier hs-var">mkAddr</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679718178"><span class="hs-identifier hs-var">scriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">StakeReference
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#StakeRefNull"><span class="hs-identifier hs-var">StakeRefNull</span></a></span><span>
</span><span id="line-1775"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679718180"><span class="annot"><span class="annottext">tx :: Tx era
</span><a href="#local-6989586621679718180"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1776"></span><span>        </span><span class="annot"><span class="annottext">TxBody era -&gt; Tx era
forall era. EraTx era =&gt; TxBody era -&gt; Tx era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTx"><span class="hs-identifier hs-var">mkBasicTx</span></a></span><span> </span><span class="annot"><span class="annottext">TxBody era
forall era. EraTxBody era =&gt; TxBody era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxBody"><span class="hs-identifier hs-var">mkBasicTxBody</span></a></span><span>
</span><span id="line-1777"></span><span>          </span><span class="annot"><span class="annottext">Tx era -&gt; (Tx era -&gt; Tx era) -&gt; Tx era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxBody era -&gt; Identity (TxBody era))
-&gt; Tx era -&gt; Identity (Tx era)
forall era. EraTx era =&gt; Lens' (Tx era) (TxBody era)
Lens' (Tx era) (TxBody era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#bodyTxL"><span class="hs-identifier hs-var">bodyTxL</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBody era -&gt; Identity (TxBody era))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; ((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
    -&gt; TxBody era -&gt; Identity (TxBody era))
-&gt; (StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; Tx era
-&gt; Identity (Tx era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
-&gt; TxBody era -&gt; Identity (TxBody era)
forall era.
EraTxBody era =&gt;
Lens' (TxBody era) (StrictSeq (TxOut era))
Lens' (TxBody era) (StrictSeq (TxOut era))
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#outputsTxBodyL"><span class="hs-identifier hs-var">outputsTxBodyL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictSeq (TxOut era) -&gt; Identity (StrictSeq (TxOut era)))
 -&gt; Tx era -&gt; Identity (Tx era))
-&gt; StrictSeq (TxOut era) -&gt; Tx era -&gt; Tx era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut era -&gt; StrictSeq (TxOut era)
forall a. a -&gt; StrictSeq a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#singleton"><span class="hs-identifier hs-var">SSeq.singleton</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Addr -&gt; Value era -&gt; TxOut era
forall era.
(EraTxOut era, HasCallStack) =&gt;
Addr -&gt; Value era -&gt; TxOut era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html#mkBasicTxOut"><span class="hs-identifier hs-var">mkBasicTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">Addr
</span><a href="#local-6989586621679718179"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Value era
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span class="hs-special">)</span><span>
</span><span id="line-1778"></span><span>  </span><span class="annot"><span class="annottext">[Char] -&gt; ImpM (LedgerSpec era) ()
forall t. HasCallStack =&gt; [Char] -&gt; ImpM t ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/ImpSpec-0.1.0.0-6ea58913ddd2445c6ef0a09c850f2b8e9ef4a818708b4f2c102bd4532b2effb1/share/doc/html/src/Test.ImpSpec.Internal.html#logString"><span class="hs-identifier hs-var">logString</span></a></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; ImpM (LedgerSpec era) ())
-&gt; [Char] -&gt; ImpM (LedgerSpec era) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Produced script: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679718178"><span class="hs-identifier hs-var">scriptHash</span></a></span><span>
</span><span id="line-1779"></span><span>  </span><span class="annot"><span class="annottext">Int -&gt; Tx era -&gt; TxIn
forall era. (HasCallStack, EraTx era) =&gt; Int -&gt; Tx era -&gt; TxIn
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/testlib/doc/html/cardano-ledger-core/src/Test.Cardano.Ledger.Core.Utils.html#txInAt"><span class="hs-identifier hs-var">txInAt</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Tx era -&gt; TxIn)
-&gt; ImpM (LedgerSpec era) (Tx era) -&gt; ImpTestM era TxIn
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tx era -&gt; ImpM (LedgerSpec era) (Tx era)
forall era.
(HasCallStack, ShelleyEraImp era) =&gt;
Tx era -&gt; ImpTestM era (Tx era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#submitTx"><span class="hs-identifier hs-var">submitTx</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679718180"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-1780"></span><span>
</span><span id="line-1781"></span><span id="local-6989586621679713511"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#advanceToPointOfNoReturn"><span class="hs-identifier hs-type">advanceToPointOfNoReturn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713511"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-1782"></span><span id="advanceToPointOfNoReturn"><span class="annot"><span class="annottext">advanceToPointOfNoReturn :: forall era. ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#advanceToPointOfNoReturn"><span class="hs-identifier hs-var hs-var">advanceToPointOfNoReturn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1783"></span><span>  </span><span id="local-6989586621679718192"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679718192"><span class="hs-identifier hs-var">impLastTick</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImpTestState era -&gt; SlotNo) -&gt; ImpM (LedgerSpec era) SlotNo
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era -&gt; SlotNo
forall era. ImpTestState era -&gt; SlotNo
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTick"><span class="hs-identifier hs-var">impLastTick</span></a></span><span>
</span><span id="line-1784"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679718193"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679718193"><span class="hs-identifier hs-var">slotOfNoReturn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShelleyBase (EpochNo, SlotNo, EpochNo)
-&gt; ImpTestM era (EpochNo, SlotNo, EpochNo)
forall a era. ShelleyBase a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#runShelleyBase"><span class="hs-identifier hs-var">runShelleyBase</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyBase (EpochNo, SlotNo, EpochNo)
 -&gt; ImpTestM era (EpochNo, SlotNo, EpochNo))
-&gt; ShelleyBase (EpochNo, SlotNo, EpochNo)
-&gt; ImpTestM era (EpochNo, SlotNo, EpochNo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; SlotNo -&gt; ShelleyBase (EpochNo, SlotNo, EpochNo)
SlotNo -&gt; ShelleyBase (EpochNo, SlotNo, EpochNo)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html#getTheSlotOfNoReturn"><span class="hs-identifier hs-var">getTheSlotOfNoReturn</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679718192"><span class="hs-identifier hs-var">impLastTick</span></a></span><span>
</span><span id="line-1785"></span><span>  </span><span class="annot"><span class="annottext">(SlotNo -&gt; Identity SlotNo)
-&gt; ImpTestState era -&gt; Identity (ImpTestState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(SlotNo -&gt; f SlotNo) -&gt; ImpTestState era -&gt; f (ImpTestState era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#impLastTickL"><span class="hs-identifier hs-var">impLastTickL</span></a></span><span> </span><span class="annot"><span class="annottext">((SlotNo -&gt; Identity SlotNo)
 -&gt; ImpTestState era -&gt; Identity (ImpTestState era))
-&gt; SlotNo -&gt; ImpTestM era ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-mtl-0.2.1.0-0d9d0bb15333296047ba4b93a576c67cb2d2f407b8b7ffd0ab1ce8097b524420/share/doc/html/src/Lens.Micro.Mtl.html#.%3D"><span class="hs-operator hs-var">.=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679718193"><span class="hs-identifier hs-var">slotOfNoReturn</span></a></span><span>
</span><span id="line-1786"></span><span>
</span><span id="line-1787"></span><span class="annot"><span class="hs-comment">-- | A legal ProtVer that differs in the minor Version</span></span><span>
</span><span id="line-1788"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#minorFollow"><span class="hs-identifier hs-type">minorFollow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span>
</span><span id="line-1789"></span><span id="minorFollow"><span class="annot"><span class="annottext">minorFollow :: ProtVer -&gt; ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#minorFollow"><span class="hs-identifier hs-var hs-var">minorFollow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span id="local-6989586621679718194"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718194"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679718195"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679718195"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Natural -&gt; ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-var">ProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718194"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679718195"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1790"></span><span>
</span><span id="line-1791"></span><span class="annot"><span class="hs-comment">-- | A legal ProtVer that moves to the next major Version</span></span><span>
</span><span id="line-1792"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#majorFollow"><span class="hs-identifier hs-type">majorFollow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span>
</span><span id="line-1793"></span><span id="majorFollow"><span class="annot"><span class="annottext">majorFollow :: ProtVer -&gt; ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#majorFollow"><span class="hs-identifier hs-var hs-var">majorFollow</span></a></span></span><span> </span><span id="local-6989586621679718197"><span class="annot"><span class="annottext">pv :: ProtVer
</span><a href="#local-6989586621679718197"><span class="hs-identifier hs-var">pv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span id="local-6989586621679718198"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718198"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Maybe Version
forall (m :: * -&gt; *). MonadFail m =&gt; Version -&gt; m Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#succVersion"><span class="hs-identifier hs-var">succVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718198"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1794"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679718200"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718200"><span class="hs-identifier hs-var">x'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Natural -&gt; ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-var">ProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718200"><span class="hs-identifier hs-var">x'</span></a></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">0</span></span><span>
</span><span id="line-1795"></span><span>  </span><span class="annot"><span class="annottext">Maybe Version
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; ProtVer
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;The last major version can't be incremented. &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">ProtVer -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718197"><span class="hs-identifier hs-var">pv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1796"></span><span>
</span><span id="line-1797"></span><span class="annot"><span class="hs-comment">-- | An illegal ProtVer that skips 3 minor versions</span></span><span>
</span><span id="line-1798"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#cantFollow"><span class="hs-identifier hs-type">cantFollow</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span>
</span><span id="line-1799"></span><span id="cantFollow"><span class="annot"><span class="annottext">cantFollow :: ProtVer -&gt; ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#cantFollow"><span class="hs-identifier hs-var hs-var">cantFollow</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span id="local-6989586621679718201"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718201"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679718202"><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679718202"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Version -&gt; Natural -&gt; ProtVer
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-var">ProtVer</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621679718201"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Natural
</span><a href="#local-6989586621679718202"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Natural -&gt; Natural
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Natural
</span><span class="hs-number">3</span></span><span class="hs-special">)</span><span>
</span><span id="line-1800"></span><span>
</span><span id="line-1801"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersion"><span class="hs-identifier hs-type">whenMajorVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1802"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679713515"><span class="annot"><a href="#local-6989586621679713515"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679713514"><span class="annot"><a href="#local-6989586621679713514"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1803"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713514"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1804"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679713515"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1805"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MinVersion"><span class="hs-identifier hs-type">MinVersion</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621679713515"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1806"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679713515"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MaxVersion"><span class="hs-identifier hs-type">MaxVersion</span></a></span><span>
</span><span id="line-1807"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1808"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713514"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713514"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1809"></span><span id="whenMajorVersion"><span class="annot"><span class="annottext">whenMajorVersion :: forall (v :: Natural) era.
(EraGov era, KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
ImpTestM era () -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersion"><span class="hs-identifier hs-var hs-var">whenMajorVersion</span></a></span></span><span> </span><span id="local-6989586621679718220"><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718220"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1810"></span><span>  </span><span id="local-6989586621679718221"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718221"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ProtVer
forall era. EraGov era =&gt; ImpTestM era ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier hs-var">getProtVer</span></a></span><span>
</span><span id="line-1811"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtVer -&gt; Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#pvMajor"><span class="hs-identifier hs-var">pvMajor</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718221"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall (v :: Natural).
(KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier hs-var">natVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679713515"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718220"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1812"></span><span>
</span><span id="line-1813"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersionAtLeast"><span class="hs-identifier hs-type">whenMajorVersionAtLeast</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1814"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679718224"><span class="annot"><a href="#local-6989586621679718224"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679718225"><span class="annot"><a href="#local-6989586621679718225"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1815"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718225"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1816"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679718224"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1817"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MinVersion"><span class="hs-identifier hs-type">MinVersion</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621679718224"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1818"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679718224"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MaxVersion"><span class="hs-identifier hs-type">MaxVersion</span></a></span><span>
</span><span id="line-1819"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1820"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718225"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718225"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1821"></span><span id="whenMajorVersionAtLeast"><span class="annot"><span class="annottext">whenMajorVersionAtLeast :: forall (v :: Natural) era.
(EraGov era, KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
ImpTestM era () -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersionAtLeast"><span class="hs-identifier hs-var hs-var">whenMajorVersionAtLeast</span></a></span></span><span> </span><span id="local-6989586621679718242"><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718242"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1822"></span><span>  </span><span id="local-6989586621679718243"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718243"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ProtVer
forall era. EraGov era =&gt; ImpTestM era ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier hs-var">getProtVer</span></a></span><span>
</span><span id="line-1823"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtVer -&gt; Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#pvMajor"><span class="hs-identifier hs-var">pvMajor</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718243"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (v :: Natural).
(KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier hs-var">natVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679718224"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718242"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1824"></span><span>
</span><span id="line-1825"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersionAtMost"><span class="hs-identifier hs-type">whenMajorVersionAtMost</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1826"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679718244"><span class="annot"><a href="#local-6989586621679718244"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679718245"><span class="annot"><a href="#local-6989586621679718245"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1827"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718245"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1828"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679718244"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1829"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MinVersion"><span class="hs-identifier hs-type">MinVersion</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621679718244"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1830"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679718244"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MaxVersion"><span class="hs-identifier hs-type">MaxVersion</span></a></span><span>
</span><span id="line-1831"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1832"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718245"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718245"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1833"></span><span id="whenMajorVersionAtMost"><span class="annot"><span class="annottext">whenMajorVersionAtMost :: forall (v :: Natural) era.
(EraGov era, KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
ImpTestM era () -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#whenMajorVersionAtMost"><span class="hs-identifier hs-var hs-var">whenMajorVersionAtMost</span></a></span></span><span> </span><span id="local-6989586621679718261"><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718261"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1834"></span><span>  </span><span id="local-6989586621679718262"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718262"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ProtVer
forall era. EraGov era =&gt; ImpTestM era ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier hs-var">getProtVer</span></a></span><span>
</span><span id="line-1835"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtVer -&gt; Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#pvMajor"><span class="hs-identifier hs-var">pvMajor</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718262"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">forall (v :: Natural).
(KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier hs-var">natVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679718244"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718261"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1836"></span><span>
</span><span id="line-1837"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#unlessMajorVersion"><span class="hs-identifier hs-type">unlessMajorVersion</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1838"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679718263"><span class="annot"><a href="#local-6989586621679718263"><span class="hs-identifier hs-type">v</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679718264"><span class="annot"><a href="#local-6989586621679718264"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1839"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718264"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-1840"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">KnownNat</span></span><span> </span><span class="annot"><a href="#local-6989586621679718263"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1841"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MinVersion"><span class="hs-identifier hs-type">MinVersion</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="#local-6989586621679718263"><span class="hs-identifier hs-type">v</span></a></span><span>
</span><span id="line-1842"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679718263"><span class="hs-identifier hs-type">v</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;=</span></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#MaxVersion"><span class="hs-identifier hs-type">MaxVersion</span></a></span><span>
</span><span id="line-1843"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1844"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718264"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718264"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1845"></span><span id="unlessMajorVersion"><span class="annot"><span class="annottext">unlessMajorVersion :: forall (v :: Natural) era.
(EraGov era, KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
ImpTestM era () -&gt; ImpTestM era ()
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#unlessMajorVersion"><span class="hs-identifier hs-var hs-var">unlessMajorVersion</span></a></span></span><span> </span><span id="local-6989586621679718280"><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718280"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1846"></span><span>  </span><span id="local-6989586621679718281"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718281"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ProtVer
forall era. EraGov era =&gt; ImpTestM era ProtVer
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getProtVer"><span class="hs-identifier hs-var">getProtVer</span></a></span><span>
</span><span id="line-1847"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; ImpTestM era () -&gt; ImpTestM era ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ProtVer -&gt; Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#pvMajor"><span class="hs-identifier hs-var">pvMajor</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679718281"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="annot"><span class="annottext">Version -&gt; Version -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">forall (v :: Natural).
(KnownNat v, 0 &lt;= v, v &lt;= MaxVersion) =&gt;
Version
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Version.html#natVersion"><span class="hs-identifier hs-var">natVersion</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679718263"><span class="hs-identifier hs-type">v</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ImpTestM era ()
</span><a href="#local-6989586621679718280"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1848"></span><span>
</span><span id="line-1849"></span><span id="local-6989586621679713525"><span id="local-6989586621679713526"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsPParams"><span class="hs-identifier hs-type">getsPParams</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713525"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713525"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679713526"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713525"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679713526"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1850"></span><span id="getsPParams"><span class="annot"><span class="annottext">getsPParams :: forall era a. EraGov era =&gt; Lens' (PParams era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsPParams"><span class="hs-identifier hs-var hs-var">getsPParams</span></a></span></span><span> </span><span id="local-6989586621679718283"><span class="annot"><span class="annottext">Lens' (PParams era) a
</span><a href="#local-6989586621679718283"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
forall era a. SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#getsNES"><span class="hs-identifier hs-var">getsNES</span></a></span><span> </span><span class="annot"><span class="annottext">(SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a)
-&gt; SimpleGetter (NewEpochState era) a -&gt; ImpTestM era a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const r (EpochState era))
-&gt; NewEpochState era -&gt; Const r (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const r (EpochState era))
 -&gt; NewEpochState era -&gt; Const r (NewEpochState era))
-&gt; ((a -&gt; Const r a) -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; (a -&gt; Const r a)
-&gt; NewEpochState era
-&gt; Const r (NewEpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const r (PParams era))
-&gt; EpochState era -&gt; Const r (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; Const r (PParams era))
 -&gt; EpochState era -&gt; Const r (EpochState era))
-&gt; ((a -&gt; Const r a) -&gt; PParams era -&gt; Const r (PParams era))
-&gt; (a -&gt; Const r a)
-&gt; EpochState era
-&gt; Const r (EpochState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Const r a) -&gt; PParams era -&gt; Const r (PParams era)
Lens' (PParams era) a
</span><a href="#local-6989586621679718283"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1851"></span><span>
</span><span id="line-1852"></span><span class="hs-comment">-- | Runs a simulation action and then restores the ledger state to what it was</span><span>
</span><span id="line-1853"></span><span class="hs-comment">-- before the simulation started.</span><span>
</span><span id="line-1854"></span><span class="hs-comment">-- This is useful for testing or running actions whose effects on the ledger</span><span>
</span><span id="line-1855"></span><span class="hs-comment">-- state should not persist. The return value of the simulation is preserved,</span><span>
</span><span id="line-1856"></span><span class="hs-comment">-- but any changes to the internal state (e.g., the UTxO set, protocol parameters,</span><span>
</span><span id="line-1857"></span><span class="hs-comment">-- etc.) are discarded and replaced with the original snapshot.</span><span>
</span><span id="line-1858"></span><span id="local-6989586621679718288"><span id="local-6989586621679718289"><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#simulateThenRestore"><span class="hs-identifier hs-type">simulateThenRestore</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1859"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718288"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718289"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1860"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718288"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718289"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1861"></span><span id="simulateThenRestore"><span class="annot"><span class="annottext">simulateThenRestore :: forall era a. ImpTestM era a -&gt; ImpTestM era a
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#simulateThenRestore"><span class="hs-identifier hs-var hs-var">simulateThenRestore</span></a></span></span><span> </span><span id="local-6989586621679718300"><span class="annot"><span class="annottext">ImpTestM era a
</span><a href="#local-6989586621679718300"><span class="hs-identifier hs-var">sim</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1862"></span><span>  </span><span id="local-6989586621679718301"><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679718301"><span class="hs-identifier hs-var">snapshot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpM (LedgerSpec era) (ImpTestState era)
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-1863"></span><span>  </span><span id="local-6989586621679718302"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679718302"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ImpTestM era a
</span><a href="#local-6989586621679718300"><span class="hs-identifier hs-var">sim</span></a></span><span>
</span><span id="line-1864"></span><span>  </span><span class="annot"><span class="annottext">ImpTestState era -&gt; ImpM (LedgerSpec era) ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">ImpTestState era
</span><a href="#local-6989586621679718301"><span class="hs-identifier hs-var">snapshot</span></a></span><span>
</span><span id="line-1865"></span><span>  </span><span class="annot"><span class="annottext">a -&gt; ImpTestM era a
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679718302"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-1866"></span><span>
</span><span id="line-1867"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenRegTxCert"><span class="hs-identifier hs-type">shelleyGenRegTxCert</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1868"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679712928"><span class="annot"><a href="#local-6989586621679712928"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1869"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.TxCert.html#ShelleyEraTxCert"><span class="hs-identifier hs-type">ShelleyEraTxCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712928"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1870"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1871"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712928"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#TxCert"><span class="hs-identifier hs-type">TxCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679712928"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1872"></span><span id="shelleyGenRegTxCert"><span class="annot"><span class="annottext">shelleyGenRegTxCert :: forall era.
ShelleyEraTxCert era =&gt;
Credential 'Staking -&gt; ImpTestM era (TxCert era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenRegTxCert"><span class="hs-identifier hs-var hs-var">shelleyGenRegTxCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCert era -&gt; ImpM (LedgerSpec era) (TxCert era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TxCert era -&gt; ImpM (LedgerSpec era) (TxCert era))
-&gt; (Credential 'Staking -&gt; TxCert era)
-&gt; Credential 'Staking
-&gt; ImpM (LedgerSpec era) (TxCert era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; TxCert era
forall era.
ShelleyEraTxCert era =&gt;
Credential 'Staking -&gt; TxCert era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.TxCert.html#RegTxCert"><span class="hs-identifier hs-var">RegTxCert</span></a></span><span>
</span><span id="line-1873"></span><span>
</span><span id="line-1874"></span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenUnRegTxCert"><span class="hs-identifier hs-type">shelleyGenUnRegTxCert</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-1875"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679718307"><span class="annot"><a href="#local-6989586621679718307"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-1876"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.TxCert.html#ShelleyEraTxCert"><span class="hs-identifier hs-type">ShelleyEraTxCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718307"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-1877"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1878"></span><span>  </span><span class="annot"><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#ImpTestM"><span class="hs-identifier hs-type">ImpTestM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718307"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.TxCert.html#TxCert"><span class="hs-identifier hs-type">TxCert</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679718307"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1879"></span><span id="shelleyGenUnRegTxCert"><span class="annot"><span class="annottext">shelleyGenUnRegTxCert :: forall era.
ShelleyEraTxCert era =&gt;
Credential 'Staking -&gt; ImpTestM era (TxCert era)
</span><a href="Test.Cardano.Ledger.Shelley.ImpTest.html#shelleyGenUnRegTxCert"><span class="hs-identifier hs-var hs-var">shelleyGenUnRegTxCert</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCert era -&gt; ImpM (LedgerSpec era) (TxCert era)
forall a. a -&gt; ImpM (LedgerSpec era) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(TxCert era -&gt; ImpM (LedgerSpec era) (TxCert era))
-&gt; (Credential 'Staking -&gt; TxCert era)
-&gt; Credential 'Staking
-&gt; ImpM (LedgerSpec era) (TxCert era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Credential 'Staking -&gt; TxCert era
forall era.
ShelleyEraTxCert era =&gt;
Credential 'Staking -&gt; TxCert era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-shelley-1.17.2.0/doc/html/cardano-ledger-shelley/src/Cardano.Ledger.Shelley.TxCert.html#UnRegTxCert"><span class="hs-identifier hs-var">UnRegTxCert</span></a></span><span>
</span><span id="line-1880"></span></pre></body></html>