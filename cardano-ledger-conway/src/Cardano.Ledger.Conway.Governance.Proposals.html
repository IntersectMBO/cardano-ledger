<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ImpredicativeTypes #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE QuantifiedConstraints #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-21"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-22"></span><span>
</span><span id="line-23"></span><span class="hs-comment">-- | This module isolates all the types and functionality around</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- Governance Proposals.</span><span>
</span><span id="line-25"></span><span class="hs-comment">--</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- It is important to note that there are two sets of state that we</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- maintain around proposals and their enactment. One is processed</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- with transactions (@`Proposals`@) and another at the epoch boundary</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- (@`PrevGovActionIds`@, @`DRepPulser`@). These two sets work together:</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- the incoming proposals and votes are collected continuously in the</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- state that lives with transaction processing, and at each epoch</span><span>
</span><span id="line-32"></span><span class="hs-comment">-- boundary a snapshot of this state is taken to perform pulsing</span><span>
</span><span id="line-33"></span><span class="hs-comment">-- computations on - after it has been adjusted (the proposals are</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- enacted or expired) based on the result of the previous pulsing</span><span>
</span><span id="line-35"></span><span class="hs-comment">-- computaiion.</span><span>
</span><span id="line-36"></span><span class="hs-comment">--</span><span>
</span><span id="line-37"></span><span class="hs-comment">-- Below is a typical timeline of the processing of these states.</span><span>
</span><span id="line-38"></span><span class="hs-comment">--</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- 1. Epoch n: Proposals and votes are continuously collected from</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- incoming transactions into @`Proposals`@</span><span>
</span><span id="line-41"></span><span class="hs-comment">--</span><span>
</span><span id="line-42"></span><span class="hs-comment">-- 2. Epoch n boundary: The @`DRepPulser`@ contains all proposals and</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- votes from epoch (n - 1). Its calculation is completed, ratified</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- and enacted or expired. Ratification and enactment do not affect</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- @`Proposals`@ directly. They only update the @`PrevGovActionIds`@</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- directly and return the sequence of enacted action-ids and the set</span><span>
</span><span id="line-47"></span><span class="hs-comment">-- of expired action-ids that inform us of the changes pending on</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- @`Proposals`@.</span><span>
</span><span id="line-49"></span><span class="hs-comment">--</span><span>
</span><span id="line-50"></span><span class="hs-comment">--   2.1. We take this sequence of enacted action-ids and set of expired</span><span>
</span><span id="line-51"></span><span class="hs-comment">--   action-ids and apply them to the @`Proposals`@ in the ledger</span><span>
</span><span id="line-52"></span><span class="hs-comment">--   state that now includes all the newly collected proposals and</span><span>
</span><span id="line-53"></span><span class="hs-comment">--   votes from epoch n and epoch (n - 1), as this is a superset of</span><span>
</span><span id="line-54"></span><span class="hs-comment">--   the pulsed set of proposals and votes. We do not expect this</span><span>
</span><span id="line-55"></span><span class="hs-comment">--   operation to fail, since all invariants are expected to hold and</span><span>
</span><span id="line-56"></span><span class="hs-comment">--   only an implementation bug could cause this operation to fail.</span><span>
</span><span id="line-57"></span><span class="hs-comment">--   After applying this operation we expect the @`Proposals`@ to be in</span><span>
</span><span id="line-58"></span><span class="hs-comment">--   a state, where (i) all expired actions and their descendants have</span><span>
</span><span id="line-59"></span><span class="hs-comment">--   been pruned, and (ii) the sequence of enacted action-ids have been</span><span>
</span><span id="line-60"></span><span class="hs-comment">--   promoted to be the root of the respective tree and their competing</span><span>
</span><span id="line-61"></span><span class="hs-comment">--   or sibling action-ids and their descendants have been pruned from</span><span>
</span><span id="line-62"></span><span class="hs-comment">--   the @`Proposals`@ tree.</span><span>
</span><span id="line-63"></span><span class="hs-comment">--</span><span>
</span><span id="line-64"></span><span class="hs-comment">--   2.2. The resultant @`Proposals`@ forest has all the latest</span><span>
</span><span id="line-65"></span><span class="hs-comment">--   proposals and votes collected and with enactments and expirations</span><span>
</span><span id="line-66"></span><span class="hs-comment">--   applied to existing ones, so we take a new snapshot to perform</span><span>
</span><span id="line-67"></span><span class="hs-comment">--   pulsing computations on and start the new pulser (@`DRepPulser`@),</span><span>
</span><span id="line-68"></span><span class="hs-comment">--   before entering the new epoch to collect more proposals and votes</span><span>
</span><span id="line-69"></span><span class="hs-comment">--   in @`Proposals`@. Here we trust that the pulser accounts correctly</span><span>
</span><span id="line-70"></span><span class="hs-comment">--   for newly collected votes on proposals from previous epochs that</span><span>
</span><span id="line-71"></span><span class="hs-comment">--   haven't been ratified yet.</span><span>
</span><span id="line-72"></span><span class="hs-comment">--</span><span>
</span><span id="line-73"></span><span class="hs-comment">-- 3. Epoch (n + 1): New proposals and votes are collected from incoming</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- transactions into @`Proposals`@.</span><span>
</span><span id="line-75"></span><span class="hs-comment">--</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- 4. Epoch (n + 1) boundary: The @`DRepPulser`@ now contains all</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- unratified proposals and votes from epoch n. Its calculation</span><span>
</span><span id="line-78"></span><span class="hs-comment">-- is completed, ratified and enacted or expired. This updates</span><span>
</span><span id="line-79"></span><span class="hs-comment">-- @`PrevGovActionIds`@ and gives us a new sequence of enacted</span><span>
</span><span id="line-80"></span><span class="hs-comment">-- action-ids and set of expired actions-ids to apply to the</span><span>
</span><span id="line-81"></span><span class="hs-comment">-- @`Proposals`@, which have been collecting even newer proposals and</span><span>
</span><span id="line-82"></span><span class="hs-comment">-- votes to be a superset of our set of pulsed proposals and votes. And</span><span>
</span><span id="line-83"></span><span class="hs-comment">-- so on...</span><span>
</span><span id="line-84"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Conway.Governance.Proposals</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Intended interface to be used for all implementation</span></span><span>
</span><span id="line-86"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier">Proposals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mapProposals"><span class="hs-identifier">mapProposals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsIds"><span class="hs-identifier">proposalsIds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsActions"><span class="hs-identifier">proposalsActions</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsSize"><span class="hs-identifier">proposalsSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsAddAction"><span class="hs-identifier">proposalsAddAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsApplyEnactment"><span class="hs-identifier">proposalsApplyEnactment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsAddVote"><span class="hs-identifier">proposalsAddVote</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsLookupId"><span class="hs-identifier">proposalsLookupId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsActionsMap"><span class="hs-identifier">proposalsActionsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsWithPurpose"><span class="hs-identifier">proposalsWithPurpose</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPrevGovActionIds"><span class="hs-identifier">toPrevGovActionIds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#fromPrevGovActionIds"><span class="hs-identifier">fromPrevGovActionIds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><span class="hs-comment">-- * To be used only for testing</span></span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveWithDescendants"><span class="hs-identifier">proposalsRemoveWithDescendants</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier">TreeMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTree"><span class="hs-identifier">toGovRelationTree</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTreeEither"><span class="hs-identifier">toGovRelationTreeEither</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier">pPropsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier">pRootsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier">pGraphL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mkProposals"><span class="hs-identifier">mkProposals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unsafeMkProposals"><span class="hs-identifier">unsafeMkProposals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier">PRoot</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRootL"><span class="hs-identifier">prRootL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildrenL"><span class="hs-identifier">prChildrenL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier">PEdges</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildrenL"><span class="hs-identifier">peChildrenL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier">PGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier">pGraphNodesL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsDeposits"><span class="hs-identifier">proposalsDeposits</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mapPRoot"><span class="hs-identifier">mapPRoot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#translateProposals"><span class="hs-identifier">translateProposals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-120"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html"><span class="hs-identifier">Cardano.Ledger.Address</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#rewardAccountCredentialL"><span class="hs-identifier">rewardAccountCredentialL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-124"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#isSJust"><span class="hs-identifier">isSJust</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#isSNothing"><span class="hs-identifier">isSNothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#strictMaybe"><span class="hs-identifier">strictMaybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.html"><span class="hs-identifier">Cardano.Ledger.Binary</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier">DecCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#DecShareCBOR"><span class="hs-identifier">DecShareCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier">EncCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier">Interns</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeListLenOrIndef"><span class="hs-identifier">decodeListLenOrIndef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeListLikeWithCountT"><span class="hs-identifier">decodeListLikeWithCountT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeRecordNamedT"><span class="hs-identifier">decodeRecordNamedT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier">CompactForm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier">CompactCoin</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#addCompactCoin"><span class="hs-identifier">addCompactCoin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html"><span class="hs-identifier">Cardano.Ledger.Compactible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#toCompact"><span class="hs-identifier">toCompact</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html"><span class="hs-identifier">Cardano.Ledger.Conway.Governance.Procedures</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.html"><span class="hs-identifier">Cardano.Ledger.Core</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier">Credential</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.DeepSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NFData</span></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">assert</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unless</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.html"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier">ToJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.html"><span class="hs-identifier">Data.Default</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier">Default</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">F</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Foldable</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldl'</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">foldrM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html"><span class="hs-identifier">Data.OMap.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OM</span></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html"><span class="hs-identifier">Data.OMap.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OMap</span></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OSet.Strict.html"><span class="hs-identifier">Data.OSet.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OSet</span></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.Pulse.html"><span class="hs-identifier">Data.Pulse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.Pulse.html#foldlM%27"><span class="hs-identifier">foldlM'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Seq</span></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html"><span class="hs-identifier">Data.Sequence.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#StrictSeq"><span class="hs-identifier">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Tree</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Void</span></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Generics</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Generic</span></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.Stack</span></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html"><span class="hs-identifier">Lens.Micro</span></a></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html"><span class="hs-identifier">NoThunks.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier">NoThunks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">-- | The root of a single `Proposals` tree. `prRoot` is always expected</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- to be equal to the respective `PrevGovActionId` at the end of every</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- epoch boundary</span><span>
</span><span id="line-173"></span><span class="hs-keyword">data</span><span> </span><span id="PRoot"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-var">PRoot</span></a></span></span><span> </span><span id="local-6989586621679606517"><span class="annot"><a href="#local-6989586621679606517"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PRoot"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-var">PRoot</span></a></span></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="prRoot"><span class="annot"><span class="annottext">forall a. PRoot a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var hs-var">prRoot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606517"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="prChildren"><span class="annot"><span class="annottext">forall a. PRoot a -&gt; Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildren"><span class="hs-identifier hs-var hs-var">prChildren</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679606517"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607242"><span id="local-6989586621679607250"><span id="local-6989586621679607254"><span class="annot"><span class="annottext">Int -&gt; PRoot a -&gt; ShowS
[PRoot a] -&gt; ShowS
PRoot a -&gt; String
(Int -&gt; PRoot a -&gt; ShowS)
-&gt; (PRoot a -&gt; String) -&gt; ([PRoot a] -&gt; ShowS) -&gt; Show (PRoot a)
forall a. Show a =&gt; Int -&gt; PRoot a -&gt; ShowS
forall a. Show a =&gt; [PRoot a] -&gt; ShowS
forall a. Show a =&gt; PRoot a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; PRoot a -&gt; ShowS
showsPrec :: Int -&gt; PRoot a -&gt; ShowS
$cshow :: forall a. Show a =&gt; PRoot a -&gt; String
show :: PRoot a -&gt; String
$cshowList :: forall a. Show a =&gt; [PRoot a] -&gt; ShowS
showList :: [PRoot a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607259"><span id="local-6989586621679607265"><span class="annot"><span class="annottext">PRoot a -&gt; PRoot a -&gt; Bool
(PRoot a -&gt; PRoot a -&gt; Bool)
-&gt; (PRoot a -&gt; PRoot a -&gt; Bool) -&gt; Eq (PRoot a)
forall a. Eq a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
== :: PRoot a -&gt; PRoot a -&gt; Bool
$c/= :: forall a. Eq a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
/= :: PRoot a -&gt; PRoot a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607274"><span id="local-6989586621679607280"><span id="local-6989586621679607284"><span id="local-6989586621679607288"><span id="local-6989586621679607291"><span id="local-6989586621679607294"><span id="local-6989586621679607297"><span class="annot"><span class="annottext">Eq (PRoot a)
Eq (PRoot a) =&gt;
(PRoot a -&gt; PRoot a -&gt; Ordering)
-&gt; (PRoot a -&gt; PRoot a -&gt; Bool)
-&gt; (PRoot a -&gt; PRoot a -&gt; Bool)
-&gt; (PRoot a -&gt; PRoot a -&gt; Bool)
-&gt; (PRoot a -&gt; PRoot a -&gt; Bool)
-&gt; (PRoot a -&gt; PRoot a -&gt; PRoot a)
-&gt; (PRoot a -&gt; PRoot a -&gt; PRoot a)
-&gt; Ord (PRoot a)
PRoot a -&gt; PRoot a -&gt; Bool
PRoot a -&gt; PRoot a -&gt; Ordering
PRoot a -&gt; PRoot a -&gt; PRoot a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (PRoot a)
forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; Ordering
forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; PRoot a
$ccompare :: forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; Ordering
compare :: PRoot a -&gt; PRoot a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
&lt; :: PRoot a -&gt; PRoot a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
&lt;= :: PRoot a -&gt; PRoot a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
&gt; :: PRoot a -&gt; PRoot a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; Bool
&gt;= :: PRoot a -&gt; PRoot a -&gt; Bool
$cmax :: forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; PRoot a
max :: PRoot a -&gt; PRoot a -&gt; PRoot a
$cmin :: forall a. Ord a =&gt; PRoot a -&gt; PRoot a -&gt; PRoot a
min :: PRoot a -&gt; PRoot a -&gt; PRoot a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607302"><span id="local-6989586621679607304"><span class="annot"><span class="annottext">(forall x. PRoot a -&gt; Rep (PRoot a) x)
-&gt; (forall x. Rep (PRoot a) x -&gt; PRoot a) -&gt; Generic (PRoot a)
forall x. Rep (PRoot a) x -&gt; PRoot a
forall x. PRoot a -&gt; Rep (PRoot a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (PRoot a) x -&gt; PRoot a
forall a x. PRoot a -&gt; Rep (PRoot a) x
$cfrom :: forall a x. PRoot a -&gt; Rep (PRoot a) x
from :: forall x. PRoot a -&gt; Rep (PRoot a) x
$cto :: forall a x. Rep (PRoot a) x -&gt; PRoot a
to :: forall x. Rep (PRoot a) x -&gt; PRoot a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607309"><span id="local-6989586621679607313"><span id="local-6989586621679607319"><span class="annot"><span class="annottext">Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo)
Proxy (PRoot a) -&gt; String
(Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (PRoot a) -&gt; String)
-&gt; NoThunks (PRoot a)
forall a. NoThunks a =&gt; Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo)
forall a. NoThunks a =&gt; Proxy (PRoot a) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: forall a. NoThunks a =&gt; Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall a. NoThunks a =&gt; Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; PRoot a -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall a. NoThunks a =&gt; Proxy (PRoot a) -&gt; String
showTypeOf :: Proxy (PRoot a) -&gt; String
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607357"><span class="annot"><span class="annottext">PRoot a -&gt; ()
(PRoot a -&gt; ()) -&gt; NFData (PRoot a)
forall a. NFData a =&gt; PRoot a -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: forall a. NFData a =&gt; PRoot a -&gt; ()
rnf :: PRoot a -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607378"><span class="annot"><span class="annottext">PRoot a
PRoot a -&gt; Default (PRoot a)
forall a. PRoot a
forall a. a -&gt; Default a
$cdef :: forall a. PRoot a
def :: PRoot a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-var hs-var hs-var hs-var">Default</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="annot"><span class="hs-comment">-- | Map a function over the values in the `PRoot`.</span></span><span>
</span><span id="line-181"></span><span id="local-6989586621679606619"><span id="local-6989586621679606620"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mapPRoot"><span class="hs-identifier hs-type">mapPRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679606619"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679606620"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679606619"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606620"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606619"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-182"></span><span id="mapPRoot"><span class="annot"><span class="annottext">mapPRoot :: forall b a. Ord b =&gt; (a -&gt; b) -&gt; PRoot a -&gt; PRoot b
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mapPRoot"><span class="hs-identifier hs-var hs-var">mapPRoot</span></a></span></span><span> </span><span id="local-6989586621679607402"><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679607402"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679607403"><span id="local-6989586621679607404"><span class="annot"><span class="annottext">Set a
StrictMaybe a
prRoot :: forall a. PRoot a -&gt; StrictMaybe a
prChildren :: forall a. PRoot a -&gt; Set a
prRoot :: StrictMaybe a
prChildren :: Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">prRoot :: StrictMaybe b
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679607402"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; StrictMaybe a -&gt; StrictMaybe b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679607403"><span class="hs-identifier hs-var">prRoot</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">prChildren :: Set b
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildren"><span class="hs-identifier hs-var">prChildren</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; Set a -&gt; Set b
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679607402"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679607404"><span class="hs-identifier hs-var">prChildren</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- | A non-root edges in a `Proposals` tree. `peParent` is expected to be</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- a `SNothing` only at the begining when no governance actions has been</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- enacted yet.</span><span>
</span><span id="line-191"></span><span class="hs-keyword">data</span><span> </span><span id="PEdges"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-var">PEdges</span></a></span></span><span> </span><span id="local-6989586621679606628"><span class="annot"><a href="#local-6989586621679606628"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PEdges"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-var">PEdges</span></a></span></span><span>
</span><span id="line-192"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="peParent"><span class="annot"><span class="annottext">forall a. PEdges a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peParent"><span class="hs-identifier hs-var hs-var">peParent</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606628"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="peChildren"><span class="annot"><span class="annottext">forall a. PEdges a -&gt; Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildren"><span class="hs-identifier hs-var hs-var">peChildren</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679606628"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-195"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607413"><span id="local-6989586621679607418"><span id="local-6989586621679607422"><span class="annot"><span class="annottext">Int -&gt; PEdges a -&gt; ShowS
[PEdges a] -&gt; ShowS
PEdges a -&gt; String
(Int -&gt; PEdges a -&gt; ShowS)
-&gt; (PEdges a -&gt; String) -&gt; ([PEdges a] -&gt; ShowS) -&gt; Show (PEdges a)
forall a. Show a =&gt; Int -&gt; PEdges a -&gt; ShowS
forall a. Show a =&gt; [PEdges a] -&gt; ShowS
forall a. Show a =&gt; PEdges a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; PEdges a -&gt; ShowS
showsPrec :: Int -&gt; PEdges a -&gt; ShowS
$cshow :: forall a. Show a =&gt; PEdges a -&gt; String
show :: PEdges a -&gt; String
$cshowList :: forall a. Show a =&gt; [PEdges a] -&gt; ShowS
showList :: [PEdges a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607426"><span id="local-6989586621679607430"><span class="annot"><span class="annottext">PEdges a -&gt; PEdges a -&gt; Bool
(PEdges a -&gt; PEdges a -&gt; Bool)
-&gt; (PEdges a -&gt; PEdges a -&gt; Bool) -&gt; Eq (PEdges a)
forall a. Eq a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
== :: PEdges a -&gt; PEdges a -&gt; Bool
$c/= :: forall a. Eq a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
/= :: PEdges a -&gt; PEdges a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607438"><span id="local-6989586621679607442"><span id="local-6989586621679607446"><span id="local-6989586621679607450"><span id="local-6989586621679607453"><span id="local-6989586621679607456"><span id="local-6989586621679607459"><span class="annot"><span class="annottext">Eq (PEdges a)
Eq (PEdges a) =&gt;
(PEdges a -&gt; PEdges a -&gt; Ordering)
-&gt; (PEdges a -&gt; PEdges a -&gt; Bool)
-&gt; (PEdges a -&gt; PEdges a -&gt; Bool)
-&gt; (PEdges a -&gt; PEdges a -&gt; Bool)
-&gt; (PEdges a -&gt; PEdges a -&gt; Bool)
-&gt; (PEdges a -&gt; PEdges a -&gt; PEdges a)
-&gt; (PEdges a -&gt; PEdges a -&gt; PEdges a)
-&gt; Ord (PEdges a)
PEdges a -&gt; PEdges a -&gt; Bool
PEdges a -&gt; PEdges a -&gt; Ordering
PEdges a -&gt; PEdges a -&gt; PEdges a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (PEdges a)
forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; Ordering
forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; PEdges a
$ccompare :: forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; Ordering
compare :: PEdges a -&gt; PEdges a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
&lt; :: PEdges a -&gt; PEdges a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
&lt;= :: PEdges a -&gt; PEdges a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
&gt; :: PEdges a -&gt; PEdges a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; Bool
&gt;= :: PEdges a -&gt; PEdges a -&gt; Bool
$cmax :: forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; PEdges a
max :: PEdges a -&gt; PEdges a -&gt; PEdges a
$cmin :: forall a. Ord a =&gt; PEdges a -&gt; PEdges a -&gt; PEdges a
min :: PEdges a -&gt; PEdges a -&gt; PEdges a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607462"><span id="local-6989586621679607464"><span class="annot"><span class="annottext">(forall x. PEdges a -&gt; Rep (PEdges a) x)
-&gt; (forall x. Rep (PEdges a) x -&gt; PEdges a) -&gt; Generic (PEdges a)
forall x. Rep (PEdges a) x -&gt; PEdges a
forall x. PEdges a -&gt; Rep (PEdges a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (PEdges a) x -&gt; PEdges a
forall a x. PEdges a -&gt; Rep (PEdges a) x
$cfrom :: forall a x. PEdges a -&gt; Rep (PEdges a) x
from :: forall x. PEdges a -&gt; Rep (PEdges a) x
$cto :: forall a x. Rep (PEdges a) x -&gt; PEdges a
to :: forall x. Rep (PEdges a) x -&gt; PEdges a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607468"><span id="local-6989586621679607472"><span id="local-6989586621679607478"><span class="annot"><span class="annottext">Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo)
Proxy (PEdges a) -&gt; String
(Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (PEdges a) -&gt; String)
-&gt; NoThunks (PEdges a)
forall a. NoThunks a =&gt; Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo)
forall a. NoThunks a =&gt; Proxy (PEdges a) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: forall a. NoThunks a =&gt; Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall a. NoThunks a =&gt; Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; PEdges a -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall a. NoThunks a =&gt; Proxy (PEdges a) -&gt; String
showTypeOf :: Proxy (PEdges a) -&gt; String
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607504"><span class="annot"><span class="annottext">PEdges a -&gt; ()
(PEdges a -&gt; ()) -&gt; NFData (PEdges a)
forall a. NFData a =&gt; PEdges a -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: forall a. NFData a =&gt; PEdges a -&gt; ()
rnf :: PEdges a -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607519"><span class="annot"><span class="annottext">PEdges a
PEdges a -&gt; Default (PEdges a)
forall a. PEdges a
forall a. a -&gt; Default a
$cdef :: forall a. PEdges a
def :: PEdges a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-var hs-var hs-var hs-var">Default</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-comment">-- | A single proposal-tree. This map represents all the action-ids that</span><span>
</span><span id="line-199"></span><span class="hs-comment">-- form a tree.</span><span>
</span><span id="line-200"></span><span class="hs-keyword">newtype</span><span> </span><span id="PGraph"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier hs-var">PGraph</span></a></span></span><span> </span><span id="local-6989586621679606646"><span class="annot"><a href="#local-6989586621679606646"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PGraph"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier hs-var">PGraph</span></a></span></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="unPGraph"><span class="annot"><span class="annottext">forall a. PGraph a -&gt; Map a (PEdges a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unPGraph"><span class="hs-identifier hs-var hs-var">unPGraph</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679606646"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-type">PEdges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606646"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607537"><span id="local-6989586621679607543"><span id="local-6989586621679607547"><span class="annot"><span class="annottext">Int -&gt; PGraph a -&gt; ShowS
[PGraph a] -&gt; ShowS
PGraph a -&gt; String
(Int -&gt; PGraph a -&gt; ShowS)
-&gt; (PGraph a -&gt; String) -&gt; ([PGraph a] -&gt; ShowS) -&gt; Show (PGraph a)
forall a. Show a =&gt; Int -&gt; PGraph a -&gt; ShowS
forall a. Show a =&gt; [PGraph a] -&gt; ShowS
forall a. Show a =&gt; PGraph a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; PGraph a -&gt; ShowS
showsPrec :: Int -&gt; PGraph a -&gt; ShowS
$cshow :: forall a. Show a =&gt; PGraph a -&gt; String
show :: PGraph a -&gt; String
$cshowList :: forall a. Show a =&gt; [PGraph a] -&gt; ShowS
showList :: [PGraph a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607551"><span id="local-6989586621679607556"><span class="annot"><span class="annottext">PGraph a -&gt; PGraph a -&gt; Bool
(PGraph a -&gt; PGraph a -&gt; Bool)
-&gt; (PGraph a -&gt; PGraph a -&gt; Bool) -&gt; Eq (PGraph a)
forall a. Eq a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
== :: PGraph a -&gt; PGraph a -&gt; Bool
$c/= :: forall a. Eq a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
/= :: PGraph a -&gt; PGraph a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607564"><span id="local-6989586621679607569"><span id="local-6989586621679607573"><span id="local-6989586621679607577"><span id="local-6989586621679607580"><span id="local-6989586621679607583"><span id="local-6989586621679607586"><span class="annot"><span class="annottext">Eq (PGraph a)
Eq (PGraph a) =&gt;
(PGraph a -&gt; PGraph a -&gt; Ordering)
-&gt; (PGraph a -&gt; PGraph a -&gt; Bool)
-&gt; (PGraph a -&gt; PGraph a -&gt; Bool)
-&gt; (PGraph a -&gt; PGraph a -&gt; Bool)
-&gt; (PGraph a -&gt; PGraph a -&gt; Bool)
-&gt; (PGraph a -&gt; PGraph a -&gt; PGraph a)
-&gt; (PGraph a -&gt; PGraph a -&gt; PGraph a)
-&gt; Ord (PGraph a)
PGraph a -&gt; PGraph a -&gt; Bool
PGraph a -&gt; PGraph a -&gt; Ordering
PGraph a -&gt; PGraph a -&gt; PGraph a
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (PGraph a)
forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; Ordering
forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; PGraph a
$ccompare :: forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; Ordering
compare :: PGraph a -&gt; PGraph a -&gt; Ordering
$c&lt; :: forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
&lt; :: PGraph a -&gt; PGraph a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
&lt;= :: PGraph a -&gt; PGraph a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
&gt; :: PGraph a -&gt; PGraph a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; Bool
&gt;= :: PGraph a -&gt; PGraph a -&gt; Bool
$cmax :: forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; PGraph a
max :: PGraph a -&gt; PGraph a -&gt; PGraph a
$cmin :: forall a. Ord a =&gt; PGraph a -&gt; PGraph a -&gt; PGraph a
min :: PGraph a -&gt; PGraph a -&gt; PGraph a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607589"><span id="local-6989586621679607591"><span class="annot"><span class="annottext">(forall x. PGraph a -&gt; Rep (PGraph a) x)
-&gt; (forall x. Rep (PGraph a) x -&gt; PGraph a) -&gt; Generic (PGraph a)
forall x. Rep (PGraph a) x -&gt; PGraph a
forall x. PGraph a -&gt; Rep (PGraph a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (PGraph a) x -&gt; PGraph a
forall a x. PGraph a -&gt; Rep (PGraph a) x
$cfrom :: forall a x. PGraph a -&gt; Rep (PGraph a) x
from :: forall x. PGraph a -&gt; Rep (PGraph a) x
$cto :: forall a x. Rep (PGraph a) x -&gt; PGraph a
to :: forall x. Rep (PGraph a) x -&gt; PGraph a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607595"><span id="local-6989586621679607601"><span id="local-6989586621679607606"><span class="annot"><span class="annottext">Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo)
Proxy (PGraph a) -&gt; String
(Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (PGraph a) -&gt; String)
-&gt; NoThunks (PGraph a)
forall a. NoThunks a =&gt; Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo)
forall a. NoThunks a =&gt; Proxy (PGraph a) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: forall a. NoThunks a =&gt; Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall a. NoThunks a =&gt; Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; PGraph a -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall a. NoThunks a =&gt; Proxy (PGraph a) -&gt; String
showTypeOf :: Proxy (PGraph a) -&gt; String
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607613"><span class="annot"><span class="annottext">PGraph a -&gt; ()
(PGraph a -&gt; ()) -&gt; NFData (PGraph a)
forall a. NFData a =&gt; PGraph a -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: forall a. NFData a =&gt; PGraph a -&gt; ()
rnf :: PGraph a -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607620"><span class="annot"><span class="annottext">PGraph a
PGraph a -&gt; Default (PGraph a)
forall a. PGraph a
forall a. a -&gt; Default a
$cdef :: forall a. PGraph a
def :: PGraph a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-var hs-var hs-var hs-var">Default</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span id="local-6989586621679606680"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRootL"><span class="hs-identifier hs-type">prRootL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606680"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606680"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-207"></span><span id="prRootL"><span class="annot"><span class="annottext">prRootL :: forall a (f :: * -&gt; *).
Functor f =&gt;
(StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRootL"><span class="hs-identifier hs-var hs-var">prRootL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PRoot a -&gt; StrictMaybe a)
-&gt; (PRoot a -&gt; StrictMaybe a -&gt; PRoot a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a -&gt; StrictMaybe a
forall a. PRoot a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot a -&gt; StrictMaybe a -&gt; PRoot a)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a))
-&gt; (PRoot a -&gt; StrictMaybe a -&gt; PRoot a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607628"><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679607628"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679607629"><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679607629"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679607628"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679607629"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span id="local-6989586621679606692"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildrenL"><span class="hs-identifier hs-type">prChildrenL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679606692"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-210"></span><span id="prChildrenL"><span class="annot"><span class="annottext">prChildrenL :: forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildrenL"><span class="hs-identifier hs-var hs-var">prChildrenL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PRoot a -&gt; Set a)
-&gt; (PRoot a -&gt; Set a -&gt; PRoot a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a -&gt; Set a
forall a. PRoot a -&gt; Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildren"><span class="hs-identifier hs-var">prChildren</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot a -&gt; Set a -&gt; PRoot a)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a))
-&gt; (PRoot a -&gt; Set a -&gt; PRoot a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607632"><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679607632"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679607633"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679607633"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679607632"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildren"><span class="hs-identifier hs-var">prChildren</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679607633"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span id="local-6989586621679606696"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildrenL"><span class="hs-identifier hs-type">peChildrenL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-type">PEdges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679606696"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-213"></span><span id="peChildrenL"><span class="annot"><span class="annottext">peChildrenL :: forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PEdges a -&gt; f (PEdges a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildrenL"><span class="hs-identifier hs-var hs-var">peChildrenL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PEdges a -&gt; Set a)
-&gt; (PEdges a -&gt; Set a -&gt; PEdges a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (Set a -&gt; f (Set a)) -&gt; PEdges a -&gt; f (PEdges a)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">PEdges a -&gt; Set a
forall a. PEdges a -&gt; Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildren"><span class="hs-identifier hs-var">peChildren</span></a></span><span> </span><span class="annot"><span class="annottext">((PEdges a -&gt; Set a -&gt; PEdges a)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (Set a -&gt; f (Set a)) -&gt; PEdges a -&gt; f (PEdges a))
-&gt; (PEdges a -&gt; Set a -&gt; PEdges a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (Set a -&gt; f (Set a)) -&gt; PEdges a -&gt; f (PEdges a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607636"><span class="annot"><span class="annottext">PEdges a
</span><a href="#local-6989586621679607636"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679607637"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679607637"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PEdges a
</span><a href="#local-6989586621679607636"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildren"><span class="hs-identifier hs-var">peChildren</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679607637"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-214"></span><span>
</span><span id="line-215"></span><span id="local-6989586621679606700"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-type">pGraphNodesL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier hs-type">PGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606700"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679606700"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-type">PEdges</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606700"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-216"></span><span id="pGraphNodesL"><span class="annot"><span class="annottext">pGraphNodesL :: forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var hs-var">pGraphNodesL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PGraph a -&gt; Map a (PEdges a))
-&gt; (PGraph a -&gt; Map a (PEdges a) -&gt; PGraph a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (Map a (PEdges a) -&gt; f (Map a (PEdges a)))
   -&gt; PGraph a -&gt; f (PGraph a)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">PGraph a -&gt; Map a (PEdges a)
forall a. PGraph a -&gt; Map a (PEdges a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unPGraph"><span class="hs-identifier hs-var">unPGraph</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph a -&gt; Map a (PEdges a) -&gt; PGraph a)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (Map a (PEdges a) -&gt; f (Map a (PEdges a)))
    -&gt; PGraph a -&gt; f (PGraph a))
-&gt; (PGraph a -&gt; Map a (PEdges a) -&gt; PGraph a)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (Map a (PEdges a) -&gt; f (Map a (PEdges a)))
   -&gt; PGraph a -&gt; f (PGraph a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607640"><span class="annot"><span class="annottext">PGraph a
</span><a href="#local-6989586621679607640"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679607641"><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679607641"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PGraph a
</span><a href="#local-6989586621679607640"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unPGraph"><span class="hs-identifier hs-var">unPGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679607641"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-comment">-- | Self-contained representation of all 4 proposals trees. This forest</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- is made up of only action-ids for nodes - full `GovActionState`s are</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- stored only once in the `OMap`. All functions in this module prefixed</span><span>
</span><span id="line-221"></span><span class="hs-comment">-- with the string @proposals-@ operate on this data-type keeping it</span><span>
</span><span id="line-222"></span><span class="hs-comment">-- consistent.</span><span>
</span><span id="line-223"></span><span class="hs-comment">--</span><span>
</span><span id="line-224"></span><span class="hs-comment">-- NOTE: The correct way to think about this data-structure is similar</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- to 4 of the following, one for each @`GovActionPurpose`@</span><span>
</span><span id="line-226"></span><span class="hs-comment">--</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-228"></span><span class="hs-comment">--   data Tree a = Node (StrictMaybe a) [Tree a]</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-230"></span><span class="hs-comment">--</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- but because this does not allow us to look-up a node's edges in</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- predictable time, we use a map from nodes to their edges (parent and</span><span>
</span><span id="line-233"></span><span class="hs-comment">-- children) to capture the graph (@`PGraph`@). We also need to always</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- know the roots of the 4 trees, and those we store in the @`PRoot`@</span><span>
</span><span id="line-235"></span><span class="hs-comment">--</span><span>
</span><span id="line-236"></span><span class="hs-comment">-- NOTE: At the end of an epoch boundary, we expect @`pRoots`@ to be the same</span><span>
</span><span id="line-237"></span><span class="hs-comment">-- as the @`PrevGovActionIds`@ from the @`EnactState`@</span><span>
</span><span id="line-238"></span><span class="hs-keyword">data</span><span> </span><span id="Proposals"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-var">Proposals</span></a></span></span><span> </span><span id="local-6989586621679606704"><span class="annot"><a href="#local-6989586621679606704"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Proposals"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-var">Proposals</span></a></span></span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="pProps"><span class="annot"><span class="annottext">forall era. Proposals era -&gt; OMap GovActionId (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var hs-var">pProps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#OMap"><span class="hs-identifier hs-type">OMap.OMap</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606704"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="pRoots"><span class="annot"><span class="annottext">forall era. Proposals era -&gt; GovRelation PRoot
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRoots"><span class="hs-identifier hs-var hs-var">pRoots</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="pGraph"><span class="annot"><span class="annottext">forall era. Proposals era -&gt; GovRelation PGraph
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraph"><span class="hs-identifier hs-var hs-var">pGraph</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier hs-type">PGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607648"><span id="local-6989586621679607661"><span id="local-6989586621679607665"><span class="annot"><span class="annottext">Int -&gt; Proposals era -&gt; ShowS
[Proposals era] -&gt; ShowS
Proposals era -&gt; String
(Int -&gt; Proposals era -&gt; ShowS)
-&gt; (Proposals era -&gt; String)
-&gt; ([Proposals era] -&gt; ShowS)
-&gt; Show (Proposals era)
forall era. EraPParams era =&gt; Int -&gt; Proposals era -&gt; ShowS
forall era. EraPParams era =&gt; [Proposals era] -&gt; ShowS
forall era. EraPParams era =&gt; Proposals era -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall era. EraPParams era =&gt; Int -&gt; Proposals era -&gt; ShowS
showsPrec :: Int -&gt; Proposals era -&gt; ShowS
$cshow :: forall era. EraPParams era =&gt; Proposals era -&gt; String
show :: Proposals era -&gt; String
$cshowList :: forall era. EraPParams era =&gt; [Proposals era] -&gt; ShowS
showList :: [Proposals era] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607672"><span id="local-6989586621679607683"><span class="annot"><span class="annottext">Proposals era -&gt; Proposals era -&gt; Bool
(Proposals era -&gt; Proposals era -&gt; Bool)
-&gt; (Proposals era -&gt; Proposals era -&gt; Bool) -&gt; Eq (Proposals era)
forall era.
EraPParams era =&gt;
Proposals era -&gt; Proposals era -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall era.
EraPParams era =&gt;
Proposals era -&gt; Proposals era -&gt; Bool
== :: Proposals era -&gt; Proposals era -&gt; Bool
$c/= :: forall era.
EraPParams era =&gt;
Proposals era -&gt; Proposals era -&gt; Bool
/= :: Proposals era -&gt; Proposals era -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607689"><span id="local-6989586621679607691"><span class="annot"><span class="annottext">(forall x. Proposals era -&gt; Rep (Proposals era) x)
-&gt; (forall x. Rep (Proposals era) x -&gt; Proposals era)
-&gt; Generic (Proposals era)
forall x. Rep (Proposals era) x -&gt; Proposals era
forall x. Proposals era -&gt; Rep (Proposals era) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall era x. Rep (Proposals era) x -&gt; Proposals era
forall era x. Proposals era -&gt; Rep (Proposals era) x
$cfrom :: forall era x. Proposals era -&gt; Rep (Proposals era) x
from :: forall x. Proposals era -&gt; Rep (Proposals era) x
$cto :: forall era x. Rep (Proposals era) x -&gt; Proposals era
to :: forall x. Rep (Proposals era) x -&gt; Proposals era
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679607695"><span id="local-6989586621679607699"><span id="local-6989586621679607705"><span class="annot"><span class="annottext">Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo)
Proxy (Proposals era) -&gt; String
(Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy (Proposals era) -&gt; String)
-&gt; NoThunks (Proposals era)
forall era.
EraPParams era =&gt;
Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo)
forall era. EraPParams era =&gt; Proxy (Proposals era) -&gt; String
forall a.
(Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Context -&gt; a -&gt; IO (Maybe ThunkInfo))
-&gt; (Proxy a -&gt; String)
-&gt; NoThunks a
$cnoThunks :: forall era.
EraPParams era =&gt;
Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo)
noThunks :: Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo)
$cwNoThunks :: forall era.
EraPParams era =&gt;
Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo)
wNoThunks :: Context -&gt; Proposals era -&gt; IO (Maybe ThunkInfo)
$cshowTypeOf :: forall era. EraPParams era =&gt; Proxy (Proposals era) -&gt; String
showTypeOf :: Proxy (Proposals era) -&gt; String
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/nothunks-0.2.1.1-0663c3283fb5dee9e67d41860072fab0227b6d69ef882303baddf309058f8618/share/doc/html/src/NoThunks.Class.html#NoThunks"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">NoThunks</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607746"><span class="annot"><span class="annottext">Proposals era -&gt; ()
(Proposals era -&gt; ()) -&gt; NFData (Proposals era)
forall era. EraPParams era =&gt; Proposals era -&gt; ()
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: forall era. EraPParams era =&gt; Proposals era -&gt; ()
rnf :: Proposals era -&gt; ()
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">NFData</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607773"><span class="annot"><span class="annottext">Proposals era
Proposals era -&gt; Default (Proposals era)
forall era. Proposals era
forall a. a -&gt; Default a
$cdef :: forall era. Proposals era
def :: Proposals era
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#Default"><span class="hs-identifier hs-var hs-var hs-var hs-var">Default</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span id="local-6989586621679606752"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#translateProposals"><span class="hs-identifier hs-type">translateProposals</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslateEra"><span class="hs-identifier hs-type">TranslateEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606752"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslationError"><span class="hs-identifier hs-type">TranslationError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606752"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-249"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-250"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#TranslationContext"><span class="hs-identifier hs-type">TranslationContext</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606752"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/l/internal/doc/html/cardano-ledger-core/src/Cardano.Ledger.Internal.Definition.Era.html#PreviousEra"><span class="hs-identifier hs-type">PreviousEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606752"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606752"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-251"></span><span id="translateProposals"><span class="annot"><span class="annottext">translateProposals :: forall era.
(TranslateEra era GovActionState,
 TranslationError era GovActionState ~ Void) =&gt;
TranslationContext era
-&gt; Proposals (PreviousEra era) -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#translateProposals"><span class="hs-identifier hs-var hs-var">translateProposals</span></a></span></span><span> </span><span id="local-6989586621679607808"><span class="annot"><span class="annottext">TranslationContext era
</span><a href="#local-6989586621679607808"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679607809"><span id="local-6989586621679607810"><span id="local-6989586621679607811"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState (PreviousEra era))
GovRelation PGraph
GovRelation PRoot
pRoots :: forall era. Proposals era -&gt; GovRelation PRoot
pProps :: forall era. Proposals era -&gt; OMap GovActionId (GovActionState era)
pGraph :: forall era. Proposals era -&gt; GovRelation PGraph
pProps :: OMap GovActionId (GovActionState (PreviousEra era))
pRoots :: GovRelation PRoot
pGraph :: GovRelation PGraph
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRoots"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>  </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; GovRelation PRoot -&gt; GovRelation PGraph -&gt; Proposals era
forall era.
OMap GovActionId (GovActionState era)
-&gt; GovRelation PRoot -&gt; GovRelation PGraph -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-var">Proposals</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GovActionState (PreviousEra era)
 -&gt; OMap GovActionId (GovActionState era)
 -&gt; OMap GovActionId (GovActionState era))
-&gt; OMap GovActionId (GovActionState era)
-&gt; OMap GovActionId (GovActionState (PreviousEra era))
-&gt; OMap GovActionId (GovActionState era)
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; OMap GovActionId a -&gt; b
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr'</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679607813"><span class="annot"><span class="annottext">GovActionState (PreviousEra era)
</span><a href="#local-6989586621679607813"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TranslationContext era
-&gt; GovActionState (PreviousEra era) -&gt; GovActionState era
forall era (f :: * -&gt; *).
(TranslateEra era f, TranslationError era f ~ Void) =&gt;
TranslationContext era -&gt; f (PreviousEra era) -&gt; f era
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Translation.html#translateEra%27"><span class="hs-identifier hs-var">translateEra'</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationContext era
</span><a href="#local-6989586621679607808"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState (PreviousEra era)
</span><a href="#local-6989586621679607813"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; OMap GovActionId (GovActionState era)
-&gt; OMap GovActionId (GovActionState era)
forall k v. HasOKey k v =&gt; v -&gt; OMap k v -&gt; OMap k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#%3C%7C"><span class="hs-operator hs-var">OM.&lt;|</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState (PreviousEra era))
</span><a href="#local-6989586621679607809"><span class="hs-identifier hs-var">pProps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679607810"><span class="hs-identifier hs-var">pRoots</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679607811"><span class="hs-identifier hs-var">pGraph</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><span class="hs-comment">-- | Make sure not to change the `gasId`, otherwise all hell will break loose.</span></span><span>
</span><span id="line-258"></span><span id="local-6989586621679606771"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mapProposals"><span class="hs-identifier hs-type">mapProposals</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606771"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606771"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606771"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606771"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-259"></span><span id="mapProposals"><span class="annot"><span class="annottext">mapProposals :: forall era.
(GovActionState era -&gt; GovActionState era)
-&gt; Proposals era -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mapProposals"><span class="hs-identifier hs-var hs-var">mapProposals</span></a></span></span><span> </span><span id="local-6989586621679607817"><span class="annot"><span class="annottext">GovActionState era -&gt; GovActionState era
</span><a href="#local-6989586621679607817"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679607818"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607818"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607818"><span class="hs-identifier hs-var">props</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var">pProps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#mapUnsafe"><span class="hs-identifier hs-type">OMap.mapUnsafe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607817"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var">pProps</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607818"><span class="hs-identifier hs-type">props</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span id="local-6989586621679606776"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-type">pPropsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606776"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#OMap"><span class="hs-identifier hs-type">OMap.OMap</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606776"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-262"></span><span id="pPropsL"><span class="annot"><span class="annottext">pPropsL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var hs-var">pPropsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; OMap GovActionId (GovActionState era))
-&gt; (Proposals era
    -&gt; OMap GovActionId (GovActionState era) -&gt; Proposals era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (OMap GovActionId (GovActionState era)
    -&gt; f (OMap GovActionId (GovActionState era)))
   -&gt; Proposals era -&gt; f (Proposals era)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; OMap GovActionId (GovActionState era)
forall era. Proposals era -&gt; OMap GovActionId (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var">pProps</span></a></span><span> </span><span class="annot"><span class="annottext">((Proposals era
  -&gt; OMap GovActionId (GovActionState era) -&gt; Proposals era)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (OMap GovActionId (GovActionState era)
     -&gt; f (OMap GovActionId (GovActionState era)))
    -&gt; Proposals era -&gt; f (Proposals era))
-&gt; (Proposals era
    -&gt; OMap GovActionId (GovActionState era) -&gt; Proposals era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (OMap GovActionId (GovActionState era)
    -&gt; f (OMap GovActionId (GovActionState era)))
   -&gt; Proposals era -&gt; f (Proposals era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607822"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607822"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679607823"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607823"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607822"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var">pProps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679607823"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span id="local-6989586621679606780"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-type">pRootsL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606780"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-265"></span><span id="pRootsL"><span class="annot"><span class="annottext">pRootsL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var hs-var">pRootsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; GovRelation PRoot)
-&gt; (Proposals era -&gt; GovRelation PRoot -&gt; Proposals era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (GovRelation PRoot -&gt; f (GovRelation PRoot))
   -&gt; Proposals era -&gt; f (Proposals era)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; GovRelation PRoot
forall era. Proposals era -&gt; GovRelation PRoot
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRoots"><span class="hs-identifier hs-var">pRoots</span></a></span><span> </span><span class="annot"><span class="annottext">((Proposals era -&gt; GovRelation PRoot -&gt; Proposals era)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (GovRelation PRoot -&gt; f (GovRelation PRoot))
    -&gt; Proposals era -&gt; f (Proposals era))
-&gt; (Proposals era -&gt; GovRelation PRoot -&gt; Proposals era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (GovRelation PRoot -&gt; f (GovRelation PRoot))
   -&gt; Proposals era -&gt; f (Proposals era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607826"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607826"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679607827"><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679607827"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607826"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRoots"><span class="hs-identifier hs-var">pRoots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679607827"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span id="local-6989586621679606784"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-type">pGraphL</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606784"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier hs-type">PGraph</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-268"></span><span id="pGraphL"><span class="annot"><span class="annottext">pGraphL :: forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var hs-var">pGraphL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; GovRelation PGraph)
-&gt; (Proposals era -&gt; GovRelation PGraph -&gt; Proposals era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (GovRelation PGraph -&gt; f (GovRelation PGraph))
   -&gt; Proposals era -&gt; f (Proposals era)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#lens"><span class="hs-identifier hs-var">lens</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; GovRelation PGraph
forall era. Proposals era -&gt; GovRelation PGraph
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraph"><span class="hs-identifier hs-var">pGraph</span></a></span><span> </span><span class="annot"><span class="annottext">((Proposals era -&gt; GovRelation PGraph -&gt; Proposals era)
 -&gt; forall {f :: * -&gt; *}.
    Functor f =&gt;
    (GovRelation PGraph -&gt; f (GovRelation PGraph))
    -&gt; Proposals era -&gt; f (Proposals era))
-&gt; (Proposals era -&gt; GovRelation PGraph -&gt; Proposals era)
-&gt; forall {f :: * -&gt; *}.
   Functor f =&gt;
   (GovRelation PGraph -&gt; f (GovRelation PGraph))
   -&gt; Proposals era -&gt; f (Proposals era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607830"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607830"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679607831"><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679607831"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607830"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraph"><span class="hs-identifier hs-var">pGraph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679607831"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-269"></span><span>
</span><span id="line-270"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679606793"><span id="local-6989586621679607836"><span id="local-6989586621679607840"><span id="local-6989586621679607843"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606793"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#ToJSON"><span class="hs-identifier hs-type">ToJSON</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606793"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-271"></span><span>  </span><span id="local-6989586621679607851"><span class="annot"><span class="annottext">toJSON :: Proposals era -&gt; Value
</span><a href="#local-6989586621679607851"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era) -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toJSON"><span class="hs-identifier hs-var">toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era) -&gt; Value)
-&gt; (Proposals era -&gt; OMap GovActionId (GovActionState era))
-&gt; Proposals era
-&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; OMap GovActionId (GovActionState era)
forall era. Proposals era -&gt; OMap GovActionId (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var">pProps</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span id="local-6989586621679607857"><span class="annot"><span class="annottext">toEncoding :: Proposals era -&gt; Encoding
</span><a href="#local-6989586621679607857"><span class="hs-identifier hs-var hs-var hs-var hs-var">toEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era) -&gt; Encoding
forall a. ToJSON a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/aeson-2.2.3.0-86b3ded2a2a93d56f93497d21d3bbbb23e8718e44c9fa876ad561a4cceac08c1/share/doc/html/src/Data.Aeson.Types.ToJSON.html#toEncoding"><span class="hs-identifier hs-var">toEncoding</span></a></span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era) -&gt; Encoding)
-&gt; (Proposals era -&gt; OMap GovActionId (GovActionState era))
-&gt; Proposals era
-&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; OMap GovActionId (GovActionState era)
forall era. Proposals era -&gt; OMap GovActionId (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var">pProps</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsWithPurpose"><span class="hs-identifier hs-type">proposalsWithPurpose</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679606800"><span class="annot"><a href="#local-6989586621679606800"><span class="hs-identifier hs-type">p</span></a></span></span><span> </span><span id="local-6989586621679606803"><span class="annot"><a href="#local-6989586621679606803"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-276"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#ToGovActionPurpose"><span class="hs-identifier hs-type">ToGovActionPurpose</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606800"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679606802"><span class="annot"><a href="#local-6989586621679606802"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606802"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679606802"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606800"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-278"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606803"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606800"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606803"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span id="proposalsWithPurpose"><span class="annot"><span class="annottext">proposalsWithPurpose :: forall (p :: GovActionPurpose) era.
ToGovActionPurpose p =&gt;
(forall (f :: * -&gt; *) (f :: * -&gt; *).
 Functor f =&gt;
 (f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
 -&gt; GovRelation f -&gt; f (GovRelation f))
-&gt; Proposals era -&gt; Map (GovPurposeId p) (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsWithPurpose"><span class="hs-identifier hs-var hs-var">proposalsWithPurpose</span></a></span></span><span> </span><span id="local-6989586621679607868"><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607868"><span class="hs-identifier hs-var">propL</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679607869"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
pProps :: forall era. Proposals era -&gt; OMap GovActionId (GovActionState era)
pProps :: OMap GovActionId (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var hs-var">pProps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679607870"><span class="annot"><span class="annottext">GovRelation PGraph
pGraph :: forall era. Proposals era -&gt; GovRelation PGraph
pGraph :: GovRelation PGraph
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraph"><span class="hs-identifier hs-var hs-var">pGraph</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><span class="annottext">Map (GovPurposeId p) (GovActionState era)
-&gt; Maybe (Map (GovPurposeId p) (GovActionState era))
-&gt; Map (GovPurposeId p) (GovActionState era)
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
-&gt; Map (GovPurposeId p) (GovActionState era)
-&gt; Map (GovPurposeId p) (GovActionState era)
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Map (GovPurposeId p) (GovActionState era)
</span><a href="#local-6989586621679607871"><span class="hs-identifier hs-var">fallBackMapWithPurpose</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (Map (GovPurposeId p) (GovActionState era))
 -&gt; Map (GovPurposeId p) (GovActionState era))
-&gt; Maybe (Map (GovPurposeId p) (GovActionState era))
-&gt; Map (GovPurposeId p) (GovActionState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><span class="annottext">(GovPurposeId p
 -&gt; PEdges (GovPurposeId p) -&gt; Maybe (GovActionState era))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Maybe (Map (GovPurposeId p) (GovActionState era))
forall (t :: * -&gt; *) k a b.
Applicative t =&gt;
(k -&gt; a -&gt; t b) -&gt; Map k a -&gt; t (Map k b)
</span><span class="hs-identifier hs-var">Map.traverseWithKey</span></span><span>
</span><span id="line-283"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span id="local-6989586621679607874"><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679607874"><span class="hs-identifier hs-var">govActionId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PEdges (GovPurposeId p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GovActionId
-&gt; OMap GovActionId (GovActionState era)
-&gt; Maybe (GovActionState era)
forall k v. Ord k =&gt; k -&gt; OMap k v -&gt; Maybe v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#lookup"><span class="hs-identifier hs-var">OMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679607874"><span class="hs-identifier hs-var">govActionId</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607869"><span class="hs-identifier hs-var">pProps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PGraph (GovPurposeId p)
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall a. PGraph a -&gt; Map a (PEdges a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unPGraph"><span class="hs-identifier hs-var">unPGraph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679607870"><span class="hs-identifier hs-var">pGraph</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
-&gt; Getting
     (PGraph (GovPurposeId p))
     (GovRelation PGraph)
     (PGraph (GovPurposeId p))
-&gt; PGraph (GovPurposeId p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (PGraph (GovPurposeId p))
  (GovRelation PGraph)
  (PGraph (GovPurposeId p))
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607868"><span class="hs-identifier hs-var">propL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-286"></span><span>    </span><span class="hs-comment">-- In case there is a bug and there is an inconsistency in state we want to report in</span><span>
</span><span id="line-287"></span><span>    </span><span class="hs-comment">-- testing, while falling back onto alternative slower implementation</span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="#local-6989586621679607871"><span class="hs-identifier hs-type">fallBackMapWithPurpose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606800"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606803"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>    </span><span id="local-6989586621679607871"><span class="annot"><span class="annottext">fallBackMapWithPurpose :: Map (GovPurposeId p) (GovActionState era)
</span><a href="#local-6989586621679607871"><span class="hs-identifier hs-var hs-var">fallBackMapWithPurpose</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>      </span><span class="annot"><span class="annottext">(GovActionId -&gt; GovPurposeId p)
-&gt; Map GovActionId (GovActionState era)
-&gt; Map (GovPurposeId p) (GovActionState era)
forall k1 k2 a. (k1 -&gt; k2) -&gt; Map k1 a -&gt; Map k2 a
</span><span class="hs-identifier hs-var">Map.mapKeysMonotonic</span></span><span> </span><span class="annot"><span class="annottext">GovActionId -&gt; GovPurposeId p
forall (p :: GovActionPurpose). GovActionId -&gt; GovPurposeId p
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-var">GovPurposeId</span></a></span><span> </span><span class="annot"><span class="annottext">(Map GovActionId (GovActionState era)
 -&gt; Map (GovPurposeId p) (GovActionState era))
-&gt; Map GovActionId (GovActionState era)
-&gt; Map (GovPurposeId p) (GovActionState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-291"></span><span>        </span><span class="annot"><span class="annottext">(GovActionState era -&gt; Bool)
-&gt; Map GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (p :: GovActionPurpose) era.
ToGovActionPurpose p =&gt;
GovAction era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#isGovActionWithPurpose"><span class="hs-identifier hs-var">isGovActionWithPurpose</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679606800"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="annot"><span class="annottext">(GovAction era -&gt; Bool)
-&gt; (GovActionState era -&gt; GovAction era)
-&gt; GovActionState era
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ProposalProcedure era -&gt; GovAction era
forall era. ProposalProcedure era -&gt; GovAction era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#pProcGovAction"><span class="hs-identifier hs-var">pProcGovAction</span></a></span><span> </span><span class="annot"><span class="annottext">(ProposalProcedure era -&gt; GovAction era)
-&gt; (GovActionState era -&gt; ProposalProcedure era)
-&gt; GovActionState era
-&gt; GovAction era
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; ProposalProcedure era
forall era. GovActionState era -&gt; ProposalProcedure era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasProposalProcedure"><span class="hs-identifier hs-var">gasProposalProcedure</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
forall k v. OMap k v -&gt; Map k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#toMap"><span class="hs-identifier hs-var">OMap.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607869"><span class="hs-identifier hs-var">pProps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- | Add a single @`GovActionState`@ to the @`Proposals`@ forest.</span><span>
</span><span id="line-294"></span><span class="hs-comment">-- The tree to which it is added is picked according to its</span><span>
</span><span id="line-295"></span><span class="hs-comment">-- @`GovActionPurpose`@. Returns `Nothing` when the operation cannot</span><span>
</span><span id="line-296"></span><span class="hs-comment">-- succeed.</span><span>
</span><span id="line-297"></span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsAddAction"><span class="hs-identifier hs-type">proposalsAddAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679606833"><span class="annot"><a href="#local-6989586621679606833"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606833"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606833"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606833"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-302"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606833"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-303"></span><span id="proposalsAddAction"><span class="annot"><span class="annottext">proposalsAddAction :: forall era.
(EraPParams era, ?callStack::CallStack) =&gt;
GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsAddAction"><span class="hs-identifier hs-var hs-var">proposalsAddAction</span></a></span></span><span> </span><span id="local-6989586621679607891"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607891"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span id="local-6989586621679607892"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607892"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
forall era.
(EraPParams era, ?callStack::CallStack) =&gt;
GovActionState era
-&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#checkInvariantAfterAddition"><span class="hs-identifier hs-var">checkInvariantAfterAddition</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607891"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607892"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; Proposals era)
-&gt; Maybe (Proposals era) -&gt; Maybe (Proposals era)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
forall era.
GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#runProposalsAddAction"><span class="hs-identifier hs-var">runProposalsAddAction</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607891"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607892"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#runProposalsAddAction"><span class="hs-identifier hs-type">runProposalsAddAction</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679606836"><span class="annot"><a href="#local-6989586621679606836"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-307"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606836"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-308"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606836"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-309"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606836"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span id="runProposalsAddAction"><span class="annot"><span class="annottext">runProposalsAddAction :: forall era.
GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#runProposalsAddAction"><span class="hs-identifier hs-var hs-var">runProposalsAddAction</span></a></span></span><span> </span><span id="local-6989586621679607898"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607898"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span id="local-6989586621679607899"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607899"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Maybe (Proposals era)
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; Maybe (Proposals era))
-&gt; Maybe (Proposals era)
forall era a.
GovActionState era
-&gt; a
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; a)
-&gt; a
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#withGovActionParent"><span class="hs-identifier hs-var">withGovActionParent</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607898"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proposals era -&gt; Maybe (Proposals era)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607901"><span class="hs-identifier hs-var">psWithGas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *) (f :: * -&gt; *).
 Functor f =&gt;
 (f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
 -&gt; GovRelation f -&gt; f (GovRelation f))
-&gt; StrictMaybe (GovPurposeId p)
-&gt; GovPurposeId p
-&gt; Maybe (Proposals era)
forall (p :: GovActionPurpose).
(forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
 Functor f2 =&gt;
 (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
 -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
-&gt; StrictMaybe (GovPurposeId p)
-&gt; GovPurposeId p
-&gt; Maybe (Proposals era)
</span><a href="#local-6989586621679607902"><span class="hs-identifier hs-var">update</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-312"></span><span>    </span><span id="local-6989586621679607901"><span class="annot"><span class="annottext">psWithGas :: Proposals era
</span><a href="#local-6989586621679607901"><span class="hs-identifier hs-var hs-var">psWithGas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607899"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era)
 -&gt; Identity (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var">pPropsL</span></a></span><span> </span><span class="annot"><span class="annottext">((OMap GovActionId (GovActionState era)
  -&gt; Identity (OMap GovActionId (GovActionState era)))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; (OMap GovActionId (GovActionState era)
    -&gt; OMap GovActionId (GovActionState era))
-&gt; Proposals era
-&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; GovActionState era -&gt; OMap GovActionId (GovActionState era)
forall k v. HasOKey k v =&gt; OMap k v -&gt; v -&gt; OMap k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#%7C%7C%3E"><span class="hs-operator hs-var">OMap.||&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607898"><span class="hs-identifier hs-var">gas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-comment">-- Append a new GovActionState to the Proposals and then add it to the set of children</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- for its parent as well as initiate an empty lineage for this new child.</span><span>
</span><span id="line-315"></span><span>    </span><span id="local-6989586621679607908"><span class="annot"><a href="#local-6989586621679607902"><span class="hs-identifier hs-type">update</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-316"></span><span>      </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679606844"><span class="annot"><a href="#local-6989586621679606844"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606844"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679606844"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607908"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-317"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607908"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-318"></span><span>      </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607908"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606836"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-320"></span><span>    </span><span id="local-6989586621679607902"><span class="annot"><span class="annottext">update :: forall (p :: GovActionPurpose).
(forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
 Functor f2 =&gt;
 (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
 -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
-&gt; StrictMaybe (GovPurposeId p)
-&gt; GovPurposeId p
-&gt; Maybe (Proposals era)
</span><a href="#local-6989586621679607902"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span id="local-6989586621679607935"><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607935"><span class="hs-identifier hs-var">govRelationL</span></a></span></span><span> </span><span id="local-6989586621679607936"><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679607936"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621679607937"><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607937"><span class="hs-identifier hs-var">newId</span></a></span></span><span>
</span><span id="line-321"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679607936"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
-&gt; StrictMaybe (GovPurposeId p) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607899"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (StrictMaybe (GovPurposeId p))
     (Proposals era)
     (StrictMaybe (GovPurposeId p))
-&gt; StrictMaybe (GovPurposeId p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot
 -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
-&gt; Proposals era
-&gt; Const (StrictMaybe (GovPurposeId p)) (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot
  -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
 -&gt; Proposals era
 -&gt; Const (StrictMaybe (GovPurposeId p)) (Proposals era))
-&gt; ((StrictMaybe (GovPurposeId p)
     -&gt; Const
          (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
    -&gt; GovRelation PRoot
    -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
-&gt; Getting
     (StrictMaybe (GovPurposeId p))
     (Proposals era)
     (StrictMaybe (GovPurposeId p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p)
 -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607935"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p)
  -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot
 -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
-&gt; ((StrictMaybe (GovPurposeId p)
     -&gt; Const
          (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p)
    -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; (StrictMaybe (GovPurposeId p)
    -&gt; Const
         (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (GovPurposeId p)
 -&gt; Const
      (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p)
-&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRootL"><span class="hs-identifier hs-var">prRootL</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-322"></span><span>          </span><span class="annot"><span class="annottext">Proposals era -&gt; Maybe (Proposals era)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; Maybe (Proposals era))
-&gt; Proposals era -&gt; Maybe (Proposals era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-323"></span><span>            </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607901"><span class="hs-identifier hs-var">psWithGas</span></a></span><span>
</span><span id="line-324"></span><span>              </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot -&gt; Identity (GovRelation PRoot))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; ((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
    -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; (Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; Proposals era
-&gt; Identity (Proposals era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607935"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; ((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; (Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Identity (GovRelation PRoot)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildrenL"><span class="hs-identifier hs-var">prChildrenL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; (Set (GovPurposeId p) -&gt; Set (GovPurposeId p))
-&gt; Proposals era
-&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p -&gt; Set (GovPurposeId p) -&gt; Set (GovPurposeId p)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607937"><span class="hs-identifier hs-var">newId</span></a></span><span>
</span><span id="line-325"></span><span>              </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var">pGraphL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PGraph -&gt; Identity (GovRelation PGraph))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; Proposals era
-&gt; Identity (Proposals era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607935"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Identity (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (GovPurposeId p) (PEdges (GovPurposeId p))
  -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Proposals era
-&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; PEdges (GovPurposeId p)
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607937"><span class="hs-identifier hs-var">newId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
-&gt; Set (GovPurposeId p) -&gt; PEdges (GovPurposeId p)
forall a. StrictMaybe a -&gt; Set a -&gt; PEdges a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-var">PEdges</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679607936"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId p)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-326"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span id="local-6989586621679607942"><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607942"><span class="hs-identifier hs-var">parentId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679607936"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-327"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)) -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.member</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607942"><span class="hs-identifier hs-var">parentId</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p)) -&gt; Bool)
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)) -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607899"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (Proposals era)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PGraph
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (GovRelation PGraph))
-&gt; Proposals era
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p))) (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var">pGraphL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PGraph
  -&gt; Const
       (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
       (GovRelation PGraph))
 -&gt; Proposals era
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p))) (Proposals era))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Const
          (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
          (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; GovRelation PGraph
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (GovRelation PGraph))
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (Proposals era)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p)
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607935"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p)
  -&gt; Const
       (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
       (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Const
          (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
          (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p)
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p)
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-328"></span><span>          </span><span class="annot"><span class="annottext">Proposals era -&gt; Maybe (Proposals era)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; Maybe (Proposals era))
-&gt; Proposals era -&gt; Maybe (Proposals era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-329"></span><span>            </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607901"><span class="hs-identifier hs-var">psWithGas</span></a></span><span>
</span><span id="line-330"></span><span>              </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var">pGraphL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PGraph -&gt; Identity (GovRelation PGraph))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; Proposals era
-&gt; Identity (Proposals era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679607935"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Identity (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span>
</span><span id="line-331"></span><span>                </span><span class="annot"><span class="annottext">((Map (GovPurposeId p) (PEdges (GovPurposeId p))
  -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Proposals era
-&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; PEdges (GovPurposeId p)
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607937"><span class="hs-identifier hs-var">newId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
-&gt; Set (GovPurposeId p) -&gt; PEdges (GovPurposeId p)
forall a. StrictMaybe a -&gt; Set a -&gt; PEdges a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-var">PEdges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovPurposeId p -&gt; StrictMaybe (GovPurposeId p)
forall a. a -&gt; StrictMaybe a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-var">SJust</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607942"><span class="hs-identifier hs-var">parentId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId p)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>                       </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PEdges (GovPurposeId p) -&gt; PEdges (GovPurposeId p))
-&gt; GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; PEdges (GovPurposeId p) -&gt; Identity (PEdges (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PEdges a -&gt; f (PEdges a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildrenL"><span class="hs-identifier hs-var">peChildrenL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
 -&gt; PEdges (GovPurposeId p) -&gt; Identity (PEdges (GovPurposeId p)))
-&gt; (Set (GovPurposeId p) -&gt; Set (GovPurposeId p))
-&gt; PEdges (GovPurposeId p)
-&gt; PEdges (GovPurposeId p)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p -&gt; Set (GovPurposeId p) -&gt; Set (GovPurposeId p)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607937"><span class="hs-identifier hs-var">newId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679607942"><span class="hs-identifier hs-var">parentId</span></a></span><span>
</span><span id="line-333"></span><span>                   </span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Proposals era)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span class="hs-comment">-- | Reconstruct the @`Proposals`@ forest from an @`OMap`@ of</span><span>
</span><span id="line-337"></span><span class="hs-comment">-- @`GovActionState`@s and the 4 roots (@`PrevGovActionIds`@)</span><span>
</span><span id="line-338"></span><span id="local-6989586621679606874"><span id="local-6989586621679606875"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mkProposals"><span class="hs-identifier hs-type">mkProposals</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-339"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606874"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadFail</span></span><span> </span><span class="annot"><a href="#local-6989586621679606875"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-340"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-341"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#OMap"><span class="hs-identifier hs-type">OMap.OMap</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606874"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-342"></span><span>  </span><span class="annot"><a href="#local-6989586621679606875"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606874"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-343"></span><span id="mkProposals"><span class="annot"><span class="annottext">mkProposals :: forall era (m :: * -&gt; *).
(EraPParams era, MonadFail m) =&gt;
GovRelation StrictMaybe
-&gt; OMap GovActionId (GovActionState era) -&gt; m (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mkProposals"><span class="hs-identifier hs-var hs-var">mkProposals</span></a></span></span><span> </span><span id="local-6989586621679607977"><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679607977"><span class="hs-identifier hs-var">pgais</span></a></span></span><span> </span><span id="local-6989586621679607978"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607978"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-344"></span><span>  </span><span id="local-6989586621679607979"><span class="annot"><span class="annottext">ps :: Proposals era
</span><a href="#local-6989586621679607979"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679607980"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607980"><span class="hs-identifier hs-var">omap'</span></a></span></span><span> </span><span id="local-6989586621679607981"><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679607981"><span class="hs-identifier hs-var">_roots</span></a></span></span><span> </span><span id="local-6989586621679607982"><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679607982"><span class="hs-identifier hs-var">_hierarchy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><span class="annottext">(Proposals era -&gt; GovActionState era -&gt; m (Proposals era))
-&gt; Proposals era
-&gt; OMap GovActionId (GovActionState era)
-&gt; m (Proposals era)
forall (t :: * -&gt; *) (m :: * -&gt; *) ans k.
(Foldable t, Monad m) =&gt;
(ans -&gt; k -&gt; m ans) -&gt; ans -&gt; t k -&gt; m ans
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.Pulse.html#foldlM%27"><span class="hs-identifier hs-var">foldlM'</span></a></span><span>
</span><span id="line-346"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679607983"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607983"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span id="local-6989586621679607984"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607984"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-347"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
forall era.
(EraPParams era, ?callStack::CallStack) =&gt;
GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsAddAction"><span class="hs-identifier hs-var">proposalsAddAction</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607984"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607983"><span class="hs-identifier hs-var">props</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-348"></span><span>            </span><span class="annot"><span class="annottext">Maybe (Proposals era)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; m (Proposals era)
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m (Proposals era)) -&gt; String -&gt; m (Proposals era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkProposals: Could not add a proposal&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">GovActionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679607984"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Getting GovActionId (GovActionState era) GovActionId
-&gt; GovActionId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting GovActionId (GovActionState era) GovActionId
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovActionId -&gt; f GovActionId)
-&gt; GovActionState era -&gt; f (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasIdL"><span class="hs-identifier hs-var">gasIdL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679607987"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607987"><span class="hs-identifier hs-var">props'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; m (Proposals era)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607987"><span class="hs-identifier hs-var">props'</span></a></span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>      </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607988"><span class="hs-identifier hs-var">initialProposals</span></a></span><span>
</span><span id="line-352"></span><span>      </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607978"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-353"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607978"><span class="hs-identifier hs-var">omap</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; OMap GovActionId (GovActionState era) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679607980"><span class="hs-identifier hs-var">omap'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; m ()
forall a. String -&gt; m a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><span class="hs-identifier hs-var">fail</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkProposals: OMap is malformed&quot;</span></span><span>
</span><span id="line-354"></span><span>  </span><span class="annot"><span class="annottext">Proposals era -&gt; m (Proposals era)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679607979"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-355"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-356"></span><span>    </span><span id="local-6989586621679607988"><span class="annot"><span class="annottext">initialProposals :: Proposals era
</span><a href="#local-6989586621679607988"><span class="hs-identifier hs-var hs-var">initialProposals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proposals era
forall a. Default a =&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot -&gt; Identity (GovRelation PRoot))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; GovRelation PRoot -&gt; Proposals era -&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe -&gt; GovRelation PRoot
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#fromPrevGovActionIds"><span class="hs-identifier hs-var">fromPrevGovActionIds</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679607977"><span class="hs-identifier hs-var">pgais</span></a></span><span>
</span><span id="line-357"></span><span>
</span><span id="line-358"></span><span class="hs-comment">-- | Reconstruct the @`Proposals`@ forest from an @`OMap`@ of</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- @`GovActionState`@s and the 4 roots (@`PrevGovActionIds`@).</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- This function can fail and may return a malformed `Proposals`</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- if not given correct inputs.</span><span>
</span><span id="line-362"></span><span class="hs-comment">--</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- WARNING: Should only be used for testing!</span><span>
</span><span id="line-364"></span><span id="local-6989586621679606897"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unsafeMkProposals"><span class="hs-identifier hs-type">unsafeMkProposals</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606897"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-366"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-367"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#OMap"><span class="hs-identifier hs-type">OMap.OMap</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606897"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-368"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606897"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-369"></span><span id="unsafeMkProposals"><span class="annot"><span class="annottext">unsafeMkProposals :: forall era.
(?callStack::CallStack, EraPParams era) =&gt;
GovRelation StrictMaybe
-&gt; OMap GovActionId (GovActionState era) -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unsafeMkProposals"><span class="hs-identifier hs-var hs-var">unsafeMkProposals</span></a></span></span><span> </span><span id="local-6989586621679608012"><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679608012"><span class="hs-identifier hs-var">pgais</span></a></span></span><span> </span><span id="local-6989586621679608013"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608013"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; GovActionState era -&gt; Proposals era)
-&gt; Proposals era
-&gt; OMap GovActionId (GovActionState era)
-&gt; Proposals era
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; OMap GovActionId a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">F.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; GovActionState era -&gt; Proposals era
forall {era}.
(Assert
   (OrdCond
      (CmpNat (ProtVerLow era) (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerLow era)) 'True 'True 'False)
   (TypeError ...),
 Assert
   (OrdCond (CmpNat 0 (ProtVerHigh era)) 'True 'True 'False)
   (TypeError ...),
 EraPParams era) =&gt;
Proposals era -&gt; GovActionState era -&gt; Proposals era
</span><a href="#local-6989586621679608014"><span class="hs-identifier hs-var">unsafeProposalsAddAction</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608015"><span class="hs-identifier hs-var">initialProposals</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608013"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-370"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621679608015"><span class="annot"><span class="annottext">initialProposals :: Proposals era
</span><a href="#local-6989586621679608015"><span class="hs-identifier hs-var hs-var">initialProposals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Proposals era
forall a. Default a =&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/data-default-0.8.0.1-9291b190c5bc542cf17f99ce44e9365d143d76b9889465ad3d362701e6cc609e/share/doc/html/src/Data.Default.Internal.html#def"><span class="hs-identifier hs-var">def</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot -&gt; Identity (GovRelation PRoot))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; GovRelation PRoot -&gt; Proposals era -&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe -&gt; GovRelation PRoot
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#fromPrevGovActionIds"><span class="hs-identifier hs-var">fromPrevGovActionIds</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679608012"><span class="hs-identifier hs-var">pgais</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span id="local-6989586621679608014"><span class="annot"><span class="annottext">unsafeProposalsAddAction :: Proposals era -&gt; GovActionState era -&gt; Proposals era
</span><a href="#local-6989586621679608014"><span class="hs-identifier hs-var hs-var">unsafeProposalsAddAction</span></a></span></span><span> </span><span id="local-6989586621679608086"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608086"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621679608087"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608087"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-373"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
forall era.
GovActionState era -&gt; Proposals era -&gt; Maybe (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#runProposalsAddAction"><span class="hs-identifier hs-var">runProposalsAddAction</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608087"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608086"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-374"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679608088"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608088"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608088"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Proposals era)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Proposals era
forall a. (?callStack::CallStack) =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Proposals era) -&gt; String -&gt; Proposals era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-377"></span><span>            </span><span class="annot"><span class="annottext">Context -&gt; String
</span><span class="hs-identifier hs-var">unlines</span></span><span>
</span><span id="line-378"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unsafeMkProposals: runProposalsAddAction failed for &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">GovActionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608087"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Getting GovActionId (GovActionState era) GovActionId
-&gt; GovActionId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting GovActionId (GovActionState era) GovActionId
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovActionId -&gt; f GovActionId)
-&gt; GovActionState era -&gt; f (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasIdL"><span class="hs-identifier hs-var">gasIdL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Proposals:&quot;</span></span><span>
</span><span id="line-380"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608086"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-381"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GovActionState:&quot;</span></span><span>
</span><span id="line-382"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608087"><span class="hs-identifier hs-var">gas</span></a></span><span>
</span><span id="line-383"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679606921"><span id="local-6989586621679608098"><span id="local-6989586621679608102"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606921"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#EncCBOR"><span class="hs-identifier hs-type">EncCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606921"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-386"></span><span>  </span><span id="local-6989586621679608120"><span class="annot"><span class="annottext">encCBOR :: Proposals era -&gt; Encoding
</span><a href="#local-6989586621679608120"><span class="hs-identifier hs-var hs-var hs-var hs-var">encCBOR</span></a></span></span><span> </span><span id="local-6989586621679608122"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608122"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608123"><span class="annot"><span class="annottext">roots :: GovRelation StrictMaybe
</span><a href="#local-6989586621679608123"><span class="hs-identifier hs-var hs-var">roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot -&gt; GovRelation StrictMaybe
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPrevGovActionIds"><span class="hs-identifier hs-var">toPrevGovActionIds</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot -&gt; GovRelation StrictMaybe)
-&gt; GovRelation PRoot -&gt; GovRelation StrictMaybe
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608122"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting (GovRelation PRoot) (Proposals era) (GovRelation PRoot)
-&gt; GovRelation PRoot
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (GovRelation PRoot) (Proposals era) (GovRelation PRoot)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span>
</span><span id="line-388"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(GovRelation StrictMaybe, OMap GovActionId (GovActionState era))
-&gt; Encoding
forall a. EncCBOR a =&gt; a -&gt; Encoding
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Encoding.EncCBOR.html#encCBOR"><span class="hs-identifier hs-var">encCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679608123"><span class="hs-identifier hs-var">roots</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608122"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (OMap GovActionId (GovActionState era))
     (Proposals era)
     (OMap GovActionId (GovActionState era))
-&gt; OMap GovActionId (GovActionState era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (OMap GovActionId (GovActionState era))
  (Proposals era)
  (OMap GovActionId (GovActionState era))
forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var">pPropsL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679606936"><span id="local-6989586621679608131"><span id="local-6989586621679608135"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606936"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#DecCBOR"><span class="hs-identifier hs-type">DecCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606936"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-391"></span><span>  </span><span id="local-6989586621679608157"><span class="annot"><span class="annottext">decCBOR :: forall s. Decoder s (Proposals era)
</span><a href="#local-6989586621679608157"><span class="hs-identifier hs-var hs-var hs-var hs-var">decCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Decoder
  s (GovRelation StrictMaybe, OMap GovActionId (GovActionState era))
forall s.
Decoder
  s (GovRelation StrictMaybe, OMap GovActionId (GovActionState era))
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span> </span><span class="annot"><span class="annottext">Decoder
  s (GovRelation StrictMaybe, OMap GovActionId (GovActionState era))
-&gt; ((GovRelation StrictMaybe,
     OMap GovActionId (GovActionState era))
    -&gt; Decoder s (Proposals era))
-&gt; Decoder s (Proposals era)
forall a b. Decoder s a -&gt; (a -&gt; Decoder s b) -&gt; Decoder s b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation StrictMaybe
 -&gt; OMap GovActionId (GovActionState era)
 -&gt; Decoder s (Proposals era))
-&gt; (GovRelation StrictMaybe, OMap GovActionId (GovActionState era))
-&gt; Decoder s (Proposals era)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
-&gt; OMap GovActionId (GovActionState era)
-&gt; Decoder s (Proposals era)
forall era (m :: * -&gt; *).
(EraPParams era, MonadFail m) =&gt;
GovRelation StrictMaybe
-&gt; OMap GovActionId (GovActionState era) -&gt; m (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mkProposals"><span class="hs-identifier hs-var">mkProposals</span></a></span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679606971"><span id="local-6989586621679608165"><span id="local-6989586621679608169"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606971"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#DecShareCBOR"><span class="hs-identifier hs-type">DecShareCBOR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606971"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-394"></span><span>  </span><span class="hs-keyword">type</span><span>
</span><span id="line-395"></span><span>    </span><span id="Share"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Share"><span class="hs-identifier hs-var">Share</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606971"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier hs-type">Interns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier hs-type">Interns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Hashes.html#KeyHash"><span class="hs-identifier hs-type">KeyHash</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#StakePool"><span class="hs-identifier hs-type">StakePool</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier hs-type">Interns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">DRepRole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#Interns"><span class="hs-identifier hs-type">Interns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#HotCommitteeRole"><span class="hs-identifier hs-type">HotCommitteeRole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>  </span><span id="local-6989586621679608210"><span class="annot"><span class="annottext">decSharePlusCBOR :: forall s.
StateT (Share (Proposals era)) (Decoder s) (Proposals era)
</span><a href="#local-6989586621679608210"><span class="hs-identifier hs-var hs-var hs-var hs-var">decSharePlusCBOR</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-402"></span><span>    </span><span class="annot"><span class="annottext">Text
-&gt; (Proposals era -&gt; Int)
-&gt; StateT (Share (Proposals era)) (Decoder s) (Proposals era)
-&gt; StateT (Share (Proposals era)) (Decoder s) (Proposals era)
forall (m :: (* -&gt; *) -&gt; * -&gt; *) s a.
(MonadTrans m, Monad (m (Decoder s))) =&gt;
Text -&gt; (a -&gt; Int) -&gt; m (Decoder s) a -&gt; m (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeRecordNamedT"><span class="hs-identifier hs-var">decodeRecordNamedT</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Proposals&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; Proposals era -&gt; Int
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(StateT (Share (Proposals era)) (Decoder s) (Proposals era)
 -&gt; StateT (Share (Proposals era)) (Decoder s) (Proposals era))
-&gt; StateT (Share (Proposals era)) (Decoder s) (Proposals era)
-&gt; StateT (Share (Proposals era)) (Decoder s) (Proposals era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-403"></span><span>      </span><span id="local-6989586621679608213"><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679608213"><span class="hs-identifier hs-var">gaid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Decoder s (GovRelation StrictMaybe)
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
      Interns (Credential 'DRepRole),
      Interns (Credential 'HotCommitteeRole))
     (Decoder s)
     (GovRelation StrictMaybe)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
      Interns (Credential 'DRepRole),
      Interns (Credential 'HotCommitteeRole))
     m
     a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">Decoder s (GovRelation StrictMaybe)
forall s. Decoder s (GovRelation StrictMaybe)
forall a s. DecCBOR a =&gt; Decoder s a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.DecCBOR.html#decCBOR"><span class="hs-identifier hs-var">decCBOR</span></a></span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608214"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608214"><span class="hs-identifier hs-var">omap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
   Interns (Credential 'DRepRole),
   Interns (Credential 'HotCommitteeRole))
  (Decoder s)
  (Maybe Int)
-&gt; (GovActionState era
    -&gt; OMap GovActionId (GovActionState era)
    -&gt; OMap GovActionId (GovActionState era))
-&gt; (OMap GovActionId (GovActionState era)
    -&gt; StateT
         (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
          Interns (Credential 'DRepRole),
          Interns (Credential 'HotCommitteeRole))
         (Decoder s)
         (GovActionState era))
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
      Interns (Credential 'DRepRole),
      Interns (Credential 'HotCommitteeRole))
     (Decoder s)
     (Int, OMap GovActionId (GovActionState era))
forall (t :: (* -&gt; *) -&gt; * -&gt; *) s a b.
(MonadTrans t, Monad (t (Decoder s)), Monoid b) =&gt;
t (Decoder s) (Maybe Int)
-&gt; (a -&gt; b -&gt; b)
-&gt; (b -&gt; t (Decoder s) a)
-&gt; t (Decoder s) (Int, b)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeListLikeWithCountT"><span class="hs-identifier hs-var">decodeListLikeWithCountT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Decoder s (Maybe Int)
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
      Interns (Credential 'DRepRole),
      Interns (Credential 'HotCommitteeRole))
     (Decoder s)
     (Maybe Int)
forall (m :: * -&gt; *) a.
Monad m =&gt;
m a
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
      Interns (Credential 'DRepRole),
      Interns (Credential 'HotCommitteeRole))
     m
     a
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">Decoder s (Maybe Int)
forall s. Decoder s (Maybe Int)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Decoder.html#decodeListLenOrIndef"><span class="hs-identifier hs-var">decodeListLenOrIndef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era)
 -&gt; GovActionState era -&gt; OMap GovActionId (GovActionState era))
-&gt; GovActionState era
-&gt; OMap GovActionId (GovActionState era)
-&gt; OMap GovActionId (GovActionState era)
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><span class="hs-identifier hs-var">flip</span></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; GovActionState era -&gt; OMap GovActionId (GovActionState era)
forall k v. HasOKey k v =&gt; OMap k v -&gt; v -&gt; OMap k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#%7C%3E"><span class="hs-operator hs-var">(OMap.|&gt;)</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((OMap GovActionId (GovActionState era)
  -&gt; StateT
       (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
        Interns (Credential 'DRepRole),
        Interns (Credential 'HotCommitteeRole))
       (Decoder s)
       (GovActionState era))
 -&gt; StateT
      (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
       Interns (Credential 'DRepRole),
       Interns (Credential 'HotCommitteeRole))
      (Decoder s)
      (Int, OMap GovActionId (GovActionState era)))
-&gt; (OMap GovActionId (GovActionState era)
    -&gt; StateT
         (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
          Interns (Credential 'DRepRole),
          Interns (Credential 'HotCommitteeRole))
         (Decoder s)
         (GovActionState era))
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
      Interns (Credential 'DRepRole),
      Interns (Credential 'HotCommitteeRole))
     (Decoder s)
     (Int, OMap GovActionId (GovActionState era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><span class="annottext">StateT
  (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
   Interns (Credential 'DRepRole),
   Interns (Credential 'HotCommitteeRole))
  (Decoder s)
  (GovActionState era)
StateT
  (Share (GovActionState era)) (Decoder s) (GovActionState era)
forall s.
StateT
  (Share (GovActionState era)) (Decoder s) (GovActionState era)
forall a s. DecShareCBOR a =&gt; StateT (Share a) (Decoder s) a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-binary-1.7.0.1/doc/html/cardano-ledger-binary/src/Cardano.Ledger.Binary.Decoding.Sharing.html#decSharePlusCBOR"><span class="hs-identifier hs-var">decSharePlusCBOR</span></a></span><span>
</span><span id="line-406"></span><span>      </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
-&gt; OMap GovActionId (GovActionState era)
-&gt; StateT
     (Interns (Credential 'Staking), Interns (KeyHash 'StakePool),
      Interns (Credential 'DRepRole),
      Interns (Credential 'HotCommitteeRole))
     (Decoder s)
     (Proposals era)
forall era (m :: * -&gt; *).
(EraPParams era, MonadFail m) =&gt;
GovRelation StrictMaybe
-&gt; OMap GovActionId (GovActionState era) -&gt; m (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#mkProposals"><span class="hs-identifier hs-var">mkProposals</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679608213"><span class="hs-identifier hs-var">gaid</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608214"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">-- | Add a vote to an existing `GovActionState`. This is a no-op if the</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- provided `GovActionId` does not already exist</span><span>
</span><span id="line-410"></span><span id="local-6989586621679606998"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsAddVote"><span class="hs-identifier hs-type">proposalsAddVote</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-411"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Voter"><span class="hs-identifier hs-type">Voter</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-412"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Vote"><span class="hs-identifier hs-type">Vote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-413"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-414"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606998"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606998"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-416"></span><span id="proposalsAddVote"><span class="annot"><span class="annottext">proposalsAddVote :: forall era.
Voter -&gt; Vote -&gt; GovActionId -&gt; Proposals era -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsAddVote"><span class="hs-identifier hs-var hs-var">proposalsAddVote</span></a></span></span><span> </span><span id="local-6989586621679608224"><span class="annot"><span class="annottext">Voter
</span><a href="#local-6989586621679608224"><span class="hs-identifier hs-var">voter</span></a></span></span><span> </span><span id="local-6989586621679608225"><span class="annot"><span class="annottext">Vote
</span><a href="#local-6989586621679608225"><span class="hs-identifier hs-var">vote</span></a></span></span><span> </span><span id="local-6989586621679608226"><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608226"><span class="hs-identifier hs-var">gai</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679608227"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608227"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span id="local-6989586621679608228"><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608228"><span class="hs-identifier hs-var">roots</span></a></span></span><span> </span><span id="local-6989586621679608229"><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608229"><span class="hs-identifier hs-var">hierarchy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-417"></span><span>  </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; GovRelation PRoot -&gt; GovRelation PGraph -&gt; Proposals era
forall era.
OMap GovActionId (GovActionState era)
-&gt; GovRelation PRoot -&gt; GovRelation PGraph -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-var">Proposals</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GovActionState era -&gt; GovActionState era)
-&gt; GovActionId
-&gt; OMap GovActionId (GovActionState era)
-&gt; OMap GovActionId (GovActionState era)
forall k v. HasOKey k v =&gt; (v -&gt; v) -&gt; k -&gt; OMap k v -&gt; OMap k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#adjust"><span class="hs-identifier hs-var">OMap.adjust</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; GovActionState era
</span><a href="#local-6989586621679608231"><span class="hs-identifier hs-var">updateVote</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608226"><span class="hs-identifier hs-var">gai</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608227"><span class="hs-identifier hs-var">omap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608228"><span class="hs-identifier hs-var">roots</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608229"><span class="hs-identifier hs-var">hierarchy</span></a></span><span>
</span><span id="line-418"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-419"></span><span>    </span><span id="local-6989586621679607005"><span id="local-6989586621679607006"><span class="annot"><a href="#local-6989586621679608232"><span class="hs-identifier hs-type">insertVote</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-420"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679607005"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-421"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607006"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679607005"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Vote"><span class="hs-identifier hs-type">Vote</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-422"></span><span>      </span><span class="annot"><a href="#local-6989586621679607005"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-423"></span><span>      </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607006"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-424"></span><span>      </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607006"><span class="hs-identifier hs-type">era</span></a></span></span></span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621679608232"><span class="annot"><span class="annottext">insertVote :: forall k era.
Ord k =&gt;
Lens' (GovActionState era) (Map k Vote)
-&gt; k -&gt; GovActionState era -&gt; GovActionState era
</span><a href="#local-6989586621679608232"><span class="hs-identifier hs-var hs-var">insertVote</span></a></span></span><span> </span><span id="local-6989586621679608236"><span class="annot"><span class="annottext">Lens' (GovActionState era) (Map k Vote)
</span><a href="#local-6989586621679608236"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679608237"><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679608237"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Map k Vote -&gt; Identity (Map k Vote))
-&gt; GovActionState era -&gt; Identity (GovActionState era)
Lens' (GovActionState era) (Map k Vote)
</span><a href="#local-6989586621679608236"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">((Map k Vote -&gt; Identity (Map k Vote))
 -&gt; GovActionState era -&gt; Identity (GovActionState era))
-&gt; (Map k Vote -&gt; Map k Vote)
-&gt; GovActionState era
-&gt; GovActionState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">k -&gt; Vote -&gt; Map k Vote -&gt; Map k Vote
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insert</span></span><span> </span><span class="annot"><span class="annottext">k
</span><a href="#local-6989586621679608237"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="#local-6989586621679608225"><span class="hs-identifier hs-var">vote</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621679608231"><span class="annot"><span class="annottext">updateVote :: GovActionState era -&gt; GovActionState era
</span><a href="#local-6989586621679608231"><span class="hs-identifier hs-var hs-var">updateVote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Voter
</span><a href="#local-6989586621679608224"><span class="hs-identifier hs-var">voter</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-427"></span><span>      </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#DRepVoter"><span class="hs-identifier hs-type">DRepVoter</span></a></span><span> </span><span id="local-6989586621679608239"><span class="annot"><span class="annottext">Credential 'DRepRole
</span><a href="#local-6989586621679608239"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Lens' (GovActionState era) (Map (Credential 'DRepRole) Vote)
-&gt; Credential 'DRepRole -&gt; GovActionState era -&gt; GovActionState era
forall k era.
Ord k =&gt;
Lens' (GovActionState era) (Map k Vote)
-&gt; k -&gt; GovActionState era -&gt; GovActionState era
</span><a href="#local-6989586621679608232"><span class="hs-identifier hs-var">insertVote</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Credential 'DRepRole) Vote
 -&gt; f (Map (Credential 'DRepRole) Vote))
-&gt; GovActionState era -&gt; f (GovActionState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (Credential 'DRepRole) Vote
 -&gt; f (Map (Credential 'DRepRole) Vote))
-&gt; GovActionState era -&gt; f (GovActionState era)
Lens' (GovActionState era) (Map (Credential 'DRepRole) Vote)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasDRepVotesL"><span class="hs-identifier hs-var">gasDRepVotesL</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'DRepRole
</span><a href="#local-6989586621679608239"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-428"></span><span>      </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#StakePoolVoter"><span class="hs-identifier hs-type">StakePoolVoter</span></a></span><span> </span><span id="local-6989586621679608244"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679608244"><span class="hs-identifier hs-var">kh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Lens' (GovActionState era) (Map (KeyHash 'StakePool) Vote)
-&gt; KeyHash 'StakePool -&gt; GovActionState era -&gt; GovActionState era
forall k era.
Ord k =&gt;
Lens' (GovActionState era) (Map k Vote)
-&gt; k -&gt; GovActionState era -&gt; GovActionState era
</span><a href="#local-6989586621679608232"><span class="hs-identifier hs-var">insertVote</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (KeyHash 'StakePool) Vote
 -&gt; f (Map (KeyHash 'StakePool) Vote))
-&gt; GovActionState era -&gt; f (GovActionState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (KeyHash 'StakePool) Vote
 -&gt; f (Map (KeyHash 'StakePool) Vote))
-&gt; GovActionState era -&gt; f (GovActionState era)
Lens' (GovActionState era) (Map (KeyHash 'StakePool) Vote)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasStakePoolVotesL"><span class="hs-identifier hs-var">gasStakePoolVotesL</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679608244"><span class="hs-identifier hs-var">kh</span></a></span><span>
</span><span id="line-429"></span><span>      </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#CommitteeVoter"><span class="hs-identifier hs-type">CommitteeVoter</span></a></span><span> </span><span id="local-6989586621679608249"><span class="annot"><span class="annottext">Credential 'HotCommitteeRole
</span><a href="#local-6989586621679608249"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Lens'
  (GovActionState era) (Map (Credential 'HotCommitteeRole) Vote)
-&gt; Credential 'HotCommitteeRole
-&gt; GovActionState era
-&gt; GovActionState era
forall k era.
Ord k =&gt;
Lens' (GovActionState era) (Map k Vote)
-&gt; k -&gt; GovActionState era -&gt; GovActionState era
</span><a href="#local-6989586621679608232"><span class="hs-identifier hs-var">insertVote</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (Credential 'HotCommitteeRole) Vote
 -&gt; f (Map (Credential 'HotCommitteeRole) Vote))
-&gt; GovActionState era -&gt; f (GovActionState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Map (Credential 'HotCommitteeRole) Vote
 -&gt; f (Map (Credential 'HotCommitteeRole) Vote))
-&gt; GovActionState era -&gt; f (GovActionState era)
Lens'
  (GovActionState era) (Map (Credential 'HotCommitteeRole) Vote)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasCommitteeVotesL"><span class="hs-identifier hs-var">gasCommitteeVotesL</span></a></span><span> </span><span class="annot"><span class="annottext">Credential 'HotCommitteeRole
</span><a href="#local-6989586621679608249"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="hs-comment">-- | For each action-id in the given set. attempt to remove it from</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- the @`Proposals`@ forest based on its purpose. Although the removal</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- operations are applied to parts of the forest without any checks, we</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- cover them in property-tests</span><span>
</span><span id="line-435"></span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveIds"><span class="hs-identifier hs-type">proposalsRemoveIds</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679607019"><span class="annot"><a href="#local-6989586621679607019"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-437"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607019"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-438"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-439"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607019"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-440"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607019"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607019"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-441"></span><span id="proposalsRemoveIds"><span class="annot"><span class="annottext">proposalsRemoveIds :: forall era.
EraPParams era =&gt;
Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveIds"><span class="hs-identifier hs-var hs-var">proposalsRemoveIds</span></a></span></span><span> </span><span id="local-6989586621679608264"><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608264"><span class="hs-identifier hs-var">gais</span></a></span></span><span> </span><span id="local-6989586621679608265"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608265"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679608266"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608266"><span class="hs-identifier hs-var">retainedOMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608267"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608267"><span class="hs-identifier hs-var">removedFromOMap</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set GovActionId
-&gt; OMap GovActionId (GovActionState era)
-&gt; (OMap GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall k v. Ord k =&gt; Set k -&gt; OMap k v -&gt; (OMap k v, Map k v)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#extractKeys"><span class="hs-identifier hs-var">OMap.extractKeys</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608264"><span class="hs-identifier hs-var">gais</span></a></span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era)
 -&gt; (OMap GovActionId (GovActionState era),
     Map GovActionId (GovActionState era)))
-&gt; OMap GovActionId (GovActionState era)
-&gt; (OMap GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608265"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (OMap GovActionId (GovActionState era))
     (Proposals era)
     (OMap GovActionId (GovActionState era))
-&gt; OMap GovActionId (GovActionState era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (OMap GovActionId (GovActionState era))
  (Proposals era)
  (OMap GovActionId (GovActionState era))
forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var">pPropsL</span></a></span><span>
</span><span id="line-443"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679608269"><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608269"><span class="hs-identifier hs-var">roots</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608270"><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608270"><span class="hs-identifier hs-var">hierarchy</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot, GovRelation PGraph)
 -&gt; GovActionState era -&gt; (GovRelation PRoot, GovRelation PGraph))
-&gt; (GovRelation PRoot, GovRelation PGraph)
-&gt; Map GovActionId (GovActionState era)
-&gt; (GovRelation PRoot, GovRelation PGraph)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; Map GovActionId a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">F.foldl'</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot, GovRelation PGraph)
-&gt; GovActionState era -&gt; (GovRelation PRoot, GovRelation PGraph)
forall {era}.
(GovRelation PRoot, GovRelation PGraph)
-&gt; GovActionState era -&gt; (GovRelation PRoot, GovRelation PGraph)
</span><a href="#local-6989586621679608271"><span class="hs-identifier hs-var">removeEach</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608265"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting (GovRelation PRoot) (Proposals era) (GovRelation PRoot)
-&gt; GovRelation PRoot
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (GovRelation PRoot) (Proposals era) (GovRelation PRoot)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608265"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (GovRelation PGraph) (Proposals era) (GovRelation PGraph)
-&gt; GovRelation PGraph
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (GovRelation PGraph) (Proposals era) (GovRelation PGraph)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var">pGraphL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608267"><span class="hs-identifier hs-var">removedFromOMap</span></a></span><span>
</span><span id="line-444"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set GovActionId -&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
forall era.
(EraPParams era, ?callStack::CallStack) =&gt;
Set GovActionId -&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#checkInvariantAfterDeletion"><span class="hs-identifier hs-var">checkInvariantAfterDeletion</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608264"><span class="hs-identifier hs-var">gais</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608265"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">(Proposals era -&gt; Proposals era) -&gt; Proposals era -&gt; Proposals era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; GovRelation PRoot -&gt; GovRelation PGraph -&gt; Proposals era
forall era.
OMap GovActionId (GovActionState era)
-&gt; GovRelation PRoot -&gt; GovRelation PGraph -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-var">Proposals</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608266"><span class="hs-identifier hs-var">retainedOMap</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608269"><span class="hs-identifier hs-var">roots</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608270"><span class="hs-identifier hs-var">hierarchy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608267"><span class="hs-identifier hs-var">removedFromOMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-445"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621679608271"><span class="annot"><span class="annottext">removeEach :: (GovRelation PRoot, GovRelation PGraph)
-&gt; GovActionState era -&gt; (GovRelation PRoot, GovRelation PGraph)
</span><a href="#local-6989586621679608271"><span class="hs-identifier hs-var hs-var">removeEach</span></a></span></span><span> </span><span id="local-6989586621679608273"><span class="annot"><span class="annottext">accum :: (GovRelation PRoot, GovRelation PGraph)
</span><a href="#local-6989586621679608273"><span class="hs-identifier hs-var">accum</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679608274"><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608274"><span class="hs-identifier hs-var">roots</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679608275"><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608275"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679608276"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608276"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="annottext">GovActionState era
-&gt; (GovRelation PRoot, GovRelation PGraph)
-&gt; (forall {p :: GovActionPurpose}.
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; (GovRelation PRoot, GovRelation PGraph))
-&gt; (GovRelation PRoot, GovRelation PGraph)
forall era a.
GovActionState era
-&gt; a
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; a)
-&gt; a
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#withGovActionParent"><span class="hs-identifier hs-var">withGovActionParent</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608276"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot, GovRelation PGraph)
</span><a href="#local-6989586621679608273"><span class="hs-identifier hs-var">accum</span></a></span><span> </span><span class="annot"><span class="annottext">((forall {p :: GovActionPurpose}.
  (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
   Functor f2 =&gt;
   (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
   -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
  -&gt; StrictMaybe (GovPurposeId p)
  -&gt; GovPurposeId p
  -&gt; (GovRelation PRoot, GovRelation PGraph))
 -&gt; (GovRelation PRoot, GovRelation PGraph))
-&gt; (forall {p :: GovActionPurpose}.
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; (GovRelation PRoot, GovRelation PGraph))
-&gt; (GovRelation PRoot, GovRelation PGraph)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679608297"><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608297"><span class="hs-identifier hs-var">govRelationL</span></a></span></span><span> </span><span id="local-6989586621679608298"><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608298"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621679608299"><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608299"><span class="hs-identifier hs-var">gpi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608298"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
-&gt; StrictMaybe (GovPurposeId p) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608274"><span class="hs-identifier hs-var">roots</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
-&gt; Getting
     (StrictMaybe (GovPurposeId p))
     (GovRelation PRoot)
     (StrictMaybe (GovPurposeId p))
-&gt; StrictMaybe (GovPurposeId p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p)
 -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot)
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608297"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p)
  -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot
 -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
-&gt; ((StrictMaybe (GovPurposeId p)
     -&gt; Const
          (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p)
    -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; Getting
     (StrictMaybe (GovPurposeId p))
     (GovRelation PRoot)
     (StrictMaybe (GovPurposeId p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (GovPurposeId p)
 -&gt; Const
      (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p)
-&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRootL"><span class="hs-identifier hs-var">prRootL</span></a></span><span>
</span><span id="line-449"></span><span>          </span><span class="hs-keyword">then</span><span>
</span><span id="line-450"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608274"><span class="hs-identifier hs-var">roots</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
-&gt; (GovRelation PRoot -&gt; GovRelation PRoot) -&gt; GovRelation PRoot
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot)
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608297"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; ((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; (Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Identity (GovRelation PRoot)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildrenL"><span class="hs-identifier hs-var">prChildrenL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
 -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; (Set (GovPurposeId p) -&gt; Set (GovPurposeId p))
-&gt; GovRelation PRoot
-&gt; GovRelation PRoot
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p -&gt; Set (GovPurposeId p) -&gt; Set (GovPurposeId p)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608299"><span class="hs-identifier hs-var">gpi</span></a></span><span>
</span><span id="line-451"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608275"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
-&gt; (GovRelation PGraph -&gt; GovRelation PGraph) -&gt; GovRelation PGraph
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph)
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608297"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Identity (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (GovPurposeId p) (PEdges (GovPurposeId p))
  -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; GovRelation PGraph
-&gt; GovRelation PGraph
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608299"><span class="hs-identifier hs-var">gpi</span></a></span><span>
</span><span id="line-452"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-454"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608274"><span class="hs-identifier hs-var">roots</span></a></span><span>
</span><span id="line-455"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608275"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-456"></span><span>                </span><span class="annot"><span class="annottext">GovRelation PGraph
-&gt; (GovRelation PGraph -&gt; GovRelation PGraph) -&gt; GovRelation PGraph
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph)
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608297"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Identity (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (GovPurposeId p) (PEdges (GovPurposeId p))
  -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; GovRelation PGraph
-&gt; GovRelation PGraph
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608299"><span class="hs-identifier hs-var">gpi</span></a></span><span>
</span><span id="line-457"></span><span>                </span><span class="annot"><span class="annottext">GovRelation PGraph
-&gt; (GovRelation PGraph -&gt; GovRelation PGraph) -&gt; GovRelation PGraph
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608298"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-458"></span><span>                  </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (GovRelation PGraph -&gt; GovRelation PGraph)
-&gt; GovRelation PGraph
-&gt; GovRelation PGraph
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph -&gt; GovRelation PGraph
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span>
</span><span id="line-459"></span><span>                  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span id="local-6989586621679608303"><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608303"><span class="hs-identifier hs-var">parentGpi</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-460"></span><span>                    </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph)
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608297"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Identity (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (GovPurposeId p) (PEdges (GovPurposeId p))
  -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; GovRelation PGraph
-&gt; GovRelation PGraph
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">(PEdges (GovPurposeId p) -&gt; PEdges (GovPurposeId p))
-&gt; GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; (a -&gt; a) -&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.adjust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; PEdges (GovPurposeId p) -&gt; Identity (PEdges (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PEdges a -&gt; f (PEdges a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildrenL"><span class="hs-identifier hs-var">peChildrenL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
 -&gt; PEdges (GovPurposeId p) -&gt; Identity (PEdges (GovPurposeId p)))
-&gt; (Set (GovPurposeId p) -&gt; Set (GovPurposeId p))
-&gt; PEdges (GovPurposeId p)
-&gt; PEdges (GovPurposeId p)
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p -&gt; Set (GovPurposeId p) -&gt; Set (GovPurposeId p)
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608299"><span class="hs-identifier hs-var">gpi</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608303"><span class="hs-identifier hs-var">parentGpi</span></a></span><span>
</span><span id="line-461"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-462"></span><span>
</span><span id="line-463"></span><span class="hs-comment">-- | Remove the set of given action-ids with their descendants from the</span><span>
</span><span id="line-464"></span><span class="hs-comment">-- @`Proposals`@ forest. Cannot be used for removing enacted GovActionIds (i.e. roots)</span><span>
</span><span id="line-465"></span><span id="local-6989586621679608304"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveWithDescendants"><span class="hs-identifier hs-type">proposalsRemoveWithDescendants</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-466"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679608304"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-467"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-468"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679608304"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679608304"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679608304"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-470"></span><span id="proposalsRemoveWithDescendants"><span class="annot"><span class="annottext">proposalsRemoveWithDescendants :: forall era.
EraPParams era =&gt;
Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveWithDescendants"><span class="hs-identifier hs-var hs-var">proposalsRemoveWithDescendants</span></a></span></span><span> </span><span id="local-6989586621679608318"><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608318"><span class="hs-identifier hs-var">gais</span></a></span></span><span> </span><span id="local-6989586621679608319"><span class="annot"><span class="annottext">ps :: Proposals era
</span><a href="#local-6989586621679608319"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679608320"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608320"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span id="local-6989586621679608321"><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608321"><span class="hs-identifier hs-var">_roots</span></a></span></span><span> </span><span id="local-6989586621679608322"><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608322"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-471"></span><span>  </span><span class="annot"><span class="annottext">Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
forall era.
EraPParams era =&gt;
Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveIds"><span class="hs-identifier hs-var">proposalsRemoveIds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608318"><span class="hs-identifier hs-var">gais</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; Set GovActionId -&gt; Set GovActionId
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">(GovActionId -&gt; Set GovActionId)
-&gt; Set GovActionId -&gt; Set GovActionId
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; Set a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">GovActionId -&gt; Set GovActionId
</span><a href="#local-6989586621679608324"><span class="hs-identifier hs-var">getAllDescendants</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608318"><span class="hs-identifier hs-var">gais</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608319"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-472"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-473"></span><span>    </span><span class="hs-comment">-- Recursively get all of the descendants for those actions that have lineage</span><span>
</span><span id="line-474"></span><span>    </span><span id="local-6989586621679608324"><span class="annot"><span class="annottext">getAllDescendants :: GovActionId -&gt; Set GovActionId
</span><a href="#local-6989586621679608324"><span class="hs-identifier hs-var hs-var">getAllDescendants</span></a></span></span><span> </span><span id="local-6989586621679608325"><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608325"><span class="hs-identifier hs-var">gai</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GovActionId
-&gt; OMap GovActionId (GovActionState era)
-&gt; Maybe (GovActionState era)
forall k v. Ord k =&gt; k -&gt; OMap k v -&gt; Maybe v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#lookup"><span class="hs-identifier hs-var">OMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608325"><span class="hs-identifier hs-var">gai</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608320"><span class="hs-identifier hs-var">omap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><span class="annottext">Maybe (GovActionState era)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set GovActionId -&gt; Set GovActionId
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679608326"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608326"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Set GovActionId
-&gt; (forall {p :: GovActionPurpose}.
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; Set GovActionId)
-&gt; Set GovActionId
forall era a.
GovActionState era
-&gt; a
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; a)
-&gt; a
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#withGovActionParent"><span class="hs-identifier hs-var">withGovActionParent</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608326"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">((forall {p :: GovActionPurpose}.
  (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
   Functor f2 =&gt;
   (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
   -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
  -&gt; StrictMaybe (GovPurposeId p)
  -&gt; GovPurposeId p
  -&gt; Set GovActionId)
 -&gt; Set GovActionId)
-&gt; (forall {p :: GovActionPurpose}.
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; Set GovActionId)
-&gt; Set GovActionId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679608336"><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608336"><span class="hs-identifier hs-var">govRelationL</span></a></span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-478"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608337"><span class="annot"><span class="annottext">go :: Set GovActionId -&gt; GovPurposeId p -&gt; Set GovActionId
</span><a href="#local-6989586621679608337"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621679608338"><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608338"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span id="local-6989586621679608339"><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608339"><span class="hs-identifier hs-var">gpi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-479"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Maybe (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608339"><span class="hs-identifier hs-var">gpi</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Maybe (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Maybe (PEdges (GovPurposeId p))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608322"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p)
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608336"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p)
  -&gt; Const
       (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
       (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Const
          (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
          (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p)
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (PGraph (GovPurposeId p)))
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p)
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-480"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (PEdges (GovPurposeId p))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set GovActionId -&gt; Set GovActionId
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608338"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-481"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PEdges"><span class="hs-identifier hs-type">PEdges</span></a></span><span> </span><span id="local-6989586621679608341"><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608341"><span class="hs-identifier hs-var">_parent</span></a></span></span><span> </span><span id="local-6989586621679608342"><span class="annot"><span class="annottext">Set (GovPurposeId p)
</span><a href="#local-6989586621679608342"><span class="hs-identifier hs-var">children</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-482"></span><span>                    </span><span class="annot"><span class="annottext">(Set GovActionId -&gt; GovPurposeId p -&gt; Set GovActionId)
-&gt; Set GovActionId -&gt; Set (GovPurposeId p) -&gt; Set GovActionId
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; Set a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">F.foldl'</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; GovPurposeId p -&gt; Set GovActionId
</span><a href="#local-6989586621679608337"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GovPurposeId p -&gt; GovActionId)
-&gt; Set (GovPurposeId p) -&gt; Set GovActionId
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p -&gt; GovActionId
forall (p :: GovActionPurpose). GovPurposeId p -&gt; GovActionId
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#unGovPurposeId"><span class="hs-identifier hs-var">unGovPurposeId</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId p)
</span><a href="#local-6989586621679608342"><span class="hs-identifier hs-var">children</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; Set GovActionId -&gt; Set GovActionId
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608338"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId p)
</span><a href="#local-6989586621679608342"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-483"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; GovPurposeId p -&gt; Set GovActionId
</span><a href="#local-6989586621679608337"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-484"></span><span>
</span><span id="line-485"></span><span class="hs-comment">-- | For use in the @`EPOCH`@ rule. Apply the result of</span><span>
</span><span id="line-486"></span><span class="hs-comment">-- @`extractDRepPulsingState`@ to the @`Proposals`@ forest, so that:</span><span>
</span><span id="line-487"></span><span class="hs-comment">--   i. all the expired action-ids and their descendants are removed,</span><span>
</span><span id="line-488"></span><span class="hs-comment">--   and</span><span>
</span><span id="line-489"></span><span class="hs-comment">--   ii. the sequence of enacted action-ids is promoted to the root,</span><span>
</span><span id="line-490"></span><span class="hs-comment">--   removing competing/sibling action-ids and their descendants at each</span><span>
</span><span id="line-491"></span><span class="hs-comment">--   step</span><span>
</span><span id="line-492"></span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsApplyEnactment"><span class="hs-identifier hs-type">proposalsApplyEnactment</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-493"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679607041"><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-495"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-496"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-497"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-498"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Enacted actions</span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Removed due to enactment</span><span>
</span><span id="line-501"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Removed due to expiry</span><span>
</span><span id="line-502"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span id="proposalsApplyEnactment"><span class="annot"><span class="annottext">proposalsApplyEnactment :: forall era.
EraPParams era =&gt;
Seq (GovActionState era)
-&gt; Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsApplyEnactment"><span class="hs-identifier hs-var hs-var">proposalsApplyEnactment</span></a></span></span><span> </span><span id="local-6989586621679608355"><span class="annot"><span class="annottext">Seq (GovActionState era)
</span><a href="#local-6989586621679608355"><span class="hs-identifier hs-var">enactedGass</span></a></span></span><span> </span><span id="local-6989586621679608356"><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608356"><span class="hs-identifier hs-var">expiredGais</span></a></span></span><span> </span><span id="local-6989586621679608357"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608357"><span class="hs-identifier hs-var">props</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-504"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679608358"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608358"><span class="hs-identifier hs-var">unexpiredProposals</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608359"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608359"><span class="hs-identifier hs-var">expiredRemoved</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
forall era.
EraPParams era =&gt;
Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveWithDescendants"><span class="hs-identifier hs-var">proposalsRemoveWithDescendants</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608356"><span class="hs-identifier hs-var">expiredGais</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608357"><span class="hs-identifier hs-var">props</span></a></span><span>
</span><span id="line-505"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679608360"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608360"><span class="hs-identifier hs-var">enactedProposalsState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608361"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608361"><span class="hs-identifier hs-var">enacted</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608362"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608362"><span class="hs-identifier hs-var">removedDueToEnactment</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-506"></span><span>        </span><span class="annot"><span class="annottext">((Proposals era, Map GovActionId (GovActionState era),
  Map GovActionId (GovActionState era))
 -&gt; GovActionState era
 -&gt; (Proposals era, Map GovActionId (GovActionState era),
     Map GovActionId (GovActionState era)))
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
-&gt; Seq (GovActionState era)
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; Seq a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">F.foldl'</span></span><span> </span><span class="annot"><span class="annottext">(Proposals era, Map GovActionId (GovActionState era),
 Map GovActionId (GovActionState era))
-&gt; GovActionState era
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
</span><a href="#local-6989586621679608363"><span class="hs-identifier hs-var">enact</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608358"><span class="hs-identifier hs-var">unexpiredProposals</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Seq (GovActionState era)
</span><a href="#local-6989586621679608355"><span class="hs-identifier hs-var">enactedGass</span></a></span><span>
</span><span id="line-507"></span><span>   </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608360"><span class="hs-identifier hs-var">enactedProposalsState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608361"><span class="hs-identifier hs-var">enacted</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608362"><span class="hs-identifier hs-var">removedDueToEnactment</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608359"><span class="hs-identifier hs-var">expiredRemoved</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-509"></span><span>    </span><span id="local-6989586621679608363"><span class="annot"><span class="annottext">enact :: (Proposals era, Map GovActionId (GovActionState era),
 Map GovActionId (GovActionState era))
-&gt; GovActionState era
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
</span><a href="#local-6989586621679608363"><span class="hs-identifier hs-var hs-var">enact</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679608365"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608365"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679608366"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608366"><span class="hs-identifier hs-var">enacted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679608367"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608367"><span class="hs-identifier hs-var">removed</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679608368"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608368"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; (Proposals era, Map GovActionId (GovActionState era),
        Map GovActionId (GovActionState era)))
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall era a.
GovActionState era
-&gt; a
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; a)
-&gt; a
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#withGovActionParent"><span class="hs-identifier hs-var">withGovActionParent</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608368"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">(Proposals era, Map GovActionId (GovActionState era),
 Map GovActionId (GovActionState era))
</span><a href="#local-6989586621679608369"><span class="hs-identifier hs-var">enactWithoutRoot</span></a></span><span> </span><span class="annot"><span class="annottext">(forall (f :: * -&gt; *) (f :: * -&gt; *).
 Functor f =&gt;
 (f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
 -&gt; GovRelation f -&gt; f (GovRelation f))
-&gt; StrictMaybe (GovPurposeId p)
-&gt; GovPurposeId p
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall (p :: GovActionPurpose).
(forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
 Functor f2 =&gt;
 (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
 -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
-&gt; StrictMaybe (GovPurposeId p)
-&gt; GovPurposeId p
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
</span><a href="#local-6989586621679608370"><span class="hs-identifier hs-var">enactFromRoot</span></a></span><span>
</span><span id="line-510"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-511"></span><span>        </span><span id="local-6989586621679608373"><span class="annot"><span class="annottext">gai :: GovActionId
</span><a href="#local-6989586621679608373"><span class="hs-identifier hs-var hs-var">gai</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608368"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Getting GovActionId (GovActionState era) GovActionId
-&gt; GovActionId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting GovActionId (GovActionState era) GovActionId
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovActionId -&gt; f GovActionId)
-&gt; GovActionState era -&gt; f (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasIdL"><span class="hs-identifier hs-var">gasIdL</span></a></span><span>
</span><span id="line-512"></span><span>        </span><span class="annot"><a href="#local-6989586621679608369"><span class="hs-identifier hs-type">enactWithoutRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-513"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-514"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-515"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>        </span><span id="local-6989586621679608369"><span class="annot"><span class="annottext">enactWithoutRoot :: (Proposals era, Map GovActionId (GovActionState era),
 Map GovActionId (GovActionState era))
</span><a href="#local-6989586621679608369"><span class="hs-identifier hs-var hs-var">enactWithoutRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-518"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679608374"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608374"><span class="hs-identifier hs-var">newOMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608375"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608375"><span class="hs-identifier hs-var">enactedAction</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set GovActionId
-&gt; OMap GovActionId (GovActionState era)
-&gt; (OMap GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall k v. Ord k =&gt; Set k -&gt; OMap k v -&gt; (OMap k v, Map k v)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#extractKeys"><span class="hs-identifier hs-var">OMap.extractKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionId -&gt; Set GovActionId
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608373"><span class="hs-identifier hs-var">gai</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era)
 -&gt; (OMap GovActionId (GovActionState era),
     Map GovActionId (GovActionState era)))
-&gt; OMap GovActionId (GovActionState era)
-&gt; (OMap GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608365"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (OMap GovActionId (GovActionState era))
     (Proposals era)
     (OMap GovActionId (GovActionState era))
-&gt; OMap GovActionId (GovActionState era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (OMap GovActionId (GovActionState era))
  (Proposals era)
  (OMap GovActionId (GovActionState era))
forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var">pPropsL</span></a></span><span>
</span><span id="line-519"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="hs-comment">-- we want an AssertionFailure here for exhaustive property-testing</span><span>
</span><span id="line-520"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608375"><span class="hs-identifier hs-var">enactedAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-521"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608365"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era)
 -&gt; Identity (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var">pPropsL</span></a></span><span> </span><span class="annot"><span class="annottext">((OMap GovActionId (GovActionState era)
  -&gt; Identity (OMap GovActionId (GovActionState era)))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; OMap GovActionId (GovActionState era)
-&gt; Proposals era
-&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608374"><span class="hs-identifier hs-var">newOMap</span></a></span><span>
</span><span id="line-522"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608366"><span class="hs-identifier hs-var">enacted</span></a></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608375"><span class="hs-identifier hs-var">enactedAction</span></a></span><span>
</span><span id="line-523"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608367"><span class="hs-identifier hs-var">removed</span></a></span><span>
</span><span id="line-524"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>        </span><span id="local-6989586621679608380"><span class="annot"><a href="#local-6989586621679608370"><span class="hs-identifier hs-type">enactFromRoot</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-526"></span><span>          </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679607046"><span class="annot"><a href="#local-6989586621679607046"><span class="hs-identifier hs-type">f</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.Type.html#Lens%27"><span class="hs-identifier hs-type">Lens'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607046"><span class="hs-identifier hs-type">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679607046"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679608380"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-527"></span><span>          </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679608380"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-528"></span><span>          </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679608380"><span class="hs-identifier hs-type">p</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-529"></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-530"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607041"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-532"></span><span>          </span><span class="hs-special">)</span></span><span>
</span><span id="line-533"></span><span>        </span><span id="local-6989586621679608370"><span class="annot"><span class="annottext">enactFromRoot :: forall (p :: GovActionPurpose).
(forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
 Functor f2 =&gt;
 (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
 -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
-&gt; StrictMaybe (GovPurposeId p)
-&gt; GovPurposeId p
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
</span><a href="#local-6989586621679608370"><span class="hs-identifier hs-var hs-var">enactFromRoot</span></a></span></span><span> </span><span id="local-6989586621679608421"><span class="annot"><span class="annottext">forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span></span><span> </span><span id="local-6989586621679608422"><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608422"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621679608423"><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608423"><span class="hs-identifier hs-var">gpi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608424"><span class="annot"><span class="annottext">siblings :: Set GovActionId
</span><a href="#local-6989586621679608424"><span class="hs-identifier hs-var hs-var">siblings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-535"></span><span>                </span><span class="annot"><span class="annottext">GovActionId -&gt; Set GovActionId -&gt; Set GovActionId
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.delete</span></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608373"><span class="hs-identifier hs-var">gai</span></a></span><span> </span><span class="annot"><span class="annottext">(Set GovActionId -&gt; Set GovActionId)
-&gt; Set GovActionId -&gt; Set GovActionId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-536"></span><span>                  </span><span class="annot"><span class="annottext">(GovPurposeId p -&gt; GovActionId)
-&gt; Set (GovPurposeId p) -&gt; Set GovActionId
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p -&gt; GovActionId
forall (p :: GovActionPurpose). GovPurposeId p -&gt; GovActionId
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#unGovPurposeId"><span class="hs-identifier hs-var">unGovPurposeId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608365"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (Set (GovPurposeId p)) (Proposals era) (Set (GovPurposeId p))
-&gt; Set (GovPurposeId p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot
 -&gt; Const (Set (GovPurposeId p)) (GovRelation PRoot))
-&gt; Proposals era -&gt; Const (Set (GovPurposeId p)) (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot
  -&gt; Const (Set (GovPurposeId p)) (GovRelation PRoot))
 -&gt; Proposals era -&gt; Const (Set (GovPurposeId p)) (Proposals era))
-&gt; ((Set (GovPurposeId p)
     -&gt; Const (Set (GovPurposeId p)) (Set (GovPurposeId p)))
    -&gt; GovRelation PRoot
    -&gt; Const (Set (GovPurposeId p)) (GovRelation PRoot))
-&gt; Getting
     (Set (GovPurposeId p)) (Proposals era) (Set (GovPurposeId p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p)
 -&gt; Const (Set (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Const (Set (GovPurposeId p)) (GovRelation PRoot)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p)
  -&gt; Const (Set (GovPurposeId p)) (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot
 -&gt; Const (Set (GovPurposeId p)) (GovRelation PRoot))
-&gt; ((Set (GovPurposeId p)
     -&gt; Const (Set (GovPurposeId p)) (Set (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p)
    -&gt; Const (Set (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; (Set (GovPurposeId p)
    -&gt; Const (Set (GovPurposeId p)) (Set (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Const (Set (GovPurposeId p)) (GovRelation PRoot)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set (GovPurposeId p)
 -&gt; Const (Set (GovPurposeId p)) (Set (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p)
-&gt; Const (Set (GovPurposeId p)) (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildrenL"><span class="hs-identifier hs-var">prChildrenL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-537"></span><span>              </span><span id="local-6989586621679608425"><span class="annot"><span class="annottext">newRootChildren :: Set (GovPurposeId p)
</span><a href="#local-6989586621679608425"><span class="hs-identifier hs-var hs-var">newRootChildren</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-538"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Maybe (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608423"><span class="hs-identifier hs-var">gpi</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Maybe (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Maybe (PEdges (GovPurposeId p))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608365"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (Proposals era)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PGraph
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (GovRelation PGraph))
-&gt; Proposals era
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p))) (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var">pGraphL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PGraph
  -&gt; Const
       (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
       (GovRelation PGraph))
 -&gt; Proposals era
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p))) (Proposals era))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Const
          (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
          (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; GovRelation PGraph
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (GovRelation PGraph))
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (Proposals era)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p)
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p)
  -&gt; Const
       (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
       (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Const
          (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
          (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p)
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p)
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-539"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (PEdges (GovPurposeId p))
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Set (GovPurposeId p) -&gt; Set (GovPurposeId p)
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId p)
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span>
</span><span id="line-540"></span><span>                  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679608426"><span class="annot"><span class="annottext">PEdges (GovPurposeId p)
</span><a href="#local-6989586621679608426"><span class="hs-identifier hs-var">pe</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PEdges (GovPurposeId p) -&gt; Set (GovPurposeId p)
forall a. PEdges a -&gt; Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildren"><span class="hs-identifier hs-var">peChildren</span></a></span><span> </span><span class="annot"><span class="annottext">PEdges (GovPurposeId p)
</span><a href="#local-6989586621679608426"><span class="hs-identifier hs-var">pe</span></a></span><span>
</span><span id="line-541"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679608427"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608427"><span class="hs-identifier hs-var">withoutSiblings</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608428"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608428"><span class="hs-identifier hs-var">removedActions</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
forall era.
EraPParams era =&gt;
Set GovActionId
-&gt; Proposals era
-&gt; (Proposals era, Map GovActionId (GovActionState era))
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsRemoveWithDescendants"><span class="hs-identifier hs-var">proposalsRemoveWithDescendants</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608424"><span class="hs-identifier hs-var">siblings</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608365"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-542"></span><span>              </span><span id="local-6989586621679608429"><span class="annot"><span class="annottext">newGraph :: Map (GovPurposeId p) (PEdges (GovPurposeId p))
</span><a href="#local-6989586621679608429"><span class="hs-identifier hs-var hs-var">newGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608423"><span class="hs-identifier hs-var">gpi</span></a></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608427"><span class="hs-identifier hs-var">withoutSiblings</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (Proposals era)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PGraph
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (GovRelation PGraph))
-&gt; Proposals era
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p))) (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var">pGraphL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PGraph
  -&gt; Const
       (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
       (GovRelation PGraph))
 -&gt; Proposals era
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p))) (Proposals era))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Const
          (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
          (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; GovRelation PGraph
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (GovRelation PGraph))
-&gt; Getting
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (Proposals era)
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p)
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p)
  -&gt; Const
       (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
       (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Const
          (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
          (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p)
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Const
         (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
         (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Const
      (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
      (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p)
-&gt; Const
     (Map (GovPurposeId p) (PEdges (GovPurposeId p)))
     (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span>
</span><span id="line-543"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621679608430"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608430"><span class="hs-identifier hs-var">newOMap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608431"><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608431"><span class="hs-identifier hs-var">enactedAction</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-544"></span><span>                </span><span class="annot"><span class="annottext">Set GovActionId
-&gt; OMap GovActionId (GovActionState era)
-&gt; (OMap GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall k v. Ord k =&gt; Set k -&gt; OMap k v -&gt; (OMap k v, Map k v)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#extractKeys"><span class="hs-identifier hs-var">OMap.extractKeys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionId -&gt; Set GovActionId
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608373"><span class="hs-identifier hs-var">gai</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era)
 -&gt; (OMap GovActionId (GovActionState era),
     Map GovActionId (GovActionState era)))
-&gt; OMap GovActionId (GovActionState era)
-&gt; (OMap GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608427"><span class="hs-identifier hs-var">withoutSiblings</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (OMap GovActionId (GovActionState era))
     (Proposals era)
     (OMap GovActionId (GovActionState era))
-&gt; OMap GovActionId (GovActionState era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (OMap GovActionId (GovActionState era))
  (Proposals era)
  (OMap GovActionId (GovActionState era))
forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var">pPropsL</span></a></span><span>
</span><span id="line-545"></span><span>              </span><span id="local-6989586621679608432"><span class="annot"><span class="annottext">newProposals :: Proposals era
</span><a href="#local-6989586621679608432"><span class="hs-identifier hs-var hs-var">newProposals</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-546"></span><span>                </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608427"><span class="hs-identifier hs-var">withoutSiblings</span></a></span><span>
</span><span id="line-547"></span><span>                  </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot -&gt; Identity (GovRelation PRoot))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; ((StrictMaybe (GovPurposeId p)
     -&gt; Identity (StrictMaybe (GovPurposeId p)))
    -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; (StrictMaybe (GovPurposeId p)
    -&gt; Identity (StrictMaybe (GovPurposeId p)))
-&gt; Proposals era
-&gt; Identity (Proposals era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; ((StrictMaybe (GovPurposeId p)
     -&gt; Identity (StrictMaybe (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; (StrictMaybe (GovPurposeId p)
    -&gt; Identity (StrictMaybe (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Identity (GovRelation PRoot)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (GovPurposeId p)
 -&gt; Identity (StrictMaybe (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRootL"><span class="hs-identifier hs-var">prRootL</span></a></span><span> </span><span class="annot"><span class="annottext">((StrictMaybe (GovPurposeId p)
  -&gt; Identity (StrictMaybe (GovPurposeId p)))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; StrictMaybe (GovPurposeId p) -&gt; Proposals era -&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p -&gt; StrictMaybe (GovPurposeId p)
forall a. a -&gt; StrictMaybe a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-var">SJust</span></a></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><a href="#local-6989586621679608423"><span class="hs-identifier hs-var">gpi</span></a></span><span> </span><span class="hs-comment">-- Set the new root</span><span>
</span><span id="line-548"></span><span>                  </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot -&gt; Identity (GovRelation PRoot))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; ((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
    -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; (Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; Proposals era
-&gt; Identity (Proposals era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot -&gt; Identity (GovRelation PRoot))
-&gt; ((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p)))
-&gt; (Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Identity (GovRelation PRoot)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p) -&gt; Identity (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Set a -&gt; f (Set a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildrenL"><span class="hs-identifier hs-var">prChildrenL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (GovPurposeId p) -&gt; Identity (Set (GovPurposeId p)))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; Set (GovPurposeId p) -&gt; Proposals era -&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId p)
</span><a href="#local-6989586621679608425"><span class="hs-identifier hs-var">newRootChildren</span></a></span><span>
</span><span id="line-549"></span><span>                  </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PGraph -&gt; f (GovRelation PGraph))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphL"><span class="hs-identifier hs-var">pGraphL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PGraph -&gt; Identity (GovRelation PGraph))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; Proposals era
-&gt; Identity (Proposals era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
 -&gt; GovRelation PGraph -&gt; Identity (GovRelation PGraph))
-&gt; ((Map (GovPurposeId p) (PEdges (GovPurposeId p))
     -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
    -&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p)))
-&gt; (Map (GovPurposeId p) (PEdges (GovPurposeId p))
    -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; GovRelation PGraph
-&gt; Identity (GovRelation PGraph)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Map (GovPurposeId p) (PEdges (GovPurposeId p))
 -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
-&gt; PGraph (GovPurposeId p) -&gt; Identity (PGraph (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(Map a (PEdges a) -&gt; f (Map a (PEdges a)))
-&gt; PGraph a -&gt; f (PGraph a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraphNodesL"><span class="hs-identifier hs-var">pGraphNodesL</span></a></span><span> </span><span class="annot"><span class="annottext">((Map (GovPurposeId p) (PEdges (GovPurposeId p))
  -&gt; Identity (Map (GovPurposeId p) (PEdges (GovPurposeId p))))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; Map (GovPurposeId p) (PEdges (GovPurposeId p))
-&gt; Proposals era
-&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Map (GovPurposeId p) (PEdges (GovPurposeId p))
</span><a href="#local-6989586621679608429"><span class="hs-identifier hs-var">newGraph</span></a></span><span>
</span><span id="line-550"></span><span>                  </span><span class="annot"><span class="annottext">Proposals era -&gt; (Proposals era -&gt; Proposals era) -&gt; Proposals era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(OMap GovActionId (GovActionState era)
 -&gt; Identity (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; Identity (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(OMap GovActionId (GovActionState era)
 -&gt; f (OMap GovActionId (GovActionState era)))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pPropsL"><span class="hs-identifier hs-var">pPropsL</span></a></span><span> </span><span class="annot"><span class="annottext">((OMap GovActionId (GovActionState era)
  -&gt; Identity (OMap GovActionId (GovActionState era)))
 -&gt; Proposals era -&gt; Identity (Proposals era))
-&gt; OMap GovActionId (GovActionState era)
-&gt; Proposals era
-&gt; Proposals era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608430"><span class="hs-identifier hs-var">newOMap</span></a></span><span>
</span><span id="line-551"></span><span>           </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
-&gt; (Proposals era, Map GovActionId (GovActionState era),
    Map GovActionId (GovActionState era))
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span>
</span><span id="line-552"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608365"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
-&gt; Getting
     (StrictMaybe (GovPurposeId p))
     (Proposals era)
     (StrictMaybe (GovPurposeId p))
-&gt; StrictMaybe (GovPurposeId p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(GovRelation PRoot
 -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
-&gt; Proposals era
-&gt; Const (StrictMaybe (GovPurposeId p)) (Proposals era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovRelation PRoot -&gt; f (GovRelation PRoot))
-&gt; Proposals era -&gt; f (Proposals era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRootsL"><span class="hs-identifier hs-var">pRootsL</span></a></span><span> </span><span class="annot"><span class="annottext">((GovRelation PRoot
  -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
 -&gt; Proposals era
 -&gt; Const (StrictMaybe (GovPurposeId p)) (Proposals era))
-&gt; ((StrictMaybe (GovPurposeId p)
     -&gt; Const
          (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
    -&gt; GovRelation PRoot
    -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
-&gt; Getting
     (StrictMaybe (GovPurposeId p))
     (Proposals era)
     (StrictMaybe (GovPurposeId p))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PRoot (GovPurposeId p)
 -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot)
forall (f :: * -&gt; *) (f :: * -&gt; *).
Functor f =&gt;
(f (GovPurposeId p) -&gt; f (f (GovPurposeId p)))
-&gt; GovRelation f -&gt; f (GovRelation f)
</span><a href="#local-6989586621679608421"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((PRoot (GovPurposeId p)
  -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
 -&gt; GovRelation PRoot
 -&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot))
-&gt; ((StrictMaybe (GovPurposeId p)
     -&gt; Const
          (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
    -&gt; PRoot (GovPurposeId p)
    -&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p)))
-&gt; (StrictMaybe (GovPurposeId p)
    -&gt; Const
         (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
-&gt; GovRelation PRoot
-&gt; Const (StrictMaybe (GovPurposeId p)) (GovRelation PRoot)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (GovPurposeId p)
 -&gt; Const
      (StrictMaybe (GovPurposeId p)) (StrictMaybe (GovPurposeId p)))
-&gt; PRoot (GovPurposeId p)
-&gt; Const (StrictMaybe (GovPurposeId p)) (PRoot (GovPurposeId p))
forall a (f :: * -&gt; *).
Functor f =&gt;
(StrictMaybe a -&gt; f (StrictMaybe a)) -&gt; PRoot a -&gt; f (PRoot a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRootL"><span class="hs-identifier hs-var">prRootL</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
-&gt; StrictMaybe (GovPurposeId p) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608422"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
forall era.
(EraPParams era, ?callStack::CallStack) =&gt;
Set GovActionId -&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#checkInvariantAfterDeletion"><span class="hs-identifier hs-var">checkInvariantAfterDeletion</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionId -&gt; Set GovActionId
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608373"><span class="hs-identifier hs-var">gai</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608427"><span class="hs-identifier hs-var">withoutSiblings</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608432"><span class="hs-identifier hs-var">newProposals</span></a></span><span>
</span><span id="line-554"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608366"><span class="hs-identifier hs-var">enacted</span></a></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608431"><span class="hs-identifier hs-var">enactedAction</span></a></span><span>
</span><span id="line-555"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608367"><span class="hs-identifier hs-var">removed</span></a></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
forall k a. Ord k =&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-operator hs-var">`Map.union`</span></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608428"><span class="hs-identifier hs-var">removedActions</span></a></span><span>
</span><span id="line-556"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="annot"><span class="hs-comment">-- | Get the sequence of `GovActionState`s</span></span><span>
</span><span id="line-559"></span><span id="local-6989586621679607055"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsActions"><span class="hs-identifier hs-type">proposalsActions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-560"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607055"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-561"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#StrictSeq"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607055"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-562"></span><span id="proposalsActions"><span class="annot"><span class="annottext">proposalsActions :: forall era. Proposals era -&gt; StrictSeq (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsActions"><span class="hs-identifier hs-var hs-var">proposalsActions</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679608434"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608434"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; StrictSeq (GovActionState era)
forall k v. Ord k =&gt; OMap k v -&gt; StrictSeq v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#toStrictSeq"><span class="hs-identifier hs-var">OMap.toStrictSeq</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608434"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span class="hs-comment">-- | Get a mapping from the reward-account staking credentials to deposits of</span><span>
</span><span id="line-565"></span><span class="hs-comment">-- all proposals.</span><span>
</span><span id="line-566"></span><span id="local-6989586621679607060"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsDeposits"><span class="hs-identifier hs-type">proposalsDeposits</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-567"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607060"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-568"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#Staking"><span class="hs-identifier hs-type">Staking</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier hs-type">CompactForm</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-569"></span><span id="proposalsDeposits"><span class="annot"><span class="annottext">proposalsDeposits :: forall era.
Proposals era -&gt; Map (Credential 'Staking) (CompactForm Coin)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsDeposits"><span class="hs-identifier hs-var hs-var">proposalsDeposits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-570"></span><span>  </span><span class="annot"><span class="annottext">(Map (Credential 'Staking) (CompactForm Coin)
 -&gt; GovActionState era
 -&gt; Map (Credential 'Staking) (CompactForm Coin))
-&gt; Map (Credential 'Staking) (CompactForm Coin)
-&gt; StrictSeq (GovActionState era)
-&gt; Map (Credential 'Staking) (CompactForm Coin)
forall b a. (b -&gt; a -&gt; b) -&gt; b -&gt; StrictSeq a -&gt; b
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">F.foldl'</span></span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679608448"><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679608448"><span class="hs-identifier hs-var">gasMap</span></a></span></span><span> </span><span id="local-6989586621679608449"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608449"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-572"></span><span>        </span><span class="annot"><span class="annottext">(CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin)
-&gt; Credential 'Staking
-&gt; CompactForm Coin
-&gt; Map (Credential 'Staking) (CompactForm Coin)
-&gt; Map (Credential 'Staking) (CompactForm Coin)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.insertWith</span></span><span>
</span><span id="line-573"></span><span>          </span><span class="annot"><span class="annottext">CompactForm Coin -&gt; CompactForm Coin -&gt; CompactForm Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#addCompactCoin"><span class="hs-identifier hs-var">addCompactCoin</span></a></span><span>
</span><span id="line-574"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608449"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Getting
     (Credential 'Staking) (GovActionState era) (Credential 'Staking)
-&gt; Credential 'Staking
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(RewardAccount -&gt; Const (Credential 'Staking) RewardAccount)
-&gt; GovActionState era
-&gt; Const (Credential 'Staking) (GovActionState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(RewardAccount -&gt; f RewardAccount)
-&gt; GovActionState era -&gt; f (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasReturnAddrL"><span class="hs-identifier hs-var">gasReturnAddrL</span></a></span><span> </span><span class="annot"><span class="annottext">((RewardAccount -&gt; Const (Credential 'Staking) RewardAccount)
 -&gt; GovActionState era
 -&gt; Const (Credential 'Staking) (GovActionState era))
-&gt; ((Credential 'Staking
     -&gt; Const (Credential 'Staking) (Credential 'Staking))
    -&gt; RewardAccount -&gt; Const (Credential 'Staking) RewardAccount)
-&gt; Getting
     (Credential 'Staking) (GovActionState era) (Credential 'Staking)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Credential 'Staking
 -&gt; Const (Credential 'Staking) (Credential 'Staking))
-&gt; RewardAccount -&gt; Const (Credential 'Staking) RewardAccount
Lens' RewardAccount (Credential 'Staking)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Address.html#rewardAccountCredentialL"><span class="hs-identifier hs-var">rewardAccountCredentialL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompactForm Coin -&gt; Maybe (CompactForm Coin) -&gt; CompactForm Coin
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; CompactForm Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-var">CompactCoin</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (CompactForm Coin) -&gt; CompactForm Coin)
-&gt; Maybe (CompactForm Coin) -&gt; CompactForm Coin
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Maybe (CompactForm Coin)
forall a. Compactible a =&gt; a -&gt; Maybe (CompactForm a)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#toCompact"><span class="hs-identifier hs-var">toCompact</span></a></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Maybe (CompactForm Coin))
-&gt; Coin -&gt; Maybe (CompactForm Coin)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608449"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Getting Coin (GovActionState era) Coin -&gt; Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Coin (GovActionState era) Coin
forall era (f :: * -&gt; *).
Functor f =&gt;
(Coin -&gt; f Coin) -&gt; GovActionState era -&gt; f (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasDepositL"><span class="hs-identifier hs-var">gasDepositL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>          </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
</span><a href="#local-6989586621679608448"><span class="hs-identifier hs-var">gasMap</span></a></span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>    </span><span class="annot"><span class="annottext">Map (Credential 'Staking) (CompactForm Coin)
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-579"></span><span>    </span><span class="annot"><span class="annottext">(StrictSeq (GovActionState era)
 -&gt; Map (Credential 'Staking) (CompactForm Coin))
-&gt; (Proposals era -&gt; StrictSeq (GovActionState era))
-&gt; Proposals era
-&gt; Map (Credential 'Staking) (CompactForm Coin)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; StrictSeq (GovActionState era)
forall era. Proposals era -&gt; StrictSeq (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsActions"><span class="hs-identifier hs-var">proposalsActions</span></a></span><span>
</span><span id="line-580"></span><span>
</span><span id="line-581"></span><span class="annot"><span class="hs-comment">-- | Get the sequence of `GovActionId`s</span></span><span>
</span><span id="line-582"></span><span id="local-6989586621679607075"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsIds"><span class="hs-identifier hs-type">proposalsIds</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-583"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607075"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-584"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#StrictSeq"><span class="hs-identifier hs-type">StrictSeq</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span></span><span>
</span><span id="line-585"></span><span id="proposalsIds"><span class="annot"><span class="annottext">proposalsIds :: forall era. Proposals era -&gt; StrictSeq GovActionId
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsIds"><span class="hs-identifier hs-var hs-var">proposalsIds</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679608453"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608453"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era) -&gt; StrictSeq GovActionId
forall k v. OMap k v -&gt; StrictSeq k
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#toStrictSeqOKeys"><span class="hs-identifier hs-var">OMap.toStrictSeqOKeys</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608453"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span class="annot"><span class="hs-comment">-- | Get the unordered map of `GovActionId`s and `GovActionState`s</span></span><span>
</span><span id="line-588"></span><span id="local-6989586621679607079"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsActionsMap"><span class="hs-identifier hs-type">proposalsActionsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-589"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607079"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-590"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607079"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-591"></span><span id="proposalsActionsMap"><span class="annot"><span class="annottext">proposalsActionsMap :: forall era. Proposals era -&gt; Map GovActionId (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsActionsMap"><span class="hs-identifier hs-var hs-var">proposalsActionsMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679608455"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608455"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
forall k v. OMap k v -&gt; Map k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#toMap"><span class="hs-identifier hs-var">OMap.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608455"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span id="local-6989586621679607081"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsSize"><span class="hs-identifier hs-type">proposalsSize</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607081"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span></span><span>
</span><span id="line-594"></span><span id="proposalsSize"><span class="annot"><span class="annottext">proposalsSize :: forall era. Proposals era -&gt; Int
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsSize"><span class="hs-identifier hs-var hs-var">proposalsSize</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679608456"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608456"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era) -&gt; Int
forall k v. OMap k v -&gt; Int
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#size"><span class="hs-identifier hs-var">OMap.size</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608456"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span id="local-6989586621679607085"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsLookupId"><span class="hs-identifier hs-type">proposalsLookupId</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-597"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-598"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607085"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-599"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607085"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-600"></span><span id="proposalsLookupId"><span class="annot"><span class="annottext">proposalsLookupId :: forall era.
GovActionId -&gt; Proposals era -&gt; Maybe (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#proposalsLookupId"><span class="hs-identifier hs-var hs-var">proposalsLookupId</span></a></span></span><span> </span><span id="local-6989586621679608459"><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608459"><span class="hs-identifier hs-var">gai</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span id="local-6989586621679608460"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608460"><span class="hs-identifier hs-var">omap</span></a></span></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovActionId
-&gt; OMap GovActionId (GovActionState era)
-&gt; Maybe (GovActionState era)
forall k v. Ord k =&gt; k -&gt; OMap k v -&gt; Maybe v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#lookup"><span class="hs-identifier hs-var">OMap.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608459"><span class="hs-identifier hs-var">gai</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608460"><span class="hs-identifier hs-var">omap</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPrevGovActionIds"><span class="hs-identifier hs-type">toPrevGovActionIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span>
</span><span id="line-603"></span><span id="toPrevGovActionIds"><span class="annot"><span class="annottext">toPrevGovActionIds :: GovRelation PRoot -&gt; GovRelation StrictMaybe
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPrevGovActionIds"><span class="hs-identifier hs-var hs-var">toPrevGovActionIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. PRoot a -&gt; StrictMaybe a)
-&gt; GovRelation PRoot -&gt; GovRelation StrictMaybe
forall (f :: * -&gt; *) (g :: * -&gt; *).
(forall a. f a -&gt; g a) -&gt; GovRelation f -&gt; GovRelation g
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#hoistGovRelation"><span class="hs-identifier hs-var">hoistGovRelation</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a -&gt; StrictMaybe a
forall a. PRoot a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span>
</span><span id="line-604"></span><span>
</span><span id="line-605"></span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#fromPrevGovActionIds"><span class="hs-identifier hs-type">fromPrevGovActionIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span>
</span><span id="line-606"></span><span id="fromPrevGovActionIds"><span class="annot"><span class="annottext">fromPrevGovActionIds :: GovRelation StrictMaybe -&gt; GovRelation PRoot
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#fromPrevGovActionIds"><span class="hs-identifier hs-var hs-var">fromPrevGovActionIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(forall a. StrictMaybe a -&gt; PRoot a)
-&gt; GovRelation StrictMaybe -&gt; GovRelation PRoot
forall (f :: * -&gt; *) (g :: * -&gt; *).
(forall a. f a -&gt; g a) -&gt; GovRelation f -&gt; GovRelation g
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#hoistGovRelation"><span class="hs-identifier hs-var">hoistGovRelation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictMaybe a -&gt; Set a -&gt; PRoot a
forall a. StrictMaybe a -&gt; Set a -&gt; PRoot a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-operator hs-var">`PRoot`</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
forall a. Set a
</span><span class="hs-identifier hs-var">Set.empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-609"></span><span class="hs-comment">-- Debugging tools --</span><span>
</span><span id="line-610"></span><span class="hs-comment">---------------------</span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span class="hs-comment">-- | Wraper type, which serves as a composition of @`Tree` . `StrictMaybe`@</span><span>
</span><span id="line-613"></span><span class="hs-comment">--</span><span>
</span><span id="line-614"></span><span class="hs-comment">-- Also its Show instance will print a nice tree structure.</span><span>
</span><span id="line-615"></span><span class="hs-keyword">data</span><span> </span><span id="TreeMaybe"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier hs-var">TreeMaybe</span></a></span></span><span> </span><span id="local-6989586621679607092"><span class="annot"><a href="#local-6989586621679607092"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TreeMaybe"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier hs-var">TreeMaybe</span></a></span></span><span> </span><span class="hs-special">{</span><span id="unTreeMaybe"><span class="annot"><span class="annottext">forall a. TreeMaybe a -&gt; Tree (StrictMaybe a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unTreeMaybe"><span class="hs-identifier hs-var hs-var">unTreeMaybe</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tree</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607092"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-616"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679608466"><span id="local-6989586621679608471"><span class="annot"><span class="annottext">TreeMaybe a -&gt; TreeMaybe a -&gt; Bool
(TreeMaybe a -&gt; TreeMaybe a -&gt; Bool)
-&gt; (TreeMaybe a -&gt; TreeMaybe a -&gt; Bool) -&gt; Eq (TreeMaybe a)
forall a. Eq a =&gt; TreeMaybe a -&gt; TreeMaybe a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; TreeMaybe a -&gt; TreeMaybe a -&gt; Bool
== :: TreeMaybe a -&gt; TreeMaybe a -&gt; Bool
$c/= :: forall a. Eq a =&gt; TreeMaybe a -&gt; TreeMaybe a -&gt; Bool
/= :: TreeMaybe a -&gt; TreeMaybe a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679607100"><span id="local-6989586621679608475"><span id="local-6989586621679608480"><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier hs-type">TreeMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607100"><span class="hs-identifier hs-type">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-619"></span><span>  </span><span id="local-6989586621679608487"><span class="annot"><span class="annottext">show :: TreeMaybe (GovPurposeId p) -&gt; String
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">show</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ShowS
-&gt; (TreeMaybe (GovPurposeId p) -&gt; String)
-&gt; TreeMaybe (GovPurposeId p)
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Tree String -&gt; String
</span><span class="hs-identifier hs-var">drawTree</span></span><span> </span><span class="annot"><span class="annottext">(Tree String -&gt; String)
-&gt; (TreeMaybe (GovPurposeId p) -&gt; Tree String)
-&gt; TreeMaybe (GovPurposeId p)
-&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (GovPurposeId p) -&gt; String)
-&gt; Tree (StrictMaybe (GovPurposeId p)) -&gt; Tree String
forall a b. (a -&gt; b) -&gt; Tree a -&gt; Tree b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p) -&gt; String
forall {p :: GovActionPurpose}.
StrictMaybe (GovPurposeId p) -&gt; String
</span><a href="#local-6989586621679608489"><span class="hs-identifier hs-var">showGovPurposeId</span></a></span><span> </span><span class="annot"><span class="annottext">(Tree (StrictMaybe (GovPurposeId p)) -&gt; Tree String)
-&gt; (TreeMaybe (GovPurposeId p)
    -&gt; Tree (StrictMaybe (GovPurposeId p)))
-&gt; TreeMaybe (GovPurposeId p)
-&gt; Tree String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId p) -&gt; Tree (StrictMaybe (GovPurposeId p))
forall a. TreeMaybe a -&gt; Tree (StrictMaybe a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#unTreeMaybe"><span class="hs-identifier hs-var">unTreeMaybe</span></a></span><span>
</span><span id="line-620"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-621"></span><span>      </span><span id="local-6989586621679608489"><span class="annot"><span class="annottext">showGovPurposeId :: StrictMaybe (GovPurposeId p) -&gt; String
</span><a href="#local-6989586621679608489"><span class="hs-identifier hs-var hs-var">showGovPurposeId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-622"></span><span>        </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;x&quot;</span></span><span>
</span><span id="line-623"></span><span>        </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-type">GovPurposeId</span></a></span><span> </span><span id="local-6989586621679608492"><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608492"><span class="hs-identifier hs-var">govActionId</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; String
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionId -&gt; Text
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#govActionIdToText"><span class="hs-identifier hs-var">govActionIdToText</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679608492"><span class="hs-identifier hs-var">govActionId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span class="annot"><span class="hs-comment">-- | Partial version of `toGovRelationTreeEither`</span></span><span>
</span><span id="line-626"></span><span id="local-6989586621679607105"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTree"><span class="hs-identifier hs-type">toGovRelationTree</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607105"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier hs-type">TreeMaybe</span></a></span></span><span>
</span><span id="line-627"></span><span id="toGovRelationTree"><span class="annot"><span class="annottext">toGovRelationTree :: forall era.
(?callStack::CallStack) =&gt;
Proposals era -&gt; GovRelation TreeMaybe
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTree"><span class="hs-identifier hs-var hs-var">toGovRelationTree</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; GovRelation TreeMaybe)
-&gt; (GovRelation TreeMaybe -&gt; GovRelation TreeMaybe)
-&gt; Either String (GovRelation TreeMaybe)
-&gt; GovRelation TreeMaybe
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; GovRelation TreeMaybe
forall a. (?callStack::CallStack) =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">GovRelation TreeMaybe -&gt; GovRelation TreeMaybe
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">(Either String (GovRelation TreeMaybe) -&gt; GovRelation TreeMaybe)
-&gt; (Proposals era -&gt; Either String (GovRelation TreeMaybe))
-&gt; Proposals era
-&gt; GovRelation TreeMaybe
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; Either String (GovRelation TreeMaybe)
forall era. Proposals era -&gt; Either String (GovRelation TreeMaybe)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTreeEither"><span class="hs-identifier hs-var">toGovRelationTreeEither</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="annot"><span class="hs-comment">-- | Convert `Proposals` into a valid `Tree`</span></span><span>
</span><span id="line-630"></span><span id="local-6989586621679607110"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTreeEither"><span class="hs-identifier hs-type">toGovRelationTreeEither</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607110"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier hs-type">TreeMaybe</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-631"></span><span id="toGovRelationTreeEither"><span class="annot"><span class="annottext">toGovRelationTreeEither :: forall era. Proposals era -&gt; Either String (GovRelation TreeMaybe)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTreeEither"><span class="hs-identifier hs-var hs-var">toGovRelationTreeEither</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679608545"><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
pProps :: forall era. Proposals era -&gt; OMap GovActionId (GovActionState era)
pProps :: OMap GovActionId (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pProps"><span class="hs-identifier hs-var hs-var">pProps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608546"><span class="annot"><span class="annottext">GovRelation PRoot
pRoots :: forall era. Proposals era -&gt; GovRelation PRoot
pRoots :: GovRelation PRoot
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pRoots"><span class="hs-identifier hs-var hs-var">pRoots</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608547"><span class="annot"><span class="annottext">GovRelation PGraph
pGraph :: forall era. Proposals era -&gt; GovRelation PGraph
pGraph :: GovRelation PGraph
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#pGraph"><span class="hs-identifier hs-var hs-var">pGraph</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-632"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era) -&gt; Bool
forall k v. Ord k =&gt; OMap k v -&gt; Bool
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#invariantHolds%27"><span class="hs-identifier hs-var">OMap.invariantHolds'</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608545"><span class="hs-identifier hs-var">pProps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;OMap invariant is violated&quot;</span></span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608549"><span class="annot"><span class="annottext">propsMap :: Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608549"><span class="hs-identifier hs-var hs-var">propsMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
-&gt; Map GovActionId (GovActionState era)
forall k v. OMap k v -&gt; Map k v
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OMap.Strict.html#toMap"><span class="hs-identifier hs-var">OMap.toMap</span></a></span><span> </span><span class="annot"><span class="annottext">OMap GovActionId (GovActionState era)
</span><a href="#local-6989586621679608545"><span class="hs-identifier hs-var">pProps</span></a></span><span>
</span><span id="line-635"></span><span>      </span><span id="local-6989586621679608550"><span class="annot"><span class="annottext">childParentRelation :: GovRelation ChildParent
</span><a href="#local-6989586621679608550"><span class="hs-identifier hs-var hs-var">childParentRelation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era) -&gt; GovRelation ChildParent
forall (f :: * -&gt; *) era.
Foldable f =&gt;
f (GovActionState era) -&gt; GovRelation ChildParent
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toChildParentRelation"><span class="hs-identifier hs-var">toChildParentRelation</span></a></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608549"><span class="hs-identifier hs-var">propsMap</span></a></span><span>
</span><span id="line-636"></span><span>
</span><span id="line-637"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679608552"><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'PParamUpdatePurpose)
</span><a href="#local-6989586621679608552"><span class="hs-identifier hs-var">grPParamUpdate</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608553"><span class="annot"><span class="annottext">Set (GovPurposeId 'PParamUpdatePurpose)
</span><a href="#local-6989586621679608553"><span class="hs-identifier hs-var">nodesPParamUpdate</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-638"></span><span>    </span><span class="annot"><span class="annottext">ChildParent (GovPurposeId 'PParamUpdatePurpose)
-&gt; PRoot (GovPurposeId 'PParamUpdatePurpose)
-&gt; PGraph (GovPurposeId 'PParamUpdatePurpose)
-&gt; Either
     String
     (TreeMaybe (GovPurposeId 'PParamUpdatePurpose),
      Set (GovPurposeId 'PParamUpdatePurpose))
forall a.
(Ord a, Show a) =&gt;
ChildParent a
-&gt; PRoot a -&gt; PGraph a -&gt; Either String (TreeMaybe a, Set a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPTree"><span class="hs-identifier hs-var">toPTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation ChildParent
-&gt; ChildParent (GovPurposeId 'PParamUpdatePurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'PParamUpdatePurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grPParamUpdate"><span class="hs-identifier hs-var">grPParamUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation ChildParent
</span><a href="#local-6989586621679608550"><span class="hs-identifier hs-var">childParentRelation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PRoot -&gt; PRoot (GovPurposeId 'PParamUpdatePurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'PParamUpdatePurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grPParamUpdate"><span class="hs-identifier hs-var">grPParamUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608546"><span class="hs-identifier hs-var">pRoots</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PGraph -&gt; PGraph (GovPurposeId 'PParamUpdatePurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'PParamUpdatePurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grPParamUpdate"><span class="hs-identifier hs-var">grPParamUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608547"><span class="hs-identifier hs-var">pGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679608556"><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'HardForkPurpose)
</span><a href="#local-6989586621679608556"><span class="hs-identifier hs-var">grHardFork</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608557"><span class="annot"><span class="annottext">Set (GovPurposeId 'HardForkPurpose)
</span><a href="#local-6989586621679608557"><span class="hs-identifier hs-var">nodesHardFork</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-640"></span><span>    </span><span class="annot"><span class="annottext">ChildParent (GovPurposeId 'HardForkPurpose)
-&gt; PRoot (GovPurposeId 'HardForkPurpose)
-&gt; PGraph (GovPurposeId 'HardForkPurpose)
-&gt; Either
     String
     (TreeMaybe (GovPurposeId 'HardForkPurpose),
      Set (GovPurposeId 'HardForkPurpose))
forall a.
(Ord a, Show a) =&gt;
ChildParent a
-&gt; PRoot a -&gt; PGraph a -&gt; Either String (TreeMaybe a, Set a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPTree"><span class="hs-identifier hs-var">toPTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation ChildParent
-&gt; ChildParent (GovPurposeId 'HardForkPurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'HardForkPurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grHardFork"><span class="hs-identifier hs-var">grHardFork</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation ChildParent
</span><a href="#local-6989586621679608550"><span class="hs-identifier hs-var">childParentRelation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PRoot -&gt; PRoot (GovPurposeId 'HardForkPurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'HardForkPurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grHardFork"><span class="hs-identifier hs-var">grHardFork</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608546"><span class="hs-identifier hs-var">pRoots</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PGraph -&gt; PGraph (GovPurposeId 'HardForkPurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'HardForkPurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grHardFork"><span class="hs-identifier hs-var">grHardFork</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608547"><span class="hs-identifier hs-var">pGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679608559"><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'CommitteePurpose)
</span><a href="#local-6989586621679608559"><span class="hs-identifier hs-var">grCommittee</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608560"><span class="annot"><span class="annottext">Set (GovPurposeId 'CommitteePurpose)
</span><a href="#local-6989586621679608560"><span class="hs-identifier hs-var">nodesCommittee</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-642"></span><span>    </span><span class="annot"><span class="annottext">ChildParent (GovPurposeId 'CommitteePurpose)
-&gt; PRoot (GovPurposeId 'CommitteePurpose)
-&gt; PGraph (GovPurposeId 'CommitteePurpose)
-&gt; Either
     String
     (TreeMaybe (GovPurposeId 'CommitteePurpose),
      Set (GovPurposeId 'CommitteePurpose))
forall a.
(Ord a, Show a) =&gt;
ChildParent a
-&gt; PRoot a -&gt; PGraph a -&gt; Either String (TreeMaybe a, Set a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPTree"><span class="hs-identifier hs-var">toPTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation ChildParent
-&gt; ChildParent (GovPurposeId 'CommitteePurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'CommitteePurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grCommittee"><span class="hs-identifier hs-var">grCommittee</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation ChildParent
</span><a href="#local-6989586621679608550"><span class="hs-identifier hs-var">childParentRelation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PRoot -&gt; PRoot (GovPurposeId 'CommitteePurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'CommitteePurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grCommittee"><span class="hs-identifier hs-var">grCommittee</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608546"><span class="hs-identifier hs-var">pRoots</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PGraph -&gt; PGraph (GovPurposeId 'CommitteePurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'CommitteePurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grCommittee"><span class="hs-identifier hs-var">grCommittee</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608547"><span class="hs-identifier hs-var">pGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679608562"><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'ConstitutionPurpose)
</span><a href="#local-6989586621679608562"><span class="hs-identifier hs-var">grConstitution</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608563"><span class="annot"><span class="annottext">Set (GovPurposeId 'ConstitutionPurpose)
</span><a href="#local-6989586621679608563"><span class="hs-identifier hs-var">nodesConstitution</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-644"></span><span>    </span><span class="annot"><span class="annottext">ChildParent (GovPurposeId 'ConstitutionPurpose)
-&gt; PRoot (GovPurposeId 'ConstitutionPurpose)
-&gt; PGraph (GovPurposeId 'ConstitutionPurpose)
-&gt; Either
     String
     (TreeMaybe (GovPurposeId 'ConstitutionPurpose),
      Set (GovPurposeId 'ConstitutionPurpose))
forall a.
(Ord a, Show a) =&gt;
ChildParent a
-&gt; PRoot a -&gt; PGraph a -&gt; Either String (TreeMaybe a, Set a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPTree"><span class="hs-identifier hs-var">toPTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation ChildParent
-&gt; ChildParent (GovPurposeId 'ConstitutionPurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'ConstitutionPurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grConstitution"><span class="hs-identifier hs-var">grConstitution</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation ChildParent
</span><a href="#local-6989586621679608550"><span class="hs-identifier hs-var">childParentRelation</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PRoot -&gt; PRoot (GovPurposeId 'ConstitutionPurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'ConstitutionPurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grConstitution"><span class="hs-identifier hs-var">grConstitution</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PRoot
</span><a href="#local-6989586621679608546"><span class="hs-identifier hs-var">pRoots</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovRelation PGraph -&gt; PGraph (GovPurposeId 'ConstitutionPurpose)
forall (f :: * -&gt; *).
GovRelation f -&gt; f (GovPurposeId 'ConstitutionPurpose)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#grConstitution"><span class="hs-identifier hs-var">grConstitution</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation PGraph
</span><a href="#local-6989586621679608547"><span class="hs-identifier hs-var">pGraph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608565"><span class="annot"><span class="annottext">allNodes :: Set GovActionId
</span><a href="#local-6989586621679608565"><span class="hs-identifier hs-var hs-var">allNodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-647"></span><span>        </span><span class="annot"><span class="annottext">[Set GovActionId] -&gt; Set GovActionId
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><span class="hs-identifier hs-var">Set.unions</span></span><span>
</span><span id="line-648"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(GovPurposeId 'PParamUpdatePurpose -&gt; GovActionId)
-&gt; Set (GovPurposeId 'PParamUpdatePurpose) -&gt; Set GovActionId
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId 'PParamUpdatePurpose -&gt; GovActionId
forall (p :: GovActionPurpose). GovPurposeId p -&gt; GovActionId
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#unGovPurposeId"><span class="hs-identifier hs-var">unGovPurposeId</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'PParamUpdatePurpose)
</span><a href="#local-6989586621679608553"><span class="hs-identifier hs-var">nodesPParamUpdate</span></a></span><span>
</span><span id="line-649"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(GovPurposeId 'HardForkPurpose -&gt; GovActionId)
-&gt; Set (GovPurposeId 'HardForkPurpose) -&gt; Set GovActionId
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId 'HardForkPurpose -&gt; GovActionId
forall (p :: GovActionPurpose). GovPurposeId p -&gt; GovActionId
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#unGovPurposeId"><span class="hs-identifier hs-var">unGovPurposeId</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'HardForkPurpose)
</span><a href="#local-6989586621679608557"><span class="hs-identifier hs-var">nodesHardFork</span></a></span><span>
</span><span id="line-650"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(GovPurposeId 'CommitteePurpose -&gt; GovActionId)
-&gt; Set (GovPurposeId 'CommitteePurpose) -&gt; Set GovActionId
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId 'CommitteePurpose -&gt; GovActionId
forall (p :: GovActionPurpose). GovPurposeId p -&gt; GovActionId
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#unGovPurposeId"><span class="hs-identifier hs-var">unGovPurposeId</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'CommitteePurpose)
</span><a href="#local-6989586621679608560"><span class="hs-identifier hs-var">nodesCommittee</span></a></span><span>
</span><span id="line-651"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(GovPurposeId 'ConstitutionPurpose -&gt; GovActionId)
-&gt; Set (GovPurposeId 'ConstitutionPurpose) -&gt; Set GovActionId
forall b a. Ord b =&gt; (a -&gt; b) -&gt; Set a -&gt; Set b
</span><span class="hs-identifier hs-var">Set.map</span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId 'ConstitutionPurpose -&gt; GovActionId
forall (p :: GovActionPurpose). GovPurposeId p -&gt; GovActionId
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#unGovPurposeId"><span class="hs-identifier hs-var">unGovPurposeId</span></a></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'ConstitutionPurpose)
</span><a href="#local-6989586621679608563"><span class="hs-identifier hs-var">nodesConstitution</span></a></span><span>
</span><span id="line-652"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-653"></span><span>      </span><span id="local-6989586621679608567"><span class="annot"><span class="annottext">guardUnknown :: Either String ()
</span><a href="#local-6989586621679608567"><span class="hs-identifier hs-var hs-var">guardUnknown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608568"><span class="annot"><span class="annottext">unknown :: Set GovActionId
</span><a href="#local-6989586621679608568"><span class="hs-identifier hs-var hs-var">unknown</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608565"><span class="hs-identifier hs-var">allNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; Set GovActionId -&gt; Set GovActionId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">Set.\\</span></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era) -&gt; Set GovActionId
forall k a. Map k a -&gt; Set k
</span><span class="hs-identifier hs-var">Map.keysSet</span></span><span> </span><span class="annot"><span class="annottext">Map GovActionId (GovActionState era)
</span><a href="#local-6989586621679608549"><span class="hs-identifier hs-var">propsMap</span></a></span><span>
</span><span id="line-655"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set GovActionId -&gt; Bool
forall a. Set a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608568"><span class="hs-identifier hs-var">unknown</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-656"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Discovered unrecognized nodes: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608568"><span class="hs-identifier hs-var">unknown</span></a></span><span>
</span><span id="line-657"></span><span>      </span><span id="local-6989586621679608572"><span class="annot"><span class="annottext">guardUnique :: Either String ()
</span><a href="#local-6989586621679608572"><span class="hs-identifier hs-var hs-var">guardUnique</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-658"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608573"><span class="annot"><span class="annottext">sumSizes :: Int
</span><a href="#local-6989586621679608573"><span class="hs-identifier hs-var hs-var">sumSizes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-659"></span><span>              </span><span class="annot"><span class="annottext">[Int] -&gt; Int
forall a. Num a =&gt; [a] -&gt; a
forall (t :: * -&gt; *) a. (Foldable t, Num a) =&gt; t a -&gt; a
</span><span class="hs-identifier hs-var">sum</span></span><span>
</span><span id="line-660"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'PParamUpdatePurpose) -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'PParamUpdatePurpose)
</span><a href="#local-6989586621679608553"><span class="hs-identifier hs-var">nodesPParamUpdate</span></a></span><span>
</span><span id="line-661"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'HardForkPurpose) -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'HardForkPurpose)
</span><a href="#local-6989586621679608557"><span class="hs-identifier hs-var">nodesHardFork</span></a></span><span>
</span><span id="line-662"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'CommitteePurpose) -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'CommitteePurpose)
</span><a href="#local-6989586621679608560"><span class="hs-identifier hs-var">nodesCommittee</span></a></span><span>
</span><span id="line-663"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'ConstitutionPurpose) -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set (GovPurposeId 'ConstitutionPurpose)
</span><a href="#local-6989586621679608563"><span class="hs-identifier hs-var">nodesConstitution</span></a></span><span>
</span><span id="line-664"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-665"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set GovActionId -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608565"><span class="hs-identifier hs-var">allNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679608573"><span class="hs-identifier hs-var">sumSizes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-666"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-667"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Duplicate govActionIds found between different purposes: &quot;</span></span><span>
</span><span id="line-668"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679608573"><span class="hs-identifier hs-var">sumSizes</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608565"><span class="hs-identifier hs-var">allNodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>  </span><span class="annot"><span class="annottext">Either String ()
</span><a href="#local-6989586621679608567"><span class="hs-identifier hs-var">guardUnknown</span></a></span><span>
</span><span id="line-670"></span><span>  </span><span class="annot"><span class="annottext">Either String ()
</span><a href="#local-6989586621679608572"><span class="hs-identifier hs-var">guardUnique</span></a></span><span>
</span><span id="line-671"></span><span>  </span><span class="annot"><span class="annottext">GovRelation TreeMaybe -&gt; Either String (GovRelation TreeMaybe)
forall a. a -&gt; Either String a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'PParamUpdatePurpose)
grPParamUpdate :: TreeMaybe (GovPurposeId 'PParamUpdatePurpose)
grPParamUpdate :: TreeMaybe (GovPurposeId 'PParamUpdatePurpose)
</span><a href="#local-6989586621679608552"><span class="hs-identifier hs-var hs-var">grPParamUpdate</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'HardForkPurpose)
grHardFork :: TreeMaybe (GovPurposeId 'HardForkPurpose)
grHardFork :: TreeMaybe (GovPurposeId 'HardForkPurpose)
</span><a href="#local-6989586621679608556"><span class="hs-identifier hs-var hs-var">grHardFork</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'CommitteePurpose)
grCommittee :: TreeMaybe (GovPurposeId 'CommitteePurpose)
grCommittee :: TreeMaybe (GovPurposeId 'CommitteePurpose)
</span><a href="#local-6989586621679608559"><span class="hs-identifier hs-var hs-var">grCommittee</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TreeMaybe (GovPurposeId 'ConstitutionPurpose)
grConstitution :: TreeMaybe (GovPurposeId 'ConstitutionPurpose)
grConstitution :: TreeMaybe (GovPurposeId 'ConstitutionPurpose)
</span><a href="#local-6989586621679608562"><span class="hs-identifier hs-var hs-var">grConstitution</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span class="annot"><span class="hs-comment">-- | Mapping from a child to a parent that was specified in the GovAction.</span></span><span>
</span><span id="line-674"></span><span class="hs-keyword">newtype</span><span> </span><span id="ChildParent"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#ChildParent"><span class="hs-identifier hs-var">ChildParent</span></a></span></span><span> </span><span id="local-6989586621679607159"><span class="annot"><a href="#local-6989586621679607159"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ChildParent"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#ChildParent"><span class="hs-identifier hs-var">ChildParent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="#local-6989586621679607159"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607159"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679608580"><span id="local-6989586621679608585"><span id="local-6989586621679608589"><span class="annot"><span class="annottext">Int -&gt; ChildParent a -&gt; ShowS
[ChildParent a] -&gt; ShowS
ChildParent a -&gt; String
(Int -&gt; ChildParent a -&gt; ShowS)
-&gt; (ChildParent a -&gt; String)
-&gt; ([ChildParent a] -&gt; ShowS)
-&gt; Show (ChildParent a)
forall a. Show a =&gt; Int -&gt; ChildParent a -&gt; ShowS
forall a. Show a =&gt; [ChildParent a] -&gt; ShowS
forall a. Show a =&gt; ChildParent a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; ChildParent a -&gt; ShowS
showsPrec :: Int -&gt; ChildParent a -&gt; ShowS
$cshow :: forall a. Show a =&gt; ChildParent a -&gt; String
show :: ChildParent a -&gt; String
$cshowList :: forall a. Show a =&gt; [ChildParent a] -&gt; ShowS
showList :: [ChildParent a] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679608593"><span id="local-6989586621679608598"><span class="annot"><span class="annottext">ChildParent a -&gt; ChildParent a -&gt; Bool
(ChildParent a -&gt; ChildParent a -&gt; Bool)
-&gt; (ChildParent a -&gt; ChildParent a -&gt; Bool) -&gt; Eq (ChildParent a)
forall a. Eq a =&gt; ChildParent a -&gt; ChildParent a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall a. Eq a =&gt; ChildParent a -&gt; ChildParent a -&gt; Bool
== :: ChildParent a -&gt; ChildParent a -&gt; Bool
$c/= :: forall a. Eq a =&gt; ChildParent a -&gt; ChildParent a -&gt; Bool
/= :: ChildParent a -&gt; ChildParent a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608605"><span id="local-6989586621679608610"><span id="local-6989586621679608616"><span class="annot"><span class="annottext">NonEmpty (ChildParent a) -&gt; ChildParent a
ChildParent a -&gt; ChildParent a -&gt; ChildParent a
(ChildParent a -&gt; ChildParent a -&gt; ChildParent a)
-&gt; (NonEmpty (ChildParent a) -&gt; ChildParent a)
-&gt; (forall b. Integral b =&gt; b -&gt; ChildParent a -&gt; ChildParent a)
-&gt; Semigroup (ChildParent a)
forall b. Integral b =&gt; b -&gt; ChildParent a -&gt; ChildParent a
forall a. Ord a =&gt; NonEmpty (ChildParent a) -&gt; ChildParent a
forall a. Ord a =&gt; ChildParent a -&gt; ChildParent a -&gt; ChildParent a
forall a b.
(Ord a, Integral b) =&gt;
b -&gt; ChildParent a -&gt; ChildParent a
forall a.
(a -&gt; a -&gt; a)
-&gt; (NonEmpty a -&gt; a)
-&gt; (forall b. Integral b =&gt; b -&gt; a -&gt; a)
-&gt; Semigroup a
$c&lt;&gt; :: forall a. Ord a =&gt; ChildParent a -&gt; ChildParent a -&gt; ChildParent a
&lt;&gt; :: ChildParent a -&gt; ChildParent a -&gt; ChildParent a
$csconcat :: forall a. Ord a =&gt; NonEmpty (ChildParent a) -&gt; ChildParent a
sconcat :: NonEmpty (ChildParent a) -&gt; ChildParent a
$cstimes :: forall a b.
(Ord a, Integral b) =&gt;
b -&gt; ChildParent a -&gt; ChildParent a
stimes :: forall b. Integral b =&gt; b -&gt; ChildParent a -&gt; ChildParent a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Semigroup</span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608627"><span id="local-6989586621679608631"><span id="local-6989586621679608635"><span class="annot"><span class="annottext">Semigroup (ChildParent a)
ChildParent a
Semigroup (ChildParent a) =&gt;
ChildParent a
-&gt; (ChildParent a -&gt; ChildParent a -&gt; ChildParent a)
-&gt; ([ChildParent a] -&gt; ChildParent a)
-&gt; Monoid (ChildParent a)
[ChildParent a] -&gt; ChildParent a
ChildParent a -&gt; ChildParent a -&gt; ChildParent a
forall a. Ord a =&gt; Semigroup (ChildParent a)
forall a. Ord a =&gt; ChildParent a
forall a. Ord a =&gt; [ChildParent a] -&gt; ChildParent a
forall a. Ord a =&gt; ChildParent a -&gt; ChildParent a -&gt; ChildParent a
forall a.
Semigroup a =&gt;
a -&gt; (a -&gt; a -&gt; a) -&gt; ([a] -&gt; a) -&gt; Monoid a
$cmempty :: forall a. Ord a =&gt; ChildParent a
mempty :: ChildParent a
$cmappend :: forall a. Ord a =&gt; ChildParent a -&gt; ChildParent a -&gt; ChildParent a
mappend :: ChildParent a -&gt; ChildParent a -&gt; ChildParent a
$cmconcat :: forall a. Ord a =&gt; [ChildParent a] -&gt; ChildParent a
mconcat :: [ChildParent a] -&gt; ChildParent a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Monoid</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span id="local-6989586621679607124"><span id="local-6989586621679607125"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toChildParentRelation"><span class="hs-identifier hs-type">toChildParentRelation</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-679"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Foldable</span></span><span> </span><span class="annot"><a href="#local-6989586621679607124"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-680"></span><span>  </span><span class="annot"><a href="#local-6989586621679607124"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607125"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-681"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#ChildParent"><span class="hs-identifier hs-type">ChildParent</span></a></span></span></span><span>
</span><span id="line-682"></span><span id="toChildParentRelation"><span class="annot"><span class="annottext">toChildParentRelation :: forall (f :: * -&gt; *) era.
Foldable f =&gt;
f (GovActionState era) -&gt; GovRelation ChildParent
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toChildParentRelation"><span class="hs-identifier hs-var hs-var">toChildParentRelation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GovActionState era -&gt; GovRelation ChildParent)
-&gt; f (GovActionState era) -&gt; GovRelation ChildParent
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; f a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; GovRelation ChildParent
forall {era}. GovActionState era -&gt; GovRelation ChildParent
</span><a href="#local-6989586621679608645"><span class="hs-identifier hs-var">toChildParent</span></a></span><span>
</span><span id="line-683"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-684"></span><span>    </span><span id="local-6989586621679608645"><span class="annot"><span class="annottext">toChildParent :: GovActionState era -&gt; GovRelation ChildParent
</span><a href="#local-6989586621679608645"><span class="hs-identifier hs-var hs-var">toChildParent</span></a></span></span><span> </span><span id="local-6989586621679608648"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608648"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-685"></span><span>      </span><span class="annot"><span class="annottext">GovActionState era
-&gt; GovRelation ChildParent
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; GovRelation ChildParent)
-&gt; GovRelation ChildParent
forall era a.
GovActionState era
-&gt; a
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; a)
-&gt; a
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#withGovActionParent"><span class="hs-identifier hs-var">withGovActionParent</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608648"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation ChildParent
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">((forall (p :: GovActionPurpose).
  (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
   Functor f2 =&gt;
   (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
   -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
  -&gt; StrictMaybe (GovPurposeId p)
  -&gt; GovPurposeId p
  -&gt; GovRelation ChildParent)
 -&gt; GovRelation ChildParent)
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p)
    -&gt; GovPurposeId p
    -&gt; GovRelation ChildParent)
-&gt; GovRelation ChildParent
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679608653"><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608653"><span class="hs-identifier hs-var">govRelationL</span></a></span></span><span> </span><span id="local-6989586621679608654"><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608654"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-686"></span><span>        </span><span class="annot"><span class="annottext">GovRelation ChildParent
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="annot"><span class="annottext">GovRelation ChildParent
-&gt; (GovRelation ChildParent -&gt; GovRelation ChildParent)
-&gt; GovRelation ChildParent
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ChildParent (GovPurposeId p)
 -&gt; Identity (ChildParent (GovPurposeId p)))
-&gt; GovRelation ChildParent -&gt; Identity (GovRelation ChildParent)
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679608653"><span class="hs-identifier hs-var">govRelationL</span></a></span><span> </span><span class="annot"><span class="annottext">((ChildParent (GovPurposeId p)
  -&gt; Identity (ChildParent (GovPurposeId p)))
 -&gt; GovRelation ChildParent -&gt; Identity (GovRelation ChildParent))
-&gt; ChildParent (GovPurposeId p)
-&gt; GovRelation ChildParent
-&gt; GovRelation ChildParent
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Map (GovPurposeId p) (StrictMaybe (GovPurposeId p))
-&gt; ChildParent (GovPurposeId p)
forall a. Map a (StrictMaybe a) -&gt; ChildParent a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#ChildParent"><span class="hs-identifier hs-var">ChildParent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovPurposeId p
-&gt; StrictMaybe (GovPurposeId p)
-&gt; Map (GovPurposeId p) (StrictMaybe (GovPurposeId p))
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionId -&gt; GovPurposeId p
forall (p :: GovActionPurpose). GovActionId -&gt; GovPurposeId p
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovPurposeId"><span class="hs-identifier hs-var">GovPurposeId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608648"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Getting GovActionId (GovActionState era) GovActionId
-&gt; GovActionId
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting GovActionId (GovActionState era) GovActionId
forall era (f :: * -&gt; *).
Functor f =&gt;
(GovActionId -&gt; f GovActionId)
-&gt; GovActionState era -&gt; f (GovActionState era)
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasIdL"><span class="hs-identifier hs-var">gasIdL</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679608654"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span id="local-6989586621679607126"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPTree"><span class="hs-identifier hs-type">toPTree</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-689"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ord</span></span><span> </span><span class="annot"><a href="#local-6989586621679607126"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Show</span></span><span> </span><span class="annot"><a href="#local-6989586621679607126"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-690"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#ChildParent"><span class="hs-identifier hs-type">ChildParent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607126"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-691"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PRoot"><span class="hs-identifier hs-type">PRoot</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607126"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-692"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier hs-type">PGraph</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607126"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-693"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier hs-type">TreeMaybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607126"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="#local-6989586621679607126"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-694"></span><span id="toPTree"><span class="annot"><span class="annottext">toPTree :: forall a.
(Ord a, Show a) =&gt;
ChildParent a
-&gt; PRoot a -&gt; PGraph a -&gt; Either String (TreeMaybe a, Set a)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toPTree"><span class="hs-identifier hs-var hs-var">toPTree</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#ChildParent"><span class="hs-identifier hs-type">ChildParent</span></a></span><span> </span><span id="local-6989586621679608718"><span class="annot"><span class="annottext">Map a (StrictMaybe a)
</span><a href="#local-6989586621679608718"><span class="hs-identifier hs-var">childParent</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679608719"><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679608719"><span class="hs-identifier hs-var">root</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#PGraph"><span class="hs-identifier hs-type">PGraph</span></a></span><span> </span><span id="local-6989586621679608720"><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608720"><span class="hs-identifier hs-var">fullGraph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-695"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608721"><span class="annot"><span class="annottext">Tree (StrictMaybe a)
</span><a href="#local-6989586621679608721"><span class="hs-identifier hs-var">tree</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
-&gt; Set a
-&gt; Map a (PEdges a)
-&gt; Either String (Map a (PEdges a), Tree (StrictMaybe a))
</span><a href="#local-6989586621679608722"><span class="hs-identifier hs-var">nodeToTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PRoot a -&gt; StrictMaybe a
forall a. PRoot a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679608719"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PRoot a -&gt; Set a
forall a. PRoot a -&gt; Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prChildren"><span class="hs-identifier hs-var">prChildren</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679608719"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608720"><span class="hs-identifier hs-var">fullGraph</span></a></span><span>
</span><span id="line-696"></span><span>  </span><span id="local-6989586621679608723"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679608723"><span class="hs-identifier hs-var">nodesList</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-697"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either () a] -&gt; ([()], [a])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">([Either () a] -&gt; ([()], [a])) -&gt; [Either () a] -&gt; ([()], [a])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe a -&gt; Either () a) -&gt; [StrictMaybe a] -&gt; [Either () a]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either () a -&gt; (a -&gt; Either () a) -&gt; StrictMaybe a -&gt; Either () a
forall a b. a -&gt; (b -&gt; a) -&gt; StrictMaybe b -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#strictMaybe"><span class="hs-identifier hs-var">strictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; Either () a
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">a -&gt; Either () a
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([StrictMaybe a] -&gt; [Either () a])
-&gt; [StrictMaybe a] -&gt; [Either () a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Tree (StrictMaybe a) -&gt; [StrictMaybe a]
forall a. Tree a -&gt; [a]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Tree (StrictMaybe a)
</span><a href="#local-6989586621679608721"><span class="hs-identifier hs-var">tree</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-698"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679608724"><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621679608724"><span class="hs-identifier hs-var">roots</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608725"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679608725"><span class="hs-identifier hs-var">nodes</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; Bool
forall a. StrictMaybe a -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#isSNothing"><span class="hs-identifier hs-var">isSNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PRoot a -&gt; StrictMaybe a
forall a. PRoot a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679608719"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[()] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621679608724"><span class="hs-identifier hs-var">roots</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-700"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Either String [a]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String [a]) -&gt; String -&gt; Either String [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected an empty root, but it was not found in the Tree&quot;</span></span><span>
</span><span id="line-701"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; Bool
forall a. StrictMaybe a -&gt; Bool
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#isSJust"><span class="hs-identifier hs-var">isSJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PRoot a -&gt; StrictMaybe a
forall a. PRoot a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679608719"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[()] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621679608724"><span class="hs-identifier hs-var">roots</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-702"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Either String [a]
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String [a]) -&gt; String -&gt; Either String [a]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected a full root, but got &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[()] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[()]
</span><a href="#local-6989586621679608724"><span class="hs-identifier hs-var">roots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; Nothing cases&quot;</span></span><span>
</span><span id="line-703"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Either String [a]
forall a. a -&gt; Either String a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679608725"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679608728"><span class="annot"><span class="annottext">nodes :: Set a
</span><a href="#local-6989586621679608728"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Set a
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679608723"><span class="hs-identifier hs-var">nodesList</span></a></span><span>
</span><span id="line-705"></span><span>      </span><span id="local-6989586621679608730"><span class="annot"><span class="annottext">nodesWithoutRoot :: Set a
</span><a href="#local-6989586621679608730"><span class="hs-identifier hs-var hs-var">nodesWithoutRoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set a -&gt; (a -&gt; Set a) -&gt; StrictMaybe a -&gt; Set a
forall a b. a -&gt; (b -&gt; a) -&gt; StrictMaybe b -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#strictMaybe"><span class="hs-identifier hs-var">strictMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679608728"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Set a -&gt; Set a
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-operator hs-var">`Set.delete`</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679608728"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PRoot a -&gt; StrictMaybe a
forall a. PRoot a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#prRoot"><span class="hs-identifier hs-var">prRoot</span></a></span><span> </span><span class="annot"><span class="annottext">PRoot a
</span><a href="#local-6989586621679608719"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>      </span><span id="local-6989586621679608731"><span class="annot"><span class="annottext">unreachable :: Map a (PEdges a)
</span><a href="#local-6989586621679608731"><span class="hs-identifier hs-var hs-var">unreachable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a) -&gt; Set a -&gt; Map a (PEdges a)
forall k a. Ord k =&gt; Map k a -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.withoutKeys</span></span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608720"><span class="hs-identifier hs-var">fullGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679608730"><span class="hs-identifier hs-var">nodesWithoutRoot</span></a></span><span>
</span><span id="line-707"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set a -&gt; Int
forall a. Set a -&gt; Int
</span><span class="hs-identifier hs-var">Set.size</span></span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679608728"><span class="hs-identifier hs-var">nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Int
forall a. [a] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679608723"><span class="hs-identifier hs-var">nodesList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-708"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Detected duplicate nodes: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Set a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Set a, OSet a) -&gt; Set a
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Set a, OSet a) -&gt; Set a) -&gt; (Set a, OSet a) -&gt; Set a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; (Set a, OSet a)
forall (f :: * -&gt; *) a.
(Foldable f, Ord a) =&gt;
f a -&gt; (Set a, OSet a)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-data-1.2.4.1/doc/html/cardano-data/src/Data.OSet.Strict.html#fromFoldableDuplicates"><span class="hs-identifier hs-var">OSet.fromFoldableDuplicates</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679608723"><span class="hs-identifier hs-var">nodesList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (PEdges a) -&gt; Bool
forall k a. Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.null</span></span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608731"><span class="hs-identifier hs-var">unreachable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Discovered unreachable nodes in the graph: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608731"><span class="hs-identifier hs-var">unreachable</span></a></span><span>
</span><span id="line-711"></span><span>  </span><span class="annot"><span class="annottext">(TreeMaybe a, Set a) -&gt; Either String (TreeMaybe a, Set a)
forall a. a -&gt; Either String a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tree (StrictMaybe a) -&gt; TreeMaybe a
forall a. Tree (StrictMaybe a) -&gt; TreeMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#TreeMaybe"><span class="hs-identifier hs-var">TreeMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (StrictMaybe a)
</span><a href="#local-6989586621679608721"><span class="hs-identifier hs-var">tree</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679608730"><span class="hs-identifier hs-var">nodesWithoutRoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-713"></span><span>    </span><span id="local-6989586621679608722"><span class="annot"><span class="annottext">nodeToTree :: StrictMaybe a
-&gt; Set a
-&gt; Map a (PEdges a)
-&gt; Either String (Map a (PEdges a), Tree (StrictMaybe a))
</span><a href="#local-6989586621679608722"><span class="hs-identifier hs-var hs-var">nodeToTree</span></a></span></span><span> </span><span id="local-6989586621679608735"><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608735"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span id="local-6989586621679608736"><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679608736"><span class="hs-identifier hs-var">children</span></a></span></span><span> </span><span id="local-6989586621679608737"><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608737"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-714"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679608738"><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608738"><span class="hs-identifier hs-var">graph'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679608739"><span class="annot"><span class="annottext">[Tree (StrictMaybe a)]
</span><a href="#local-6989586621679608739"><span class="hs-identifier hs-var">subTrees</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(a
 -&gt; (Map a (PEdges a), [Tree (StrictMaybe a)])
 -&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)]))
-&gt; (Map a (PEdges a), [Tree (StrictMaybe a)])
-&gt; Set a
-&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)])
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; b -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><span class="hs-identifier hs-var">foldrM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictMaybe a
-&gt; a
-&gt; (Map a (PEdges a), [Tree (StrictMaybe a)])
-&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)])
</span><a href="#local-6989586621679608740"><span class="hs-identifier hs-var">childToTree</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608735"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608737"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set a
</span><a href="#local-6989586621679608736"><span class="hs-identifier hs-var">children</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="annot"><span class="annottext">(Map a (PEdges a), Tree (StrictMaybe a))
-&gt; Either String (Map a (PEdges a), Tree (StrictMaybe a))
forall a. a -&gt; Either String a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608738"><span class="hs-identifier hs-var">graph'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; [Tree (StrictMaybe a)] -&gt; Tree (StrictMaybe a)
forall a. a -&gt; [Tree a] -&gt; Tree a
</span><span class="hs-identifier hs-var">Node</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608735"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="annot"><span class="annottext">[Tree (StrictMaybe a)]
</span><a href="#local-6989586621679608739"><span class="hs-identifier hs-var">subTrees</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-716"></span><span>    </span><span id="local-6989586621679608740"><span class="annot"><span class="annottext">childToTree :: StrictMaybe a
-&gt; a
-&gt; (Map a (PEdges a), [Tree (StrictMaybe a)])
-&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)])
</span><a href="#local-6989586621679608740"><span class="hs-identifier hs-var hs-var">childToTree</span></a></span></span><span> </span><span id="local-6989586621679608742"><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608742"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621679608743"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679608744"><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608744"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679608745"><span class="annot"><span class="annottext">[Tree (StrictMaybe a)]
</span><a href="#local-6989586621679608745"><span class="hs-identifier hs-var">acc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-717"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Map a (PEdges a) -&gt; Maybe (PEdges a)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608744"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-718"></span><span>        </span><span class="annot"><span class="annottext">Maybe (PEdges a)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)])
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)]))
-&gt; String
-&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot find the node: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-719"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679608746"><span class="annot"><span class="annottext">PEdges a
</span><a href="#local-6989586621679608746"><span class="hs-identifier hs-var">edges</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-720"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PEdges a -&gt; StrictMaybe a
forall a. PEdges a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peParent"><span class="hs-identifier hs-var">peParent</span></a></span><span> </span><span class="annot"><span class="annottext">PEdges a
</span><a href="#local-6989586621679608746"><span class="hs-identifier hs-var">edges</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; StrictMaybe a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608742"><span class="hs-identifier hs-var">parent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-721"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-722"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Incorrect parent: &quot;</span></span><span>
</span><span id="line-723"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PEdges a -&gt; StrictMaybe a
forall a. PEdges a -&gt; StrictMaybe a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peParent"><span class="hs-identifier hs-var">peParent</span></a></span><span> </span><span class="annot"><span class="annottext">PEdges a
</span><a href="#local-6989586621679608746"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; listed for the node: &quot;</span></span><span>
</span><span id="line-725"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-726"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Map a (StrictMaybe a) -&gt; Maybe (StrictMaybe a)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (StrictMaybe a)
</span><a href="#local-6989586621679608718"><span class="hs-identifier hs-var">childParent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-727"></span><span>            </span><span class="annot"><span class="annottext">Maybe (StrictMaybe a)
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Node is not found in the governance states map: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-728"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679608747"><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608747"><span class="hs-identifier hs-var">trueParent</span></a></span></span><span>
</span><span id="line-729"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608747"><span class="hs-identifier hs-var">trueParent</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; StrictMaybe a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608742"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-730"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-731"></span><span>                    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parent of &quot;</span></span><span>
</span><span id="line-732"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span>
</span><span id="line-733"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; specified in the GovAction: &quot;</span></span><span>
</span><span id="line-734"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608747"><span class="hs-identifier hs-var">trueParent</span></a></span><span>
</span><span id="line-735"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; does not match the one on the Graph: &quot;</span></span><span>
</span><span id="line-736"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe a
</span><a href="#local-6989586621679608742"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-737"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either String ()
forall a. a -&gt; Either String a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-738"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679608749"><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608749"><span class="hs-identifier hs-var">graph'</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679608750"><span class="annot"><span class="annottext">Tree (StrictMaybe a)
</span><a href="#local-6989586621679608750"><span class="hs-identifier hs-var">subTree</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-739"></span><span>            </span><span class="hs-comment">-- Deleting the child from the graph ensures that every node except the root</span><span>
</span><span id="line-740"></span><span>            </span><span class="hs-comment">-- appears exactly once in the graph.</span><span>
</span><span id="line-741"></span><span>            </span><span class="annot"><span class="annottext">StrictMaybe a
-&gt; Set a
-&gt; Map a (PEdges a)
-&gt; Either String (Map a (PEdges a), Tree (StrictMaybe a))
</span><a href="#local-6989586621679608722"><span class="hs-identifier hs-var">nodeToTree</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; StrictMaybe a
forall a. a -&gt; StrictMaybe a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-var">SJust</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PEdges a -&gt; Set a
forall a. PEdges a -&gt; Set a
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#peChildren"><span class="hs-identifier hs-var">peChildren</span></a></span><span> </span><span class="annot"><span class="annottext">PEdges a
</span><a href="#local-6989586621679608746"><span class="hs-identifier hs-var">edges</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Map a (PEdges a) -&gt; Map a (PEdges a)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.delete</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679608743"><span class="hs-identifier hs-var">child</span></a></span><span> </span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608744"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>          </span><span class="annot"><span class="annottext">(Map a (PEdges a), [Tree (StrictMaybe a)])
-&gt; Either String (Map a (PEdges a), [Tree (StrictMaybe a)])
forall a. a -&gt; Either String a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map a (PEdges a)
</span><a href="#local-6989586621679608749"><span class="hs-identifier hs-var">graph'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Tree (StrictMaybe a)
</span><a href="#local-6989586621679608750"><span class="hs-identifier hs-var">subTree</span></a></span><span> </span><span class="annot"><span class="annottext">Tree (StrictMaybe a)
-&gt; [Tree (StrictMaybe a)] -&gt; [Tree (StrictMaybe a)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Tree (StrictMaybe a)]
</span><a href="#local-6989586621679608745"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span class="hs-comment">-- | Verify invariant after addition of GovActionState to Proposals. Will print the state</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- before the invariant is violated.</span><span>
</span><span id="line-746"></span><span class="hs-comment">--</span><span>
</span><span id="line-747"></span><span class="hs-comment">-- /Note/ - runs only when assertions are turned on.</span><span>
</span><span id="line-748"></span><span id="local-6989586621679606835"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#checkInvariantAfterAddition"><span class="hs-identifier hs-type">checkInvariantAfterAddition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-749"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606835"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-750"></span><span>  </span><span class="annot"><span class="hs-comment">-- | GovAction that was added</span></span><span>
</span><span id="line-751"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606835"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-752"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Proposals before adding the GovActionState</span></span><span>
</span><span id="line-753"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606835"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-754"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Proposals after adding the GovActionState</span></span><span>
</span><span id="line-755"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606835"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-756"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679606835"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-757"></span><span id="checkInvariantAfterAddition"><span class="annot"><span class="annottext">checkInvariantAfterAddition :: forall era.
(EraPParams era, ?callStack::CallStack) =&gt;
GovActionState era
-&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#checkInvariantAfterAddition"><span class="hs-identifier hs-var hs-var">checkInvariantAfterAddition</span></a></span></span><span> </span><span id="local-6989586621679608763"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608763"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span id="local-6989586621679608764"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608764"><span class="hs-identifier hs-var">psPre</span></a></span></span><span> </span><span id="local-6989586621679608765"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608765"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Proposals era -&gt; Proposals era
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679608766"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608765"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-759"></span><span>    </span><span id="local-6989586621679608766"><span class="annot"><span class="annottext">check :: Bool
</span><a href="#local-6989586621679608766"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-760"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; Either String (GovRelation TreeMaybe)
forall era. Proposals era -&gt; Either String (GovRelation TreeMaybe)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTreeEither"><span class="hs-identifier hs-var">toGovRelationTreeEither</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608765"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-761"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679608767"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679608767"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. (?callStack::CallStack) =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; String -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Addition error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679608767"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679608763"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608764"><span class="hs-identifier hs-var">psPre</span></a></span><span>
</span><span id="line-762"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">GovRelation TreeMaybe
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-763"></span><span>
</span><span id="line-764"></span><span class="hs-comment">-- | Verify invariant after deletion of GovActionState to Proposals. Will print the state</span><span>
</span><span id="line-765"></span><span class="hs-comment">-- before the invariant is violated.</span><span>
</span><span id="line-766"></span><span class="hs-comment">--</span><span>
</span><span id="line-767"></span><span class="hs-comment">-- /Note/ - runs only when assertions are turned on.</span><span>
</span><span id="line-768"></span><span id="local-6989586621679607025"><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#checkInvariantAfterDeletion"><span class="hs-identifier hs-type">checkInvariantAfterDeletion</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#EraPParams"><span class="hs-identifier hs-type">EraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607025"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-770"></span><span>  </span><span class="annot"><span class="hs-comment">-- | GovAction that was added</span></span><span>
</span><span id="line-771"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionId"><span class="hs-identifier hs-type">GovActionId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-772"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Proposals before adding the GovActionState</span></span><span>
</span><span id="line-773"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607025"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-774"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Proposals after adding the GovActionState</span></span><span>
</span><span id="line-775"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607025"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-776"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Proposals.html#Proposals"><span class="hs-identifier hs-type">Proposals</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679607025"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-777"></span><span id="checkInvariantAfterDeletion"><span class="annot"><span class="annottext">checkInvariantAfterDeletion :: forall era.
(EraPParams era, ?callStack::CallStack) =&gt;
Set GovActionId -&gt; Proposals era -&gt; Proposals era -&gt; Proposals era
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#checkInvariantAfterDeletion"><span class="hs-identifier hs-var hs-var">checkInvariantAfterDeletion</span></a></span></span><span> </span><span id="local-6989586621679608781"><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608781"><span class="hs-identifier hs-var">gais</span></a></span></span><span> </span><span id="local-6989586621679608782"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608782"><span class="hs-identifier hs-var">psPre</span></a></span></span><span> </span><span id="local-6989586621679608783"><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608783"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Proposals era -&gt; Proposals era
forall a. (?callStack::CallStack) =&gt; Bool -&gt; a -&gt; a
</span><span class="hs-identifier hs-var hs-var">assert</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679608784"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608783"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-778"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-779"></span><span>    </span><span id="local-6989586621679608784"><span class="annot"><span class="annottext">check :: Bool
</span><a href="#local-6989586621679608784"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-780"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; Either String (GovRelation TreeMaybe)
forall era. Proposals era -&gt; Either String (GovRelation TreeMaybe)
</span><a href="Cardano.Ledger.Conway.Governance.Proposals.html#toGovRelationTreeEither"><span class="hs-identifier hs-var">toGovRelationTreeEither</span></a></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608783"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679608785"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679608785"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. (?callStack::CallStack) =&gt; String -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; String -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Deletion error: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679608785"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679608781"><span class="hs-identifier hs-var">gais</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Proposals era -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Proposals era
</span><a href="#local-6989586621679608782"><span class="hs-identifier hs-var">psPre</span></a></span><span>
</span><span id="line-782"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="annot"><span class="annottext">GovRelation TreeMaybe
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-783"></span></pre></body></html>