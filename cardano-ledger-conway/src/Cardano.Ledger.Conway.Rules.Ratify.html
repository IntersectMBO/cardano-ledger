<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Conway.Rules.Ratify</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier">ConwayRATIFY</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier">RatifyState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAccepted"><span class="hs-identifier">committeeAccepted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAcceptedRatio"><span class="hs-identifier">committeeAcceptedRatio</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAccepted"><span class="hs-identifier">spoAccepted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAcceptedRatio"><span class="hs-identifier">spoAcceptedRatio</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAccepted"><span class="hs-identifier">dRepAccepted</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAcceptedRatio"><span class="hs-identifier">dRepAcceptedRatio</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#acceptedByEveryone"><span class="hs-identifier">acceptedByEveryone</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="hs-comment">-- Testing</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#prevActionAsExpected"><span class="hs-identifier">prevActionAsExpected</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#validCommitteeTerm"><span class="hs-identifier">validCommitteeTerm</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#withdrawalCanWithdraw"><span class="hs-identifier">withdrawalCanWithdraw</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#BoundedRational"><span class="hs-identifier">BoundedRational</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier">ProtVer</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier">ShelleyBase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier">StrictMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#addEpochInterval"><span class="hs-identifier">addEpochInterval</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#%25%3F"><span class="hs-operator">(%?)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html"><span class="hs-identifier">Cardano.Ledger.Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier">Coin</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Compactible.html#CompactForm"><span class="hs-identifier">CompactForm</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Core.html"><span class="hs-identifier">Cardano.Ledger.Conway.Core</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html"><span class="hs-identifier">Cardano.Ledger.Conway.Era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayENACT"><span class="hs-identifier">ConwayENACT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier">ConwayRATIFY</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#hardforkConwayBootstrapPhase"><span class="hs-identifier">hardforkConwayBootstrapPhase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.html"><span class="hs-identifier">Cardano.Ledger.Conway.Governance</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Committee"><span class="hs-identifier">Committee</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.html#DefaultVote"><span class="hs-identifier">DefaultVote</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovAction"><span class="hs-identifier">GovAction</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier">GovActionState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier">GovRelation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#ProposalProcedure"><span class="hs-identifier">ProposalProcedure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier">RatifyEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifySignal"><span class="hs-identifier">RatifySignal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier">RatifyState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Vote"><span class="hs-identifier">Vote</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.html#defaultStakePoolVote"><span class="hs-identifier">defaultStakePoolVote</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#ensCommitteeL"><span class="hs-identifier">ensCommitteeL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#ensProtVerL"><span class="hs-identifier">ensProtVerL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#ensTreasuryL"><span class="hs-identifier">ensTreasuryL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasAction"><span class="hs-identifier">gasAction</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsDelayedL"><span class="hs-identifier">rsDelayedL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsEnactStateL"><span class="hs-identifier">rsEnactStateL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsEnactedL"><span class="hs-identifier">rsEnactedL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsExpiredL"><span class="hs-identifier">rsExpiredL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#votingCommitteeThreshold"><span class="hs-identifier">votingCommitteeThreshold</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#votingDRepThreshold"><span class="hs-identifier">votingDRepThreshold</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#votingStakePoolThreshold"><span class="hs-identifier">votingStakePoolThreshold</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#withGovActionParent"><span class="hs-identifier">withGovActionParent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Enact.html"><span class="hs-identifier">Cardano.Ledger.Conway.Rules.Enact</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Enact.html#EnactSignal"><span class="hs-identifier">EnactSignal</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#EnactState"><span class="hs-identifier">EnactState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.State.html"><span class="hs-identifier">Cardano.Ledger.Conway.State</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html"><span class="hs-identifier">Cardano.Ledger.Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier">Credential</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Slot.html"><span class="hs-identifier">Cardano.Ledger.Slot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier">EpochNo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html"><span class="hs-identifier">Cardano.Ledger.Val</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#Val"><span class="hs-identifier">Val</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator">(&lt;+&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html"><span class="hs-identifier">Control.State.Transition.Extended</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Embed"><span class="hs-identifier">Embed</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TransitionRule"><span class="hs-identifier">TransitionRule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#judgmentContext"><span class="hs-identifier">judgmentContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#trans"><span class="hs-identifier">trans</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Foldable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Foldable</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map.Strict</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html"><span class="hs-identifier">Data.Sequence.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SSeq</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Void</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Void</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">absurd</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html"><span class="hs-identifier">Lens.Micro</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-90"></span><span>  </span><span id="local-6989586621679643827"><span id="local-6989586621679644082"><span id="local-6989586621679644089"><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.PParams.html#ConwayEraPParams"><span class="hs-identifier hs-type">ConwayEraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.State.Account.html#ConwayEraAccounts"><span class="hs-identifier hs-type">ConwayEraAccounts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Embed"><span class="hs-identifier hs-type">Embed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#EnactState"><span class="hs-identifier hs-type">EnactState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Enact.html#EnactSignal"><span class="hs-identifier hs-type">EnactSignal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#STS"><span class="hs-identifier hs-type">STS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Environment"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-var">Environment</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-100"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="PredicateFailure"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#PredicateFailure"><span class="hs-identifier hs-var">PredicateFailure</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Void</span></span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Signal"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-var">Signal</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifySignal"><span class="hs-identifier hs-type">RatifySignal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-102"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="State"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-var">State</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier hs-type">RatifyState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="BaseM"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#BaseM"><span class="hs-identifier hs-var">BaseM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643827"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ShelleyBase"><span class="hs-identifier hs-type">ShelleyBase</span></a></span><span>
</span><span id="line-104"></span><span>
</span><span id="line-105"></span><span>  </span><span id="local-6989586621679644111"><span class="annot"><span class="annottext">initialRules :: [InitialRule (ConwayRATIFY era)]
</span><a href="#local-6989586621679644111"><span class="hs-identifier hs-var hs-var hs-var hs-var">initialRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-106"></span><span>  </span><span id="local-6989586621679644119"><span class="annot"><span class="annottext">transitionRules :: [TransitionRule (ConwayRATIFY era)]
</span><a href="#local-6989586621679644119"><span class="hs-identifier hs-var hs-var hs-var hs-var">transitionRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TransitionRule (ConwayRATIFY era)
forall era.
(Embed (EraRule &quot;ENACT&quot; era) (ConwayRATIFY era),
 State (EraRule &quot;ENACT&quot; era) ~ EnactState era,
 Environment (EraRule &quot;ENACT&quot; era) ~ (),
 Signal (EraRule &quot;ENACT&quot; era) ~ EnactSignal era,
 ConwayEraPParams era, ConwayEraAccounts era) =&gt;
TransitionRule (ConwayRATIFY era)
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#ratifyTransition"><span class="hs-identifier hs-var">ratifyTransition</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- Compute the ratio yes/(yes + no), where</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- yes:</span><span>
</span><span id="line-110"></span><span class="hs-comment">--      - the number of registered, unexpired, unresigned committee members that voted yes</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- no:</span><span>
</span><span id="line-112"></span><span class="hs-comment">--      - the number of registered, unexpired, unresigned committee members that voted no, plus</span><span>
</span><span id="line-113"></span><span class="hs-comment">--      - the number of registered, unexpired, unresigned committee members that did not vote for this action</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- We iterate over the committee, and incrementally construct the numerator and denominator,</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- based on the votes and the committee state.</span><span>
</span><span id="line-117"></span><span id="local-6989586621679643832"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAccepted"><span class="hs-identifier hs-type">committeeAccepted</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-118"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.PParams.html#ConwayEraPParams"><span class="hs-identifier hs-type">ConwayEraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643832"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643832"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier hs-type">RatifyState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643832"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643832"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-123"></span><span id="committeeAccepted"><span class="annot"><span class="annottext">committeeAccepted :: forall era.
ConwayEraPParams era =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAccepted"><span class="hs-identifier hs-var hs-var">committeeAccepted</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679644144"><span class="annot"><span class="annottext">CommitteeState era
reCommitteeState :: CommitteeState era
reCommitteeState :: forall era. RatifyEnv era -&gt; CommitteeState era
</span><a href="#local-6989586621679644144"><span class="hs-identifier hs-var hs-var">reCommitteeState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644146"><span class="annot"><span class="annottext">EpochNo
reCurrentEpoch :: EpochNo
reCurrentEpoch :: forall era. RatifyEnv era -&gt; EpochNo
</span><a href="#local-6989586621679644146"><span class="hs-identifier hs-var hs-var">reCurrentEpoch</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679644148"><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644148"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621679644149"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644149"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EpochNo
-&gt; RatifyState era
-&gt; CommitteeState era
-&gt; GovAction era
-&gt; StrictMaybe UnitInterval
forall era.
ConwayEraPParams era =&gt;
EpochNo
-&gt; RatifyState era
-&gt; CommitteeState era
-&gt; GovAction era
-&gt; StrictMaybe UnitInterval
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#votingCommitteeThreshold"><span class="hs-identifier hs-var">votingCommitteeThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644146"><span class="hs-identifier hs-var">reCurrentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644148"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">CommitteeState era
</span><a href="#local-6989586621679644144"><span class="hs-identifier hs-var">reCommitteeState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionState era -&gt; GovAction era
forall era. GovActionState era -&gt; GovAction era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasAction"><span class="hs-identifier hs-var">gasAction</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644149"><span class="hs-identifier hs-var">gas</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>    </span><span class="annot"><span class="annottext">StrictMaybe UnitInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- this happens if we have no committee, or if the committee is too small,</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-comment">-- in which case the committee vote is `no`</span><span>
</span><span id="line-127"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span id="local-6989586621679644152"><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644152"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-128"></span><span>      </span><span class="hs-comment">-- short circuit on zero threshold, in which case the committee vote is `yes`</span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644152"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInterval -&gt; UnitInterval -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInterval
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Rational
</span><a href="#local-6989586621679644155"><span class="hs-identifier hs-var">acceptedRatio</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UnitInterval -&gt; Rational
forall r. BoundedRational r =&gt; r -&gt; Rational
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#unboundRational"><span class="hs-identifier hs-var">unboundRational</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644152"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679644155"><span class="annot"><span class="annottext">acceptedRatio :: Rational
</span><a href="#local-6989586621679644155"><span class="hs-identifier hs-var hs-var">acceptedRatio</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-132"></span><span>      </span><span class="annot"><span class="annottext">Map (Credential 'ColdCommitteeRole) EpochNo
-&gt; Map (Credential 'HotCommitteeRole) Vote
-&gt; CommitteeState era
-&gt; EpochNo
-&gt; Rational
forall era.
Map (Credential 'ColdCommitteeRole) EpochNo
-&gt; Map (Credential 'HotCommitteeRole) Vote
-&gt; CommitteeState era
-&gt; EpochNo
-&gt; Rational
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAcceptedRatio"><span class="hs-identifier hs-var">committeeAcceptedRatio</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'ColdCommitteeRole) EpochNo
</span><a href="#local-6989586621679644157"><span class="hs-identifier hs-var">members</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionState era -&gt; Map (Credential 'HotCommitteeRole) Vote
forall era.
GovActionState era -&gt; Map (Credential 'HotCommitteeRole) Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasCommitteeVotes"><span class="hs-identifier hs-var">gasCommitteeVotes</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644149"><span class="hs-identifier hs-var">gas</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CommitteeState era
</span><a href="#local-6989586621679644144"><span class="hs-identifier hs-var">reCommitteeState</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644146"><span class="hs-identifier hs-var">reCurrentEpoch</span></a></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679644157"><span class="annot"><span class="annottext">members :: Map (Credential 'ColdCommitteeRole) EpochNo
</span><a href="#local-6989586621679644157"><span class="hs-identifier hs-var hs-var">members</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Committee era -&gt; Map (Credential 'ColdCommitteeRole) EpochNo)
-&gt; StrictMaybe (Committee era)
-&gt; Map (Credential 'ColdCommitteeRole) EpochNo
forall m a. Monoid m =&gt; (a -&gt; m) -&gt; StrictMaybe a -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap'</span></span><span> </span><span class="annot"><span class="annottext">Committee era -&gt; Map (Credential 'ColdCommitteeRole) EpochNo
forall era.
Committee era -&gt; Map (Credential 'ColdCommitteeRole) EpochNo
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#committeeMembers"><span class="hs-identifier hs-var">committeeMembers</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644148"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
-&gt; Getting
     (StrictMaybe (Committee era))
     (RatifyState era)
     (StrictMaybe (Committee era))
-&gt; StrictMaybe (Committee era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(EnactState era
 -&gt; Const (StrictMaybe (Committee era)) (EnactState era))
-&gt; RatifyState era
-&gt; Const (StrictMaybe (Committee era)) (RatifyState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EnactState era -&gt; f (EnactState era))
-&gt; RatifyState era -&gt; f (RatifyState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsEnactStateL"><span class="hs-identifier hs-var">rsEnactStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((EnactState era
  -&gt; Const (StrictMaybe (Committee era)) (EnactState era))
 -&gt; RatifyState era
 -&gt; Const (StrictMaybe (Committee era)) (RatifyState era))
-&gt; ((StrictMaybe (Committee era)
     -&gt; Const
          (StrictMaybe (Committee era)) (StrictMaybe (Committee era)))
    -&gt; EnactState era
    -&gt; Const (StrictMaybe (Committee era)) (EnactState era))
-&gt; Getting
     (StrictMaybe (Committee era))
     (RatifyState era)
     (StrictMaybe (Committee era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (Committee era)
 -&gt; Const
      (StrictMaybe (Committee era)) (StrictMaybe (Committee era)))
-&gt; EnactState era
-&gt; Const (StrictMaybe (Committee era)) (EnactState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(StrictMaybe (Committee era) -&gt; f (StrictMaybe (Committee era)))
-&gt; EnactState era -&gt; f (EnactState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#ensCommitteeL"><span class="hs-identifier hs-var">ensCommitteeL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAcceptedRatio"><span class="hs-identifier hs-type">committeeAcceptedRatio</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679643863"><span class="annot"><a href="#local-6989586621679643863"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-137"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#ColdCommitteeRole"><span class="hs-identifier hs-type">ColdCommitteeRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#HotCommitteeRole"><span class="hs-identifier hs-type">HotCommitteeRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Vote"><span class="hs-identifier hs-type">Vote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#CommitteeState"><span class="hs-identifier hs-type">CommitteeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643863"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-142"></span><span id="committeeAcceptedRatio"><span class="annot"><span class="annottext">committeeAcceptedRatio :: forall era.
Map (Credential 'ColdCommitteeRole) EpochNo
-&gt; Map (Credential 'HotCommitteeRole) Vote
-&gt; CommitteeState era
-&gt; EpochNo
-&gt; Rational
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAcceptedRatio"><span class="hs-identifier hs-var hs-var">committeeAcceptedRatio</span></a></span></span><span> </span><span id="local-6989586621679644177"><span class="annot"><span class="annottext">Map (Credential 'ColdCommitteeRole) EpochNo
</span><a href="#local-6989586621679644177"><span class="hs-identifier hs-var">members</span></a></span></span><span> </span><span id="local-6989586621679644178"><span class="annot"><span class="annottext">Map (Credential 'HotCommitteeRole) Vote
</span><a href="#local-6989586621679644178"><span class="hs-identifier hs-var">votes</span></a></span></span><span> </span><span id="local-6989586621679644179"><span class="annot"><span class="annottext">CommitteeState era
</span><a href="#local-6989586621679644179"><span class="hs-identifier hs-var">committeeState</span></a></span></span><span> </span><span id="local-6989586621679644180"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644180"><span class="hs-identifier hs-var">currentEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644181"><span class="hs-identifier hs-var">yesVotes</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#%25%3F"><span class="hs-operator hs-var">%?</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644182"><span class="hs-identifier hs-var">totalExcludingAbstain</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><a href="#local-6989586621679644183"><span class="hs-identifier hs-type">accumVotes</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-146"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>      </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#ColdCommitteeRole"><span class="hs-identifier hs-type">ColdCommitteeRole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>      </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-149"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Integer</span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span id="local-6989586621679644183"><span class="annot"><span class="annottext">accumVotes :: (Integer, Integer)
-&gt; Credential 'ColdCommitteeRole -&gt; EpochNo -&gt; (Integer, Integer)
</span><a href="#local-6989586621679644183"><span class="hs-identifier hs-var hs-var">accumVotes</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679644184"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679644185"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679644186"><span class="annot"><span class="annottext">Credential 'ColdCommitteeRole
</span><a href="#local-6989586621679644186"><span class="hs-identifier hs-var">member</span></a></span></span><span> </span><span id="local-6989586621679644187"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644187"><span class="hs-identifier hs-var">expiry</span></a></span></span><span>
</span><span id="line-151"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644180"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644187"><span class="hs-identifier hs-var">expiry</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- member is expired, vote &quot;abstain&quot; (don't count it)</span><span>
</span><span id="line-152"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-153"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential 'ColdCommitteeRole
-&gt; Map (Credential 'ColdCommitteeRole) CommitteeAuthorization
-&gt; Maybe CommitteeAuthorization
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'ColdCommitteeRole
</span><a href="#local-6989586621679644186"><span class="hs-identifier hs-var">member</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CommitteeState era
-&gt; Map (Credential 'ColdCommitteeRole) CommitteeAuthorization
forall era.
CommitteeState era
-&gt; Map (Credential 'ColdCommitteeRole) CommitteeAuthorization
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#csCommitteeCreds"><span class="hs-identifier hs-var">csCommitteeCreds</span></a></span><span> </span><span class="annot"><span class="annottext">CommitteeState era
</span><a href="#local-6989586621679644179"><span class="hs-identifier hs-var">committeeState</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-154"></span><span>            </span><span class="annot"><span class="annottext">Maybe CommitteeAuthorization
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- member is not registered, vote &quot;abstain&quot;</span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#CommitteeMemberResigned"><span class="hs-identifier hs-type">CommitteeMemberResigned</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe Anchor
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- member has resigned, vote &quot;abstain&quot;</span><span>
</span><span id="line-156"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.CertState.html#CommitteeHotCredential"><span class="hs-identifier hs-type">CommitteeHotCredential</span></a></span><span> </span><span id="local-6989586621679644193"><span class="annot"><span class="annottext">Credential 'HotCommitteeRole
</span><a href="#local-6989586621679644193"><span class="hs-identifier hs-var">hotKey</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-157"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential 'HotCommitteeRole
-&gt; Map (Credential 'HotCommitteeRole) Vote -&gt; Maybe Vote
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'HotCommitteeRole
</span><a href="#local-6989586621679644193"><span class="hs-identifier hs-var">hotKey</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'HotCommitteeRole) Vote
</span><a href="#local-6989586621679644178"><span class="hs-identifier hs-var">votes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-158"></span><span>                </span><span class="annot"><span class="annottext">Maybe Vote
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- member hasn't voted, vote &quot;no&quot;</span><span>
</span><span id="line-159"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Abstain"><span class="hs-identifier hs-var">Abstain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- member voted &quot;abstain&quot;</span><span>
</span><span id="line-160"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#VoteNo"><span class="hs-identifier hs-var">VoteNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- member voted &quot;no&quot;</span><span>
</span><span id="line-161"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#VoteYes"><span class="hs-identifier hs-var">VoteYes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644184"><span class="hs-identifier hs-var">yes</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644185"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- member voted &quot;yes&quot;</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679644181"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644181"><span class="hs-identifier hs-var">yesVotes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644182"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679644182"><span class="hs-identifier hs-var">totalExcludingAbstain</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Integer, Integer)
 -&gt; Credential 'ColdCommitteeRole -&gt; EpochNo -&gt; (Integer, Integer))
-&gt; (Integer, Integer)
-&gt; Map (Credential 'ColdCommitteeRole) EpochNo
-&gt; (Integer, Integer)
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><span class="hs-identifier hs-var">Map.foldlWithKey'</span></span><span> </span><span class="annot"><span class="annottext">(Integer, Integer)
-&gt; Credential 'ColdCommitteeRole -&gt; EpochNo -&gt; (Integer, Integer)
</span><a href="#local-6989586621679644183"><span class="hs-identifier hs-var">accumVotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (Credential 'ColdCommitteeRole) EpochNo
</span><a href="#local-6989586621679644177"><span class="hs-identifier hs-var">members</span></a></span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span id="local-6989586621679643890"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAccepted"><span class="hs-identifier hs-type">spoAccepted</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-165"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.PParams.html#ConwayEraPParams"><span class="hs-identifier hs-type">ConwayEraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643890"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.State.Account.html#ConwayEraAccounts"><span class="hs-identifier hs-type">ConwayEraAccounts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643890"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-166"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643890"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-167"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier hs-type">RatifyState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643890"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-168"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643890"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-169"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-170"></span><span id="spoAccepted"><span class="annot"><span class="annottext">spoAccepted :: forall era.
(ConwayEraPParams era, ConwayEraAccounts era) =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAccepted"><span class="hs-identifier hs-var hs-var">spoAccepted</span></a></span></span><span> </span><span id="local-6989586621679644217"><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644217"><span class="hs-identifier hs-var">re</span></a></span></span><span> </span><span id="local-6989586621679644218"><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644218"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span id="local-6989586621679644219"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644219"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RatifyState era -&gt; GovAction era -&gt; StrictMaybe UnitInterval
forall era.
ConwayEraPParams era =&gt;
RatifyState era -&gt; GovAction era -&gt; StrictMaybe UnitInterval
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#votingStakePoolThreshold"><span class="hs-identifier hs-var">votingStakePoolThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644218"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GovActionState era -&gt; GovAction era
forall era. GovActionState era -&gt; GovAction era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasAction"><span class="hs-identifier hs-var">gasAction</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644219"><span class="hs-identifier hs-var">gas</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- Short circuit on zero threshold in order to avoid redundant computation.</span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span id="local-6989586621679644220"><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644220"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644220"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInterval -&gt; UnitInterval -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInterval
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era -&gt; GovActionState era -&gt; ProtVer -&gt; Rational
forall era.
ConwayEraAccounts era =&gt;
RatifyEnv era -&gt; GovActionState era -&gt; ProtVer -&gt; Rational
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAcceptedRatio"><span class="hs-identifier hs-var">spoAcceptedRatio</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644217"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644219"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644218"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
-&gt; Getting ProtVer (RatifyState era) ProtVer -&gt; ProtVer
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(EnactState era -&gt; Const ProtVer (EnactState era))
-&gt; RatifyState era -&gt; Const ProtVer (RatifyState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EnactState era -&gt; f (EnactState era))
-&gt; RatifyState era -&gt; f (RatifyState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsEnactStateL"><span class="hs-identifier hs-var">rsEnactStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((EnactState era -&gt; Const ProtVer (EnactState era))
 -&gt; RatifyState era -&gt; Const ProtVer (RatifyState era))
-&gt; ((ProtVer -&gt; Const ProtVer ProtVer)
    -&gt; EnactState era -&gt; Const ProtVer (EnactState era))
-&gt; Getting ProtVer (RatifyState era) ProtVer
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(ProtVer -&gt; Const ProtVer ProtVer)
-&gt; EnactState era -&gt; Const ProtVer (EnactState era)
forall era. EraPParams era =&gt; Lens' (EnactState era) ProtVer
Lens' (EnactState era) ProtVer
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#ensProtVerL"><span class="hs-identifier hs-var">ensProtVerL</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UnitInterval -&gt; Rational
forall r. BoundedRational r =&gt; r -&gt; Rational
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#unboundRational"><span class="hs-identifier hs-var">unboundRational</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644220"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="annot"><span class="annottext">StrictMaybe UnitInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- | Final ratio for `totalAcceptedStakePoolsRatio` we want during the bootstrap period is:</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- t = y \/ (s - a)</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- Where:</span><span>
</span><span id="line-180"></span><span class="hs-comment">--  * `y` - total delegated stake that voted Yes</span><span>
</span><span id="line-181"></span><span class="hs-comment">--  * `a` - total delegated stake that voted Abstain</span><span>
</span><span id="line-182"></span><span class="hs-comment">--  * `s` - total delegated stake</span><span>
</span><span id="line-183"></span><span class="hs-comment">--</span><span>
</span><span id="line-184"></span><span class="hs-comment">-- For `HardForkInitiation` all SPOs that didn't vote are considered as</span><span>
</span><span id="line-185"></span><span class="hs-comment">-- `No` votes. Whereas, for all other `GovAction`s, SPOs that didn't</span><span>
</span><span id="line-186"></span><span class="hs-comment">-- vote are considered as `Abstain` votes.</span><span>
</span><span id="line-187"></span><span class="hs-comment">--</span><span>
</span><span id="line-188"></span><span class="hs-comment">-- `No` votes are not counted.</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- After the bootstrap period if an SPO didn't vote, it will be considered as a `No` vote by default.</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- The only exceptions are when a pool delegated to an `AlwaysNoConfidence` or an `AlwaysAbstain` DRep.</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- In those cases, behaviour is as expected: vote `Yes` on `NoConfidence` proposals in case of the former and</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- and vote `Abstain` by default in case of the latter. For `HardForkInitiation`, behaviour is the same as</span><span>
</span><span id="line-193"></span><span class="hs-comment">-- during the bootstrap period: if an SPO didn't vote, their vote will always count as `No`.</span><span>
</span><span id="line-194"></span><span id="local-6989586621679643900"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAcceptedRatio"><span class="hs-identifier hs-type">spoAcceptedRatio</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-195"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.State.Account.html#ConwayEraAccounts"><span class="hs-identifier hs-type">ConwayEraAccounts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643900"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643900"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643900"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#ProtVer"><span class="hs-identifier hs-type">ProtVer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span></span><span>
</span><span id="line-196"></span><span id="spoAcceptedRatio"><span class="annot"><span class="annottext">spoAcceptedRatio :: forall era.
ConwayEraAccounts era =&gt;
RatifyEnv era -&gt; GovActionState era -&gt; ProtVer -&gt; Rational
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAcceptedRatio"><span class="hs-identifier hs-var hs-var">spoAcceptedRatio</span></a></span></span><span>
</span><span id="line-197"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">reStakePoolDistr :: forall era. RatifyEnv era -&gt; PoolDistr
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#reStakePoolDistr"><span class="hs-identifier hs-var">reStakePoolDistr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.PoolDistr.html#PoolDistr"><span class="hs-identifier hs-type">PoolDistr</span></a></span><span> </span><span id="local-6989586621679644242"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) IndividualPoolStake
</span><a href="#local-6989586621679644242"><span class="hs-identifier hs-var">individualPoolStake</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679644244"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644244"><span class="hs-identifier hs-var">totalActiveStake</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644245"><span class="annot"><span class="annottext">Accounts era
reAccounts :: Accounts era
reAccounts :: forall era. RatifyEnv era -&gt; Accounts era
</span><a href="#local-6989586621679644245"><span class="hs-identifier hs-var hs-var">reAccounts</span></a></span></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644247"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState
reStakePools :: Map (KeyHash 'StakePool) StakePoolState
reStakePools :: forall era.
RatifyEnv era -&gt; Map (KeyHash 'StakePool) StakePoolState
</span><a href="#local-6989586621679644247"><span class="hs-identifier hs-var hs-var">reStakePools</span></a></span></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679644250"><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Vote
gasStakePoolVotes :: Map (KeyHash 'StakePool) Vote
gasStakePoolVotes :: forall era. GovActionState era -&gt; Map (KeyHash 'StakePool) Vote
</span><a href="#local-6989586621679644250"><span class="hs-identifier hs-var hs-var">gasStakePoolVotes</span></a></span></span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gasProposalProcedure :: forall era. GovActionState era -&gt; ProposalProcedure era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasProposalProcedure"><span class="hs-identifier hs-var">gasProposalProcedure</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#ProposalProcedure"><span class="hs-identifier hs-type">ProposalProcedure</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679644254"><span class="annot"><span class="annottext">GovAction era
pProcGovAction :: GovAction era
pProcGovAction :: forall era. ProposalProcedure era -&gt; GovAction era
</span><a href="#local-6989586621679644254"><span class="hs-identifier hs-var hs-var">pProcGovAction</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-206"></span><span>  </span><span id="local-6989586621679644256"><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679644256"><span class="hs-identifier hs-var">pv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>    </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644257"><span class="hs-identifier hs-var">yesStake</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#%25%3F"><span class="hs-operator hs-var">%?</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644244"><span class="hs-identifier hs-var">totalActiveStake</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644258"><span class="hs-identifier hs-var">abstainStake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-209"></span><span>      </span><span id="local-6989586621679644259"><span class="annot"><span class="annottext">accumStake :: (Word64, Word64)
-&gt; KeyHash 'StakePool -&gt; IndividualPoolStake -&gt; (Word64, Word64)
</span><a href="#local-6989586621679644259"><span class="hs-identifier hs-var hs-var">accumStake</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679644260"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679644261"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679644262"><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679644262"><span class="hs-identifier hs-var">poolId</span></a></span></span><span> </span><span id="local-6989586621679644263"><span class="annot"><span class="annottext">IndividualPoolStake
</span><a href="#local-6989586621679644263"><span class="hs-identifier hs-var">distr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-210"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679644264"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644264"><span class="hs-identifier hs-var">stake</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IndividualPoolStake -&gt; CompactForm Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.PoolDistr.html#individualTotalPoolStake"><span class="hs-identifier hs-var">individualTotalPoolStake</span></a></span><span> </span><span class="annot"><span class="annottext">IndividualPoolStake
</span><a href="#local-6989586621679644263"><span class="hs-identifier hs-var">distr</span></a></span><span>
</span><span id="line-211"></span><span>            </span><span id="local-6989586621679644266"><span class="annot"><span class="annottext">vote :: Maybe Vote
</span><a href="#local-6989586621679644266"><span class="hs-identifier hs-var hs-var">vote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool -&gt; Map (KeyHash 'StakePool) Vote -&gt; Maybe Vote
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679644262"><span class="hs-identifier hs-var">poolId</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) Vote
</span><a href="#local-6989586621679644250"><span class="hs-identifier hs-var">gasStakePoolVotes</span></a></span><span>
</span><span id="line-212"></span><span>         </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Vote
</span><a href="#local-6989586621679644266"><span class="hs-identifier hs-var">vote</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-213"></span><span>              </span><span class="annot"><span class="annottext">Maybe Vote
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-214"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#HardForkInitiation"><span class="hs-identifier hs-type">HardForkInitiation</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644254"><span class="hs-identifier hs-var">pProcGovAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ProtVer -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Era.html#hardforkConwayBootstrapPhase"><span class="hs-identifier hs-var">hardforkConwayBootstrapPhase</span></a></span><span> </span><span class="annot"><span class="annottext">ProtVer
</span><a href="#local-6989586621679644256"><span class="hs-identifier hs-var">pv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644264"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
-&gt; Map (KeyHash 'StakePool) StakePoolState
-&gt; Accounts era
-&gt; DefaultVote
forall era.
ConwayEraAccounts era =&gt;
KeyHash 'StakePool
-&gt; Map (KeyHash 'StakePool) StakePoolState
-&gt; Accounts era
-&gt; DefaultVote
</span><a href="Cardano.Ledger.Conway.Governance.html#defaultStakePoolVote"><span class="hs-identifier hs-var">defaultStakePoolVote</span></a></span><span> </span><span class="annot"><span class="annottext">KeyHash 'StakePool
</span><a href="#local-6989586621679644262"><span class="hs-identifier hs-var">poolId</span></a></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) StakePoolState
</span><a href="#local-6989586621679644247"><span class="hs-identifier hs-var">reStakePools</span></a></span><span> </span><span class="annot"><span class="annottext">Accounts era
</span><a href="#local-6989586621679644245"><span class="hs-identifier hs-var">reAccounts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-217"></span><span>                    </span><span class="annot"><span class="annottext">DefaultVote
</span><a href="Cardano.Ledger.Conway.Governance.html#DefaultNoConfidence"><span class="hs-identifier hs-var">DefaultNoConfidence</span></a></span><span>
</span><span id="line-218"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#NoConfidence"><span class="hs-identifier hs-type">NoConfidence</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644254"><span class="hs-identifier hs-var">pProcGovAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644264"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>                    </span><span class="annot"><span class="annottext">DefaultVote
</span><a href="Cardano.Ledger.Conway.Governance.html#DefaultAbstain"><span class="hs-identifier hs-var">DefaultAbstain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644264"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>                    </span><span class="annot"><span class="annottext">DefaultVote
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Default is No, unless overridden by one of the above cases</span><span>
</span><span id="line-221"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Abstain"><span class="hs-identifier hs-var">Abstain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644264"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#VoteNo"><span class="hs-identifier hs-var">VoteNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>              </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#VoteYes"><span class="hs-identifier hs-var">VoteYes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644260"><span class="hs-identifier hs-var">yes</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644264"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644261"><span class="hs-identifier hs-var">abstain</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679644257"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644257"><span class="hs-identifier hs-var">yesStake</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644258"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644258"><span class="hs-identifier hs-var">abstainStake</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="annottext">((Word64, Word64)
 -&gt; KeyHash 'StakePool -&gt; IndividualPoolStake -&gt; (Word64, Word64))
-&gt; (Word64, Word64)
-&gt; Map (KeyHash 'StakePool) IndividualPoolStake
-&gt; (Word64, Word64)
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><span class="hs-identifier hs-var">Map.foldlWithKey'</span></span><span> </span><span class="annot"><span class="annottext">(Word64, Word64)
-&gt; KeyHash 'StakePool -&gt; IndividualPoolStake -&gt; (Word64, Word64)
</span><a href="#local-6989586621679644259"><span class="hs-identifier hs-var">accumStake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool) IndividualPoolStake
</span><a href="#local-6989586621679644242"><span class="hs-identifier hs-var">individualPoolStake</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span id="local-6989586621679644269"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAccepted"><span class="hs-identifier hs-type">dRepAccepted</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.PParams.html#ConwayEraPParams"><span class="hs-identifier hs-type">ConwayEraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644269"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644269"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier hs-type">RatifyState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644269"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644269"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-229"></span><span id="dRepAccepted"><span class="annot"><span class="annottext">dRepAccepted :: forall era.
ConwayEraPParams era =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAccepted"><span class="hs-identifier hs-var hs-var">dRepAccepted</span></a></span></span><span> </span><span id="local-6989586621679644277"><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644277"><span class="hs-identifier hs-var">re</span></a></span></span><span> </span><span id="local-6989586621679644278"><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644278"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679644279"><span class="annot"><span class="annottext">Map (Credential 'DRepRole) Vote
gasDRepVotes :: Map (Credential 'DRepRole) Vote
gasDRepVotes :: forall era. GovActionState era -&gt; Map (Credential 'DRepRole) Vote
</span><a href="#local-6989586621679644279"><span class="hs-identifier hs-var hs-var">gasDRepVotes</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644281"><span class="annot"><span class="annottext">ProposalProcedure era
gasProposalProcedure :: forall era. GovActionState era -&gt; ProposalProcedure era
gasProposalProcedure :: ProposalProcedure era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasProposalProcedure"><span class="hs-identifier hs-var hs-var">gasProposalProcedure</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-230"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RatifyState era -&gt; GovAction era -&gt; StrictMaybe UnitInterval
forall era.
ConwayEraPParams era =&gt;
RatifyState era -&gt; GovAction era -&gt; StrictMaybe UnitInterval
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#votingDRepThreshold"><span class="hs-identifier hs-var">votingDRepThreshold</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644278"><span class="hs-identifier hs-var">rs</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644282"><span class="hs-identifier hs-var">govAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SJust"><span class="hs-identifier hs-type">SJust</span></a></span><span> </span><span id="local-6989586621679644283"><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644283"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>      </span><span class="hs-comment">-- Short circuit on zero threshold in order to avoid redundant computation.</span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644283"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInterval -&gt; UnitInterval -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInterval
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span>
</span><span id="line-234"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era
-&gt; Map (Credential 'DRepRole) Vote -&gt; GovAction era -&gt; Rational
forall era.
RatifyEnv era
-&gt; Map (Credential 'DRepRole) Vote -&gt; GovAction era -&gt; Rational
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAcceptedRatio"><span class="hs-identifier hs-var">dRepAcceptedRatio</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644277"><span class="hs-identifier hs-var">re</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole) Vote
</span><a href="#local-6989586621679644279"><span class="hs-identifier hs-var">gasDRepVotes</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644282"><span class="hs-identifier hs-var">govAction</span></a></span><span> </span><span class="annot"><span class="annottext">Rational -&gt; Rational -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UnitInterval -&gt; Rational
forall r. BoundedRational r =&gt; r -&gt; Rational
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.html#unboundRational"><span class="hs-identifier hs-var">unboundRational</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInterval
</span><a href="#local-6989586621679644283"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">StrictMaybe UnitInterval
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#SNothing"><span class="hs-identifier hs-var">SNothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-237"></span><span>    </span><span id="local-6989586621679644282"><span class="annot"><span class="annottext">govAction :: GovAction era
</span><a href="#local-6989586621679644282"><span class="hs-identifier hs-var hs-var">govAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProposalProcedure era -&gt; GovAction era
forall era. ProposalProcedure era -&gt; GovAction era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#pProcGovAction"><span class="hs-identifier hs-var">pProcGovAction</span></a></span><span> </span><span class="annot"><span class="annottext">ProposalProcedure era
</span><a href="#local-6989586621679644281"><span class="hs-identifier hs-var">gasProposalProcedure</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span class="hs-comment">-- Compute the dRep ratio yes/(yes + no), where</span><span>
</span><span id="line-240"></span><span class="hs-comment">-- yes: is the total stake of</span><span>
</span><span id="line-241"></span><span class="hs-comment">--    - registered dReps that voted 'yes', plus</span><span>
</span><span id="line-242"></span><span class="hs-comment">--    - the AlwaysNoConfidence dRep, in case the action is NoConfidence</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- no: is the total stake of</span><span>
</span><span id="line-244"></span><span class="hs-comment">--    - registered dReps that voted 'no', plus</span><span>
</span><span id="line-245"></span><span class="hs-comment">--    - registered dReps that did not vote for this action, plus</span><span>
</span><span id="line-246"></span><span class="hs-comment">--    - the AlwaysNoConfidence dRep</span><span>
</span><span id="line-247"></span><span class="hs-comment">-- In other words, the denominator `yes + no` is the total stake of all registered dReps, minus the abstain votes stake</span><span>
</span><span id="line-248"></span><span class="hs-comment">-- (both credential DReps and AlwaysAbstain)</span><span>
</span><span id="line-249"></span><span class="hs-comment">--</span><span>
</span><span id="line-250"></span><span class="hs-comment">-- We iterate over the dRep distribution, and incrementally construct the numerator and denominator.</span><span>
</span><span id="line-251"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAcceptedRatio"><span class="hs-identifier hs-type">dRepAcceptedRatio</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-252"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679643927"><span class="annot"><a href="#local-6989586621679643927"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-253"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643927"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-254"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Credential.html#Credential"><span class="hs-identifier hs-type">Credential</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Keys.Internal.html#DRepRole"><span class="hs-identifier hs-type">DRepRole</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Vote"><span class="hs-identifier hs-type">Vote</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-255"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovAction"><span class="hs-identifier hs-type">GovAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643927"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-256"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-257"></span><span id="dRepAcceptedRatio"><span class="annot"><span class="annottext">dRepAcceptedRatio :: forall era.
RatifyEnv era
-&gt; Map (Credential 'DRepRole) Vote -&gt; GovAction era -&gt; Rational
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAcceptedRatio"><span class="hs-identifier hs-var hs-var">dRepAcceptedRatio</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679644299"><span class="annot"><span class="annottext">Map DRep (CompactForm Coin)
reDRepDistr :: Map DRep (CompactForm Coin)
reDRepDistr :: forall era. RatifyEnv era -&gt; Map DRep (CompactForm Coin)
</span><a href="#local-6989586621679644299"><span class="hs-identifier hs-var hs-var">reDRepDistr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644301"><span class="annot"><span class="annottext">Map (Credential 'DRepRole) DRepState
reDRepState :: Map (Credential 'DRepRole) DRepState
reDRepState :: forall era. RatifyEnv era -&gt; Map (Credential 'DRepRole) DRepState
</span><a href="#local-6989586621679644301"><span class="hs-identifier hs-var hs-var">reDRepState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644303"><span class="annot"><span class="annottext">EpochNo
reCurrentEpoch :: forall era. RatifyEnv era -&gt; EpochNo
reCurrentEpoch :: EpochNo
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#reCurrentEpoch"><span class="hs-identifier hs-var hs-var">reCurrentEpoch</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679644304"><span class="annot"><span class="annottext">Map (Credential 'DRepRole) Vote
</span><a href="#local-6989586621679644304"><span class="hs-identifier hs-var">gasDRepVotes</span></a></span></span><span> </span><span id="local-6989586621679644305"><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644305"><span class="hs-identifier hs-var">govAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-258"></span><span>  </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644306"><span class="hs-identifier hs-var">yesStake</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Rational
forall a. Integral a =&gt; a -&gt; a -&gt; Ratio a
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.BaseTypes.NonZero.html#%25%3F"><span class="hs-operator hs-var">%?</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><span class="hs-identifier hs-var">toInteger</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644307"><span class="hs-identifier hs-var">totalExcludingAbstainStake</span></a></span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679644308"><span class="annot"><span class="annottext">accumStake :: (Word64, Word64) -&gt; DRep -&gt; CompactForm Coin -&gt; (Word64, Word64)
</span><a href="#local-6989586621679644308"><span class="hs-identifier hs-var hs-var">accumStake</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span id="local-6989586621679644309"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679644310"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679644311"><span class="annot"><span class="annottext">DRep
</span><a href="#local-6989586621679644311"><span class="hs-identifier hs-var">drep</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#CompactCoin"><span class="hs-identifier hs-type">CompactCoin</span></a></span><span> </span><span id="local-6989586621679644312"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-261"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DRep
</span><a href="#local-6989586621679644311"><span class="hs-identifier hs-var">drep</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.DRep.html#DRepCredential"><span class="hs-identifier hs-type">DRepCredential</span></a></span><span> </span><span id="local-6989586621679644314"><span class="annot"><span class="annottext">Credential 'DRepRole
</span><a href="#local-6989586621679644314"><span class="hs-identifier hs-var">cred</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-263"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential 'DRepRole
-&gt; Map (Credential 'DRepRole) DRepState -&gt; Maybe DRepState
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'DRepRole
</span><a href="#local-6989586621679644314"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole) DRepState
</span><a href="#local-6989586621679644301"><span class="hs-identifier hs-var">reDRepState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-264"></span><span>            </span><span class="annot"><span class="annottext">Maybe DRepState
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- drep is not registered, so we don't consider it</span><span>
</span><span id="line-265"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679644315"><span class="annot"><span class="annottext">DRepState
</span><a href="#local-6989586621679644315"><span class="hs-identifier hs-var">drepState</span></a></span></span><span>
</span><span id="line-266"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644303"><span class="hs-identifier hs-var">reCurrentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">DRepState -&gt; EpochNo
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.DRep.html#drepExpiry"><span class="hs-identifier hs-var">drepExpiry</span></a></span><span> </span><span class="annot"><span class="annottext">DRepState
</span><a href="#local-6989586621679644315"><span class="hs-identifier hs-var">drepState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- drep is expired, so we don't consider it</span><span>
</span><span id="line-267"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-268"></span><span>                  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Credential 'DRepRole
-&gt; Map (Credential 'DRepRole) Vote -&gt; Maybe Vote
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">Credential 'DRepRole
</span><a href="#local-6989586621679644314"><span class="hs-identifier hs-var">cred</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'DRepRole) Vote
</span><a href="#local-6989586621679644304"><span class="hs-identifier hs-var">gasDRepVotes</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-269"></span><span>                    </span><span class="hs-comment">-- drep hasn't voted for this action, so we don't count</span><span>
</span><span id="line-270"></span><span>                    </span><span class="hs-comment">-- the vote but we consider it in the denominator:</span><span>
</span><span id="line-271"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Vote
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#VoteYes"><span class="hs-identifier hs-var">VoteYes</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#Abstain"><span class="hs-identifier hs-var">Abstain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-274"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="annot"><span class="annottext">Vote
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#VoteNo"><span class="hs-identifier hs-var">VoteNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">DRep
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.DRep.html#DRepAlwaysNoConfidence"><span class="hs-identifier hs-var">DRepAlwaysNoConfidence</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644305"><span class="hs-identifier hs-var">govAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#NoConfidence"><span class="hs-identifier hs-type">NoConfidence</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId 'CommitteePurpose)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>            </span><span class="annot"><span class="annottext">GovAction era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Word64 -&gt; Word64
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644312"><span class="hs-identifier hs-var">stake</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">DRep
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.DRep.html#DRepAlwaysAbstain"><span class="hs-identifier hs-var">DRepAlwaysAbstain</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644309"><span class="hs-identifier hs-var">yes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644310"><span class="hs-identifier hs-var">tot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679644306"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644306"><span class="hs-identifier hs-var">yesStake</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644307"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679644307"><span class="hs-identifier hs-var">totalExcludingAbstainStake</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Word64, Word64) -&gt; DRep -&gt; CompactForm Coin -&gt; (Word64, Word64))
-&gt; (Word64, Word64)
-&gt; Map DRep (CompactForm Coin)
-&gt; (Word64, Word64)
forall a k b. (a -&gt; k -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span><span class="hs-identifier hs-var">Map.foldlWithKey'</span></span><span> </span><span class="annot"><span class="annottext">(Word64, Word64) -&gt; DRep -&gt; CompactForm Coin -&gt; (Word64, Word64)
</span><a href="#local-6989586621679644308"><span class="hs-identifier hs-var">accumStake</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map DRep (CompactForm Coin)
</span><a href="#local-6989586621679644299"><span class="hs-identifier hs-var">reDRepDistr</span></a></span><span>
</span><span id="line-281"></span><span>
</span><span id="line-282"></span><span id="local-6989586621679643935"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-type">delayingAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovAction"><span class="hs-identifier hs-type">GovAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643935"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-283"></span><span id="delayingAction"><span class="annot"><span class="annottext">delayingAction :: forall era. GovAction era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var hs-var">delayingAction</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#NoConfidence"><span class="hs-identifier hs-type">NoConfidence</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-284"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var">delayingAction</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#HardForkInitiation"><span class="hs-identifier hs-type">HardForkInitiation</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-285"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var">delayingAction</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#UpdateCommittee"><span class="hs-identifier hs-type">UpdateCommittee</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-286"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var">delayingAction</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#NewConstitution"><span class="hs-identifier hs-type">NewConstitution</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-287"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var">delayingAction</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#TreasuryWithdrawals"><span class="hs-identifier hs-type">TreasuryWithdrawals</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-288"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var">delayingAction</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#ParameterChange"><span class="hs-identifier hs-type">ParameterChange</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-289"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var">delayingAction</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#InfoAction"><span class="hs-identifier hs-type">InfoAction</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span id="local-6989586621679643937"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#withdrawalCanWithdraw"><span class="hs-identifier hs-type">withdrawalCanWithdraw</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovAction"><span class="hs-identifier hs-type">GovAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643937"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-type">Coin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-292"></span><span id="withdrawalCanWithdraw"><span class="annot"><span class="annottext">withdrawalCanWithdraw :: forall era. GovAction era -&gt; Coin -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#withdrawalCanWithdraw"><span class="hs-identifier hs-var hs-var">withdrawalCanWithdraw</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#TreasuryWithdrawals"><span class="hs-identifier hs-type">TreasuryWithdrawals</span></a></span><span> </span><span id="local-6989586621679644330"><span class="annot"><span class="annottext">Map RewardAccount Coin
</span><a href="#local-6989586621679644330"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="annot"><span class="annottext">StrictMaybe ScriptHash
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679644331"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679644331"><span class="hs-identifier hs-var">treasury</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-293"></span><span>  </span><span class="annot"><span class="annottext">(Coin -&gt; Coin -&gt; Coin) -&gt; Coin -&gt; Map RewardAccount Coin -&gt; Coin
forall a b k. (a -&gt; b -&gt; b) -&gt; b -&gt; Map k a -&gt; b
</span><span class="hs-identifier hs-var">Map.foldr'</span></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#%3C%2B%3E"><span class="hs-operator hs-var">(&lt;+&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Val.html#zero"><span class="hs-identifier hs-var">zero</span></a></span><span> </span><span class="annot"><span class="annottext">Map RewardAccount Coin
</span><a href="#local-6989586621679644330"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679644331"><span class="hs-identifier hs-var">treasury</span></a></span><span>
</span><span id="line-294"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#withdrawalCanWithdraw"><span class="hs-identifier hs-var">withdrawalCanWithdraw</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span id="local-6989586621679644335"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#acceptedByEveryone"><span class="hs-identifier hs-type">acceptedByEveryone</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.PParams.html#ConwayEraPParams"><span class="hs-identifier hs-type">ConwayEraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644335"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.State.Account.html#ConwayEraAccounts"><span class="hs-identifier hs-type">ConwayEraAccounts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644335"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644335"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier hs-type">RatifyState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644335"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644335"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-301"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-302"></span><span id="acceptedByEveryone"><span class="annot"><span class="annottext">acceptedByEveryone :: forall era.
(ConwayEraPParams era, ConwayEraAccounts era) =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#acceptedByEveryone"><span class="hs-identifier hs-var hs-var">acceptedByEveryone</span></a></span></span><span> </span><span id="local-6989586621679644342"><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644342"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679644343"><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644343"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679644344"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644344"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="annottext">RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
forall era.
ConwayEraPParams era =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#committeeAccepted"><span class="hs-identifier hs-var">committeeAccepted</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644342"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644343"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644344"><span class="hs-identifier hs-var">gas</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
forall era.
(ConwayEraPParams era, ConwayEraAccounts era) =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#spoAccepted"><span class="hs-identifier hs-var">spoAccepted</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644342"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644343"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644344"><span class="hs-identifier hs-var">gas</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
forall era.
ConwayEraPParams era =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#dRepAccepted"><span class="hs-identifier hs-var">dRepAccepted</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era
</span><a href="#local-6989586621679644342"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644343"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644344"><span class="hs-identifier hs-var">gas</span></a></span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#ratifyTransition"><span class="hs-identifier hs-type">ratifyTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679643831"><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-309"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Embed"><span class="hs-identifier hs-type">Embed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#State"><span class="hs-identifier hs-type">State</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#EnactState"><span class="hs-identifier hs-type">EnactState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-311"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Environment"><span class="hs-identifier hs-type">Environment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Signal"><span class="hs-identifier hs-type">Signal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-operator hs-type">~</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Enact.html#EnactSignal"><span class="hs-identifier hs-type">EnactSignal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-313"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.PParams.html#ConwayEraPParams"><span class="hs-identifier hs-type">ConwayEraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-314"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.State.Account.html#ConwayEraAccounts"><span class="hs-identifier hs-type">ConwayEraAccounts</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-315"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-316"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TransitionRule"><span class="hs-identifier hs-type">TransitionRule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span id="ratifyTransition"><span class="annot"><span class="annottext">ratifyTransition :: forall era.
(Embed (EraRule &quot;ENACT&quot; era) (ConwayRATIFY era),
 State (EraRule &quot;ENACT&quot; era) ~ EnactState era,
 Environment (EraRule &quot;ENACT&quot; era) ~ (),
 Signal (EraRule &quot;ENACT&quot; era) ~ EnactSignal era,
 ConwayEraPParams era, ConwayEraAccounts era) =&gt;
TransitionRule (ConwayRATIFY era)
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#ratifyTransition"><span class="hs-identifier hs-var hs-var">ratifyTransition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-type">TRC</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">(</span><span> </span><span id="local-6989586621679644388"><span class="annot"><span class="annottext">env :: Environment (ConwayRATIFY era)
</span><a href="#local-6989586621679644388"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyEnv"><span class="hs-identifier hs-type">RatifyEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679644389"><span class="annot"><span class="annottext">EpochNo
reCurrentEpoch :: forall era. RatifyEnv era -&gt; EpochNo
reCurrentEpoch :: EpochNo
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#reCurrentEpoch"><span class="hs-identifier hs-var hs-var">reCurrentEpoch</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-320"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644390"><span class="annot"><span class="annottext">st :: State (ConwayRATIFY era)
</span><a href="#local-6989586621679644390"><span class="hs-identifier hs-var">st</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifyState"><span class="hs-identifier hs-type">RatifyState</span></a></span><span>
</span><span id="line-321"></span><span>               </span><span id="local-6989586621679644392"><span class="annot"><span class="annottext">rsEnactState :: EnactState era
</span><a href="#local-6989586621679644392"><span class="hs-identifier hs-var">rsEnactState</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#EnactState"><span class="hs-identifier hs-type">EnactState</span></a></span><span>
</span><span id="line-322"></span><span>                 </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679644394"><span class="annot"><span class="annottext">PParams era
ensCurPParams :: PParams era
ensCurPParams :: forall era. EnactState era -&gt; PParams era
</span><a href="#local-6989586621679644394"><span class="hs-identifier hs-var hs-var">ensCurPParams</span></a></span></span><span>
</span><span id="line-323"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644396"><span class="annot"><span class="annottext">Coin
ensTreasury :: Coin
ensTreasury :: forall era. EnactState era -&gt; Coin
</span><a href="#local-6989586621679644396"><span class="hs-identifier hs-var hs-var">ensTreasury</span></a></span></span><span>
</span><span id="line-324"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644398"><span class="annot"><span class="annottext">GovRelation StrictMaybe
ensPrevGovActionIds :: GovRelation StrictMaybe
ensPrevGovActionIds :: forall era. EnactState era -&gt; GovRelation StrictMaybe
</span><a href="#local-6989586621679644398"><span class="hs-identifier hs-var hs-var">ensPrevGovActionIds</span></a></span></span><span>
</span><span id="line-325"></span><span>                 </span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>               </span><span id="local-6989586621679644400"><span class="annot"><span class="annottext">Seq (GovActionState era)
</span><a href="#local-6989586621679644400"><span class="hs-identifier hs-var">_rsEnacted</span></a></span></span><span>
</span><span id="line-327"></span><span>               </span><span id="local-6989586621679644401"><span class="annot"><span class="annottext">Set GovActionId
</span><a href="#local-6989586621679644401"><span class="hs-identifier hs-var">_rsExpired</span></a></span></span><span>
</span><span id="line-328"></span><span>               </span><span id="local-6989586621679644402"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644402"><span class="hs-identifier hs-var">rsDelayed</span></a></span></span><span>
</span><span id="line-329"></span><span>             </span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifySignal"><span class="hs-identifier hs-type">RatifySignal</span></a></span><span> </span><span id="local-6989586621679644404"><span class="annot"><span class="annottext">StrictSeq (GovActionState era)
</span><a href="#local-6989586621679644404"><span class="hs-identifier hs-var">rsig</span></a></span></span><span>
</span><span id="line-331"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">Rule
  (ConwayRATIFY era)
  'Transition
  (RuleContext 'Transition (ConwayRATIFY era))
F (Clause (ConwayRATIFY era) 'Transition) (TRC (ConwayRATIFY era))
forall sts (rtype :: RuleType).
Rule sts rtype (RuleContext rtype sts)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#judgmentContext"><span class="hs-identifier hs-var">judgmentContext</span></a></span><span>
</span><span id="line-333"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StrictSeq (GovActionState era)
</span><a href="#local-6989586621679644404"><span class="hs-identifier hs-var">rsig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621679644405"><span class="annot"><span class="annottext">gas :: GovActionState era
</span><a href="#local-6989586621679644405"><span class="hs-identifier hs-var">gas</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679644406"><span class="annot"><span class="annottext">GovActionId
gasId :: GovActionId
gasId :: forall era. GovActionState era -&gt; GovActionId
</span><a href="#local-6989586621679644406"><span class="hs-identifier hs-var hs-var">gasId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644408"><span class="annot"><span class="annottext">EpochNo
gasExpiresAfter :: EpochNo
gasExpiresAfter :: forall era. GovActionState era -&gt; EpochNo
</span><a href="#local-6989586621679644408"><span class="hs-identifier hs-var hs-var">gasExpiresAfter</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#%3A%3C%7C"><span class="hs-operator hs-type">SSeq.:&lt;|</span></a></span><span> </span><span id="local-6989586621679644411"><span class="annot"><span class="annottext">StrictSeq (GovActionState era)
</span><a href="#local-6989586621679644411"><span class="hs-identifier hs-var">sigs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679644412"><span class="annot"><span class="annottext">govAction :: GovAction era
</span><a href="#local-6989586621679644412"><span class="hs-identifier hs-var hs-var">govAction</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; GovAction era
forall era. GovActionState era -&gt; GovAction era
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#gasAction"><span class="hs-identifier hs-var">gasAction</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644405"><span class="hs-identifier hs-var">gas</span></a></span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GovActionState era -&gt; GovRelation StrictMaybe -&gt; Bool
forall era. GovActionState era -&gt; GovRelation StrictMaybe -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#prevActionAsExpected"><span class="hs-identifier hs-var">prevActionAsExpected</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644405"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679644398"><span class="hs-identifier hs-var">ensPrevGovActionIds</span></a></span><span>
</span><span id="line-337"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">GovAction era -&gt; PParams era -&gt; EpochNo -&gt; Bool
forall era.
ConwayEraPParams era =&gt;
GovAction era -&gt; PParams era -&gt; EpochNo -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#validCommitteeTerm"><span class="hs-identifier hs-var">validCommitteeTerm</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644412"><span class="hs-identifier hs-var">govAction</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679644394"><span class="hs-identifier hs-var">ensCurPParams</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644389"><span class="hs-identifier hs-var">reCurrentEpoch</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644402"><span class="hs-identifier hs-var">rsDelayed</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">GovAction era -&gt; Coin -&gt; Bool
forall era. GovAction era -&gt; Coin -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#withdrawalCanWithdraw"><span class="hs-identifier hs-var">withdrawalCanWithdraw</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644412"><span class="hs-identifier hs-var">govAction</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679644396"><span class="hs-identifier hs-var">ensTreasury</span></a></span><span>
</span><span id="line-340"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
forall era.
(ConwayEraPParams era, ConwayEraAccounts era) =&gt;
RatifyEnv era -&gt; RatifyState era -&gt; GovActionState era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#acceptedByEveryone"><span class="hs-identifier hs-var">acceptedByEveryone</span></a></span><span> </span><span class="annot"><span class="annottext">Environment (ConwayRATIFY era)
RatifyEnv era
</span><a href="#local-6989586621679644388"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">State (ConwayRATIFY era)
RatifyState era
</span><a href="#local-6989586621679644390"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644405"><span class="hs-identifier hs-var">gas</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-342"></span><span>          </span><span id="local-6989586621679644414"><span class="annot"><span class="annottext">EnactState era
</span><a href="#local-6989586621679644414"><span class="hs-identifier hs-var">newEnactState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-343"></span><span>            </span><span class="annot"><span class="annottext">forall sub super (rtype :: RuleType).
Embed sub super =&gt;
RuleContext rtype sub -&gt; Rule super rtype (State sub)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#trans"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.Era.html#EraRule"><span class="hs-identifier hs-type">EraRule</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;ENACT&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RuleContext 'Transition (EraRule &quot;ENACT&quot; era)
 -&gt; Rule
      (ConwayRATIFY era) 'Transition (State (EraRule &quot;ENACT&quot; era)))
-&gt; RuleContext 'Transition (EraRule &quot;ENACT&quot; era)
-&gt; Rule
     (ConwayRATIFY era) 'Transition (State (EraRule &quot;ENACT&quot; era))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-344"></span><span>              </span><span class="annot"><span class="annottext">(Environment (EraRule &quot;ENACT&quot; era), State (EraRule &quot;ENACT&quot; era),
 Signal (EraRule &quot;ENACT&quot; era))
-&gt; TRC (EraRule &quot;ENACT&quot; era)
forall sts. (Environment sts, State sts, Signal sts) -&gt; TRC sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-var">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;ENACT&quot; era)
EnactState era
</span><a href="#local-6989586621679644392"><span class="hs-identifier hs-var">rsEnactState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GovActionId -&gt; GovAction era -&gt; EnactSignal era
forall era. GovActionId -&gt; GovAction era -&gt; EnactSignal era
</span><a href="Cardano.Ledger.Conway.Rules.Enact.html#EnactSignal"><span class="hs-identifier hs-var">EnactSignal</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679644406"><span class="hs-identifier hs-var">gasId</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644412"><span class="hs-identifier hs-var">govAction</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-346"></span><span>            </span><span id="local-6989586621679644416"><span class="annot"><span class="annottext">st' :: RatifyState era
</span><a href="#local-6989586621679644416"><span class="hs-identifier hs-var hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-347"></span><span>              </span><span class="annot"><span class="annottext">State (ConwayRATIFY era)
RatifyState era
</span><a href="#local-6989586621679644390"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-348"></span><span>                </span><span class="annot"><span class="annottext">RatifyState era
-&gt; (RatifyState era -&gt; RatifyState era) -&gt; RatifyState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EnactState era -&gt; Identity (EnactState era))
-&gt; RatifyState era -&gt; Identity (RatifyState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EnactState era -&gt; f (EnactState era))
-&gt; RatifyState era -&gt; f (RatifyState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsEnactStateL"><span class="hs-identifier hs-var">rsEnactStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((EnactState era -&gt; Identity (EnactState era))
 -&gt; RatifyState era -&gt; Identity (RatifyState era))
-&gt; EnactState era -&gt; RatifyState era -&gt; RatifyState era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">EnactState era
</span><a href="#local-6989586621679644414"><span class="hs-identifier hs-var">newEnactState</span></a></span><span>
</span><span id="line-349"></span><span>                </span><span class="annot"><span class="annottext">RatifyState era
-&gt; (RatifyState era -&gt; RatifyState era) -&gt; RatifyState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Identity Bool)
-&gt; RatifyState era -&gt; Identity (RatifyState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Bool -&gt; f Bool) -&gt; RatifyState era -&gt; f (RatifyState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsDelayedL"><span class="hs-identifier hs-var">rsDelayedL</span></a></span><span> </span><span class="annot"><span class="annottext">((Bool -&gt; Identity Bool)
 -&gt; RatifyState era -&gt; Identity (RatifyState era))
-&gt; Bool -&gt; RatifyState era -&gt; RatifyState era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era -&gt; Bool
forall era. GovAction era -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#delayingAction"><span class="hs-identifier hs-var">delayingAction</span></a></span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644412"><span class="hs-identifier hs-var">govAction</span></a></span><span>
</span><span id="line-350"></span><span>                </span><span class="annot"><span class="annottext">RatifyState era
-&gt; (RatifyState era -&gt; RatifyState era) -&gt; RatifyState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Seq (GovActionState era) -&gt; Identity (Seq (GovActionState era)))
-&gt; RatifyState era -&gt; Identity (RatifyState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Seq (GovActionState era) -&gt; f (Seq (GovActionState era)))
-&gt; RatifyState era -&gt; f (RatifyState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsEnactedL"><span class="hs-identifier hs-var">rsEnactedL</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (GovActionState era) -&gt; Identity (Seq (GovActionState era)))
 -&gt; RatifyState era -&gt; Identity (RatifyState era))
-&gt; (Seq (GovActionState era) -&gt; Seq (GovActionState era))
-&gt; RatifyState era
-&gt; RatifyState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (GovActionState era)
-&gt; GovActionState era -&gt; Seq (GovActionState era)
forall a. Seq a -&gt; a -&gt; Seq a
</span><span class="hs-operator hs-var">Seq.:|&gt;</span></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644405"><span class="hs-identifier hs-var">gas</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>          </span><span class="annot"><span class="annottext">forall sub super (rtype :: RuleType).
Embed sub super =&gt;
RuleContext rtype sub -&gt; Rule super rtype (State sub)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#trans"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RuleContext 'Transition (ConwayRATIFY era)
 -&gt; TransitionRule (ConwayRATIFY era))
-&gt; RuleContext 'Transition (ConwayRATIFY era)
-&gt; TransitionRule (ConwayRATIFY era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Environment (ConwayRATIFY era), State (ConwayRATIFY era),
 Signal (ConwayRATIFY era))
-&gt; TRC (ConwayRATIFY era)
forall sts. (Environment sts, State sts, Signal sts) -&gt; TRC sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-var">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment (ConwayRATIFY era)
</span><a href="#local-6989586621679644388"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State (ConwayRATIFY era)
RatifyState era
</span><a href="#local-6989586621679644416"><span class="hs-identifier hs-var">st'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StrictSeq (GovActionState era) -&gt; RatifySignal era
forall era. StrictSeq (GovActionState era) -&gt; RatifySignal era
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifySignal"><span class="hs-identifier hs-var">RatifySignal</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (GovActionState era)
</span><a href="#local-6989586621679644411"><span class="hs-identifier hs-var">sigs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>          </span><span class="hs-comment">-- This action hasn't been ratified yet. Process the remaining actions.</span><span>
</span><span id="line-354"></span><span>          </span><span id="local-6989586621679644421"><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644421"><span class="hs-identifier hs-var">st'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall sub super (rtype :: RuleType).
Embed sub super =&gt;
RuleContext rtype sub -&gt; Rule super rtype (State sub)
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#trans"><span class="hs-identifier hs-var">trans</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643831"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(RuleContext 'Transition (ConwayRATIFY era)
 -&gt; TransitionRule (ConwayRATIFY era))
-&gt; RuleContext 'Transition (ConwayRATIFY era)
-&gt; TransitionRule (ConwayRATIFY era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Environment (ConwayRATIFY era), State (ConwayRATIFY era),
 Signal (ConwayRATIFY era))
-&gt; TRC (ConwayRATIFY era)
forall sts. (Environment sts, State sts, Signal sts) -&gt; TRC sts
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#TRC"><span class="hs-identifier hs-var">TRC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Environment (ConwayRATIFY era)
</span><a href="#local-6989586621679644388"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">State (ConwayRATIFY era)
</span><a href="#local-6989586621679644390"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">StrictSeq (GovActionState era) -&gt; RatifySignal era
forall era. StrictSeq (GovActionState era) -&gt; RatifySignal era
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#RatifySignal"><span class="hs-identifier hs-var">RatifySignal</span></a></span><span> </span><span class="annot"><span class="annottext">StrictSeq (GovActionState era)
</span><a href="#local-6989586621679644411"><span class="hs-identifier hs-var">sigs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>          </span><span class="hs-comment">-- Finally, filter out actions that have expired.</span><span>
</span><span id="line-356"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644408"><span class="hs-identifier hs-var">gasExpiresAfter</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644389"><span class="hs-identifier hs-var">reCurrentEpoch</span></a></span><span>
</span><span id="line-357"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">RatifyState era
-&gt; F (Clause (ConwayRATIFY era) 'Transition) (RatifyState era)
forall a. a -&gt; F (Clause (ConwayRATIFY era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(RatifyState era
 -&gt; F (Clause (ConwayRATIFY era) 'Transition) (RatifyState era))
-&gt; RatifyState era
-&gt; F (Clause (ConwayRATIFY era) 'Transition) (RatifyState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644421"><span class="hs-identifier hs-var">st'</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
-&gt; (RatifyState era -&gt; RatifyState era) -&gt; RatifyState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(Set GovActionId -&gt; Identity (Set GovActionId))
-&gt; RatifyState era -&gt; Identity (RatifyState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Set GovActionId -&gt; f (Set GovActionId))
-&gt; RatifyState era -&gt; f (RatifyState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsExpiredL"><span class="hs-identifier hs-var">rsExpiredL</span></a></span><span> </span><span class="annot"><span class="annottext">((Set GovActionId -&gt; Identity (Set GovActionId))
 -&gt; RatifyState era -&gt; Identity (RatifyState era))
-&gt; (Set GovActionId -&gt; Set GovActionId)
-&gt; RatifyState era
-&gt; RatifyState era
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%25~"><span class="hs-operator hs-var">%~</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionId -&gt; Set GovActionId -&gt; Set GovActionId
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.insert</span></span><span> </span><span class="annot"><span class="annottext">GovActionId
</span><a href="#local-6989586621679644406"><span class="hs-identifier hs-var">gasId</span></a></span><span>
</span><span id="line-358"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">RatifyState era
-&gt; F (Clause (ConwayRATIFY era) 'Transition) (RatifyState era)
forall a. a -&gt; F (Clause (ConwayRATIFY era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">RatifyState era
</span><a href="#local-6989586621679644421"><span class="hs-identifier hs-var">st'</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span class="annot"><span class="annottext">StrictSeq (GovActionState era)
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Sequence.Strict.html#Empty"><span class="hs-identifier hs-var">SSeq.Empty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RatifyState era
-&gt; F (Clause (ConwayRATIFY era) 'Transition) (RatifyState era)
forall a. a -&gt; F (Clause (ConwayRATIFY era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(RatifyState era
 -&gt; F (Clause (ConwayRATIFY era) 'Transition) (RatifyState era))
-&gt; RatifyState era
-&gt; F (Clause (ConwayRATIFY era) 'Transition) (RatifyState era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">State (ConwayRATIFY era)
RatifyState era
</span><a href="#local-6989586621679644390"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">RatifyState era
-&gt; (RatifyState era -&gt; RatifyState era) -&gt; RatifyState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><span class="hs-operator hs-var">&amp;</span></span><span> </span><span class="annot"><span class="annottext">(EnactState era -&gt; Identity (EnactState era))
-&gt; RatifyState era -&gt; Identity (RatifyState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EnactState era -&gt; f (EnactState era))
-&gt; RatifyState era -&gt; f (RatifyState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#rsEnactStateL"><span class="hs-identifier hs-var">rsEnactStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((EnactState era -&gt; Identity (EnactState era))
 -&gt; RatifyState era -&gt; Identity (RatifyState era))
-&gt; ((Coin -&gt; Identity Coin)
    -&gt; EnactState era -&gt; Identity (EnactState era))
-&gt; (Coin -&gt; Identity Coin)
-&gt; RatifyState era
-&gt; Identity (RatifyState era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Coin -&gt; Identity Coin)
-&gt; EnactState era -&gt; Identity (EnactState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(Coin -&gt; f Coin) -&gt; EnactState era -&gt; f (EnactState era)
</span><a href="Cardano.Ledger.Conway.Governance.Internal.html#ensTreasuryL"><span class="hs-identifier hs-var">ensTreasuryL</span></a></span><span> </span><span class="annot"><span class="annottext">((Coin -&gt; Identity Coin)
 -&gt; RatifyState era -&gt; Identity (RatifyState era))
-&gt; Coin -&gt; RatifyState era -&gt; RatifyState era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#.~"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Coin.html#Coin"><span class="hs-identifier hs-var">Coin</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="hs-comment">-- | Check that the previous governance action id specified in the proposal</span><span>
</span><span id="line-362"></span><span class="hs-comment">-- does match the last one of the same purpose that was enacted.</span><span>
</span><span id="line-363"></span><span id="local-6989586621679643971"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#prevActionAsExpected"><span class="hs-identifier hs-type">prevActionAsExpected</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovActionState"><span class="hs-identifier hs-type">GovActionState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643971"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovRelation"><span class="hs-identifier hs-type">GovRelation</span></a></span><span> </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-strict-containers-0.1.5.0-d2741b9ef9564f4a1a3151d17a0f69b9663f5795dd47dab0bbd6117738fcce96/share/doc/html/src/Data.Maybe.Strict.html#StrictMaybe"><span class="hs-identifier hs-type">StrictMaybe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-364"></span><span id="prevActionAsExpected"><span class="annot"><span class="annottext">prevActionAsExpected :: forall era. GovActionState era -&gt; GovRelation StrictMaybe -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#prevActionAsExpected"><span class="hs-identifier hs-var hs-var">prevActionAsExpected</span></a></span></span><span> </span><span id="local-6989586621679644426"><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644426"><span class="hs-identifier hs-var">gas</span></a></span></span><span> </span><span id="local-6989586621679644427"><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679644427"><span class="hs-identifier hs-var">prevGovActionIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-365"></span><span>  </span><span class="annot"><span class="annottext">GovActionState era
-&gt; Bool
-&gt; (forall {p :: GovActionPurpose}.
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; Bool)
-&gt; Bool
forall era a.
GovActionState era
-&gt; a
-&gt; (forall (p :: GovActionPurpose).
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; a)
-&gt; a
</span><a href="Cardano.Ledger.Conway.Governance.Procedures.html#withGovActionParent"><span class="hs-identifier hs-var">withGovActionParent</span></a></span><span> </span><span class="annot"><span class="annottext">GovActionState era
</span><a href="#local-6989586621679644426"><span class="hs-identifier hs-var">gas</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">((forall {p :: GovActionPurpose}.
  (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
   Functor f2 =&gt;
   (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
   -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
  -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; Bool)
 -&gt; Bool)
-&gt; (forall {p :: GovActionPurpose}.
    (forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
     Functor f2 =&gt;
     (f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
     -&gt; GovRelation f1 -&gt; f2 (GovRelation f1))
    -&gt; StrictMaybe (GovPurposeId p) -&gt; GovPurposeId p -&gt; Bool)
-&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679644433"><span class="annot"><span class="annottext">forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679644433"><span class="hs-identifier hs-var">govRelationL</span></a></span></span><span> </span><span id="local-6989586621679644434"><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679644434"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="annot"><span class="annottext">GovPurposeId p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-366"></span><span>    </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
</span><a href="#local-6989586621679644434"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId p)
-&gt; StrictMaybe (GovPurposeId p) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
</span><a href="#local-6989586621679644427"><span class="hs-identifier hs-var">prevGovActionIds</span></a></span><span> </span><span class="annot"><span class="annottext">GovRelation StrictMaybe
-&gt; Getting
     (StrictMaybe (GovPurposeId p))
     (GovRelation StrictMaybe)
     (StrictMaybe (GovPurposeId p))
-&gt; StrictMaybe (GovPurposeId p)
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (StrictMaybe (GovPurposeId p))
  (GovRelation StrictMaybe)
  (StrictMaybe (GovPurposeId p))
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *).
Functor f2 =&gt;
(f1 (GovPurposeId p) -&gt; f2 (f1 (GovPurposeId p)))
-&gt; GovRelation f1 -&gt; f2 (GovRelation f1)
</span><a href="#local-6989586621679644433"><span class="hs-identifier hs-var">govRelationL</span></a></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span id="local-6989586621679643972"><span class="annot"><a href="Cardano.Ledger.Conway.Rules.Ratify.html#validCommitteeTerm"><span class="hs-identifier hs-type">validCommitteeTerm</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-369"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.PParams.html#ConwayEraPParams"><span class="hs-identifier hs-type">ConwayEraPParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643972"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-370"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#GovAction"><span class="hs-identifier hs-type">GovAction</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643972"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-371"></span><span>  </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.Core.PParams.html#PParams"><span class="hs-identifier hs-type">PParams</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679643972"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-372"></span><span>  </span><span class="annot"><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-373"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-374"></span><span id="validCommitteeTerm"><span class="annot"><span class="annottext">validCommitteeTerm :: forall era.
ConwayEraPParams era =&gt;
GovAction era -&gt; PParams era -&gt; EpochNo -&gt; Bool
</span><a href="Cardano.Ledger.Conway.Rules.Ratify.html#validCommitteeTerm"><span class="hs-identifier hs-var hs-var">validCommitteeTerm</span></a></span></span><span> </span><span id="local-6989586621679644441"><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644441"><span class="hs-identifier hs-var">govAction</span></a></span></span><span> </span><span id="local-6989586621679644442"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679644442"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621679644443"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644443"><span class="hs-identifier hs-var">currentEpoch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-375"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">GovAction era
</span><a href="#local-6989586621679644441"><span class="hs-identifier hs-var">govAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Conway.Governance.Procedures.html#UpdateCommittee"><span class="hs-identifier hs-type">UpdateCommittee</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (GovPurposeId 'CommitteePurpose)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Set (Credential 'ColdCommitteeRole)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679644444"><span class="annot"><span class="annottext">Map (Credential 'ColdCommitteeRole) EpochNo
</span><a href="#local-6989586621679644444"><span class="hs-identifier hs-var">newMembers</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnitInterval
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Map (Credential 'ColdCommitteeRole) EpochNo -&gt; Bool
</span><a href="#local-6989586621679644445"><span class="hs-identifier hs-var">withinMaxTermLength</span></a></span><span> </span><span class="annot"><span class="annottext">Map (Credential 'ColdCommitteeRole) EpochNo
</span><a href="#local-6989586621679644444"><span class="hs-identifier hs-var">newMembers</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="annot"><span class="annottext">GovAction era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-379"></span><span>    </span><span id="local-6989586621679644446"><span class="annot"><span class="annottext">committeeMaxTermLength :: EpochInterval
</span><a href="#local-6989586621679644446"><span class="hs-identifier hs-var hs-var">committeeMaxTermLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679644442"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
-&gt; Getting EpochInterval (PParams era) EpochInterval
-&gt; EpochInterval
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/microlens-0.4.13.1-71c999e1e9d35dc39dc696ab4bf56f0958d34c6f1e240362775e227e5e550787/share/doc/html/src/Lens.Micro.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting EpochInterval (PParams era) EpochInterval
forall era.
ConwayEraPParams era =&gt;
Lens' (PParams era) EpochInterval
Lens' (PParams era) EpochInterval
</span><a href="Cardano.Ledger.Conway.PParams.html#ppCommitteeMaxTermLengthL"><span class="hs-identifier hs-var">ppCommitteeMaxTermLengthL</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span id="local-6989586621679644445"><span class="annot"><span class="annottext">withinMaxTermLength :: Map (Credential 'ColdCommitteeRole) EpochNo -&gt; Bool
</span><a href="#local-6989586621679644445"><span class="hs-identifier hs-var hs-var">withinMaxTermLength</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EpochNo -&gt; Bool)
-&gt; Map (Credential 'ColdCommitteeRole) EpochNo -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochInterval -&gt; EpochNo
</span><a href="file:///home/runner/.local/state/cabal/store/ghc-9.6.7/cardano-slotting-0.2.0.1-cbaa0d455a08b054bafb132b87b34221d87bbbacf98d60661b1ed3cfc20b13c4/share/doc/html/src/Cardano.Slotting.Slot.html#addEpochInterval"><span class="hs-identifier hs-var">addEpochInterval</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679644443"><span class="hs-identifier hs-var">currentEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInterval
</span><a href="#local-6989586621679644446"><span class="hs-identifier hs-var">committeeMaxTermLength</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679644028"><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/cardano-ledger-core-1.19.0.0/doc/html/cardano-ledger-core/src/Cardano.Ledger.State.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644028"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///home/runner/work/cardano-ledger/cardano-ledger/dist-newstyle/build/x86_64-linux/ghc-9.6.7/small-steps-1.1.2.0/doc/html/small-steps/src/Control.State.Transition.Extended.html#Embed"><span class="hs-identifier hs-type">Embed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayENACT"><span class="hs-identifier hs-type">ConwayENACT</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644028"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Conway.Era.html#ConwayRATIFY"><span class="hs-identifier hs-type">ConwayRATIFY</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644028"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-383"></span><span>  </span><span id="local-6989586621679644460"><span class="annot"><span class="annottext">wrapFailed :: PredicateFailure (ConwayENACT era)
-&gt; PredicateFailure (ConwayRATIFY era)
</span><a href="#local-6989586621679644460"><span class="hs-identifier hs-var hs-var hs-var hs-var">wrapFailed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Void -&gt; Void
PredicateFailure (ConwayENACT era)
-&gt; PredicateFailure (ConwayRATIFY era)
forall a. Void -&gt; a
</span><span class="hs-identifier hs-var">absurd</span></span><span>
</span><span id="line-384"></span><span>  </span><span id="local-6989586621679644462"><span class="annot"><span class="annottext">wrapEvent :: Event (ConwayENACT era) -&gt; Event (ConwayRATIFY era)
</span><a href="#local-6989586621679644462"><span class="hs-identifier hs-var hs-var hs-var hs-var">wrapEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Void -&gt; Void
Event (ConwayENACT era) -&gt; Event (ConwayRATIFY era)
forall a. Void -&gt; a
</span><span class="hs-identifier hs-var">absurd</span></span><span>
</span><span id="line-385"></span></pre></body></html>